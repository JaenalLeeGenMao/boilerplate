module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=265)}([function(e,t,r){"use strict";e.exports=r(98)},function(e,t,r){var n=r(102);e.exports=function(e,t,r){var i=null==e?void 0:n(e,t);return void 0===i?r:i}},function(e,t,r){e.exports=r(100)()},function(e,t,r){"use strict";r.d(t,"a",(function(){return o.css}));var n=r(0),i=r.n(n),o=r(30),a=r(2),s=r.n(a),l=r(31),u=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|valueLink|accept|acceptCharset|accessKey|action|allow|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|default|defer|dir|disabled|download|draggable|encType|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|itemProp|itemScope|itemType|itemID|itemRef|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class)|(on[A-Z].*)|((data|aria|x)-.*))$/i,c=Object(l.a)(u.test.bind(u));function d(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var p,f="__EMOTION_THEMING__",h=((p={})[f]=s.a.object,p);function m(e){this.setState({theme:e})}var g=c,y=function(e){return"theme"!==e&&"innerRef"!==e},_=function(){return!0},v=function(e,t){for(var r=2,n=arguments.length;r<n;r++){var i=arguments[r],o=void 0;for(o in i)e(o)&&(t[o]=i[o])}return t};var E=function(e,t){var r=function(n,i){var o,a,s,l;void 0!==i&&(o=i.e,a=i.label,s=i.target,l=n.__emotion_forwardProp&&i.shouldForwardProp?function(e){return n.__emotion_forwardProp(e)&&i.shouldForwardProp(e)}:i.shouldForwardProp);var u=n.__emotion_real===n,c=void 0===o&&u&&n.__emotion_base||n;return"function"!=typeof l&&(l="string"==typeof c&&c.charAt(0)===c.charAt(0).toLowerCase()?g:y),function(){var p=arguments,g=u&&void 0!==n.__emotion_styles?n.__emotion_styles.slice(0):[];if(void 0!==a&&g.push("label:"+a+";"),void 0===o)if(null==p[0]||void 0===p[0].raw)g.push.apply(g,p);else{g.push(p[0][0]);for(var y=p.length,E=1;E<y;E++)g.push(p[E],p[0][E])}else 0;var S=function(r){function n(){return r.apply(this,arguments)||this}d(n,r);var i=n.prototype;return i.componentWillMount=function(){void 0!==this.context[f]&&(this.unsubscribe=this.context[f].subscribe(m.bind(this)))},i.componentWillUnmount=function(){void 0!==this.unsubscribe&&this.context[f].unsubscribe(this.unsubscribe)},i.render=function(){var r=this.props,n=this.state;this.mergedProps=v(_,{},r,{theme:null!==n&&n.theme||r.theme||{}});var i="",a=[];return r.className&&(i+=void 0===o?e.getRegisteredStyles(a,r.className):r.className+" "),i+=void 0===o?e.css.apply(this,g.concat(a)):o,void 0!==s&&(i+=" "+s),t.createElement(c,v(l,{},r,{className:i,ref:r.innerRef}))},n}(t.Component);return S.displayName=void 0!==a?a:"Styled("+("string"==typeof c?c:c.displayName||c.name||"Component")+")",void 0!==n.defaultProps&&(S.defaultProps=n.defaultProps),S.contextTypes=h,S.__emotion_styles=g,S.__emotion_base=c,S.__emotion_real=S,S.__emotion_forwardProp=l,Object.defineProperty(S,"toString",{value:function(){return"."+s}}),S.withComponent=function(e,t){return r(e,void 0!==t?v(_,{},i,t):i).apply(void 0,g)},S}};return r}(o,i.a);t.b=E},function(e,t){(function(){e.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(this)},function(e,t,r){"use strict";r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return d})),r.d(t,"b",(function(){return p})),r.d(t,"a",(function(){return f})),r.d(t,"e",(function(){return h}));var n=r(3);function i(){var e=u(["{\n  display: grid;\n  grid-template-areas:\n    'progressbar progressbar progressbar duration'\n    'bottomleftsection auto bottomrightsection bottomrightsection';\n  grid-template-rows: 1fr 1fr;\n  grid-template-columns: auto 1fr;\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  height: 6em;\n  padding: 1.6em 2em;\n  opacity: 1;\n  background: linear-gradient(to top, rgba(0, 0, 0, 1) 0%, rgba(0, 0, 0, 0) 100%);\n  transition: all 0.3s ease-in;\n  transform: scale(1);\n  transform: translateY(0%);\n  z-index: 102; /* greater than ad-root class and feedback class*/\n\n  &.hide {\n    transform: translateY(50%);\n    opacity: 0;\n  }\n\n  .bottom_left_section {\n    grid-area: bottomleftsection;\n    display: flex;\n    align-items: center;\n  }\n  \n  .bottom_right_section {\n    grid-area: bottomrightsection;\n    display: flex;\n    align-items: center;\n    justify-content: flex-end;\n  }\n  \n  .duration {\n    grid-area: duration;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 4rem;\n    font-weight: 600;\n  }\n  \n  .progress {\n    grid-area: progressbar;\n    display: flex;\n    align-items: center;\n    position: relative;\n    margin: 0 2em 0 0;\n    height: 100%;\n    border-radius: 0.1em;\n    transition: all 0.1s ease-in;\n  }\n  \n  input[type='range']:hover {\n    cursor: pointer;\n  }\n  \n  .progress_wrapper {\n    position: relative;\n    height: 0.25em;\n    width: 100%;\n    border-radius: 0.1em;\n  }\n  \n  .progressbar_dot {\n    position: relative;\n    display: inline-block;\n    top: -0.35em;\n    left: 99%;\n    margin: 0;\n    width: 1.25em;\n    height: 1.25em;\n    border-radius: 50%;\n    background: #1f93ff;\n    opacity: 0;\n  }\n  \n  .progressbar_progress {\n    position: absolute;\n    width: 0%;\n    height: 100%;\n    background: #1f93ff;\n    border-radius: 0.1em;\n    z-index: 2;\n  }\n  \n  .progressbar_progress_buffer {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 0%;\n    height: 100%;\n    background: #cecece;\n    border-radius: 0.1em;\n    z-index: 1;\n  }\n  \n  .progressbar_progress_background {\n    position: relative;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(255, 255, 255, 0.45);\n    border-radius: 0.1em;\n    z-index: 0;\n  }\n  \n  .volume {\n    display: flex;\n  }\n  \n  .volume > .progress {\n    position: relative;\n    width: 10em;\n    height: 100%;\n    margin: auto 0;\n    border-radius: 0.1em;\n    transition: all 0.1s ease-in;\n  }\n  \n  .volume > .progress:hover {\n    cursor: pointer;\n  }\n  \n  .volume > .progress > .progress_wrapper {\n    position: relative;\n    height: 0.25em;\n    width: 100%;\n    border-radius: 0.1em;\n  }\n  \n  .volume > .progress > .progress_wrapper > .progressbar_progress {\n    position: absolute;\n    width: 0%;\n    height: 100%;\n    background: #ffffff;\n    border-radius: 0.1em;\n    z-index: 2;\n  }\n  \n  .volume > .progress > .progress_wrapper > .progressbar_progress > .progressbar_dot {\n    position: relative;\n    display: inline-block;\n    top: -0.4em;\n    left: 90%;\n    margin: 0;\n    width: 1em;\n    height: 1em;\n    border-radius: 50%;\n    background: #ffffff;\n    opacity: 0;\n    cursor: pointer;\n  }\n  \n  .volume > .progress > .progress_wrapper > .progressbar_progress_background {\n    position: relative;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(255, 255, 255, 0.45);\n    border-radius: 0.1em;\n    z-index: 0;\n  }\n  \n  .seek {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    opacity: 0;\n    width: 100%;\n    margin: auto;\n    z-index: 3;\n  }\n  \n  :global(#vpcc-seek-tooltip) {\n    transform: translateX(-75%);\n  }\n  \n  .tooltip {\n    position: absolute;\n    bottom: 2em;\n    left: 0;\n    background: #333333;\n    border-radius: 0.2em;\n    min-width: 4.25em;\n    padding: 0.47em;\n    font-size: 1.2em;\n    opacity: 0;\n    text-align: center;\n    z-index: 5;\n  }\n  \n  /* .tooltip::after {\n    content: '';\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    margin-left: -0.5em;\n    border-width: 0.5em;\n    border-style: solid;\n    border-color: #333333 transparent transparent transparent;\n  } */\n  \n  .progress:hover > .progress_wrapper > .tooltip {\n    opacity: 0.95;\n    cursor: pointer;\n  }\n\n  .subtitle_popup {\n    /* display: grid; */\n    display: none;\n    grid-template-rows: repeat(1, 1fr);\n    grid-gap: 0em;\n    position: relative;\n    transform: translate(calc(-65% - .85em), calc(-100% - 1rem));\n    padding: 1.5em 0;\n    opacity: 0.95;\n    border-radius: 0.3em;\n    background: #262626;\n    transition: all 0.1s ease-in;\n    min-width: 18em;\n    min-height: 6em;\n    text-align: left;\n    z-index: 5;\n  }\n\n  .quality_popup {\n    /* display: grid; */\n    display: none;\n    grid-template-rows: repeat(1, 1fr);\n    grid-gap: 0em;\n    position: relative;\n    transform: translate(calc(-60% - 1em), calc(-100% - 1rem));\n    padding: 1.5em 0;\n    opacity: 0.95;\n    border-radius: 0.3em;\n    background: #262626;\n    transition: all 0.1s ease-in;\n    min-width: 16em;\n    min-height: 6em;\n    text-align: left;\n    z-index: 5;\n  }\n\n  /* .subtitle_popup::after,\n  .quality_popup::after {\n    content: '';\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    margin-left: -0.5em;\n    border-width: 0.5em;\n    border-style: solid;\n    border-color: #333333 transparent transparent transparent;\n  } */\n\n  .subtitle_list,\n  .quality_list {\n    color: #838586;\n    background: transparent;\n    padding: 0.8em 2.8em;\n    font-size: 1.2em;\n    height: 1em;\n  }\n\n  .subtitle_list:hover,\n  .quality_list:hover {\n    cursor: pointer;\n    color: rgba(255, 255, 255, 1);\n    background: #404040;\n  }\n  \n  .subtitle_list.active,\n  .quality_list.active {\n    color: rgba(255, 255, 255, 1);\n    /* background: rgba(255, 255, 255, 0.25); */\n  }\n  \n  .subtitle_title,\n  .quality_title {\n    color: #c1c2c2;\n    font-size: 1.4em;\n    font-weight: 600;\n    background: transparent;\n    padding: 0 2.25em 0.75em;\n    height: 1em;\n  }\n  \n  .subtitle_tick_wrapper,\n  .quality_tick_wrapper {\n    position: absolute;\n    left: 0.6em;\n  }\n  \n  .subtitle_tick_wrapper > div,\n  .quality_tick_wrapper > div {\n    width: 1em;\n    height: 1em;\n  }\n  \n  .live_text:hover {\n    cursor: pointer;\n  }\n  \n  .live_indicator {\n    position: relative;\n    height: 0.5em;\n    width: 0.5em;\n    background: rgba(255, 0, 0, 1);\n    border-radius: 50%;\n    margin: 0 0.4em;\n  }\n  \n  .live_indicator:hover {\n    cursor: pointer;\n  }\n  \n  .live_indicator_beckground {\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n    border: 0.1em solid rgba(255, 0, 0, 1);\n    border-radius: 50%;\n    animation: fadeOutLive 0.8s ease-out infinite;\n  }\n  \n  @keyframes fadeOut {\n    from {\n      opacity: 1;\n      transform: scale(0);\n    }\n  \n    to {\n      opacity: 0;\n      transform: scale(1);\n    }\n  }\n  \n  @keyframes fadeOutLive {\n    from {\n      opacity: 1;\n      transform: scale(1);\n    }\n  \n    to {\n      opacity: 0;\n      transform: scale(2);\n    }\n  }\n  \n}"]);return i=function(){return e},e}function o(){var e=u(["{\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 9.2em;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  transition: all 0.3s ease-in;\n  transform: translateY(25%);\n\n  &.hide {\n    transform: translateY(100%);\n  }\n\n  p {\n    font-size: 1.8em;\n    font-weight: 600;\n    line-height: 1.2;\n    white-space: pre;\n    margin-bottom: 1em;\n    padding: 0.5em;\n    background: rgba(0, 0, 0, 0.6);\n  }\n}"]);return o=function(){return e},e}function a(){var e=u(["{\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 101; /* greater than ad-root class */\n\n  button {\n    min-width: 5em;\n    min-height: 5em;\n    padding: 1rem;\n    background: rgba(0, 0, 0, 0.7);\n    color: white;\n    font-size: 1.8em;\n    font-weight: 600;\n    border: none;\n    outline: none;\n    border-radius: 50%;\n    animation: fadeOut 0.8s ease-out infinite;\n  }\n\n  button.square {\n    border-radius: 0;\n  }\n}"]);return a=function(){return e},e}function s(){var e=u(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  .slider {\n    -webkit-appearance: none !important;\n    width: 100% !important;\n    height: .2em !important;\n    background: rgba(255, 255, 255, 0.45) !important;\n    outline: none !important;\n    opacity: 0.7 !important;\n    -webkit-transition: .2s !important;\n    transition: opacity .2s !important;\n  }\n\n  .slider:hover {\n    opacity: 1 !important;\n  }\n\n  .slider::-webkit-slider-thumb {\n    -webkit-appearance: none !important;\n    appearance: none !important;\n    width: 1em !important;\n    height: 1em !important;\n    background: white !important;\n    border-radius: 50% !important;\n    border: 1px solid #d3d3d3 !important;\n    cursor: pointer !important;\n  }\n\n  .slider::-moz-range-thumb {\n    width: 1em !important;\n    height: 1em !important;\n    background: #4CAF50 !important;\n    background: white !important;\n    border-radius: 50% !important;\n    cursor: pointer;\n  }\n\n  slider::-webkit-slider-runnable-track,\n  slider::-moz-range-progress {\n    color: #13bba4;\n  }\n"]);return s=function(){return e},e}function l(){var e=u(["\n  position: relative;\n  display: inline-block;\n  width: 2.4em;\n  height: 2.4em;\n  margin: 0 0.4em;\n  transition: all 0.2s ease-in-out;\n  overflow: hidden;\n\n  > div.withTooltip {\n    transition: all 0.3s ease-in-out;\n    transform: translate(calc(-30%), calc(-100% - 1em));\n    bottom: auto;\n    left: auto;\n  }\n\n  &:hover {\n    overflow: visible;\n    cursor: pointer;\n\n    > div.withTooltip {\n      opacity: 0.95;\n    }\n  }\n\n  &.disabled:hover {\n    overflow: hidden;\n    cursor: not-allowed !important;\n    opacity: .4;\n\n    > div.withTooltip {\n      opacity: 0;\n    }\n  }\n\n  &.playIcon {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2MxYzJjMjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjc3IDUzNSkiLz48L2NsaXBQYXRoPjwvZGVmcz48ZyBjbGFzcz0iYiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEyNzcgLTUzNSkiPjxwYXRoIGNsYXNzPSJhIiBkPSJNMTEsNDA5LjkxMnYxMy4xNzZhLjk2Mi45NjIsMCwwLDAsMS40NTUuNzgxbDExLjU3OS02LjU4OGEuODg3Ljg4NywwLDAsMCwwLTEuNTYybC0xMS41NzktNi41ODhBLjk2Mi45NjIsMCwwLDAsMTEsNDA5LjkxMloiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEyNzEuNSAxMzAuNSkiLz48L2c+PC9zdmc+);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n  }\n\n  &.playIcon:hover {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2ZmZjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjc3IDUzNSkiLz48L2NsaXBQYXRoPjwvZGVmcz48ZyBjbGFzcz0iYiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEyNzcgLTUzNSkiPjxwYXRoIGNsYXNzPSJhIiBkPSJNMTEsNDA5LjkxMnYxMy4xNzZhLjk2Mi45NjIsMCwwLDAsMS40NTUuNzgxbDExLjU3OS02LjU4OGEuODg3Ljg4NywwLDAsMCwwLTEuNTYybC0xMS41NzktNi41ODhBLjk2Mi45NjIsMCwwLDAsMTEsNDA5LjkxMloiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEyNzEuNSAxMzAuNSkiLz48L2c+PC9zdmc+);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n  }\n\n  &.pauseIcon {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2MxYzJjMjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMzMwIDE1NDUpIi8+PC9jbGlwUGF0aD48L2RlZnM+PGcgY2xhc3M9ImIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMzMwIC0xNTQ1KSI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTMzNi41IDE1NDgpIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjQiIGhlaWdodD0iMTgiIHJ4PSIyIi8+PHJlY3QgY2xhc3M9ImEiIHdpZHRoPSI0IiBoZWlnaHQ9IjE4IiByeD0iMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNykiLz48L2c+PC9nPjwvc3ZnPg==);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n  }\n\n  &.pauseIcon:hover {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2ZmZmZmZjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMzMwIDE1NDUpIi8+PC9jbGlwUGF0aD48L2RlZnM+PGcgY2xhc3M9ImIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMzMwIC0xNTQ1KSI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTMzNi41IDE1NDgpIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjQiIGhlaWdodD0iMTgiIHJ4PSIyIi8+PHJlY3QgY2xhc3M9ImEiIHdpZHRoPSI0IiBoZWlnaHQ9IjE4IiByeD0iMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNykiLz48L2c+PC9nPjwvc3ZnPg==);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n  }\n\n  &.forwardIcon {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2MxYzJjMjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjUwIDUyMikiLz48L2NsaXBQYXRoPjwvZGVmcz48ZyBjbGFzcz0iYiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEyNTAgLTUyMikiPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEyNTQuNSA1MjUpIj48cGF0aCBjbGFzcz0iYSIgZD0iTTE0My43LDQxNC4zOTNhMSwxLDAsMCwwLTEuNjY5LS40MjRoMGEuOTkuOTksMCwwLDAtLjI1Ljk3OSw1LjUsNS41LDAsMSwxLTYuOTUtMy42OTRsLTEuMDM1LDEuMDRhMSwxLDAsMSwwLDEuNDEsMS40MWwyLjU2LTIuNTYuNDQtLjQ0YS45ODcuOTg3LDAsMCwwLDAtMS40MWwtLjEzLS4xMy0yLjg3LTIuODdhMSwxLDAsMSwwLTEuNDEsMS40MWwxLjQsMS40MWE3LjQ5NCw3LjQ5NCwwLDEsMCw4LjUsNS4yNzlaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTI5IC00MDUuOTk3KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNMTQ5LjU4Niw0MTBsLTIuMjkzLDIuMjkzYTEsMSwwLDEsMCwxLjQxNCwxLjQxNGwzLTNhMSwxLDAsMCwwLDAtMS40MTRsLTMtM2ExLDEsMCwxLDAtMS40MTQsMS40MTRaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTM4IC00MDUuOTk5KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNMTM5Ljc0Myw0MjguNjYydi00LjMzOGgtLjU4MmEuNTguNTgsMCwwLDEtLjEzNS4zMi43MTcuNzE3LDAsMCwxLS4zNDQuMiwyLjEsMi4xLDAsMCwxLS42LjA3MXYuNWguNzc1djMuMjQ5WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzMy41NCAtNDE1LjE2MSkiLz48cGF0aCBjbGFzcz0iYSIgZD0iTTE0NC45LDQyNC4yYTEuNTI3LDEuNTI3LDAsMCwwLS44OTEuMjYsMS42NSwxLjY1LDAsMCwwLS41NzkuNzYsMy4yNDIsMy4yNDIsMCwwLDAtLjIsMS4yMjEsMi42NTYsMi42NTYsMCwwLDAsLjQ0MiwxLjY1LDEuNiwxLjYsMCwwLDAsMi40NTksMCwzLjMxMiwzLjMxMiwwLDAsMC0uMDA1LTMuMzEyQTEuNDYyLDEuNDYyLDAsMCwwLDE0NC45LDQyNC4yWm0uNTY3LDMuNGEuNi42LDAsMCwxLS41NjcuMzQ2LjYxMi42MTIsMCwwLDEtLjU3Ni0uMzQ4LDIuNjIzLDIuNjIzLDAsMCwxLS4xODYtMS4xNTgsMi43NTgsMi43NTgsMCwwLDEsLjE4OC0xLjE4OC42MDguNjA4LDAsMCwxLC41NzItLjM2My42LjYsMCwwLDEsLjU2Ny4zNiwyLjgxNSwyLjgxNSwwLDAsMSwuMTgzLDEuMTkxQTIuNywyLjcsMCwwLDEsMTQ1LjQ3LDQyNy42WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzNi4xMTQgLTQxNS4xMDEpIi8+PC9nPjwvZz48L3N2Zz4=);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n\n    > div.withTooltip {\n      width: 6.25em;\n    }\n  }\n\n  &.forwardIcon:hover {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2ZmZjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjUwIDUyMikiLz48L2NsaXBQYXRoPjwvZGVmcz48ZyBjbGFzcz0iYiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEyNTAgLTUyMikiPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEyNTQuNSA1MjUpIj48cGF0aCBjbGFzcz0iYSIgZD0iTTE0My43LDQxNC4zOTNhMSwxLDAsMCwwLTEuNjY5LS40MjRoMGEuOTkuOTksMCwwLDAtLjI1Ljk3OSw1LjUsNS41LDAsMSwxLTYuOTUtMy42OTRsLTEuMDM1LDEuMDRhMSwxLDAsMSwwLDEuNDEsMS40MWwyLjU2LTIuNTYuNDQtLjQ0YS45ODcuOTg3LDAsMCwwLDAtMS40MWwtLjEzLS4xMy0yLjg3LTIuODdhMSwxLDAsMSwwLTEuNDEsMS40MWwxLjQsMS40MWE3LjQ5NCw3LjQ5NCwwLDEsMCw4LjUsNS4yNzlaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTI5IC00MDUuOTk3KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNMTQ5LjU4Niw0MTBsLTIuMjkzLDIuMjkzYTEsMSwwLDEsMCwxLjQxNCwxLjQxNGwzLTNhMSwxLDAsMCwwLDAtMS40MTRsLTMtM2ExLDEsMCwxLDAtMS40MTQsMS40MTRaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTM4IC00MDUuOTk5KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNMTM5Ljc0Myw0MjguNjYydi00LjMzOGgtLjU4MmEuNTguNTgsMCwwLDEtLjEzNS4zMi43MTcuNzE3LDAsMCwxLS4zNDQuMiwyLjEsMi4xLDAsMCwxLS42LjA3MXYuNWguNzc1djMuMjQ5WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzMy41NCAtNDE1LjE2MSkiLz48cGF0aCBjbGFzcz0iYSIgZD0iTTE0NC45LDQyNC4yYTEuNTI3LDEuNTI3LDAsMCwwLS44OTEuMjYsMS42NSwxLjY1LDAsMCwwLS41NzkuNzYsMy4yNDIsMy4yNDIsMCwwLDAtLjIsMS4yMjEsMi42NTYsMi42NTYsMCwwLDAsLjQ0MiwxLjY1LDEuNiwxLjYsMCwwLDAsMi40NTksMCwzLjMxMiwzLjMxMiwwLDAsMC0uMDA1LTMuMzEyQTEuNDYyLDEuNDYyLDAsMCwwLDE0NC45LDQyNC4yWm0uNTY3LDMuNGEuNi42LDAsMCwxLS41NjcuMzQ2LjYxMi42MTIsMCwwLDEtLjU3Ni0uMzQ4LDIuNjIzLDIuNjIzLDAsMCwxLS4xODYtMS4xNTgsMi43NTgsMi43NTgsMCwwLDEsLjE4OC0xLjE4OC42MDguNjA4LDAsMCwxLC41NzItLjM2My42LjYsMCwwLDEsLjU2Ny4zNiwyLjgxNSwyLjgxNSwwLDAsMSwuMTgzLDEuMTkxQTIuNywyLjcsMCwwLDEsMTQ1LjQ3LDQyNy42WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzNi4xMTQgLTQxNS4xMDEpIi8+PC9nPjwvZz48L3N2Zz4=);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n  }\n\n  &.backwardIcon {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2MxYzJjMjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMDI1IDk1MikiLz48L2NsaXBQYXRoPjwvZGVmcz48ZyBjbGFzcz0iYiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIwMjUgLTk1MikiPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIwMjkuNSA5NTQuOTk5KSI+PHBhdGggY2xhc3M9ImEiIGQ9Ik0xOTcuOCw0MDkuMTE0bDEuNC0xLjQxYTEsMSwwLDEsMC0xLjQxLTEuNDFsLTIuODcsMi44Ny0uMTMuMTNhLjk4Ny45ODcsMCwwLDAsMCwxLjQxbC40NC40NCwyLjU2LDIuNTZhMSwxLDAsMCwwLDEuNDEtMS40MWwtMS4wMzUtMS4wNGE1LjUsNS41LDAsMSwxLTYuOTQ5LDMuNjk0Ljk5Ljk5LDAsMCwwLS4yNS0uOTc5aDBhMSwxLDAsMCwwLTEuNjcuNDI0LDcuNSw3LjUsMCwwLDAsNy41NTQsOS42LDcuNSw3LjUsMCwwLDAsLjk0Ni0xNC44NzdaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTg5IC00MDUuOTk3KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNMTk0LjI5Myw0MTMuNzA3YTEsMSwwLDAsMCwxLjQxNC0xLjQxNEwxOTMuNDE0LDQxMGwyLjI5My0yLjI5M2ExLDEsMCwwLDAtMS40MTQtMS40MTRsLTMsM2ExLDEsMCwwLDAsMCwxLjQxNFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xOTAgLTQwNS45OTkpIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0xOTkuNzQzLDQyOC42NjJ2LTQuMzM4aC0uNTgyYS41OC41OCwwLDAsMS0uMTM1LjMyLjcxNi43MTYsMCwwLDEtLjM0NC4yLDIuMSwyLjEsMCwwLDEtLjYuMDcxdi41aC43NzV2My4yNDlaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTkzLjU0MSAtNDE1LjE2MSkiLz48cGF0aCBjbGFzcz0iYSIgZD0iTTIwNC45LDQyOC42NjhhMS40NTksMS40NTksMCwwLDAsMS4yMjctLjU3NCwzLjMxMiwzLjMxMiwwLDAsMC0uMDA1LTMuMzEyLDEuNDYyLDEuNDYyLDAsMCwwLTEuMjIyLS41NzgsMS41MjcsMS41MjcsMCwwLDAtLjg5MS4yNiwxLjY1LDEuNjUsMCwwLDAtLjU3OS43NiwzLjI0MiwzLjI0MiwwLDAsMC0uMiwxLjIyMSwyLjY1NiwyLjY1NiwwLDAsMCwuNDQyLDEuNjVBMS40NjgsMS40NjgsMCwwLDAsMjA0LjksNDI4LjY2OFptLS41NzQtMy40MTFhLjYwOC42MDgsMCwwLDEsLjU3Mi0uMzYzLjYuNiwwLDAsMSwuNTY3LjM2LDIuODE1LDIuODE1LDAsMCwxLC4xODMsMS4xOTEsMi43LDIuNywwLDAsMS0uMTgsMS4xNi42LjYsMCwwLDEtLjU2Ny4zNDYuNjEyLjYxMiwwLDAsMS0uNTc2LS4zNDgsMi42MjMsMi42MjMsMCwwLDEtLjE4Ni0xLjE1OEEyLjc1OCwyLjc1OCwwLDAsMSwyMDQuMzI5LDQyNS4yNTdaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTk2LjExNSAtNDE1LjEwMSkiLz48L2c+PC9nPjwvc3ZnPg==);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n\n    > div.withTooltip {\n      width: 7.25em;\n    }\n  }\n\n  &.backwardIcon:hover {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2ZmZjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMDI1IDk1MikiLz48L2NsaXBQYXRoPjwvZGVmcz48ZyBjbGFzcz0iYiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIwMjUgLTk1MikiPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIwMjkuNSA5NTQuOTk5KSI+PHBhdGggY2xhc3M9ImEiIGQ9Ik0xOTcuOCw0MDkuMTE0bDEuNC0xLjQxYTEsMSwwLDEsMC0xLjQxLTEuNDFsLTIuODcsMi44Ny0uMTMuMTNhLjk4Ny45ODcsMCwwLDAsMCwxLjQxbC40NC40NCwyLjU2LDIuNTZhMSwxLDAsMCwwLDEuNDEtMS40MWwtMS4wMzUtMS4wNGE1LjUsNS41LDAsMSwxLTYuOTQ5LDMuNjk0Ljk5Ljk5LDAsMCwwLS4yNS0uOTc5aDBhMSwxLDAsMCwwLTEuNjcuNDI0LDcuNSw3LjUsMCwwLDAsNy41NTQsOS42LDcuNSw3LjUsMCwwLDAsLjk0Ni0xNC44NzdaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTg5IC00MDUuOTk3KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNMTk0LjI5Myw0MTMuNzA3YTEsMSwwLDAsMCwxLjQxNC0xLjQxNEwxOTMuNDE0LDQxMGwyLjI5My0yLjI5M2ExLDEsMCwwLDAtMS40MTQtMS40MTRsLTMsM2ExLDEsMCwwLDAsMCwxLjQxNFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xOTAgLTQwNS45OTkpIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0xOTkuNzQzLDQyOC42NjJ2LTQuMzM4aC0uNTgyYS41OC41OCwwLDAsMS0uMTM1LjMyLjcxNi43MTYsMCwwLDEtLjM0NC4yLDIuMSwyLjEsMCwwLDEtLjYuMDcxdi41aC43NzV2My4yNDlaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTkzLjU0MSAtNDE1LjE2MSkiLz48cGF0aCBjbGFzcz0iYSIgZD0iTTIwNC45LDQyOC42NjhhMS40NTksMS40NTksMCwwLDAsMS4yMjctLjU3NCwzLjMxMiwzLjMxMiwwLDAsMC0uMDA1LTMuMzEyLDEuNDYyLDEuNDYyLDAsMCwwLTEuMjIyLS41NzgsMS41MjcsMS41MjcsMCwwLDAtLjg5MS4yNiwxLjY1LDEuNjUsMCwwLDAtLjU3OS43NiwzLjI0MiwzLjI0MiwwLDAsMC0uMiwxLjIyMSwyLjY1NiwyLjY1NiwwLDAsMCwuNDQyLDEuNjVBMS40NjgsMS40NjgsMCwwLDAsMjA0LjksNDI4LjY2OFptLS41NzQtMy40MTFhLjYwOC42MDgsMCwwLDEsLjU3Mi0uMzYzLjYuNiwwLDAsMSwuNTY3LjM2LDIuODE1LDIuODE1LDAsMCwxLC4xODMsMS4xOTEsMi43LDIuNywwLDAsMS0uMTgsMS4xNi42LjYsMCwwLDEtLjU2Ny4zNDYuNjEyLjYxMiwwLDAsMS0uNTc2LS4zNDgsMi42MjMsMi42MjMsMCwwLDEtLjE4Ni0xLjE1OEEyLjc1OCwyLjc1OCwwLDAsMSwyMDQuMzI5LDQyNS4yNTdaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTk2LjExNSAtNDE1LjEwMSkiLz48L2c+PC9nPjwvc3ZnPg==);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n  }\n\n  &.upcommingIcon {\n    background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxOCAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMy41IDhMMCAwVjE2TDEzLjUgOFpNMTggMEgxNVYxNkgxOFYwWiIgZmlsbD0iI0MxQzJDMiIvPgo8L3N2Zz4K);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n    width: 1.8em;\n    height: 1.6em;\n\n    > div.withTooltip {\n      width: 10em;\n      transform: translate(calc(-40% - 0.2em), calc(-100% - 1.25em));\n    }\n  }\n\n  &.upcommingIcon:hover {\n    background: url(data:image/svg+xml;charset=utf-8;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxOCAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTMuNSA4TDAgMFYxNkwxMy41IDhaTTE4IDBIMTVWMTZIMThWMFoiIGZpbGw9IiNGRkZGRkYiLz4NCjwvc3ZnPg==);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n  }\n\n  &.muteIcon {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2MxYzJjMjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMzY4IDYwNikiLz48L2NsaXBQYXRoPjwvZGVmcz48ZyBjbGFzcz0iYiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzNjggLTYwNikiPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEzNzEuNDI5IDYwOS40MjkpIj48cGF0aCBjbGFzcz0iYSIgZD0iTTI2NC41MTUsNDA2LjAyOGEuNS41LDAsMCwwLS41MTUuNXYxLjAwNmEuNS41LDAsMCwwLC40NzkuNSw3LDcsMCwwLDEsMCwxMy45NjguNS41LDAsMCwwLS40NzkuNVY0MjMuNWEuNS41LDAsMCwwLC41MTUuNSw5LDksMCwwLDAsMC0xNy45NzFaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjU1IC00MDYuMDI3KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNMjQ4LjMzNCw0MTNIMjQ3YTEsMSwwLDAsMC0xLDF2NmExLDEsMCwwLDAsMSwxaDEuMzMzYTIsMiwwLDAsMSwxLjIuNEwyNTMsNDI0VjQxMGwtMy40NjcsMi42QTIsMiwwLDAsMSwyNDguMzM0LDQxM1oiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yNDYgLTQwOC4wMTQpIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0yNjQuNTY5LDQyNGE0LDQsMCwwLDAsMC03LjkyLjUuNSwwLDAsMC0uNTY5LjVWNDIzLjVBLjUuNSwwLDAsMCwyNjQuNTY5LDQyNFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yNTUgLTQxMS4wNDkpIi8+PC9nPjwvZz48L3N2Zz4=);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n  }\n\n  &.muteIcon:hover {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2ZmZjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMzY4IDYwNikiLz48L2NsaXBQYXRoPjwvZGVmcz48ZyBjbGFzcz0iYiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzNjggLTYwNikiPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEzNzEuNDI5IDYwOS40MjkpIj48cGF0aCBjbGFzcz0iYSIgZD0iTTI2NC41MTUsNDA2LjAyOGEuNS41LDAsMCwwLS41MTUuNXYxLjAwNmEuNS41LDAsMCwwLC40NzkuNSw3LDcsMCwwLDEsMCwxMy45NjguNS41LDAsMCwwLS40NzkuNVY0MjMuNWEuNS41LDAsMCwwLC41MTUuNSw5LDksMCwwLDAsMC0xNy45NzFaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjU1IC00MDYuMDI3KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNMjQ4LjMzNCw0MTNIMjQ3YTEsMSwwLDAsMC0xLDF2NmExLDEsMCwwLDAsMSwxaDEuMzMzYTIsMiwwLDAsMSwxLjIuNEwyNTMsNDI0VjQxMGwtMy40NjcsMi42QTIsMiwwLDAsMSwyNDguMzM0LDQxM1oiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yNDYgLTQwOC4wMTQpIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0yNjQuNTY5LDQyNGE0LDQsMCwwLDAsMC03LjkyLjUuNSwwLDAsMC0uNTY5LjVWNDIzLjVBLjUuNSwwLDAsMCwyNjQuNTY5LDQyNFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yNTUgLTQxMS4wNDkpIi8+PC9nPjwvZz48L3N2Zz4=);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n  }\n\n  &.mutedIcon {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2MxYzJjMjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjYyIDEzNjApIi8+PC9jbGlwUGF0aD48L2RlZnM+PGcgY2xhc3M9ImIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMjYyIC0xMzYwKSI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTI2NSAxMzYzKSI+PHBhdGggY2xhc3M9ImEiIGQ9Ik0yNCwyMi45MTRWMjNhMSwxLDAsMCwxLTEsMWgtLjA4NmExLDEsMCwwLDEtLjcwNy0uMjkzTDYuMjkzLDcuNzkzQTEsMSwwLDAsMSw2LDcuMDg2VjdBMSwxLDAsMCwxLDcsNmguMDg2YTEsMSwwLDAsMSwuNzA3LjI5M0wyMy43MDcsMjIuMjA3QTEsMSwwLDAsMSwyNCwyMi45MTRaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNiAtNikiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIDAuMDE0KSI+PHBhdGggY2xhc3M9ImEiIGQ9Ik0yNi44LDM2Ljg0bDEuNDksMS40OWE4LjksOC45LDAsMCwxLTMuNzcsMS4wNzVBLjUuNSwwLDAsMSwyNCwzOC45di0xYS41LjUsMCwwLDEsLjQ4LS41QTYuOTkzLDYuOTkzLDAsMCwwLDI2LjgsMzYuODRaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTUgLTIxLjQzNCkiLz48cGF0aCBjbGFzcz0iYSIgZD0iTTMzLDE1LjAxNEE4LjksOC45LDAsMCwxLDMxLjkxLDE5LjNsLTEuNDktMS40OWE3LjAwNiw3LjAwNiwwLDAsMC01Ljk0LTkuNzguNS41LDAsMCwxLS40OC0uNXYtMWEuNS41LDAsMCwxLC41MTUtLjVBOSw5LDAsMCwxLDMzLDE1LjAxNFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNSAtNi4wMjkpIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0xOS4yMTUsMTB2MS4zNzVsLS43ODUtLjc4NVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMi4yMTUgLTguMDE0KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNMTMsMjEuNjI1VjI3TDkuNTM1LDI0LjRhMi4wMTIsMi4wMTIsMCwwLDAtMS4yLS40SDdhMSwxLDAsMCwxLTEtMVYxN2ExLDEsMCwwLDEsMS0xaC4zNzVaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNiAtMTEuMDE0KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNMjguMDI1LDIwLjAzNHEwLC4xOC0uMDE1LjM2bC0zLjk2LTMuOTZhLjQ4OC40ODgsMCwwLDEsLjU0NS0uMzZBNCw0LDAsMCwxLDI4LjAyNSwyMC4wMzRaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTUuMDI1IC0xMS4wNDgpIi8+PC9nPjwvZz48L2c+PC9zdmc+);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n\n    > div.withTooltip {\n      width: 6em;\n    }\n  }\n\n  &.mutedIcon:hover {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2ZmZjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjYyIDEzNjApIi8+PC9jbGlwUGF0aD48L2RlZnM+PGcgY2xhc3M9ImIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMjYyIC0xMzYwKSI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTI2NSAxMzYzKSI+PHBhdGggY2xhc3M9ImEiIGQ9Ik0yNCwyMi45MTRWMjNhMSwxLDAsMCwxLTEsMWgtLjA4NmExLDEsMCwwLDEtLjcwNy0uMjkzTDYuMjkzLDcuNzkzQTEsMSwwLDAsMSw2LDcuMDg2VjdBMSwxLDAsMCwxLDcsNmguMDg2YTEsMSwwLDAsMSwuNzA3LjI5M0wyMy43MDcsMjIuMjA3QTEsMSwwLDAsMSwyNCwyMi45MTRaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNiAtNikiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIDAuMDE0KSI+PHBhdGggY2xhc3M9ImEiIGQ9Ik0yNi44LDM2Ljg0bDEuNDksMS40OWE4LjksOC45LDAsMCwxLTMuNzcsMS4wNzVBLjUuNSwwLDAsMSwyNCwzOC45di0xYS41LjUsMCwwLDEsLjQ4LS41QTYuOTkzLDYuOTkzLDAsMCwwLDI2LjgsMzYuODRaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTUgLTIxLjQzNCkiLz48cGF0aCBjbGFzcz0iYSIgZD0iTTMzLDE1LjAxNEE4LjksOC45LDAsMCwxLDMxLjkxLDE5LjNsLTEuNDktMS40OWE3LjAwNiw3LjAwNiwwLDAsMC01Ljk0LTkuNzguNS41LDAsMCwxLS40OC0uNXYtMWEuNS41LDAsMCwxLC41MTUtLjVBOSw5LDAsMCwxLDMzLDE1LjAxNFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNSAtNi4wMjkpIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0xOS4yMTUsMTB2MS4zNzVsLS43ODUtLjc4NVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMi4yMTUgLTguMDE0KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNMTMsMjEuNjI1VjI3TDkuNTM1LDI0LjRhMi4wMTIsMi4wMTIsMCwwLDAtMS4yLS40SDdhMSwxLDAsMCwxLTEtMVYxN2ExLDEsMCwwLDEsMS0xaC4zNzVaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNiAtMTEuMDE0KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNMjguMDI1LDIwLjAzNHEwLC4xOC0uMDE1LjM2bC0zLjk2LTMuOTZhLjQ4OC40ODgsMCwwLDEsLjU0NS0uMzZBNCw0LDAsMCwxLDI4LjAyNSwyMC4wMzRaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTUuMDI1IC0xMS4wNDgpIi8+PC9nPjwvZz48L2c+PC9zdmc+);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n  }\n\n  &.gearIcon {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2MxYzJjMjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMTM4IDgxMikiLz48L2NsaXBQYXRoPjwvZGVmcz48ZyBjbGFzcz0iYiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIxMzggLTgxMikiPjxwYXRoIGNsYXNzPSJhIiBkPSJNNjg0LDQxNi43MzJ2LTEuNDYzYS44ODkuODg5LDAsMCwwLS41NTktLjgyNmwtMS4wMjgtLjQxMWEuODg5Ljg4OSwwLDAsMS0uNDg3LTEuMTc1bC40MzYtMS4wMThhLjg4OC44ODgsMCwwLDAtLjE4OC0uOTc4bC0xLjAzNC0xLjAzNWEuODg4Ljg4OCwwLDAsMC0uOTc5LS4xODhsLTEuMDE4LjQzNmEuODg5Ljg4OSwwLDAsMS0xLjE3NS0uNDg3bC0uNDExLTEuMDI3YS44ODkuODg5LDAsMCwwLS44MjYtLjU1OWgtMS40NjNhLjg4OS44ODksMCwwLDAtLjgyNi41NTlsLS40MTEsMS4wMjdhLjg4OS44ODksMCwwLDEtMS4xNzUuNDg3bC0xLjAxOC0uNDM2YS44ODguODg4LDAsMCwwLS45NzkuMTg4bC0xLjAzNCwxLjAzNWEuODg4Ljg4OCwwLDAsMC0uMTg4Ljk3OGwuNDM2LDEuMDE4YS44ODkuODg5LDAsMCwxLS40ODcsMS4xNzVsLTEuMDI4LjQxMWEuODg5Ljg4OSwwLDAsMC0uNTU5LjgyNnYxLjQ2M2EuODg5Ljg4OSwwLDAsMCwuNTU5LjgyNmwxLjAyOC40MTFhLjg4OS44ODksMCwwLDEsLjQ4NywxLjE3NWwtLjQzNiwxLjAxOGEuODg4Ljg4OCwwLDAsMCwuMTg4Ljk3OGwxLjAzNCwxLjAzNWEuODg4Ljg4OCwwLDAsMCwuOTc5LjE4OGwxLjAxOC0uNDM2YS44ODkuODg5LDAsMCwxLDEuMTc1LjQ4N2wuNDExLDEuMDI3YS44ODkuODg5LDAsMCwwLC44MjYuNTU5aDEuNDYzYS44ODkuODg5LDAsMCwwLC44MjYtLjU1OWwuNDExLTEuMDI3YS44ODkuODg5LDAsMCwxLDEuMTc1LS40ODdsMS4wMTguNDM2YS44ODguODg4LDAsMCwwLC45NzktLjE4OGwxLjAzNC0xLjAzNWEuODg4Ljg4OCwwLDAsMCwuMTg4LS45NzhsLS40MzYtMS4wMThhLjg4OS44ODksMCwwLDEsLjQ4Ny0xLjE3NWwxLjAyOC0uNDExQS44ODkuODg5LDAsMCwwLDY4NCw0MTYuNzMyWk02NzYsNDIwYTQsNCwwLDEsMSw0LTRBNCw0LDAsMCwxLDY3Niw0MjBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNDc0IDQwOCkiLz48L2c+PC9zdmc+);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n    overflow: visible;\n  }\n\n  &.gearIcon:hover {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2ZmZjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMTM4IDgxMikiLz48L2NsaXBQYXRoPjwvZGVmcz48ZyBjbGFzcz0iYiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIxMzggLTgxMikiPjxwYXRoIGNsYXNzPSJhIiBkPSJNNjg0LDQxNi43MzJ2LTEuNDYzYS44ODkuODg5LDAsMCwwLS41NTktLjgyNmwtMS4wMjgtLjQxMWEuODg5Ljg4OSwwLDAsMS0uNDg3LTEuMTc1bC40MzYtMS4wMThhLjg4OC44ODgsMCwwLDAtLjE4OC0uOTc4bC0xLjAzNC0xLjAzNWEuODg4Ljg4OCwwLDAsMC0uOTc5LS4xODhsLTEuMDE4LjQzNmEuODg5Ljg4OSwwLDAsMS0xLjE3NS0uNDg3bC0uNDExLTEuMDI3YS44ODkuODg5LDAsMCwwLS44MjYtLjU1OWgtMS40NjNhLjg4OS44ODksMCwwLDAtLjgyNi41NTlsLS40MTEsMS4wMjdhLjg4OS44ODksMCwwLDEtMS4xNzUuNDg3bC0xLjAxOC0uNDM2YS44ODguODg4LDAsMCwwLS45NzkuMTg4bC0xLjAzNCwxLjAzNWEuODg4Ljg4OCwwLDAsMC0uMTg4Ljk3OGwuNDM2LDEuMDE4YS44ODkuODg5LDAsMCwxLS40ODcsMS4xNzVsLTEuMDI4LjQxMWEuODg5Ljg4OSwwLDAsMC0uNTU5LjgyNnYxLjQ2M2EuODg5Ljg4OSwwLDAsMCwuNTU5LjgyNmwxLjAyOC40MTFhLjg4OS44ODksMCwwLDEsLjQ4NywxLjE3NWwtLjQzNiwxLjAxOGEuODg4Ljg4OCwwLDAsMCwuMTg4Ljk3OGwxLjAzNCwxLjAzNWEuODg4Ljg4OCwwLDAsMCwuOTc5LjE4OGwxLjAxOC0uNDM2YS44ODkuODg5LDAsMCwxLDEuMTc1LjQ4N2wuNDExLDEuMDI3YS44ODkuODg5LDAsMCwwLC44MjYuNTU5aDEuNDYzYS44ODkuODg5LDAsMCwwLC44MjYtLjU1OWwuNDExLTEuMDI3YS44ODkuODg5LDAsMCwxLDEuMTc1LS40ODdsMS4wMTguNDM2YS44ODguODg4LDAsMCwwLC45NzktLjE4OGwxLjAzNC0xLjAzNWEuODg4Ljg4OCwwLDAsMCwuMTg4LS45NzhsLS40MzYtMS4wMThhLjg4OS44ODksMCwwLDEsLjQ4Ny0xLjE3NWwxLjAyOC0uNDExQS44ODkuODg5LDAsMCwwLDY4NCw0MTYuNzMyWk02NzYsNDIwYTQsNCwwLDEsMSw0LTRBNCw0LDAsMCwxLDY3Niw0MjBaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNDc0IDQwOCkiLz48L2c+PC9zdmc+);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n    overflow: visible;\n  }\n\n  &.chatIcon {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2MxYzJjMjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMTU1IDgwMikiLz48L2NsaXBQYXRoPjwvZGVmcz48ZyBjbGFzcz0iYiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIxNTUgLTgwMikiPjxwYXRoIGNsYXNzPSJhIiBkPSJNNjIzLDQwOEg2MDdhMSwxLDAsMCwwLTEsMXYxMWExLDEsMCwwLDAsMSwxaDhhLjUuNSwwLDAsMSwuNS41VjQyNGw1LjI3Ni0yLjg3OGExLDEsMCwwLDEsLjQ3OS0uMTIySDYyM2ExLDEsMCwwLDAsMS0xVjQwOUExLDEsMCwwLDAsNjIzLDQwOFptLTcsOS41aC03di0yaDdabTUtNC41SDYwOXYtMmgxMloiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE1NTIgMzk4KSIvPjwvZz48L3N2Zz4=);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n    overflow: visible;\n  }\n\n  &.chatIcon:hover {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2ZmZjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMTU1IDgwMikiLz48L2NsaXBQYXRoPjwvZGVmcz48ZyBjbGFzcz0iYiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIxNTUgLTgwMikiPjxwYXRoIGNsYXNzPSJhIiBkPSJNNjIzLDQwOEg2MDdhMSwxLDAsMCwwLTEsMXYxMWExLDEsMCwwLDAsMSwxaDhhLjUuNSwwLDAsMSwuNS41VjQyNGw1LjI3Ni0yLjg3OGExLDEsMCwwLDEsLjQ3OS0uMTIySDYyM2ExLDEsMCwwLDAsMS0xVjQwOUExLDEsMCwwLDAsNjIzLDQwOFptLTcsOS41aC03di0yaDdabTUtNC41SDYwOXYtMmgxMloiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE1NTIgMzk4KSIvPjwvZz48L3N2Zz4=);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n    overflow: visible;\n  }\n\n  &.enterFullscreenIcon {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5hLC5je2ZpbGw6I2MxYzJjMjt9LmF7c3Ryb2tlOiM3MDcwNzA7fS5ie2NsaXAtcGF0aDp1cmwoI2EpO308L3N0eWxlPjxjbGlwUGF0aCBpZD0iYSI+PHJlY3QgY2xhc3M9ImEiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjM2NiA3NjkpIi8+PC9jbGlwUGF0aD48L2RlZnM+PGcgY2xhc3M9ImIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yMzY2IC03NjkpIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMzY5IDc3MykiPjxwYXRoIGNsYXNzPSJjIiBkPSJNNDg2LDQwOHY1LjVoMlY0MTBoNXYtMmgtN1oiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC00ODYgLTQwOCkiLz48cGF0aCBjbGFzcz0iYyIgZD0iTTUxMyw0MDhoLTV2Mmg1djMuNWgyVjQwOFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC00OTcgLTQwOCkiLz48cGF0aCBjbGFzcz0iYyIgZD0iTTUxMyw0MzIuNWgtNXYyaDdWNDI5aC0yWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTQ5NyAtNDE4LjUpIi8+PHBhdGggY2xhc3M9ImMiIGQ9Ik00ODgsNDI5aC0ydjUuNWg3di0yaC01WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTQ4NiAtNDE4LjUpIi8+PC9nPjwvZz48L3N2Zz4=);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n\n    > div.withTooltip {\n      width: 9.5em;\n      transform: translate(calc(-65% - 0.2em), calc(-100% - 1em));\n    }\n  }\n\n  &.enterFullscreenIcon:hover {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5hLC5je2ZpbGw6I2ZmZjt9LmF7c3Ryb2tlOiM3MDcwNzA7fS5ie2NsaXAtcGF0aDp1cmwoI2EpO308L3N0eWxlPjxjbGlwUGF0aCBpZD0iYSI+PHJlY3QgY2xhc3M9ImEiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjM2NiA3NjkpIi8+PC9jbGlwUGF0aD48L2RlZnM+PGcgY2xhc3M9ImIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yMzY2IC03NjkpIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMzY5IDc3MykiPjxwYXRoIGNsYXNzPSJjIiBkPSJNNDg2LDQwOHY1LjVoMlY0MTBoNXYtMmgtN1oiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC00ODYgLTQwOCkiLz48cGF0aCBjbGFzcz0iYyIgZD0iTTUxMyw0MDhoLTV2Mmg1djMuNWgyVjQwOFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC00OTcgLTQwOCkiLz48cGF0aCBjbGFzcz0iYyIgZD0iTTUxMyw0MzIuNWgtNXYyaDdWNDI5aC0yWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTQ5NyAtNDE4LjUpIi8+PHBhdGggY2xhc3M9ImMiIGQ9Ik00ODgsNDI5aC0ydjUuNWg3di0yaC01WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTQ4NiAtNDE4LjUpIi8+PC9nPjwvZz48L3N2Zz4=);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n  }\n\n  &.exitFullscreenIcon {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2MxYzJjMjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNjc1IDMyNTMpIi8+PC9jbGlwUGF0aD48L2RlZnM+PGcgY2xhc3M9ImIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yNjc1IC0zMjUzKSI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjY3OCAzMjU3KSI+PHBhdGggY2xhc3M9ImEiIGQ9Ik01NTMsNDEzLjVWNDA4aC0ydjMuNWgtNXYyaDdaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNTQ2IC00MDgpIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik01NzAsNDEzLjVoNXYtMmgtNVY0MDhoLTJ2NS41WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTU1NyAtNDA4KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNNTcwLDQzMWg1di0yaC03djUuNWgyWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTU1NyAtNDE4LjUpIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik01NTEsNDM0LjVoMlY0MjloLTd2Mmg1WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTU0NiAtNDE4LjUpIi8+PC9nPjwvZz48L3N2Zz4=);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n\n    > div.withTooltip {\n      width: 9.5em;\n      transform: translate(calc(-65% - 0.2em), calc(-100% - 1em));\n    }\n  }\n\n  &.exitFullscreenIcon:hover {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6I2ZmZmZmZjt9LmJ7Y2xpcC1wYXRoOnVybCgjYSk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNjc1IDMyNTMpIi8+PC9jbGlwUGF0aD48L2RlZnM+PGcgY2xhc3M9ImIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yNjc1IC0zMjUzKSI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjY3OCAzMjU3KSI+PHBhdGggY2xhc3M9ImEiIGQ9Ik01NTMsNDEzLjVWNDA4aC0ydjMuNWgtNXYyaDdaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNTQ2IC00MDgpIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik01NzAsNDEzLjVoNXYtMmgtNVY0MDhoLTJ2NS41WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTU1NyAtNDA4KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNNTcwLDQzMWg1di0yaC03djUuNWgyWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTU1NyAtNDE4LjUpIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik01NTEsNDM0LjVoMlY0MjloLTd2Mmg1WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTU0NiAtNDE4LjUpIi8+PC9nPjwvZz48L3N2Zz4=);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n  }\n\n  &.tickIcon {\n    background: url(data:image/svg+xml;charset=utf-8;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9Ii0xOCAtNDgwIDI0MDAgMjQwMCIgY2xhc3M9InN2Zy1pY29uIG9wdC1pdGVtLWN1ci1wb2ludGVyIHJlcGxhY2VkLXN2ZyI+DQogIDxnIHRyYW5zZm9ybT0ibWF0cml4KDEgMCAwIC0xIDAgMTkyMCkiPg0KICAgPHBhdGggZmlsbD0iI2ZmZmZmZiIgZD0iTTc4MyAyNTUuMTNsLTMyNC42MzIgMzI0LjYzMWMtMTkuNSAxOS40NDA0IC01MS4zNzk5IDUxLjI1IC03MC42ODk1IDcwLjY5MDRsLTM5MC42OSAzOTAuNzVjLTkuNSA5LjY2MDE2IC0xNC4yNSAyMi40NDA0IC0xNC4yNSAzNS4yNXM0Ljc1IDI1LjY0OTQgMTQuMjUgMzUuNDM5NWwzMjQuNjkgMzI0LjYyYzkuNzUgOS43MTk3MyAyMi41ODk4IDE0LjU4MDEgMzUuNDEwMiAxNC41ODAxczI1LjYyMDEgLTQuODYwMzUgMzUuMjgwMyAtMTQuNTgwMSBsMzkwLjYzIC0zOTAuNjJjOS43ODAyNyAtOS43MTk3MyAyMi42MjAxIC0xNC41ODAxIDM1LjQyOTcgLTE0LjU4MDFzMjUuNTg5OCA0Ljg2MDM1IDM1LjI1IDE0LjU4MDFsMTA0OS40MyAxMDQ5LjE4YzkuNzAwMiA5Ljc1OTc3IDIyLjYxMDQgMTQuNjQ5NCAzNS41MzAzIDE0LjY0OTRjMTIuODIwMyAwIDI1LjY1MDQgLTQuODA5NTcgMzUuMzYwNCAtMTQuNDZsMzI2Ljc1IC0zMjIuMjUgYzkuOTI5NjkgLTkuNzA5OTYgMTQuODcwMSAtMjIuNTQ5OCAxNC44NzAxIC0zNS4zOTk0YzAgLTEyLjcwMDIgLTQuODMwMDggLTI1LjQxMDIgLTE0LjQyOTcgLTM1LjEwMDZsLTE0NDcuNSAtMTQ0Ny4zOGMtOS43NSAtOS43MTk3MyAtMjIuNTgwMSAtMTQuNTgwMSAtMzUuMzg5NiAtMTQuNTgwMXMtMjUuNjA5NCA0Ljg2MDM1IC0zNS4yOTk4IDE0LjU4MDF6Ij48L3BhdGg+DQogIDwvZz4NCg0KPC9zdmc+);\n    background-repeat: no-repeat;\n    background-size: contain;\n    vertical-align: middle;\n  }\n"]);return l=function(){return e},e}function u(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var c=Object(n.b)("div")(l()),d=Object(n.b)("div")(s()),p=Object(n.b)("div")(a()),f=Object(n.b)("div")(o()),h=Object(n.a)(i())},function(e,t,r){"use strict";var n=r(64),i=Object.prototype.toString;function o(e){return"[object Array]"===i.call(e)}function a(e){return void 0===e}function s(e){return null!==e&&"object"==typeof e}function l(e){return"[object Function]"===i.call(e)}function u(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),o(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:o,isArrayBuffer:function(e){return"[object ArrayBuffer]"===i.call(e)},isBuffer:function(e){return null!==e&&!a(e)&&null!==e.constructor&&!a(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:s,isUndefined:a,isDate:function(e){return"[object Date]"===i.call(e)},isFile:function(e){return"[object File]"===i.call(e)},isBlob:function(e){return"[object Blob]"===i.call(e)},isFunction:l,isStream:function(e){return s(e)&&l(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:u,merge:function e(){var t={};function r(r,n){"object"==typeof t[n]&&"object"==typeof r?t[n]=e(t[n],r):t[n]=r}for(var n=0,i=arguments.length;n<i;n++)u(arguments[n],r);return t},deepMerge:function e(){var t={};function r(r,n){"object"==typeof t[n]&&"object"==typeof r?t[n]=e(t[n],r):t[n]="object"==typeof r?e({},r):r}for(var n=0,i=arguments.length;n<i;n++)u(arguments[n],r);return t},extend:function(e,t,r){return u(t,(function(t,i){e[i]=r&&"function"==typeof t?n(t,r):t})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t,r){(function(){var t,n,i,o,a,s,l,u,c,d,p,f,h,m,g,y,_,v={}.hasOwnProperty;_=r(11),y=_.isObject,g=_.isFunction,m=_.isEmpty,h=_.getValue,u=null,i=null,o=null,a=null,s=null,p=null,f=null,d=null,l=null,n=null,c=null,t=null,e.exports=function(){function e(e){this.parent=e,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,u||(u=r(38),i=r(40),o=r(41),a=r(42),s=r(43),p=r(48),f=r(49),d=r(50),l=r(75),n=r(4),c=r(164),r(39),t=r(165))}return Object.defineProperty(e.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(e.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(e.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(e.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(e.prototype,"childNodes",{get:function(){return this.childNodeList&&this.childNodeList.nodes||(this.childNodeList=new c(this.children)),this.childNodeList}}),Object.defineProperty(e.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(e.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(e.prototype,"previousSibling",{get:function(){var e;return e=this.parent.children.indexOf(this),this.parent.children[e-1]||null}}),Object.defineProperty(e.prototype,"nextSibling",{get:function(){var e;return e=this.parent.children.indexOf(this),this.parent.children[e+1]||null}}),Object.defineProperty(e.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(e.prototype,"textContent",{get:function(){var e,t,r,i,o;if(this.nodeType===n.Element||this.nodeType===n.DocumentFragment){for(o="",t=0,r=(i=this.children).length;t<r;t++)(e=i[t]).textContent&&(o+=e.textContent);return o}return null},set:function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),e.prototype.setParent=function(e){var t,r,n,i,o;for(this.parent=e,e&&(this.options=e.options,this.stringify=e.stringify),o=[],r=0,n=(i=this.children).length;r<n;r++)t=i[r],o.push(t.setParent(this));return o},e.prototype.element=function(e,t,r){var n,i,o,a,s,l,u,c,d,p,f;if(l=null,null===t&&null==r&&(t=(d=[{},null])[0],r=d[1]),null==t&&(t={}),t=h(t),y(t)||(r=(p=[t,r])[0],t=p[1]),null!=e&&(e=h(e)),Array.isArray(e))for(o=0,u=e.length;o<u;o++)i=e[o],l=this.element(i);else if(g(e))l=this.element(e.apply());else if(y(e)){for(s in e)if(v.call(e,s))if(f=e[s],g(f)&&(f=f.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===s.indexOf(this.stringify.convertAttKey))l=this.attribute(s.substr(this.stringify.convertAttKey.length),f);else if(!this.options.separateArrayItems&&Array.isArray(f)&&m(f))l=this.dummy();else if(y(f)&&m(f))l=this.element(s);else if(this.options.keepNullNodes||null!=f)if(!this.options.separateArrayItems&&Array.isArray(f))for(a=0,c=f.length;a<c;a++)i=f[a],(n={})[s]=i,l=this.element(n);else y(f)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===s.indexOf(this.stringify.convertTextKey)?l=this.element(f):(l=this.element(s)).element(f):l=this.element(s,f);else l=this.dummy()}else l=this.options.keepNullNodes||null!==r?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===e.indexOf(this.stringify.convertTextKey)?this.text(r):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===e.indexOf(this.stringify.convertCDataKey)?this.cdata(r):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===e.indexOf(this.stringify.convertCommentKey)?this.comment(r):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===e.indexOf(this.stringify.convertRawKey)?this.raw(r):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===e.indexOf(this.stringify.convertPIKey)?this.instruction(e.substr(this.stringify.convertPIKey.length),r):this.node(e,t,r):this.dummy();if(null==l)throw new Error("Could not create any elements with: "+e+". "+this.debugInfo());return l},e.prototype.insertBefore=function(e,t,r){var n,i,o,a,s;if(null!=e?e.type:void 0)return a=t,(o=e).setParent(this),a?(i=children.indexOf(a),s=children.splice(i),children.push(o),Array.prototype.push.apply(children,s)):children.push(o),o;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(e));return i=this.parent.children.indexOf(this),s=this.parent.children.splice(i),n=this.parent.element(e,t,r),Array.prototype.push.apply(this.parent.children,s),n},e.prototype.insertAfter=function(e,t,r){var n,i,o;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(e));return i=this.parent.children.indexOf(this),o=this.parent.children.splice(i+1),n=this.parent.element(e,t,r),Array.prototype.push.apply(this.parent.children,o),n},e.prototype.remove=function(){var e;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return e=this.parent.children.indexOf(this),[].splice.apply(this.parent.children,[e,e-e+1].concat([])),this.parent},e.prototype.node=function(e,t,r){var n,i;return null!=e&&(e=h(e)),t||(t={}),t=h(t),y(t)||(r=(i=[t,r])[0],t=i[1]),n=new u(this,e,t),null!=r&&n.text(r),this.children.push(n),n},e.prototype.text=function(e){var t;return y(e)&&this.element(e),t=new f(this,e),this.children.push(t),this},e.prototype.cdata=function(e){var t;return t=new i(this,e),this.children.push(t),this},e.prototype.comment=function(e){var t;return t=new o(this,e),this.children.push(t),this},e.prototype.commentBefore=function(e){var t,r;return t=this.parent.children.indexOf(this),r=this.parent.children.splice(t),this.parent.comment(e),Array.prototype.push.apply(this.parent.children,r),this},e.prototype.commentAfter=function(e){var t,r;return t=this.parent.children.indexOf(this),r=this.parent.children.splice(t+1),this.parent.comment(e),Array.prototype.push.apply(this.parent.children,r),this},e.prototype.raw=function(e){var t;return t=new p(this,e),this.children.push(t),this},e.prototype.dummy=function(){return new l(this)},e.prototype.instruction=function(e,t){var r,n,i,o,a;if(null!=e&&(e=h(e)),null!=t&&(t=h(t)),Array.isArray(e))for(o=0,a=e.length;o<a;o++)r=e[o],this.instruction(r);else if(y(e))for(r in e)v.call(e,r)&&(n=e[r],this.instruction(r,n));else g(t)&&(t=t.apply()),i=new d(this,e,t),this.children.push(i);return this},e.prototype.instructionBefore=function(e,t){var r,n;return r=this.parent.children.indexOf(this),n=this.parent.children.splice(r),this.parent.instruction(e,t),Array.prototype.push.apply(this.parent.children,n),this},e.prototype.instructionAfter=function(e,t){var r,n;return r=this.parent.children.indexOf(this),n=this.parent.children.splice(r+1),this.parent.instruction(e,t),Array.prototype.push.apply(this.parent.children,n),this},e.prototype.declaration=function(e,t,r){var i,o;return i=this.document(),o=new a(i,e,t,r),0===i.children.length?i.children.unshift(o):i.children[0].type===n.Declaration?i.children[0]=o:i.children.unshift(o),i.root()||i},e.prototype.dtd=function(e,t){var r,i,o,a,l,u,c,d,p;for(r=this.document(),i=new s(r,e,t),o=a=0,u=(d=r.children).length;a<u;o=++a)if(d[o].type===n.DocType)return r.children[o]=i,i;for(o=l=0,c=(p=r.children).length;l<c;o=++l)if(p[o].isRoot)return r.children.splice(o,0,i),i;return r.children.push(i),i},e.prototype.up=function(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent},e.prototype.root=function(){var e;for(e=this;e;){if(e.type===n.Document)return e.rootObject;if(e.isRoot)return e;e=e.parent}},e.prototype.document=function(){var e;for(e=this;e;){if(e.type===n.Document)return e;e=e.parent}},e.prototype.end=function(e){return this.document().end(e)},e.prototype.prev=function(){var e;if((e=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[e-1]},e.prototype.next=function(){var e;if(-1===(e=this.parent.children.indexOf(this))||e===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[e+1]},e.prototype.importDocument=function(e){var t;return(t=e.root().clone()).parent=this,t.isRoot=!1,this.children.push(t),this},e.prototype.debugInfo=function(e){var t,r;return null!=(e=e||this.name)||(null!=(t=this.parent)?t.name:void 0)?null==e?"parent: <"+this.parent.name+">":(null!=(r=this.parent)?r.name:void 0)?"node: <"+e+">, parent: <"+this.parent.name+">":"node: <"+e+">":""},e.prototype.ele=function(e,t,r){return this.element(e,t,r)},e.prototype.nod=function(e,t,r){return this.node(e,t,r)},e.prototype.txt=function(e){return this.text(e)},e.prototype.dat=function(e){return this.cdata(e)},e.prototype.com=function(e){return this.comment(e)},e.prototype.ins=function(e,t){return this.instruction(e,t)},e.prototype.doc=function(){return this.document()},e.prototype.dec=function(e,t,r){return this.declaration(e,t,r)},e.prototype.e=function(e,t,r){return this.element(e,t,r)},e.prototype.n=function(e,t,r){return this.node(e,t,r)},e.prototype.t=function(e){return this.text(e)},e.prototype.d=function(e){return this.cdata(e)},e.prototype.c=function(e){return this.comment(e)},e.prototype.r=function(e){return this.raw(e)},e.prototype.i=function(e,t){return this.instruction(e,t)},e.prototype.u=function(){return this.up()},e.prototype.importXMLBuilder=function(e){return this.importDocument(e)},e.prototype.replaceChild=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.removeChild=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.appendChild=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.hasChildNodes=function(){return 0!==this.children.length},e.prototype.cloneNode=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.normalize=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.isSupported=function(e,t){return!0},e.prototype.hasAttributes=function(){return 0!==this.attribs.length},e.prototype.compareDocumentPosition=function(e){var r;return this,this===e?0:this.document()!==e.document()?(r=t.Disconnected|t.ImplementationSpecific,Math.random()<.5?r|=t.Preceding:r|=t.Following,r):this.isAncestor(e)?t.Contains|t.Preceding:this.isDescendant(e)?t.Contains|t.Following:this.isPreceding(e)?t.Preceding:t.Following},e.prototype.isSameNode=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.lookupPrefix=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.isDefaultNamespace=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.lookupNamespaceURI=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.isEqualNode=function(e){var t,r,n;if(e.nodeType!==this.nodeType)return!1;if(e.children.length!==this.children.length)return!1;for(t=r=0,n=this.children.length-1;0<=n?r<=n:r>=n;t=0<=n?++r:--r)if(!this.children[t].isEqualNode(e.children[t]))return!1;return!0},e.prototype.getFeature=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.setUserData=function(e,t,r){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.getUserData=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},e.prototype.contains=function(e){return!!e&&(e===this||this.isDescendant(e))},e.prototype.isDescendant=function(e){var t,r,n,i;for(r=0,n=(i=this.children).length;r<n;r++){if(e===(t=i[r]))return!0;if(t.isDescendant(e))return!0}return!1},e.prototype.isAncestor=function(e){return e.isDescendant(this)},e.prototype.isPreceding=function(e){var t,r;return t=this.treePosition(e),r=this.treePosition(this),-1!==t&&-1!==r&&t<r},e.prototype.isFollowing=function(e){var t,r;return t=this.treePosition(e),r=this.treePosition(this),-1!==t&&-1!==r&&t>r},e.prototype.treePosition=function(e){var t,r;return r=0,t=!1,this.foreachTreeNode(this.document(),(function(n){if(r++,!t&&n===e)return t=!0})),t?r:-1},e.prototype.foreachTreeNode=function(e,t){var r,n,i,o,a;for(e||(e=this.document()),n=0,i=(o=e.children).length;n<i;n++){if(a=t(r=o[n]))return a;if(a=this.foreachTreeNode(r,t))return a}},e}()}).call(this)},function(e,t,r){"use strict";e.exports=function(e){return i.test("number"==typeof e?n(e):e.charAt(0))};var n=String.fromCharCode,i=/\s/},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){
/*! zero-fill. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
e.exports=function e(t,r,n){return void 0===r?function(r,n){return e(t,r,n)}:(void 0===n&&(n="0"),(t-=r.toString().length)>0?new Array(t+(/\./.test(r)?2:1)).join(n)+r:r+"")}},function(e,t){(function(){var t,r,n,i,o,a,s,l=[].slice,u={}.hasOwnProperty;t=function(){var e,t,r,n,i,a;if(a=arguments[0],i=2<=arguments.length?l.call(arguments,1):[],o(Object.assign))Object.assign.apply(null,arguments);else for(e=0,r=i.length;e<r;e++)if(null!=(n=i[e]))for(t in n)u.call(n,t)&&(a[t]=n[t]);return a},o=function(e){return!!e&&"[object Function]"===Object.prototype.toString.call(e)},a=function(e){var t;return!!e&&("function"==(t=typeof e)||"object"===t)},n=function(e){return o(Array.isArray)?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},i=function(e){var t;if(n(e))return!e.length;for(t in e)if(u.call(e,t))return!1;return!0},s=function(e){var t,r;return a(e)&&(r=Object.getPrototypeOf(e))&&(t=r.constructor)&&"function"==typeof t&&t instanceof t&&Function.prototype.toString.call(t)===Function.prototype.toString.call(Object)},r=function(e){return o(e.valueOf)?e.valueOf():e},e.exports.assign=t,e.exports.isFunction=o,e.exports.isObject=a,e.exports.isArray=n,e.exports.isEmpty=i,e.exports.isPlainObject=s,e.exports.getValue=r}).call(this)},function(e,t){e.exports=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var i in n)r.call(n,i)&&(e[i]=n[i])}return e};var r=Object.prototype.hasOwnProperty},function(e,t){var r,n,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var l,u=[],c=!1,d=-1;function p(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length&&f())}function f(){if(!c){var e=s(p);c=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new h(e,t)),1!==u.length||c||s(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},function(e,t,r){"use strict";var n=r(27),i=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=d;var o=Object.create(r(18));o.inherits=r(14);var a=r(79),s=r(54);o.inherits(d,a);for(var l=i(s.prototype),u=0;u<l.length;u++){var c=l[u];d.prototype[c]||(d.prototype[c]=s.prototype[c])}function d(e){if(!(this instanceof d))return new d(e);a.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",p)}function p(){this.allowHalfOpen||this._writableState.ended||n.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),d.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e)}},function(e,t){(t=e.exports=function(e){return e.replace(/^\s*|\s*$/g,"")}).left=function(e){return e.replace(/^\s*/,"")},t.right=function(e){return e.replace(/\s*$/,"")}},function(e,t,r){(function(e){
/*
 @license
 Shaka Player
 Copyright 2016 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/
!function(){var r="undefined"!=typeof window?window:e,n={};for(var i in function(e,t,r){var n,i=i||{};i.scope={},i.ASSUME_ES5=!1,i.ASSUME_NO_NATIVE_MAP=!1,i.ASSUME_NO_NATIVE_SET=!1,i.defineProperty=i.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){e!=Array.prototype&&e!=Object.prototype&&(e[t]=r.value)},i.getGlobal=function(r){return void 0!==e&&e===r?r:void 0!==t&&null!=t?t:r},i.global=i.getGlobal(this),i.SYMBOL_PREFIX="jscomp_symbol_",i.initSymbol=function(){i.initSymbol=function(){},i.global.Symbol||(i.global.Symbol=i.Symbol)},i.Symbol=(n=0,function(e){return i.SYMBOL_PREFIX+(e||"")+n++}),i.initSymbolIterator=function(){i.initSymbol();var e=i.global.Symbol.iterator;e||(e=i.global.Symbol.iterator=i.global.Symbol("iterator")),"function"!=typeof Array.prototype[e]&&i.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return i.arrayIterator(this)}}),i.initSymbolIterator=function(){}},i.arrayIterator=function(e){var t=0;return i.iteratorPrototype((function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}))},i.iteratorPrototype=function(e){return i.initSymbolIterator(),(e={next:e})[i.global.Symbol.iterator]=function(){return this},e},i.makeIterator=function(e){i.initSymbolIterator();var t=e[Symbol.iterator];return t?t.call(e):i.arrayIterator(e)},i.polyfill=function(e,t,r,n){if(t){for(r=i.global,e=e.split("."),n=0;n<e.length-1;n++){var o=e[n];o in r||(r[o]={}),r=r[o]}(t=t(n=r[e=e[e.length-1]]))!=n&&null!=t&&i.defineProperty(r,e,{configurable:!0,writable:!0,value:t})}},i.FORCE_POLYFILL_PROMISE=!1,i.polyfill("Promise",(function(e){function t(){this.batch_=null}function r(e){return e instanceof o?e:new o((function(t,r){t(e)}))}if(e&&!i.FORCE_POLYFILL_PROMISE)return e;t.prototype.asyncExecute=function(e){return null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_()),this.batch_.push(e),this},t.prototype.asyncExecuteBatch_=function(){var e=this;this.asyncExecuteFunction((function(){e.executeBatch_()}))};var n=i.global.setTimeout;t.prototype.asyncExecuteFunction=function(e){n(e,0)},t.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=this.batch_;this.batch_=[];for(var t=0;t<e.length;++t){var r=e[t];e[t]=null;try{r()}catch(e){this.asyncThrow_(e)}}}this.batch_=null},t.prototype.asyncThrow_=function(e){this.asyncExecuteFunction((function(){throw e}))};var o=function(e){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[];var t=this.createResolveAndReject_();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}};o.prototype.createResolveAndReject_=function(){function e(e){return function(n){r||(r=!0,e.call(t,n))}}var t=this,r=!1;return{resolve:e(this.resolveTo_),reject:e(this.reject_)}},o.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof o)this.settleSameAsPromise_(e);else{e:switch(typeof e){case"object":var t=null!=e;break e;case"function":t=!0;break e;default:t=!1}t?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}},o.prototype.resolveToNonPromiseObj_=function(e){var t=void 0;try{t=e.then}catch(e){return void this.reject_(e)}"function"==typeof t?this.settleSameAsThenable_(t,e):this.fulfill_(e)},o.prototype.reject_=function(e){this.settle_(2,e)},o.prototype.fulfill_=function(e){this.settle_(1,e)},o.prototype.settle_=function(e,t){if(0!=this.state_)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.state_);this.state_=e,this.result_=t,this.executeOnSettledCallbacks_()},o.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)a.asyncExecute(this.onSettledCallbacks_[e]);this.onSettledCallbacks_=null}};var a=new t;return o.prototype.settleSameAsPromise_=function(e){var t=this.createResolveAndReject_();e.callWhenSettled_(t.resolve,t.reject)},o.prototype.settleSameAsThenable_=function(e,t){var r=this.createResolveAndReject_();try{e.call(t,r.resolve,r.reject)}catch(e){r.reject(e)}},o.prototype.then=function(e,t){function r(e,t){return"function"==typeof e?function(t){try{n(e(t))}catch(e){i(e)}}:t}var n,i,a=new o((function(e,t){n=e,i=t}));return this.callWhenSettled_(r(e,n),r(t,i)),a},o.prototype.catch=function(e){return this.then(void 0,e)},o.prototype.callWhenSettled_=function(e,t){function r(){switch(n.state_){case 1:e(n.result_);break;case 2:t(n.result_);break;default:throw Error("Unexpected state: "+n.state_)}}var n=this;null==this.onSettledCallbacks_?a.asyncExecute(r):this.onSettledCallbacks_.push(r)},o.resolve=r,o.reject=function(e){return new o((function(t,r){r(e)}))},o.race=function(e){return new o((function(t,n){for(var o=i.makeIterator(e),a=o.next();!a.done;a=o.next())r(a.value).callWhenSettled_(t,n)}))},o.all=function(e){var t=i.makeIterator(e),n=t.next();return n.done?r([]):new o((function(e,i){function o(t){return function(r){a[t]=r,0==--s&&e(a)}}var a=[],s=0;do{a.push(void 0),s++,r(n.value).callWhenSettled_(o(a.length-1),i),n=t.next()}while(!n.done)}))},o}),"es6","es3"),i.polyfill("Promise.prototype.finally",(function(e){return e||function(e){return this.then((function(t){return Promise.resolve(e()).then((function(){return t}))}),(function(t){return Promise.resolve(e()).then((function(){throw t}))}))}}),"es8","es3"),i.asyncExecutePromiseGenerator=function(e){function t(t){return e.next(t)}function r(t){return e.throw(t)}return new Promise((function(n,i){!function e(o){o.done?n(o.value):Promise.resolve(o.value).then(t,r).then(e,i)}(e.next())}))},i.asyncExecutePromiseGeneratorFunction=function(e){return i.asyncExecutePromiseGenerator(e())},i.objectCreate=i.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(e){var t=function(){};return t.prototype=e,new t},i.underscoreProtoCanBeSet=function(){var e={};try{return e.__proto__={a:!0},e.a}catch(e){}return!1},i.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:i.underscoreProtoCanBeSet()?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null,i.inherits=function(e,t){if(e.prototype=i.objectCreate(t.prototype),e.prototype.constructor=e,i.setPrototypeOf){var r=i.setPrototypeOf;r(e,t)}else for(r in t)if("prototype"!=r)if(Object.defineProperties){var n=Object.getOwnPropertyDescriptor(t,r);n&&Object.defineProperty(e,r,n)}else e[r]=t[r];e.superClass_=t.prototype},i.generator={},i.generator.ensureIteratorResultIsObject_=function(e){if(!(e instanceof Object))throw new TypeError("Iterator result "+e+" is not an object")},i.generator.Context=function(){this.isRunning_=!1,this.yieldAllIterator_=null,this.yieldResult=void 0,this.nextAddress=1,this.finallyAddress_=this.catchAddress_=0,this.finallyContexts_=this.abruptCompletion_=null},i.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0},i.generator.Context.prototype.stop_=function(){this.isRunning_=!1},i.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_},i.generator.Context.prototype.next_=function(e){this.yieldResult=e},i.generator.Context.prototype.throw_=function(e){this.abruptCompletion_={exception:e,isException:!0},this.jumpToErrorHandler_()},i.generator.Context.prototype.return=function(e){this.abruptCompletion_={return:e},this.nextAddress=this.finallyAddress_},i.generator.Context.prototype.jumpThroughFinallyBlocks=function(e){this.abruptCompletion_={jumpTo:e},this.nextAddress=this.finallyAddress_},i.generator.Context.prototype.yield=function(e,t){return this.nextAddress=t,{value:e}},i.generator.Context.prototype.yieldAll=function(e,t){var r=i.makeIterator(e),n=r.next();if(i.generator.ensureIteratorResultIsObject_(n),!n.done)return this.yieldAllIterator_=r,this.yield(n.value,t);this.yieldResult=n.value,this.nextAddress=t},i.generator.Context.prototype.jumpTo=function(e){this.nextAddress=e},i.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0},i.generator.Context.prototype.setCatchFinallyBlocks=function(e,t){this.catchAddress_=e,null!=t&&(this.finallyAddress_=t)},i.generator.Context.prototype.setFinallyBlock=function(e){this.catchAddress_=0,this.finallyAddress_=e||0},i.generator.Context.prototype.leaveTryBlock=function(e,t){this.nextAddress=e,this.catchAddress_=t||0},i.generator.Context.prototype.enterCatchBlock=function(e){return this.catchAddress_=e||0,e=this.abruptCompletion_.exception,this.abruptCompletion_=null,e},i.generator.Context.prototype.enterFinallyBlock=function(e,t,r){r?this.finallyContexts_[r]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_],this.catchAddress_=e||0,this.finallyAddress_=t||0},i.generator.Context.prototype.leaveFinallyBlock=function(e,t){var r=this.finallyContexts_.splice(t||0)[0];if(r=this.abruptCompletion_=this.abruptCompletion_||r){if(r.isException)return this.jumpToErrorHandler_();null!=r.jumpTo&&this.finallyAddress_<r.jumpTo?(this.nextAddress=r.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=e},i.generator.Context.prototype.forIn=function(e){return new i.generator.Context.PropertyIterator(e)},i.generator.Context.PropertyIterator=function(e){for(var t in this.object_=e,this.properties_=[],e)this.properties_.push(t);this.properties_.reverse()},i.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var e=this.properties_.pop();if(e in this.object_)return e}return null},i.generator.Engine_=function(e){this.context_=new i.generator.Context,this.program_=e},i.generator.Engine_.prototype.next_=function(e){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.next,e,this.context_.next_):(this.context_.next_(e),this.nextStep_())},i.generator.Engine_.prototype.return_=function(e){this.context_.start_();var t=this.context_.yieldAllIterator_;return t?this.yieldAllStep_("return"in t?t.return:function(e){return{value:e,done:!0}},e,this.context_.return):(this.context_.return(e),this.nextStep_())},i.generator.Engine_.prototype.throw_=function(e){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.throw,e,this.context_.next_):(this.context_.throw_(e),this.nextStep_())},i.generator.Engine_.prototype.yieldAllStep_=function(e,t,r){try{var n=e.call(this.context_.yieldAllIterator_,t);if(i.generator.ensureIteratorResultIsObject_(n),!n.done)return this.context_.stop_(),n;var o=n.value}catch(e){return this.context_.yieldAllIterator_=null,this.context_.throw_(e),this.nextStep_()}return this.context_.yieldAllIterator_=null,r.call(this.context_,o),this.nextStep_()},i.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var e=this.program_(this.context_);if(e)return this.context_.stop_(),{value:e.value,done:!1}}catch(e){this.context_.yieldResult=void 0,this.context_.throw_(e)}if(this.context_.stop_(),this.context_.abruptCompletion_){if(e=this.context_.abruptCompletion_,this.context_.abruptCompletion_=null,e.isException)throw e.exception;return{value:e.return,done:!0}}return{value:void 0,done:!0}},i.generator.Generator_=function(e){this.next=function(t){return e.next_(t)},this.throw=function(t){return e.throw_(t)},this.return=function(t){return e.return_(t)},i.initSymbolIterator(),this[Symbol.iterator]=function(){return this}},i.generator.createGenerator=function(e,t){return i.generator.Generator_.prototype=e.prototype,new i.generator.Generator_(new i.generator.Engine_(t))},i.arrayFromIterator=function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r},i.arrayFromIterable=function(e){return e instanceof Array?e:i.arrayFromIterator(i.makeIterator(e))},i.checkEs6ConformanceViaProxy=function(){try{var e={},t=Object.create(new i.global.Proxy(e,{get:function(r,n,i){return r==e&&"q"==n&&i==t}}));return!0===t.q}catch(e){return!1}},i.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1,i.ES6_CONFORMANCE=i.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&i.checkEs6ConformanceViaProxy(),i.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.polyfill("WeakMap",(function(e){function t(e){i.owns(e,n)||i.defineProperty(e,n,{value:{}})}function r(e){var r=Object[e];r&&(Object[e]=function(e){return t(e),r(e)})}if(i.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(e&&i.ES6_CONFORMANCE)return e}else if(function(){if(!e||!Object.seal)return!1;try{var t=Object.seal({}),r=Object.seal({}),n=new e([[t,2],[r,3]]);return 2==n.get(t)&&3==n.get(r)&&(n.delete(t),n.set(r,4),!n.has(t)&&4==n.get(r))}catch(e){return!1}}())return e;var n="$jscomp_hidden_"+Math.random();r("freeze"),r("preventExtensions"),r("seal");var o=0,a=function(e){if(this.id_=(o+=Math.random()+1).toString(),e){i.initSymbol(),i.initSymbolIterator(),e=i.makeIterator(e);for(var t;!(t=e.next()).done;)t=t.value,this.set(t[0],t[1])}};return a.prototype.set=function(e,r){if(t(e),!i.owns(e,n))throw Error("WeakMap key fail: "+e);return e[n][this.id_]=r,this},a.prototype.get=function(e){return i.owns(e,n)?e[n][this.id_]:void 0},a.prototype.has=function(e){return i.owns(e,n)&&i.owns(e[n],this.id_)},a.prototype.delete=function(e){return!(!i.owns(e,n)||!i.owns(e[n],this.id_))&&delete e[n][this.id_]},a}),"es6","es3"),i.MapEntry=function(){},i.polyfill("Map",(function(e){if(i.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(e&&i.ES6_CONFORMANCE)return e}else if(function(){if(i.ASSUME_NO_NATIVE_MAP||!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),r=new e(i.makeIterator([[t,"s"]]));if("s"!=r.get(t)||1!=r.size||r.get({x:4})||r.set({x:4},"t")!=r||2!=r.size)return!1;var n=r.entries(),o=n.next();return!o.done&&o.value[0]==t&&"s"==o.value[1]&&!((o=n.next()).done||4!=o.value[0].x||"t"!=o.value[1]||!n.next().done)}catch(e){return!1}}())return e;i.initSymbol(),i.initSymbolIterator();var t=new WeakMap,r=function(e){if(this.data_={},this.head_=a(),this.size=0,e){e=i.makeIterator(e);for(var t;!(t=e.next()).done;)t=t.value,this.set(t[0],t[1])}};r.prototype.set=function(e,t){var r=n(this,e);return r.list||(r.list=this.data_[r.id]=[]),r.entry?r.entry.value=t:(r.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:e,value:t},r.list.push(r.entry),this.head_.previous.next=r.entry,this.head_.previous=r.entry,this.size++),this},r.prototype.delete=function(e){return!(!(e=n(this,e)).entry||!e.list)&&(e.list.splice(e.index,1),e.list.length||delete this.data_[e.id],e.entry.previous.next=e.entry.next,e.entry.next.previous=e.entry.previous,e.entry.head=null,this.size--,!0)},r.prototype.clear=function(){this.data_={},this.head_=this.head_.previous=a(),this.size=0},r.prototype.has=function(e){return!!n(this,e).entry},r.prototype.get=function(e){return(e=n(this,e).entry)&&e.value},r.prototype.entries=function(){return o(this,(function(e){return[e.key,e.value]}))},r.prototype.keys=function(){return o(this,(function(e){return e.key}))},r.prototype.values=function(){return o(this,(function(e){return e.value}))},r.prototype.forEach=function(e,t){for(var r,n=this.entries();!(r=n.next()).done;)r=r.value,e.call(t,r[1],r[0],this)},r.prototype[Symbol.iterator]=r.prototype.entries;var n=function(e,r){var n=r&&typeof r;"object"==n||"function"==n?t.has(r)?n=t.get(r):(n=""+ ++s,t.set(r,n)):n="p_"+r;var o=e.data_[n];if(o&&i.owns(e.data_,n))for(var a=0;a<o.length;a++){var l=o[a];if(r!=r&&l.key!=l.key||r===l.key)return{id:n,list:o,index:a,entry:l}}return{id:n,list:o,index:-1,entry:void 0}},o=function(e,t){var r=e.head_;return i.iteratorPrototype((function(){if(r){for(;r.head!=e.head_;)r=r.previous;for(;r.next!=r.head;)return r=r.next,{done:!1,value:t(r)};r=null}return{done:!0,value:void 0}}))},a=function(){var e={};return e.previous=e.next=e.head=e},s=0;return r}),"es6","es3"),i.polyfill("Set",(function(e){if(i.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(e&&i.ES6_CONFORMANCE)return e}else if(function(){if(i.ASSUME_NO_NATIVE_SET||!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),r=new e(i.makeIterator([t]));if(!r.has(t)||1!=r.size||r.add(t)!=r||1!=r.size||r.add({x:4})!=r||2!=r.size)return!1;var n=r.entries(),o=n.next();return!o.done&&o.value[0]==t&&o.value[1]==t&&(!(o=n.next()).done&&o.value[0]!=t&&4==o.value[0].x&&o.value[1]==o.value[0]&&n.next().done)}catch(e){return!1}}())return e;i.initSymbol(),i.initSymbolIterator();var t=function(e){if(this.map_=new Map,e){e=i.makeIterator(e);for(var t;!(t=e.next()).done;)this.add(t.value)}this.size=this.map_.size};return t.prototype.add=function(e){return this.map_.set(e,e),this.size=this.map_.size,this},t.prototype.delete=function(e){return e=this.map_.delete(e),this.size=this.map_.size,e},t.prototype.clear=function(){this.map_.clear(),this.size=0},t.prototype.has=function(e){return this.map_.has(e)},t.prototype.entries=function(){return this.map_.entries()},t.prototype.values=function(){return this.map_.values()},t.prototype.keys=t.prototype.values,t.prototype[Symbol.iterator]=t.prototype.values,t.prototype.forEach=function(e,t){var r=this;this.map_.forEach((function(n){return e.call(t,n,n,r)}))},t}),"es6","es3"),i.findInternal=function(e,t,r){e instanceof String&&(e=String(e));for(var n=e.length,i=0;i<n;i++){var o=e[i];if(t.call(r,o,i,e))return{i:i,v:o}}return{i:-1,v:void 0}},i.polyfill("Array.prototype.findIndex",(function(e){return e||function(e,t){return i.findInternal(this,e,t).i}}),"es6","es3"),i.iteratorFromArray=function(e,t){i.initSymbolIterator(),e instanceof String&&(e+="");var r=0,n={next:function(){if(r<e.length){var i=r++;return{value:t(i,e[i]),done:!1}}return n.next=function(){return{done:!0,value:void 0}},n.next()}};return n[Symbol.iterator]=function(){return n},n},i.polyfill("Array.prototype.keys",(function(e){return e||function(){return i.iteratorFromArray(this,(function(e){return e}))}}),"es6","es3"),i.polyfill("Object.is",(function(e){return e||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}}),"es6","es3"),i.polyfill("Array.prototype.includes",(function(e){return e||function(e,t){var r=this;r instanceof String&&(r=String(r));var n=r.length,i=t||0;for(0>i&&(i=Math.max(i+n,0));i<n;i++){var o=r[i];if(o===e||Object.is(o,e))return!0}return!1}}),"es7","es3"),i.checkStringArgs=function(e,t,r){if(null==e)throw new TypeError("The 'this' value for String.prototype."+r+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+r+" must not be a regular expression");return e+""},i.polyfill("String.prototype.includes",(function(e){return e||function(e,t){return-1!==i.checkStringArgs(this,e,"includes").indexOf(e,t||0)}}),"es6","es3"),i.polyfill("Array.from",(function(e){return e||function(e,t,r){i.initSymbolIterator(),t=null!=t?t:function(e){return e};var n=[],o=e[Symbol.iterator];if("function"==typeof o)for(e=o.call(e);!(o=e.next()).done;)n.push(t.call(r,o.value));else{o=e.length;for(var a=0;a<o;a++)n.push(t.call(r,e[a]))}return n}}),"es6","es3"),i.polyfill("String.prototype.startsWith",(function(e){return e||function(e,t){var r=i.checkStringArgs(this,e,"startsWith");e+="";for(var n=r.length,o=e.length,a=Math.max(0,Math.min(0|t,r.length)),s=0;s<o&&a<n;)if(r[a++]!=e[s++])return!1;return s>=o}}),"es6","es3"),i.polyfill("Array.prototype.find",(function(e){return e||function(e,t){return i.findInternal(this,e,t).v}}),"es6","es3"),i.assign="function"==typeof Object.assign?Object.assign:function(e,t){for(var r=1;r<arguments.length;r++){var n=arguments[r];if(n)for(var o in n)i.owns(n,o)&&(e[o]=n[o])}return e},i.polyfill("Object.assign",(function(e){return e||i.assign}),"es6","es3");var o=o||{};o.global=this,o.isDef=function(e){return void 0!==e},o.exportPath_=function(e,t,r){e=e.split("."),r=r||o.global,e[0]in r||!r.execScript||r.execScript("var "+e[0]);for(var n;e.length&&(n=e.shift());)!e.length&&o.isDef(t)?r[n]=t:r=r[n]?r[n]:r[n]={}},o.define=function(e,t){var r=t;o.exportPath_(e,r)},o.DEBUG=!0,o.LOCALE="en",o.TRUSTED_SITE=!0,o.STRICT_MODE_COMPATIBLE=!0,o.provide=function(e){o.exportPath_(e)},o.forwardDeclare=function(e){},o.getObjectByName=function(e,t){for(var r,n=e.split("."),i=t||o.global;r=n.shift();){if(!o.isDefAndNotNull(i[r]))return null;i=i[r]}return i},o.globalize=function(e,t){for(var r in t=t||o.global,e)t[r]=e[r]},o.addDependency=function(e,t,r){if(o.DEPENDENCIES_ENABLED){var n;e=e.replace(/\\/g,"/");for(var i=o.dependencies_,a=0;n=t[a];a++)i.nameToPath[n]=e;for(n=0;t=r[n];n++)e in i.requires||(i.requires[e]={}),i.requires[e][t]=!0}},o.ENABLE_DEBUG_LOADER=!1,o.logToConsole_=function(e){o.global.console&&o.global.console.error(e)},o.require=function(e){},o.basePath="",o.global.CLOSURE_NO_DEPS=!0,o.DEPENDENCIES_ENABLED=!1,o.DEPENDENCIES_ENABLED&&(o.included_={},o.dependencies_={nameToPath:{},requires:{},visited:{},written:{}},o.inHtmlDocument_=function(){var e=o.global.document;return void 0!==e&&"write"in e},o.findBasePath_=function(){if(o.global.CLOSURE_BASE_PATH)o.basePath=o.global.CLOSURE_BASE_PATH;else if(o.inHtmlDocument_())for(var e=o.global.document.getElementsByTagName("script"),t=e.length-1;0<=t;--t){var r=e[t].src,n=r.lastIndexOf("?");if(n=-1==n?r.length:n,"base.js"==r.substr(n-7,7)){o.basePath=r.substr(0,n-7);break}}},o.importScript_=function(e,t){(o.global.CLOSURE_IMPORT_SCRIPT||o.writeScriptTag_)(e,t)&&(o.dependencies_.written[e]=!0)},o.writeScriptTag_=function(e,t){if(o.inHtmlDocument_()){var r=o.global.document;if("complete"==r.readyState){if(/\bdeps.js$/.test(e))return!1;throw Error('Cannot write "'+e+'" after document load')}return void 0===t?r.write('<script type="text/javascript" src="'+e+'"><\/script>'):r.write('<script type="text/javascript">'+t+"<\/script>"),!0}return!1},o.writeScripts_=function(){function e(i){if(!(i in n.written)){if(!(i in n.visited)&&(n.visited[i]=!0,i in n.requires))for(var a in n.requires[i])if(!o.isProvided_(a)){if(!(a in n.nameToPath))throw Error("Undefined nameToPath for "+a);e(n.nameToPath[a])}i in r||(r[i]=!0,t.push(i))}}var t=[],r={},n=o.dependencies_;for(a in o.included_)n.written[a]||e(a);for(var i=0;i<t.length;i++){var a=t[i];o.dependencies_.written[a]=!0}for(i=0;i<t.length;i++)(a=t[i])&&o.importScript_(o.basePath+a)},o.getPathFromDeps_=function(e){return e in o.dependencies_.nameToPath?o.dependencies_.nameToPath[e]:null},o.findBasePath_(),o.global.CLOSURE_NO_DEPS||o.importScript_(o.basePath+"deps.js")),o.isDefAndNotNull=function(e){return null!=e},o.isString=function(e){return"string"==typeof e},o.exportSymbol=function(e,t,r){o.exportPath_(e,t,r)},o.exportProperty=function(e,t,r){e[t]=r},o.inherits=function(e,t){function r(){}r.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.base=function(e,r,n){var i=Array.prototype.slice.call(arguments,2);return t.prototype[r].apply(e,i)}},o.asserts={},o.asserts.ENABLE_ASSERTS=!0,o.asserts.assert=function(){},o.asserts.patchAssert_=function(){var e=console.assert;e?e.bind||(console.assert=function(){e.apply(console,arguments)}):console.assert=function(){}},o.asserts.ENABLE_ASSERTS&&(o.asserts.patchAssert_(),o.asserts.assert=console.assert.bind(console));var a={abr:{}};a.abr.Ewma=function(e){o.asserts.assert(0<e,"expected halfLife to be positive"),this.alpha_=Math.exp(Math.log(.5)/e),this.totalWeight_=this.estimate_=0},a.abr.Ewma.prototype.sample=function(e,t){var r=Math.pow(this.alpha_,e);r=t*(1-r)+r*this.estimate_,isNaN(r)||(this.estimate_=r,this.totalWeight_+=e)},a.abr.Ewma.prototype.getEstimate=function(){return this.estimate_/(1-Math.pow(this.alpha_,this.totalWeight_))},a.abr.EwmaBandwidthEstimator=function(){this.fast_=new a.abr.Ewma(2),this.slow_=new a.abr.Ewma(5),this.bytesSampled_=0,this.minTotalBytes_=128e3,this.minBytes_=16e3},a.abr.EwmaBandwidthEstimator.prototype.sample=function(e,t){if(!(t<this.minBytes_)){var r=8e3*t/e,n=e/1e3;this.bytesSampled_+=t,this.fast_.sample(n,r),this.slow_.sample(n,r)}},a.abr.EwmaBandwidthEstimator.prototype.getBandwidthEstimate=function(e){return this.bytesSampled_<this.minTotalBytes_?e:Math.min(this.fast_.getEstimate(),this.slow_.getEstimate())},a.abr.EwmaBandwidthEstimator.prototype.hasGoodEstimate=function(){return this.bytesSampled_>=this.minTotalBytes_},a.log={},a.log.Level={NONE:0,ERROR:1,WARNING:2,INFO:3,DEBUG:4,V1:5,V2:6},a.log.MAX_LOG_LEVEL=4,a.log.alwaysError=function(){},a.log.alwaysWarn=function(){},a.log.error=function(){},a.log.warning=function(){},a.log.info=function(){},a.log.debug=function(){},a.log.v1=function(){},a.log.v2=function(){},e.console&&e.console.log.bind&&(a.log.alwaysWarn=console.warn.bind(console),a.log.alwaysError=console.error.bind(console),o.DEBUG?(o.exportSymbol("shaka.log",a.log),a.log.setLevel=function(e){var t=function(){},r=a.log,n=a.log.Level;a.log.currentLevel=e,r.error=e>=n.ERROR?console.error.bind(console):t,r.warning=e>=n.WARNING?console.warn.bind(console):t,r.info=e>=n.INFO?console.info.bind(console):t,r.debug=e>=n.DEBUG?console.log.bind(console):t,r.v1=e>=n.V1?console.debug.bind(console):t,r.v2=e>=n.V2?console.debug.bind(console):t},a.log.setLevel(a.log.MAX_LOG_LEVEL)):(a.log.MAX_LOG_LEVEL>=a.log.Level.ERROR&&(a.log.error=console.error.bind(console)),a.log.MAX_LOG_LEVEL>=a.log.Level.WARNING&&(a.log.warning=console.warn.bind(console)),a.log.MAX_LOG_LEVEL>=a.log.Level.INFO&&(a.log.info=console.info.bind(console)),a.log.MAX_LOG_LEVEL>=a.log.Level.DEBUG&&(a.log.debug=console.log.bind(console)),a.log.MAX_LOG_LEVEL>=a.log.Level.V1&&(a.log.v1=console.debug.bind(console)),a.log.MAX_LOG_LEVEL>=a.log.Level.V2&&(a.log.v2=console.debug.bind(console)))),
/*
 @license
 Copyright 2008 The Closure Library Authors
 SPDX-License-Identifier: Apache-2.0
*/
o.uri={},o.uri.utils={},o.uri.utils.splitRe_=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/,o.uri.utils.ComponentIndex={SCHEME:1,USER_INFO:2,DOMAIN:3,PORT:4,PATH:5,QUERY_DATA:6,FRAGMENT:7},o.uri.utils.split=function(e){return e.match(o.uri.utils.splitRe_)},
/*
 @license
 Copyright 2006 The Closure Library Authors
 SPDX-License-Identifier: Apache-2.0
*/
o.Uri=function(e){var t;e instanceof o.Uri?(this.setScheme(e.getScheme()),this.setUserInfo(e.getUserInfo()),this.setDomain(e.getDomain()),this.setPort(e.getPort()),this.setPath(e.getPath()),this.setQueryData(e.getQueryData().clone()),this.setFragment(e.getFragment())):e&&(t=o.uri.utils.split(String(e)))?(this.setScheme(t[o.uri.utils.ComponentIndex.SCHEME]||"",!0),this.setUserInfo(t[o.uri.utils.ComponentIndex.USER_INFO]||"",!0),this.setDomain(t[o.uri.utils.ComponentIndex.DOMAIN]||"",!0),this.setPort(t[o.uri.utils.ComponentIndex.PORT]),this.setPath(t[o.uri.utils.ComponentIndex.PATH]||"",!0),this.setQueryData(t[o.uri.utils.ComponentIndex.QUERY_DATA]||"",!0),this.setFragment(t[o.uri.utils.ComponentIndex.FRAGMENT]||"",!0)):this.queryData_=new o.Uri.QueryData(null,null)},o.Uri.prototype.scheme_="",o.Uri.prototype.userInfo_="",o.Uri.prototype.domain_="",o.Uri.prototype.port_=null,o.Uri.prototype.path_="",o.Uri.prototype.fragment_="",o.Uri.prototype.toString=function(){var e=[],t=this.getScheme();if(t&&e.push(o.Uri.encodeSpecialChars_(t,o.Uri.reDisallowedInSchemeOrUserInfo_,!0),":"),t=this.getDomain()){e.push("//");var r=this.getUserInfo();r&&e.push(o.Uri.encodeSpecialChars_(r,o.Uri.reDisallowedInSchemeOrUserInfo_,!0),"@"),e.push(o.Uri.removeDoubleEncoding_(encodeURIComponent(t))),null!=(t=this.getPort())&&e.push(":",String(t))}return(t=this.getPath())&&(this.hasDomain()&&"/"!=t.charAt(0)&&e.push("/"),e.push(o.Uri.encodeSpecialChars_(t,"/"==t.charAt(0)?o.Uri.reDisallowedInAbsolutePath_:o.Uri.reDisallowedInRelativePath_,!0))),(t=this.getEncodedQuery())&&e.push("?",t),(t=this.getFragment())&&e.push("#",o.Uri.encodeSpecialChars_(t,o.Uri.reDisallowedInFragment_)),e.join("")},o.Uri.prototype.resolve=function(e){var t=this.clone();"data"===t.scheme_&&(t=new o.Uri);var r=e.hasScheme();r?t.setScheme(e.getScheme()):r=e.hasUserInfo(),r?t.setUserInfo(e.getUserInfo()):r=e.hasDomain(),r?t.setDomain(e.getDomain()):r=e.hasPort();var n=e.getPath();if(r)t.setPort(e.getPort());else if(r=e.hasPath()){if("/"!=n.charAt(0))if(this.hasDomain()&&!this.hasPath())n="/"+n;else{var i=t.getPath().lastIndexOf("/");-1!=i&&(n=t.getPath().substr(0,i+1)+n)}n=o.Uri.removeDotSegments(n)}return r?t.setPath(n):r=e.hasQuery(),r?t.setQueryData(e.getQueryData().clone()):r=e.hasFragment(),r&&t.setFragment(e.getFragment()),t},o.Uri.prototype.clone=function(){return new o.Uri(this)},o.Uri.prototype.getScheme=function(){return this.scheme_},o.Uri.prototype.setScheme=function(e,t){return(this.scheme_=t?o.Uri.decodeOrEmpty_(e,!0):e)&&(this.scheme_=this.scheme_.replace(/:$/,"")),this},o.Uri.prototype.hasScheme=function(){return!!this.scheme_},o.Uri.prototype.getUserInfo=function(){return this.userInfo_},o.Uri.prototype.setUserInfo=function(e,t){return this.userInfo_=t?o.Uri.decodeOrEmpty_(e):e,this},o.Uri.prototype.hasUserInfo=function(){return!!this.userInfo_},o.Uri.prototype.getDomain=function(){return this.domain_},o.Uri.prototype.setDomain=function(e,t){return this.domain_=t?o.Uri.decodeOrEmpty_(e,!0):e,this},o.Uri.prototype.hasDomain=function(){return!!this.domain_},o.Uri.prototype.getPort=function(){return this.port_},o.Uri.prototype.setPort=function(e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);this.port_=e}else this.port_=null;return this},o.Uri.prototype.hasPort=function(){return null!=this.port_},o.Uri.prototype.getPath=function(){return this.path_},o.Uri.prototype.setPath=function(e,t){return this.path_=t?o.Uri.decodeOrEmpty_(e,!0):e,this},o.Uri.prototype.hasPath=function(){return!!this.path_},o.Uri.prototype.hasQuery=function(){return""!==this.queryData_.toString()},o.Uri.prototype.setQueryData=function(e,t){return e instanceof o.Uri.QueryData?this.queryData_=e:(t||(e=o.Uri.encodeSpecialChars_(e,o.Uri.reDisallowedInQuery_)),this.queryData_=new o.Uri.QueryData(e,null)),this},o.Uri.prototype.getEncodedQuery=function(){return this.queryData_.toString()},o.Uri.prototype.getDecodedQuery=function(){return this.queryData_.toDecodedString()},o.Uri.prototype.getQueryData=function(){return this.queryData_},o.Uri.prototype.getFragment=function(){return this.fragment_},o.Uri.prototype.setFragment=function(e,t){return this.fragment_=t?o.Uri.decodeOrEmpty_(e):e,this},o.Uri.prototype.hasFragment=function(){return!!this.fragment_},o.Uri.removeDotSegments=function(e){if(".."==e||"."==e)return"";if(-1==e.indexOf("./")&&-1==e.indexOf("/."))return e;var t=0==e.lastIndexOf("/",0);e=e.split("/");for(var r=[],n=0;n<e.length;){var i=e[n++];"."==i?t&&n==e.length&&r.push(""):".."==i?((1<r.length||1==r.length&&""!=r[0])&&r.pop(),t&&n==e.length&&r.push("")):(r.push(i),t=!0)}return r.join("/")},o.Uri.decodeOrEmpty_=function(e,t){return e?t?decodeURI(e):decodeURIComponent(e):""},o.Uri.encodeSpecialChars_=function(e,t,r){return o.isString(e)?(e=encodeURI(e).replace(t,o.Uri.encodeChar_),r&&(e=o.Uri.removeDoubleEncoding_(e)),e):null},o.Uri.encodeChar_=function(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)},o.Uri.removeDoubleEncoding_=function(e){return e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")},o.Uri.reDisallowedInSchemeOrUserInfo_=/[#\/\?@]/g,o.Uri.reDisallowedInRelativePath_=/[#\?:]/g,o.Uri.reDisallowedInAbsolutePath_=/[#\?]/g,o.Uri.reDisallowedInQuery_=/[#\?@]/g,o.Uri.reDisallowedInFragment_=/#/g,o.Uri.QueryData=function(e,t){this.encodedQuery_=e||null},o.Uri.QueryData.prototype.ensureKeyMapInitialized_=function(){if(!this.keyMap_&&(this.keyMap_={},this.count_=0,this.encodedQuery_))for(var e=this.encodedQuery_.split("&"),t=0;t<e.length;t++){var r=e[t].indexOf("="),n=null;if(0<=r){var i=e[t].substring(0,r);n=e[t].substring(r+1)}else i=e[t];i=decodeURIComponent(i.replace(/\+/g," ")),n=n||"",this.add(i,decodeURIComponent(n.replace(/\+/g," ")))}},o.Uri.QueryData.prototype.keyMap_=null,o.Uri.QueryData.prototype.count_=null,o.Uri.QueryData.prototype.getCount=function(){return this.ensureKeyMapInitialized_(),this.count_},o.Uri.QueryData.prototype.add=function(e,t){this.ensureKeyMapInitialized_(),this.encodedQuery_=null;var r=this.keyMap_.hasOwnProperty(e)&&this.keyMap_[e];return r||(this.keyMap_[e]=r=[]),r.push(t),this.count_++,this},o.Uri.QueryData.prototype.toString=function(){if(this.encodedQuery_)return this.encodedQuery_;if(!this.keyMap_)return"";var e,t=[];for(e in this.keyMap_)for(var r=encodeURIComponent(e),n=this.keyMap_[e],i=0;i<n.length;i++){var o=r;""!==n[i]&&(o+="="+encodeURIComponent(n[i])),t.push(o)}return this.encodedQuery_=t.join("&")},o.Uri.QueryData.prototype.toDecodedString=function(){return o.Uri.decodeOrEmpty_(this.toString())},o.Uri.QueryData.prototype.clone=function(){var e=new o.Uri.QueryData;if(e.encodedQuery_=this.encodedQuery_,this.keyMap_){var t,r={};for(t in this.keyMap_)r[t]=this.keyMap_[t].concat();e.keyMap_=r,e.count_=this.count_}return e},a.util={},a.util.DelayedTick=function(e){this.onTick_=e,this.cancelPending_=null},a.util.DelayedTick.prototype.tickAfter=function(t){var r=this;this.stop();var n=!0,i=null;return this.cancelPending_=function(){e.clearTimeout(i),n=!1},i=e.setTimeout((function(){n&&r.onTick_()}),1e3*t),this},a.util.DelayedTick.prototype.stop=function(){this.cancelPending_&&(this.cancelPending_(),this.cancelPending_=null)},a.util.Timer=function(e){this.onTick_=e,this.ticker_=null},o.exportSymbol("shaka.util.Timer",a.util.Timer),a.util.Timer.prototype.tickNow=function(){return this.stop(),this.onTick_(),this},o.exportProperty(a.util.Timer.prototype,"tickNow",a.util.Timer.prototype.tickNow),a.util.Timer.prototype.tickAfter=function(e){var t=this;return this.stop(),this.ticker_=new a.util.DelayedTick((function(){t.onTick_()})).tickAfter(e),this},o.exportProperty(a.util.Timer.prototype,"tickAfter",a.util.Timer.prototype.tickAfter),a.util.Timer.prototype.tickEvery=function(e){var t=this;return this.stop(),this.ticker_=new a.util.DelayedTick((function(){t.ticker_.tickAfter(e),t.onTick_()})).tickAfter(e),this},o.exportProperty(a.util.Timer.prototype,"tickEvery",a.util.Timer.prototype.tickEvery),a.util.Timer.prototype.stop=function(){this.ticker_&&(this.ticker_.stop(),this.ticker_=null)},o.exportProperty(a.util.Timer.prototype,"stop",a.util.Timer.prototype.stop),a.net={},a.net.Backoff=function(e,t){t=void 0!==t&&t;var r=a.net.Backoff.defaultRetryParameters();this.maxAttempts_=null==e.maxAttempts?r.maxAttempts:e.maxAttempts,o.asserts.assert(1<=this.maxAttempts_,"maxAttempts should be >= 1"),this.baseDelay_=null==e.baseDelay?r.baseDelay:e.baseDelay,o.asserts.assert(0<=this.baseDelay_,"baseDelay should be >= 0"),this.fuzzFactor_=null==e.fuzzFactor?r.fuzzFactor:e.fuzzFactor,o.asserts.assert(0<=this.fuzzFactor_,"fuzzFactor should be >= 0"),this.backoffFactor_=null==e.backoffFactor?r.backoffFactor:e.backoffFactor,o.asserts.assert(0<=this.backoffFactor_,"backoffFactor should be >= 0"),this.numAttempts_=0,this.nextUnfuzzedDelay_=this.baseDelay_,(this.autoReset_=t)&&(o.asserts.assert(2<=this.maxAttempts_,"maxAttempts must be >= 2 for autoReset == true"),this.numAttempts_=1)},a.net.Backoff.prototype.attempt=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var r,n;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:if(e.numAttempts_>=e.maxAttempts_){if(!e.autoReset_)return t.return(Promise.reject());e.reset_()}return r=e.numAttempts_,e.numAttempts_++,0==r?(o.asserts.assert(!e.autoReset_,"Failed to delay with auto-reset!"),t.return()):(n=a.net.Backoff.fuzz_(e.nextUnfuzzedDelay_,e.fuzzFactor_),t.yield(new Promise((function(e){a.net.Backoff.defer(n,e)})),2));case 2:e.nextUnfuzzedDelay_*=e.backoffFactor_,t.jumpToEnd()}}))}))},a.net.Backoff.defaultRetryParameters=function(){return{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0}},a.net.Backoff.fuzz_=function(e,t){return e*(1+(2*Math.random()-1)*t)},a.net.Backoff.prototype.reset_=function(){o.asserts.assert(this.autoReset_,"Should only be used for auto-reset!"),this.numAttempts_=1,this.nextUnfuzzedDelay_=this.baseDelay_},a.net.Backoff.defer=function(e,t){new a.util.Timer(t).tickAfter(e/1e3)},a.util.Error=function(e,t,r,n){for(var i=[],s=3;s<arguments.length;++s)i[s-3]=arguments[s];if(this.severity=e,this.category=t,this.code=r,this.data=i,this.handled=!1,o.DEBUG){for(var l in s=i="UNKNOWN",a.util.Error.Category)a.util.Error.Category[l]==this.category&&(i=l);for(var u in a.util.Error.Code)a.util.Error.Code[u]==this.code&&(s=u);if(this.message="Shaka Error "+i+"."+s+" ("+this.data.toString()+")",a.util.Error.createStack)try{throw Error(this.message)}catch(e){this.stack=e.stack}}},o.exportSymbol("shaka.util.Error",a.util.Error),a.util.Error.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},o.DEBUG&&(a.util.Error.createStack=!0),a.util.Error.Severity={RECOVERABLE:1,CRITICAL:2},o.exportProperty(a.util.Error,"Severity",a.util.Error.Severity),a.util.Error.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9},o.exportProperty(a.util.Error,"Category",a.util.Error.Category),a.util.Error.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,UNKNOWN_DATA_URI_ENCODING:1005,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,UNPLAYABLE_PERIOD:4011,RESTRICTIONS_CANNOT_BE_MET:4012,NO_PERIODS:4014,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_COULD_NOT_GUESS_MIME_TYPE:4021,HLS_MASTER_PLAYLIST_NOT_PROVIDED:4022,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,HLS_COULD_NOT_PARSE_SEGMENT_START_TIME:4030,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,HLS_AES_128_ENCRYPTION_NOT_SUPPORTED:4034,HLS_INTERNAL_SKIP_STREAM:4035,INVALID_STREAMS_CHOSEN:5005,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,SERVER_CERTIFICATE_REQUIRED:6015,INIT_DATA_TRANSFORM_ERROR:6016,LOAD_INTERRUPTED:7e3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,STORE_ALREADY_IN_PROGRESS:9006,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013},o.exportProperty(a.util.Error,"Code",a.util.Error.Code),a.util.PublicPromise=function(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.resolve=e,r.reject=t,r},a.util.PublicPromise.prototype.resolve=function(e){},a.util.PublicPromise.prototype.reject=function(e){},a.util.AbortableOperation=function(e,t){this.promise=e,this.onAbort_=t,this.aborted_=!1},o.exportSymbol("shaka.util.AbortableOperation",a.util.AbortableOperation),a.util.AbortableOperation.failed=function(e){return new a.util.AbortableOperation(Promise.reject(e),(function(){return Promise.resolve()}))},o.exportProperty(a.util.AbortableOperation,"failed",a.util.AbortableOperation.failed),a.util.AbortableOperation.aborted=function(){var e=Promise.reject(a.util.AbortableOperation.abortError());return e.catch((function(){})),new a.util.AbortableOperation(e,(function(){return Promise.resolve()}))},o.exportProperty(a.util.AbortableOperation,"aborted",a.util.AbortableOperation.aborted),a.util.AbortableOperation.abortError=function(){return new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.PLAYER,a.util.Error.Code.OPERATION_ABORTED)},a.util.AbortableOperation.completed=function(e){return new a.util.AbortableOperation(Promise.resolve(e),(function(){return Promise.resolve()}))},o.exportProperty(a.util.AbortableOperation,"completed",a.util.AbortableOperation.completed),a.util.AbortableOperation.notAbortable=function(e){return new a.util.AbortableOperation(e,(function(){return e.catch((function(){}))}))},o.exportProperty(a.util.AbortableOperation,"notAbortable",a.util.AbortableOperation.notAbortable),a.util.AbortableOperation.prototype.abort=function(){return this.aborted_=!0,this.onAbort_()},o.exportProperty(a.util.AbortableOperation.prototype,"abort",a.util.AbortableOperation.prototype.abort),a.util.AbortableOperation.all=function(e){return new a.util.AbortableOperation(Promise.all(e.map((function(e){return e.promise}))),(function(){return Promise.all(e.map((function(e){return e.abort()})))}))},o.exportProperty(a.util.AbortableOperation,"all",a.util.AbortableOperation.all),a.util.AbortableOperation.prototype.finally=function(e){return this.promise.then((function(t){return e(!0)}),(function(t){return e(!1)})),this},o.exportProperty(a.util.AbortableOperation.prototype,"finally",a.util.AbortableOperation.prototype.finally),a.util.AbortableOperation.prototype.chain=function(e,t){var r=this,n=new a.util.PublicPromise,i=a.util.AbortableOperation.abortError(),o=function(){return n.reject(i),r.abort()},s=function(s){return function(l){if(r.aborted_&&s)n.reject(i);else{var u=s?e:t;u?o=a.util.AbortableOperation.wrapChainCallback_(u,l,n):(s?n.resolve:n.reject)(l)}}};return this.promise.then(s(!0),s(!1)),new a.util.AbortableOperation(n,(function(){return o()}))},o.exportProperty(a.util.AbortableOperation.prototype,"chain",a.util.AbortableOperation.prototype.chain),a.util.AbortableOperation.wrapChainCallback_=function(e,t,r){try{var n=e(t);return n&&n.promise&&n.abort?(r.resolve(n.promise),function(){return n.abort()}):(r.resolve(n),function(){return Promise.resolve(n).then((function(){}),(function(){}))})}catch(e){return r.reject(e),function(){return Promise.resolve()}}},a.util.FakeEvent=function(t,r){for(var n in r=void 0===r?{}:r)this[n]=r[n];this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=e.performance&&e.performance.now?e.performance.now():Date.now(),this.type=t,this.isTrusted=!1,this.target=this.currentTarget=null,this.stopped=!1},a.util.FakeEvent.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},a.util.FakeEvent.prototype.stopImmediatePropagation=function(){this.stopped=!0},a.util.FakeEvent.prototype.stopPropagation=function(){},a.util.MultiMap=function(){this.map_={}},a.util.MultiMap.prototype.push=function(e,t){this.map_.hasOwnProperty(e)?this.map_[e].push(t):this.map_[e]=[t]},a.util.MultiMap.prototype.get=function(e){return(e=this.map_[e])?e.slice():null},a.util.MultiMap.prototype.getAll=function(){var e,t=[];for(e in this.map_)t.push.apply(t,this.map_[e]);return t},a.util.MultiMap.prototype.remove=function(e,t){var r=this.map_[e];if(r)for(var n=0;n<r.length;++n)r[n]==t&&(r.splice(n,1),--n)},a.util.MultiMap.prototype.clear=function(){this.map_={}},a.util.MultiMap.prototype.forEach=function(e){for(var t in this.map_)e(t,this.map_[t])},a.util.FakeEventTarget=function(){this.listeners_=new a.util.MultiMap,this.dispatchTarget=this},a.util.FakeEventTarget.prototype.addEventListener=function(e,t,r){this.listeners_.push(e,t)},a.util.FakeEventTarget.prototype.removeEventListener=function(e,t,r){this.listeners_.remove(e,t)},a.util.FakeEventTarget.prototype.dispatchEvent=function(e){o.asserts.assert(e instanceof a.util.FakeEvent,"FakeEventTarget can only dispatch FakeEvents!");for(var t=this.listeners_.get(e.type)||[],r=0;r<t.length;++r){e.target=this.dispatchTarget,e.currentTarget=this.dispatchTarget;var n=t[r];try{n.handleEvent?n.handleEvent(e):n.call(this,e)}catch(e){a.log.error("Uncaught exception in event handler",e,e?e.message:null,e?e.stack:null)}if(e.stopped)break}return e.defaultPrevented},a.util.IDestroyable=function(){},a.util.IDestroyable.prototype.destroy=function(){},a.util.ObjectUtils=function(){},a.util.ObjectUtils.cloneObject=function(e){var t=new Set,r=function(e){switch(typeof e){case"undefined":case"boolean":case"number":case"string":case"symbol":case"function":return e;default:if(!e||e.buffer&&e.buffer.constructor==ArrayBuffer)return e;if(t.has(e))return null;var n=e.constructor==Array;if(e.constructor!=Object&&!n)return null;t.add(e);var i,o=n?[]:{};for(i in e)o[i]=r(e[i]);return n&&(o.length=e.length),o}};return r(e)},a.util.ArrayUtils={},a.util.ArrayUtils.defaultEquals=function(e,t){return!("number"!=typeof e||"number"!=typeof t||!isNaN(e)||!isNaN(t))||e===t},a.util.ArrayUtils.remove=function(e,t){var r=e.indexOf(t);-1<r&&e.splice(r,1)},a.util.ArrayUtils.count=function(e,t){var r=0;return e.forEach((function(e){r+=t(e)?1:0})),r},a.util.ArrayUtils.hasSameElements=function(e,t,r){if(r||(r=a.util.ArrayUtils.defaultEquals),e.length!=t.length)return!1;t=t.slice();for(var n={},o=(e=i.makeIterator(e)).next();!o.done;n={item:n.item},o=e.next()){if(n.item=o.value,-1==(o=t.findIndex(function(e){return function(t){return r(e.item,t)}}(n))))return!1;t[o]=t[t.length-1],t.pop()}return 0==t.length},a.util.OperationManager=function(){this.operations_=[]},a.util.OperationManager.prototype.manage=function(e){var t=this;this.operations_.push(e.finally((function(){a.util.ArrayUtils.remove(t.operations_,e)})))},a.util.OperationManager.prototype.destroy=function(){var e=[];return this.operations_.forEach((function(t){t.promise.catch((function(){})),e.push(t.abort())})),this.operations_=[],Promise.all(e)},a.net.NetworkingEngine=function(e){a.util.FakeEventTarget.call(this),this.destroyed_=!1,this.operationManager_=new a.util.OperationManager,this.requestFilters_=new Set,this.responseFilters_=new Set,this.onProgressUpdated_=e||null},o.inherits(a.net.NetworkingEngine,a.util.FakeEventTarget),o.exportSymbol("shaka.net.NetworkingEngine",a.net.NetworkingEngine),a.net.NetworkingEngine.RequestType={MANIFEST:0,SEGMENT:1,LICENSE:2,APP:3,TIMING:4},o.exportProperty(a.net.NetworkingEngine,"RequestType",a.net.NetworkingEngine.RequestType),a.net.NetworkingEngine.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:3},o.exportProperty(a.net.NetworkingEngine,"PluginPriority",a.net.NetworkingEngine.PluginPriority),a.net.NetworkingEngine.schemes_={},a.net.NetworkingEngine.registerScheme=function(e,t,r){o.asserts.assert(null==r||0<r,"explicit priority must be > 0"),r=r||a.net.NetworkingEngine.PluginPriority.APPLICATION;var n=a.net.NetworkingEngine.schemes_[e];(!n||r>=n.priority)&&(a.net.NetworkingEngine.schemes_[e]={priority:r,plugin:t})},o.exportProperty(a.net.NetworkingEngine,"registerScheme",a.net.NetworkingEngine.registerScheme),a.net.NetworkingEngine.unregisterScheme=function(e){delete a.net.NetworkingEngine.schemes_[e]},o.exportProperty(a.net.NetworkingEngine,"unregisterScheme",a.net.NetworkingEngine.unregisterScheme),a.net.NetworkingEngine.prototype.registerRequestFilter=function(e){this.requestFilters_.add(e)},o.exportProperty(a.net.NetworkingEngine.prototype,"registerRequestFilter",a.net.NetworkingEngine.prototype.registerRequestFilter),a.net.NetworkingEngine.prototype.unregisterRequestFilter=function(e){this.requestFilters_.delete(e)},o.exportProperty(a.net.NetworkingEngine.prototype,"unregisterRequestFilter",a.net.NetworkingEngine.prototype.unregisterRequestFilter),a.net.NetworkingEngine.prototype.clearAllRequestFilters=function(){this.requestFilters_.clear()},o.exportProperty(a.net.NetworkingEngine.prototype,"clearAllRequestFilters",a.net.NetworkingEngine.prototype.clearAllRequestFilters),a.net.NetworkingEngine.prototype.registerResponseFilter=function(e){this.responseFilters_.add(e)},o.exportProperty(a.net.NetworkingEngine.prototype,"registerResponseFilter",a.net.NetworkingEngine.prototype.registerResponseFilter),a.net.NetworkingEngine.prototype.unregisterResponseFilter=function(e){this.responseFilters_.delete(e)},o.exportProperty(a.net.NetworkingEngine.prototype,"unregisterResponseFilter",a.net.NetworkingEngine.prototype.unregisterResponseFilter),a.net.NetworkingEngine.prototype.clearAllResponseFilters=function(){this.responseFilters_.clear()},o.exportProperty(a.net.NetworkingEngine.prototype,"clearAllResponseFilters",a.net.NetworkingEngine.prototype.clearAllResponseFilters),a.net.NetworkingEngine.defaultRetryParameters=function(){return a.net.Backoff.defaultRetryParameters()},o.exportProperty(a.net.NetworkingEngine,"defaultRetryParameters",a.net.NetworkingEngine.defaultRetryParameters),a.net.NetworkingEngine.makeRequest=function(e,t){return{uris:e,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:t,licenseRequestType:null,sessionId:null}},o.exportProperty(a.net.NetworkingEngine,"makeRequest",a.net.NetworkingEngine.makeRequest),a.net.NetworkingEngine.prototype.destroy=function(){return this.destroyed_=!0,this.requestFilters_.clear(),this.responseFilters_.clear(),this.operationManager_.destroy()},o.exportProperty(a.net.NetworkingEngine.prototype,"destroy",a.net.NetworkingEngine.prototype.destroy),a.net.NetworkingEngine.prototype.request=function(e,t){var r=this,n=a.util.ObjectUtils,i=new a.net.NetworkingEngine.NumBytesRemainingClass;if(this.destroyed_)return(n=Promise.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.PLAYER,a.util.Error.Code.OPERATION_ABORTED))).catch((function(){})),new a.net.NetworkingEngine.PendingRequest(n,(function(){return Promise.resolve()}),i);o.asserts.assert(t.uris&&t.uris.length,"Request without URIs!"),t.method=t.method||"GET",t.headers=t.headers||{},t.retryParameters=t.retryParameters?n.cloneObject(t.retryParameters):a.net.NetworkingEngine.defaultRetryParameters(),t.uris=n.cloneObject(t.uris);var s=(n=this.filterRequest_(e,t)).chain((function(){return r.makeRequestWithRetry_(e,t,i)})),l=s.chain((function(t){return r.filterResponse_(e,t)})),u=Date.now(),c=0;n.promise.then((function(){c=Date.now()-u}),(function(){}));var d=0;return s.promise.then((function(){d=Date.now()}),(function(){})),n=l.chain((function(t){var n=Date.now()-d,i=t.response;return i.timeMs+=c,i.timeMs+=n,t.gotProgress||!r.onProgressUpdated_||i.fromCache||e!=a.net.NetworkingEngine.RequestType.SEGMENT||r.onProgressUpdated_(i.timeMs,i.data.byteLength),i}),(function(e){throw e&&(o.asserts.assert(e instanceof a.util.Error,"Wrong error type"),e.severity=a.util.Error.Severity.CRITICAL),e})),n=new a.net.NetworkingEngine.PendingRequest(n.promise,n.onAbort_,i),this.operationManager_.manage(n),n},o.exportProperty(a.net.NetworkingEngine.prototype,"request",a.net.NetworkingEngine.prototype.request),a.net.NetworkingEngine.prototype.filterRequest_=function(e,t){for(var r=a.util.AbortableOperation.completed(void 0),n={},o=i.makeIterator(this.requestFilters_),s=o.next();!s.done;n={requestFilter:n.requestFilter},s=o.next())n.requestFilter=s.value,r=r.chain(function(r){return function(){return r.requestFilter(e,t)}}(n));return r.chain(void 0,(function(e){if(e&&e.code==a.util.Error.Code.OPERATION_ABORTED)throw e;throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.NETWORK,a.util.Error.Code.REQUEST_FILTER_ERROR,e)}))},a.net.NetworkingEngine.prototype.makeRequestWithRetry_=function(e,t,r){var n=new a.net.Backoff(t.retryParameters,!1);return this.send_(e,t,n,0,null,r)},a.net.NetworkingEngine.prototype.send_=function(e,t,r,n,i,s){var l=this,u=new o.Uri(t.uris[n]),c=u.getScheme(),d=!1;c||(c=a.net.NetworkingEngine.getLocationProtocol_(),o.asserts.assert(":"==c[c.length-1],"location.protocol expected to end with a colon!"),c=c.slice(0,-1),u.setScheme(c),t.uris[n]=u.toString()),c=c.toLowerCase();var p,f=(c=a.net.NetworkingEngine.schemes_[c])?c.plugin:null;return f?a.util.AbortableOperation.notAbortable(r.attempt()).chain((function(){if(l.destroyed_)return a.util.AbortableOperation.aborted();p=Date.now();var r=a.net.NetworkingEngine.RequestType.SEGMENT;return f(t.uris[n],t,e,(function(t,n,i){l.onProgressUpdated_&&e==r&&(l.onProgressUpdated_(t,n),d=!0,s.setBytes(i))}))})).chain((function(e){return null==e.timeMs&&(e.timeMs=Date.now()-p),{response:e,gotProgress:d}}),(function(o){if(o&&o.code==a.util.Error.Code.OPERATION_ABORTED)throw o;if(l.destroyed_)return a.util.AbortableOperation.aborted();if(o&&o.severity==a.util.Error.Severity.RECOVERABLE){var u=new a.util.FakeEvent("retry",{error:o instanceof a.util.Error?o:null});return l.dispatchEvent(u),n=(n+1)%t.uris.length,l.send_(e,t,r,n,o,s)}throw o||i})):a.util.AbortableOperation.failed(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.NETWORK,a.util.Error.Code.UNSUPPORTED_SCHEME,u))},a.net.NetworkingEngine.prototype.filterResponse_=function(e,t){for(var r=a.util.AbortableOperation.completed(void 0),n=i.makeIterator(this.responseFilters_),o=n.next();!o.done;o=n.next())r=r.chain(o.value.bind(null,e,t.response));return r.chain((function(){return t}),(function(e){if(e&&e.code==a.util.Error.Code.OPERATION_ABORTED)throw e;var t=a.util.Error.Severity.CRITICAL;throw e instanceof a.util.Error&&(t=e.severity),new a.util.Error(t,a.util.Error.Category.NETWORK,a.util.Error.Code.RESPONSE_FILTER_ERROR,e)}))},a.net.NetworkingEngine.getLocationProtocol_=function(){return location.protocol},a.net.NetworkingEngine.NumBytesRemainingClass=function(){this.bytesToLoad_=0},o.exportProperty(a.net.NetworkingEngine,"NumBytesRemainingClass",a.net.NetworkingEngine.NumBytesRemainingClass),a.net.NetworkingEngine.NumBytesRemainingClass.prototype.setBytes=function(e){this.bytesToLoad_=e},a.net.NetworkingEngine.NumBytesRemainingClass.prototype.getBytes=function(){return this.bytesToLoad_},a.net.NetworkingEngine.PendingRequest=function(e,t,r){a.util.AbortableOperation.call(this,e,t),this.bytesRemaining_=r},i.inherits(a.net.NetworkingEngine.PendingRequest,a.util.AbortableOperation),o.exportProperty(a.net.NetworkingEngine,"PendingRequest",a.net.NetworkingEngine.PendingRequest),a.net.NetworkingEngine.PendingRequest.wrapChainCallback_=a.util.AbortableOperation.wrapChainCallback_,a.net.NetworkingEngine.PendingRequest.all=a.util.AbortableOperation.all,o.exportProperty(a.net.NetworkingEngine.PendingRequest,"all",a.net.NetworkingEngine.PendingRequest.all),a.net.NetworkingEngine.PendingRequest.notAbortable=a.util.AbortableOperation.notAbortable,o.exportProperty(a.net.NetworkingEngine.PendingRequest,"notAbortable",a.net.NetworkingEngine.PendingRequest.notAbortable),a.net.NetworkingEngine.PendingRequest.completed=a.util.AbortableOperation.completed,o.exportProperty(a.net.NetworkingEngine.PendingRequest,"completed",a.net.NetworkingEngine.PendingRequest.completed),a.net.NetworkingEngine.PendingRequest.abortError=a.util.AbortableOperation.abortError,a.net.NetworkingEngine.PendingRequest.aborted=a.util.AbortableOperation.aborted,o.exportProperty(a.net.NetworkingEngine.PendingRequest,"aborted",a.net.NetworkingEngine.PendingRequest.aborted),a.net.NetworkingEngine.PendingRequest.failed=a.util.AbortableOperation.failed,o.exportProperty(a.net.NetworkingEngine.PendingRequest,"failed",a.net.NetworkingEngine.PendingRequest.failed),a.net.NetworkingEngine.PendingRequest.prototype.getBytesRemaining=function(){return this.bytesRemaining_.getBytes()},a.util.IReleasable=function(){},o.exportSymbol("shaka.util.IReleasable",a.util.IReleasable),a.util.IReleasable.prototype.release=function(){},a.util.EventManager=function(){this.bindingMap_=new a.util.MultiMap},o.exportSymbol("shaka.util.EventManager",a.util.EventManager),a.util.EventManager.prototype.release=function(){this.removeAll(),this.bindingMap_=null},o.exportProperty(a.util.EventManager.prototype,"release",a.util.EventManager.prototype.release),a.util.EventManager.prototype.listen=function(e,t,r,n){this.bindingMap_&&(e=new a.util.EventManager.Binding_(e,t,r,n),this.bindingMap_.push(t,e))},o.exportProperty(a.util.EventManager.prototype,"listen",a.util.EventManager.prototype.listen),a.util.EventManager.prototype.listenOnce=function(e,t,r,n){var i=this,o=function(n){i.unlisten(e,t,o),r(n)};this.listen(e,t,o,n)},o.exportProperty(a.util.EventManager.prototype,"listenOnce",a.util.EventManager.prototype.listenOnce),a.util.EventManager.prototype.unlisten=function(e,t,r){if(this.bindingMap_)for(var n=this.bindingMap_.get(t)||[],o=(n=i.makeIterator(n)).next();!o.done;o=n.next())(o=o.value).target!=e||r!=o.listener&&r||(o.unlisten(),this.bindingMap_.remove(t,o))},o.exportProperty(a.util.EventManager.prototype,"unlisten",a.util.EventManager.prototype.unlisten),a.util.EventManager.prototype.removeAll=function(){if(this.bindingMap_){for(var e=this.bindingMap_.getAll(),t=(e=i.makeIterator(e)).next();!t.done;t=e.next())t.value.unlisten();this.bindingMap_.clear()}},o.exportProperty(a.util.EventManager.prototype,"removeAll",a.util.EventManager.prototype.removeAll),a.util.EventManager.Binding_=function(e,t,r,n){this.target=e,this.type=t,this.listener=r,this.options=a.util.EventManager.Binding_.convertOptions_(e,n),this.target.addEventListener(t,r,this.options)},a.util.EventManager.Binding_.prototype.unlisten=function(){o.asserts.assert(this.target,"Missing target"),this.target.removeEventListener(this.type,this.listener,this.options),this.listener=this.target=null,this.options=!1},o.exportProperty(a.util.EventManager.Binding_.prototype,"unlisten",a.util.EventManager.Binding_.prototype.unlisten),a.util.EventManager.Binding_.convertOptions_=function(e,t){if(null==t)return!1;if("boolean"==typeof t)return t;var r=new Set(["passive","capture"]),n=Object.keys(t).filter((function(e){return!r.has(e)}));return o.asserts.assert(0==n.length,"Unsupported flag(s) to addEventListener: "+n.join(",")),a.util.EventManager.Binding_.doesSupportObject_(e)?t:t.capture||!1},a.util.EventManager.Binding_.doesSupportObject_=function(e){var t=a.util.EventManager.Binding_.supportsObject_;if(null==t){t=!1;try{var r={},n={get:function(){return t=!0,!1}};Object.defineProperty(r,"passive",n),Object.defineProperty(r,"capture",n),n=function(){},e.addEventListener("test",n,r),e.removeEventListener("test",n,r)}catch(e){t=!1}a.util.EventManager.Binding_.supportsObject_=t}return t||!1},a.util.EventManager.Binding_.supportsObject_=void 0,a.util.FairPlayUtils=function(){},a.util.FairPlayUtils.defaultGetContentId=function(e){return e=a.util.StringUtils.fromBytesAutoDetect(e),new o.Uri(e).getDomain()},o.exportSymbol("shaka.util.FairPlayUtils.defaultGetContentId",a.util.FairPlayUtils.defaultGetContentId),a.util.FairPlayUtils.initDataTransform=function(e,t,r){if(!r||!r.byteLength)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.DRM,a.util.Error.Code.SERVER_CERTIFICATE_REQUIRED);t="string"==typeof t?new Uint8Array(a.util.StringUtils.toUTF16(t,!0)):new Uint8Array(t),e=a.util.StringUtils.fromBytesAutoDetect(e),e=a.util.StringUtils.toUTF16(e,!0);var n=new Uint8Array(12+e.byteLength+t.byteLength+r.byteLength),i=0,s=function(e){new DataView(n.buffer).setUint32(i,e.byteLength,!0),i+=4,n.set(e,i),i+=e.byteLength};return s(new Uint8Array(e)),s(t),s(new Uint8Array(r)),o.asserts.assert(i==n.length,"Inconsistent init data length"),n},o.exportSymbol("shaka.util.FairPlayUtils.initDataTransform",a.util.FairPlayUtils.initDataTransform),a.util.Iterables=function(){},a.util.Iterables.map=function(e,t){for(var r=[],n=i.makeIterator(e),o=n.next();!o.done;o=n.next())r.push(t(o.value));return r},a.util.Iterables.every=function(e,t){for(var r=i.makeIterator(e),n=r.next();!n.done;n=r.next())if(!t(n.value))return!1;return!0},a.util.Iterables.some=function(e,t){for(var r=i.makeIterator(e),n=r.next();!n.done;n=r.next())if(t(n.value))return!0;return!1},a.util.Iterables.filter=function(e,t){for(var r=[],n=i.makeIterator(e),o=n.next();!o.done;o=n.next())t(o=o.value)&&r.push(o);return r},a.util.MapUtils={},a.util.MapUtils.asMap=function(e){var t=new Map;return Object.keys(e).forEach((function(r){t.set(r,e[r])})),t},a.util.MapUtils.asObject=function(e){var t={};return e.forEach((function(e,r){t[r]=e})),t},a.util.MimeUtils=function(){},a.util.MimeUtils.getFullType=function(e,t){var r=e;return t&&(r+='; codecs="'+t+'"'),r},a.util.MimeUtils.getExtendedType=function(e){var t=[e.mimeType];return a.util.MimeUtils.EXTENDED_MIME_PARAMETERS_.forEach((function(r,n){var i=e[n];i&&t.push(r+'="'+i+'"')})),t.join(";")},a.util.MimeUtils.splitCodecs=function(e){return e.split(",")},a.util.MimeUtils.getCodecBase=function(e){return a.util.MimeUtils.getCodecParts_(e)[0]},a.util.MimeUtils.getCodecParts_=function(e){var t=e.split(".");return e=t[0],t.pop(),[e,t=t.join(".")]},a.util.MimeUtils.EXTENDED_MIME_PARAMETERS_=(new Map).set("codecs","codecs").set("frameRate","framerate").set("bandwidth","bitrate").set("width","width").set("height","height").set("channelsCount","channels"),a.util.MimeUtils.CLOSED_CAPTION_MIMETYPE="application/cea-608",a.util.Platform=function(){},a.util.Platform.supportsMediaSource=function(){return!(!e.MediaSource||!MediaSource.isTypeSupported)},a.util.Platform.supportsMediaType=function(e){return""!=a.util.Platform.anyMediaElement().canPlayType(e)},a.util.Platform.isEdge=function(){return a.util.Platform.userAgentContains_("Edge/")},a.util.Platform.isIE=function(){return a.util.Platform.userAgentContains_("Trident/")},a.util.Platform.isTizen=function(){return a.util.Platform.userAgentContains_("Tizen")},a.util.Platform.isTizen4=function(){return a.util.Platform.userAgentContains_("Tizen 4")},a.util.Platform.isTizen3=function(){return a.util.Platform.userAgentContains_("Tizen 3")},a.util.Platform.isTizen2=function(){return a.util.Platform.userAgentContains_("Tizen 2")},a.util.Platform.isVideoFutur=function(){return a.util.Platform.userAgentContains_("VITIS")},a.util.Platform.isWebOS=function(){return a.util.Platform.userAgentContains_("Web0S")},a.util.Platform.isTiVo=function(){return a.util.Platform.userAgentContains_("TiVo")},a.util.Platform.isChromecast=function(){return a.util.Platform.userAgentContains_("CrKey")},a.util.Platform.isChrome=function(){return a.util.Platform.userAgentContains_("Chrome")&&!a.util.Platform.isEdge()},a.util.Platform.isApple=function(){return!!navigator.vendor&&navigator.vendor.includes("Apple")&&!a.util.Platform.isTizen()},a.util.Platform.safariVersion=function(){if(!a.util.Platform.isApple())return null;var e=navigator.userAgent.match(/Version\/(\d+)/);return e||(e=navigator.userAgent.match(/OS (\d+)(?:_\d+)?/))?parseInt(e[1],10):null},a.util.Platform.isMobile=function(){return!!/(?:iPhone|iPad|iPod|Android)/.test(navigator.userAgent)||a.util.Platform.isApple()&&1<navigator.maxTouchPoints},a.util.Platform.userAgentContains_=function(e){return(navigator.userAgent||"").includes(e)},a.util.Platform.anyMediaElement=function(){var e=a.util.Platform;return e.cachedMediaElement_||(e.cacheExpirationTimer_||(e.cacheExpirationTimer_=new a.util.Timer((function(){e.cachedMediaElement_=null}))),e.cachedMediaElement_=document.getElementsByTagName("video")[0]||document.getElementsByTagName("audio")[0],e.cachedMediaElement_||(e.cachedMediaElement_=document.createElement("video")),e.cacheExpirationTimer_.tickAfter(1)),e.cachedMediaElement_},a.util.Platform.cacheExpirationTimer_=null,a.util.Platform.cachedMediaElement_=null,a.util.StringUtils={},a.util.StringUtils.fromUTF8=function(e){if(!e)return"";239==(e=new Uint8Array(e))[0]&&187==e[1]&&191==e[2]&&(e=e.subarray(3)),e=a.util.StringUtils.fromCharCode(e),e=escape(e);try{return decodeURIComponent(e)}catch(e){throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.BAD_ENCODING)}},o.exportSymbol("shaka.util.StringUtils.fromUTF8",a.util.StringUtils.fromUTF8),a.util.StringUtils.fromUTF16=function(e,t,r){if(!e)return"";if(!r&&0!=e.byteLength%2)throw a.log.error("Data has an incorrect length, must be even."),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.BAD_ENCODING);if(e instanceof ArrayBuffer)var n=e;else(r=new Uint8Array(e.byteLength)).set(new Uint8Array(e)),n=r.buffer;e=Math.floor(e.byteLength/2),r=new Uint16Array(e),n=new DataView(n);for(var i=0;i<e;i++)r[i]=n.getUint16(2*i,t);return a.util.StringUtils.fromCharCode(r)},o.exportSymbol("shaka.util.StringUtils.fromUTF16",a.util.StringUtils.fromUTF16),a.util.StringUtils.fromBytesAutoDetect=function(e){var t=a.util.StringUtils,r=new Uint8Array(e);if(239==r[0]&&187==r[1]&&191==r[2])return t.fromUTF8(r);if(254==r[0]&&255==r[1])return t.fromUTF16(r.subarray(2),!1);if(255==r[0]&&254==r[1])return t.fromUTF16(r.subarray(2),!0);var n=function(e,t){return e.byteLength<=t||32<=e[t]&&126>=e[t]}.bind(null,r);if(a.log.debug("Unable to find byte-order-mark, making an educated guess."),0==r[0]&&0==r[2])return t.fromUTF16(e,!1);if(0==r[1]&&0==r[3])return t.fromUTF16(e,!0);if(n(0)&&n(1)&&n(2)&&n(3))return t.fromUTF8(e);throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.UNABLE_TO_DETECT_ENCODING)},o.exportSymbol("shaka.util.StringUtils.fromBytesAutoDetect",a.util.StringUtils.fromBytesAutoDetect),a.util.StringUtils.toUTF8=function(e){e=encodeURIComponent(e),e=unescape(e);for(var t=new Uint8Array(e.length),r=0;r<e.length;++r)t[r]=e.charCodeAt(r);return t.buffer},o.exportSymbol("shaka.util.StringUtils.toUTF8",a.util.StringUtils.toUTF8),a.util.StringUtils.toUTF16=function(e,t){for(var r=new Uint8Array(2*e.length),n=new DataView(r.buffer),i=0;i<e.length;++i){var o=e.charCodeAt(i);n.setUint16(2*i,o,t)}return r.buffer},o.exportSymbol("shaka.util.StringUtils.toUTF16",a.util.StringUtils.toUTF16),a.util.StringUtils.fromCharCode=function(e){if(!a.util.StringUtils.fromCharCodeImpl_)for(var t=function(e){try{var t=new Uint8Array(e),r=String.fromCharCode.apply(null,t);return o.asserts.assert(r,"Should get value"),0<r.length}catch(e){return!1}},r={size:65536};0<r.size;(r={size:r.size}).size/=2)if(t(r.size)){a.util.StringUtils.fromCharCodeImpl_=function(e){return function(t){for(var r="",n=0;n<t.length;n+=e.size){var i=t.subarray(n,n+e.size);r+=String.fromCharCode.apply(null,i)}return r}}(r);break}return o.asserts.assert(a.util.StringUtils.fromCharCodeImpl_,"Unable to create a fromCharCode method"),a.util.StringUtils.fromCharCodeImpl_(e)},a.util.StringUtils.fromCharCodeImpl_=null,a.util.StringUtils.resetFromCharCode=function(){a.util.StringUtils.fromCharCodeImpl_=null},o.exportSymbol("shaka.util.StringUtils.resetFromCharCode",a.util.StringUtils.resetFromCharCode),a.util.Uint8ArrayUtils={},a.util.Uint8ArrayUtils.toBase64=function(t,r){var n=a.util.StringUtils.fromCharCode(t);return r=null==r||r,n=e.btoa(n).replace(/\+/g,"-").replace(/\//g,"_"),r?n:n.replace(/=*$/,"")},o.exportSymbol("shaka.util.Uint8ArrayUtils.toBase64",a.util.Uint8ArrayUtils.toBase64),a.util.Uint8ArrayUtils.fromBase64=function(t){t=e.atob(t.replace(/-/g,"+").replace(/_/g,"/"));for(var r=new Uint8Array(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r},o.exportSymbol("shaka.util.Uint8ArrayUtils.fromBase64",a.util.Uint8ArrayUtils.fromBase64),a.util.Uint8ArrayUtils.fromHex=function(t){for(var r=new Uint8Array(t.length/2),n=0;n<t.length;n+=2)r[n/2]=e.parseInt(t.substr(n,2),16);return r},o.exportSymbol("shaka.util.Uint8ArrayUtils.fromHex",a.util.Uint8ArrayUtils.fromHex),a.util.Uint8ArrayUtils.toHex=function(e){for(var t="",r=0;r<e.length;++r){var n=e[r].toString(16);1==n.length&&(n="0"+n),t+=n}return t},o.exportSymbol("shaka.util.Uint8ArrayUtils.toHex",a.util.Uint8ArrayUtils.toHex),a.util.Uint8ArrayUtils.equal=function(e,t){if(!e&&!t)return!0;if(!e||!t||e.length!=t.length)return!1;for(var r=0;r<e.length;++r)if(e[r]!=t[r])return!1;return!0},o.exportSymbol("shaka.util.Uint8ArrayUtils.equal",a.util.Uint8ArrayUtils.equal),a.util.Uint8ArrayUtils.concat=function(e){for(var t=[],r=0;r<arguments.length;++r)t[r-0]=arguments[r];for(var n=r=0;n<t.length;++n)r+=t[n].length;r=new Uint8Array(r);for(var i=n=0;i<t.length;++i)r.set(t[i],n),n+=t[i].length;return r},o.exportSymbol("shaka.util.Uint8ArrayUtils.concat",a.util.Uint8ArrayUtils.concat),a.media={},a.media.DrmEngine=function(e,t){var r=this;t=void 0===t?1:t,this.playerInterface_=e,this.supportedTypes_=new Set,this.video_=this.mediaKeys_=null,this.initialized_=!1,this.licenseTimeSeconds_=0,this.currentDrmInfo_=null,this.eventManager_=new a.util.EventManager,this.activeSessions_=new Map,this.offlineSessionIds_=[],this.allSessionsLoaded_=new a.util.PublicPromise,this.config_=null,this.onError_=function(t){r.allSessionsLoaded_.reject(t),e.onError(t)},this.keyStatusByKeyId_=new Map,this.announcedKeyStatusByKeyId_=new Map,this.keyStatusTimer_=new a.util.Timer((function(){return r.processKeyStatusChanges_()})),this.isDestroying_=!1,this.finishedDestroyingPromise_=new a.util.PublicPromise,this.usePersistentLicenses_=!1,this.mediaKeyMessageEvents_=[],this.initialRequestsSent_=!1,this.expirationTimer_=new a.util.Timer((function(){r.pollExpiration_()})).tickEvery(t),this.allSessionsLoaded_.catch((function(){}))},a.media.DrmEngine.prototype.destroy=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return e.isDestroying_?t.yield(e.finishedDestroyingPromise_,0):(e.isDestroying_=!0,t.yield(e.destroyNow_(),4));case 4:e.finishedDestroyingPromise_.resolve(),t.jumpTo(0)}}))}))},a.media.DrmEngine.prototype.destroyNow_=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return e.eventManager_.release(),e.eventManager_=null,e.allSessionsLoaded_.reject(),e.expirationTimer_.stop(),e.expirationTimer_=null,e.keyStatusTimer_.stop(),e.keyStatusTimer_=null,t.yield(e.closeOpenSessions_(),2);case 2:if(!e.video_){t.jumpTo(3);break}return o.asserts.assert(!e.video_.src,"video src must be removed first!"),t.setCatchFinallyBlocks(4),t.yield(e.video_.setMediaKeys(null),6);case 6:t.leaveTryBlock(5);break;case 4:t.enterCatchBlock();case 5:e.video_=null;case 3:e.currentDrmInfo_=null,e.supportedTypes_.clear(),e.mediaKeys_=null,e.offlineSessionIds_=[],e.config_=null,e.onError_=null,e.playerInterface_=null,t.jumpToEnd()}}))}))},a.media.DrmEngine.prototype.configure=function(e){this.config_=e},a.media.DrmEngine.prototype.initForStorage=function(e,t){return this.offlineSessionIds_=[],this.usePersistentLicenses_=t,this.init_(e)},a.media.DrmEngine.prototype.initForPlayback=function(e,t){return this.offlineSessionIds_=t,this.usePersistentLicenses_=0<t.length,this.init_(e)},a.media.DrmEngine.prototype.initForRemoval=function(e,t,r,n,i){var o=new Map;return o.set(e,{audioCapabilities:n,videoCapabilities:i,distinctiveIdentifier:"optional",persistentState:"required",sessionTypes:["persistent-license"],label:e,drmInfos:[{keySystem:e,licenseServerUri:t,distinctiveIdentifierRequired:!1,persistentStateRequired:!0,audioRobustness:"",videoRobustness:"",serverCertificate:r,initData:null,keyIds:null}]}),this.queryMediaKeys_(o)},a.media.DrmEngine.prototype.init_=function(e){o.asserts.assert(this.config_,"DrmEngine configure() must be called before init()!");var t=this.configureClearKey_();if(t)for(var r=i.makeIterator(e),n=r.next();!n.done;n=r.next())n.value.drmInfos=[t];for((t=e.some((function(e){return 0<e.drmInfos.length})))||(n=a.util.MapUtils.asMap(this.config_.servers),a.media.DrmEngine.replaceDrmInfo_(e,n)),n=(r=i.makeIterator(e)).next();!n.done;n=r.next())for(var s=(n=i.makeIterator(n.value.drmInfos)).next();!s.done;s=n.next())a.media.DrmEngine.fillInDrmInfoDefaults_(s.value,a.util.MapUtils.asMap(this.config_.servers),a.util.MapUtils.asMap(this.config_.advanced||{}));return(e=this.prepareMediaKeyConfigsForVariants_(e)).size?(e=this.queryMediaKeys_(e),t?e:e.catch((function(){}))):(this.initialized_=!0,Promise.resolve())},a.media.DrmEngine.prototype.attach=function(e){var t=this;if(!this.mediaKeys_)return this.eventManager_.listenOnce(e,"encrypted",(function(e){t.onError_(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.DRM,a.util.Error.Code.ENCRYPTED_CONTENT_WITHOUT_DRM_INFO))})),Promise.resolve();this.video_=e,this.eventManager_.listenOnce(this.video_,"play",(function(){return t.onPlay_()})),"webkitCurrentPlaybackTargetIsWireless"in this.video_&&this.eventManager_.listen(this.video_,"webkitcurrentplaybacktargetiswirelesschanged",(function(){return t.closeOpenSessions_()})),e=(e=this.video_.setMediaKeys(this.mediaKeys_)).catch((function(e){return Promise.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.DRM,a.util.Error.Code.FAILED_TO_ATTACH_TO_VIDEO,e.message))}));var r=this.setServerCertificate();return Promise.all([e,r]).then((function(){if(t.isDestroying_)return Promise.reject();t.createOrLoad(),t.currentDrmInfo_.initData.length||t.offlineSessionIds_.length||t.eventManager_.listen(t.video_,"encrypted",(function(e){return t.newInitData(e.initDataType,new Uint8Array(e.initData))}))})).catch((function(e){if(!t.isDestroying_)return Promise.reject(e)}))},a.media.DrmEngine.prototype.setServerCertificate=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var r;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:if(o.asserts.assert(e.initialized_,"Must call init() before setServerCertificate"),!(e.mediaKeys_&&e.currentDrmInfo_&&e.currentDrmInfo_.serverCertificate&&e.currentDrmInfo_.serverCertificate.length)){t.jumpTo(0);break}return t.setCatchFinallyBlocks(3),t.yield(e.mediaKeys_.setServerCertificate(e.currentDrmInfo_.serverCertificate),5);case 5:t.yieldResult||a.log.warning("Server certificates are not supported by the key system.  The server certificate has been ignored."),t.leaveTryBlock(0);break;case 3:return r=t.enterCatchBlock(),t.return(Promise.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.DRM,a.util.Error.Code.INVALID_SERVER_CERTIFICATE,r.message)))}}))}))},a.media.DrmEngine.prototype.removeSession=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){var n,s,l;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return o.asserts.assert(t.mediaKeys_,"Must call init() before removeSession"),r.yield(t.loadOfflineSession_(e),2);case 2:return(n=r.yieldResult)?(s=[],(l=t.activeSessions_.get(n))&&(l.updatePromise=new a.util.PublicPromise,s.push(l.updatePromise)),a.log.v2("Attempting to remove session",e),s.push(n.remove()),r.yield(Promise.all(s),0)):(a.log.v2("Ignoring attempt to remove missing session",e),r.return())}}))}))},a.media.DrmEngine.prototype.createOrLoad=function(){var e=this,t=this.currentDrmInfo_?this.currentDrmInfo_.initData:[];return t.forEach((function(t){return e.createTemporarySession_(t.initDataType,t.initData)})),this.offlineSessionIds_.forEach((function(t){return e.loadOfflineSession_(t)})),t.length||this.offlineSessionIds_.length||this.allSessionsLoaded_.resolve(),this.allSessionsLoaded_},a.media.DrmEngine.prototype.newInitData=function(e,t){for(var r=a.util.Uint8ArrayUtils,n=this.activeSessions_.values(),o=(n=i.makeIterator(n)).next();!o.done;o=n.next())if(r.equal(t,o.value.initData)&&!a.util.Platform.isTizen2())return void a.log.debug("Ignoring duplicate init data.");this.createTemporarySession_(e,t)},a.media.DrmEngine.prototype.initialized=function(){return this.initialized_},a.media.DrmEngine.keySystem=function(e){return e?e.keySystem:""},a.media.DrmEngine.prototype.willSupport=function(e){return!!a.util.Platform.isEdge()||this.supportedTypes_.has(e)},a.media.DrmEngine.prototype.getSessionIds=function(){var e=this.activeSessions_.keys();return e=a.util.Iterables.map(e,(function(e){return e.sessionId})),Array.from(e)},a.media.DrmEngine.prototype.getExpiration=function(){for(var e=1/0,t=this.activeSessions_.keys(),r=(t=i.makeIterator(t)).next();!r.done;r=t.next())r=r.value,isNaN(r.expiration)||(e=Math.min(e,r.expiration));return e},a.media.DrmEngine.prototype.getLicenseTime=function(){return this.licenseTimeSeconds_?this.licenseTimeSeconds_:NaN},a.media.DrmEngine.prototype.getDrmInfo=function(){return this.currentDrmInfo_},a.media.DrmEngine.prototype.getKeyStatuses=function(){return a.util.MapUtils.asObject(this.announcedKeyStatusByKeyId_)},a.media.DrmEngine.prototype.prepareMediaKeyConfigsForVariants_=function(e){for(var t=new Set,r=i.makeIterator(e),n=r.next();!n.done;n=r.next()){var s=i.makeIterator(n.value.drmInfos);for(n=s.next();!n.done;n=s.next())t.add(n.value)}for(n=(r=i.makeIterator(t)).next();!n.done;n=r.next())a.media.DrmEngine.fillInDrmInfoDefaults_(n.value,a.util.MapUtils.asMap(this.config_.servers),a.util.MapUtils.asMap(this.config_.advanced||{}));s=this.usePersistentLicenses_?"required":"optional";var l=this.usePersistentLicenses_?["persistent-license"]:["temporary"];for(r=new Map,n=(t=i.makeIterator(t)).next();!n.done;n=t.next())n=n.value,r.set(n.keySystem,{audioCapabilities:[],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:s,sessionTypes:l,label:n.keySystem,drmInfos:[]});for(n=(e=i.makeIterator(e)).next();!n.done;n=e.next()){t=(n=n.value).audio,s=n.video,l=t?a.util.MimeUtils.getFullType(t.mimeType,t.codecs):"";var u=s?a.util.MimeUtils.getFullType(s.mimeType,s.codecs):"",c=i.makeIterator(n.drmInfos);for(n=c.next();!n.done;n=c.next()){n=n.value;var d=r.get(n.keySystem);o.asserts.assert(d,"Any missing configs should have be filled in before."),d.drmInfos.push(n),n.distinctiveIdentifierRequired&&(d.distinctiveIdentifier="required"),n.persistentStateRequired&&(d.persistentState="required"),t&&d.audioCapabilities.push({robustness:n.audioRobustness||"",contentType:l}),s&&d.videoCapabilities.push({robustness:n.videoRobustness||"",contentType:u})}}return r},a.media.DrmEngine.prototype.queryMediaKeys_=function(e){if(1==e.size&&e.has(""))return Promise.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.DRM,a.util.Error.Code.NO_RECOGNIZED_KEY_SYSTEMS));for(var t=i.makeIterator(e.values()),r=t.next();!r.done;r=t.next())0==(r=r.value).audioCapabilities.length&&delete r.audioCapabilities,0==r.videoCapabilities.length&&delete r.videoCapabilities;var n=t=new a.util.PublicPromise;return[!0,!1].forEach(function(t){var r=this;e.forEach((function(e,i){e.drmInfos.some((function(e){return!!e.licenseServerUri}))==t&&(n=n.catch(function(){if(!this.isDestroying_)return navigator.requestMediaKeySystemAccess(i,[e])}.bind(r)))}))}.bind(this)),n=(n=n.catch((function(){return Promise.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.DRM,a.util.Error.Code.REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE))}))).then(function(t){if(this.isDestroying_)return Promise.reject();this.supportedTypes_.clear();var r=t.getConfiguration(),n=r.videoCapabilities||[],s=i.makeIterator(r.audioCapabilities||[]);for(r=s.next();!r.done;r=s.next())this.supportedTypes_.add(r.value.contentType);for(r=(n=i.makeIterator(n)).next();!r.done;r=n.next())this.supportedTypes_.add(r.value.contentType);return o.asserts.assert(this.supportedTypes_.size,"We should get at least one supported MIME type"),this.currentDrmInfo_=a.media.DrmEngine.createDrmInfoFor_(t.keySystem,e.get(t.keySystem)),this.currentDrmInfo_.licenseServerUri?t.createMediaKeys():Promise.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.DRM,a.util.Error.Code.NO_LICENSE_SERVER_GIVEN,this.currentDrmInfo_.keySystem))}.bind(this)).then(function(e){if(this.isDestroying_)return Promise.reject();a.log.info("Created MediaKeys object for key system",this.currentDrmInfo_.keySystem),this.mediaKeys_=e,this.initialized_=!0}.bind(this)).catch(function(e){if(!this.isDestroying_)return this.currentDrmInfo_=null,this.supportedTypes_.clear(),e instanceof a.util.Error?Promise.reject(e):Promise.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.DRM,a.util.Error.Code.FAILED_TO_CREATE_CDM,e.message))}.bind(this)),t.reject(),n},a.media.DrmEngine.prototype.configureClearKey_=function(){var t=a.util.MapUtils.asMap(this.config_.clearKeys);if(0==t.size)return null;var r=a.util.StringUtils,n=a.util.Uint8ArrayUtils,i=[],o=[];t.forEach((function(e,t){var r=n.fromHex(t),a=n.fromHex(e);r={kty:"oct",kid:n.toBase64(r,!1),k:n.toBase64(a,!1)},i.push(r),o.push(r.kid)})),t=JSON.stringify({keys:i});var s=JSON.stringify({kids:o});return r=[{initData:new Uint8Array(r.toUTF8(s)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+e.btoa(t),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:r,keyIds:[]}},a.media.DrmEngine.prototype.loadOfflineSession_=function(e){try{a.log.v1("Attempting to load an offline session",e);var t=this.mediaKeys_.createSession("persistent-license")}catch(e){var r=new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.DRM,a.util.Error.Code.FAILED_TO_CREATE_SESSION,e.message);return this.onError_(r),Promise.reject(r)}this.eventManager_.listen(t,"message",this.onSessionMessage_.bind(this)),this.eventManager_.listen(t,"keystatuseschange",this.onKeyStatusesChange_.bind(this));var n={initData:null,loaded:!1,oldExpiration:1/0,updatePromise:null};return this.activeSessions_.set(t,n),t.load(e).then(function(r){return this.isDestroying_?Promise.reject():(a.log.v2("Loaded offline session",e,r),r?(n.loaded=!0,this.areAllSessionsLoaded_()&&this.allSessionsLoaded_.resolve(),t):(this.activeSessions_.delete(t),void this.onError_(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.DRM,a.util.Error.Code.OFFLINE_SESSION_REMOVED))))}.bind(this),function(e){this.isDestroying_||(this.activeSessions_.delete(t),this.onError_(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.DRM,a.util.Error.Code.FAILED_TO_CREATE_SESSION,e.message)))}.bind(this))},a.media.DrmEngine.prototype.createTemporarySession_=function(e,t){var r=this;try{if(this.usePersistentLicenses_){a.log.v1("Creating new persistent session");var n=this.mediaKeys_.createSession("persistent-license")}else a.log.v1("Creating new temporary session"),n=this.mediaKeys_.createSession()}catch(e){return void this.onError_(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.DRM,a.util.Error.Code.FAILED_TO_CREATE_SESSION,e.message))}this.eventManager_.listen(n,"message",this.onSessionMessage_.bind(this)),this.eventManager_.listen(n,"keystatuseschange",this.onKeyStatusesChange_.bind(this)),this.activeSessions_.set(n,{initData:t,loaded:!1,oldExpiration:1/0,updatePromise:null});try{t=this.config_.initDataTransform(t,this.currentDrmInfo_)}catch(e){var i=e;return e instanceof a.util.Error||(i=new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.DRM,a.util.Error.Code.INIT_DATA_TRANSFORM_ERROR,e)),void this.onError_(i)}n.generateRequest(e,t.buffer).catch((function(e){if(!r.isDestroying_){if(r.activeSessions_.delete(n),e.errorCode&&e.errorCode.systemCode){var t=e.errorCode.systemCode;0>t&&(t+=Math.pow(2,32)),t="0x"+t.toString(16)}r.onError_(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.DRM,a.util.Error.Code.FAILED_TO_GENERATE_LICENSE_REQUEST,e.message,e,t))}}))},a.media.DrmEngine.defaultInitDataTransform=function(e,t){if(a.media.DrmEngine.keySystem(t).startsWith("com.apple.fps")){var r=t.serverCertificate,n=a.util.FairPlayUtils.defaultGetContentId(e);e=a.util.FairPlayUtils.initDataTransform(e,n,r)}return e},a.media.DrmEngine.prototype.onSessionMessage_=function(e){this.delayLicenseRequest_()?this.mediaKeyMessageEvents_.push(e):this.sendLicenseRequest_(e)},a.media.DrmEngine.prototype.delayLicenseRequest_=function(){return!!this.video_&&(this.config_.delayLicenseRequestUntilPlayed&&this.video_.paused&&!this.initialRequestsSent_)},a.media.DrmEngine.prototype.sendLicenseRequest_=function(e){var t=e.target;a.log.v1("Sending license request for session",t.sessionId,"of type",e.messageType);var r=this.activeSessions_.get(t),n=this.currentDrmInfo_.licenseServerUri,i=this.config_.advanced[this.currentDrmInfo_.keySystem];"individualization-request"==e.messageType&&i&&i.individualizationServer&&(n=i.individualizationServer),i=a.net.NetworkingEngine.RequestType.LICENSE,(n=a.net.NetworkingEngine.makeRequest([n],this.config_.retryParameters)).body=e.message,n.method="POST",n.licenseRequestType=e.messageType,n.sessionId=t.sessionId,"com.microsoft.playready"!=this.currentDrmInfo_.keySystem&&"com.chromecast.playready"!=this.currentDrmInfo_.keySystem||this.unpackPlayReadyRequest_(n),this.currentDrmInfo_.keySystem.startsWith("com.apple.fps")&&this.config_.fairPlayTransform&&this.formatFairPlayRequest_(n);var s=Date.now();this.playerInterface_.netEngine.request(i,n).promise.then(function(e){return this.isDestroying_?Promise.reject():(this.currentDrmInfo_.keySystem.startsWith("com.apple.fps")&&this.config_.fairPlayTransform&&this.parseFairPlayResponse_(e),this.licenseTimeSeconds_+=(Date.now()-s)/1e3,a.log.v1("Updating session",t.sessionId),t.update(e.data).then(function(){var e=this,t=new a.util.FakeEvent("drmsessionupdate");this.playerInterface_.onEvent(t),r&&(r.updatePromise&&r.updatePromise.resolve(),new a.util.Timer((function(){r.loaded=!0,e.areAllSessionsLoaded_()&&e.allSessionsLoaded_.resolve()})).tickAfter(a.media.DrmEngine.SESSION_LOAD_TIMEOUT_))}.bind(this)))}.bind(this),function(e){this.isDestroying_||(o.asserts.assert(e instanceof a.util.Error,"Wrong NetworkingEngine error type!"),e=new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.DRM,a.util.Error.Code.LICENSE_REQUEST_FAILED,e),this.onError_(e),r&&r.updatePromise&&r.updatePromise.reject(e))}.bind(this)).catch(function(e){this.isDestroying_||(e=new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.DRM,a.util.Error.Code.LICENSE_RESPONSE_REJECTED,e.message),this.onError_(e),r&&r.updatePromise&&r.updatePromise.reject(e))}.bind(this))},a.media.DrmEngine.prototype.unpackPlayReadyRequest_=function(e){var t=a.util.StringUtils.fromUTF16(e.body,!0,!0);if(t.includes("PlayReadyKeyMessage")){a.log.debug("Unwrapping PlayReady request.");for(var r=(t=(new DOMParser).parseFromString(t,"application/xml")).getElementsByTagName("HttpHeader"),n=0;n<r.length;++n){var i=r[n].getElementsByTagName("name")[0],s=r[n].getElementsByTagName("value")[0];o.asserts.assert(i&&s,"Malformed PlayReady headers!"),e.headers[i.textContent]=s.textContent}t=t.getElementsByTagName("Challenge")[0],o.asserts.assert(t,"Malformed PlayReady challenge!"),o.asserts.assert("base64encoded"==t.getAttribute("encoding"),"Unexpected PlayReady challenge encoding!"),e.body=a.util.Uint8ArrayUtils.fromBase64(t.textContent).buffer}else a.log.debug("PlayReady request is already unwrapped."),e.headers["Content-Type"]="text/xml; charset=utf-8"},a.media.DrmEngine.prototype.formatFairPlayRequest_=function(e){var t=new Uint8Array(e.body);t=a.util.Uint8ArrayUtils.toBase64(t),e.headers["Content-Type"]="application/x-www-form-urlencoded",e.body=a.util.StringUtils.toUTF8("spc="+t)},a.media.DrmEngine.prototype.parseFairPlayResponse_=function(e){try{var t=a.util.StringUtils.fromUTF8(e.data)}catch(e){return}"<ckc>"===(t=t.trim()).substr(0,5)&&"</ckc>"===t.substr(-6)&&(t=t.slice(5,-6));try{t=JSON.parse(t).ckc}catch(e){}e.data=a.util.Uint8ArrayUtils.fromBase64(t).buffer},a.media.DrmEngine.prototype.onKeyStatusesChange_=function(e){e=e.target,a.log.v2("Key status changed for session",e.sessionId);var t=this.activeSessions_.get(e),r=!1;e.keyStatuses.forEach(function(e,n){if("string"==typeof n){var i=n;n=e,e=i}if(!("com.microsoft.playready"!=this.currentDrmInfo_.keySystem||16!=n.byteLength||a.util.Platform.isTizen()||a.util.Platform.isVideoFutur()||a.util.Platform.isWebOS()||a.util.Platform.isTiVo())){var s=(i=new DataView(n)).getUint32(0,!0),l=i.getUint16(4,!0),u=i.getUint16(6,!0);i.setUint32(0,s,!1),i.setUint16(4,l,!1),i.setUint16(6,u,!1)}"com.microsoft.playready"==this.currentDrmInfo_.keySystem&&"status-pending"==e&&(e="usable"),"status-pending"!=e&&(t.loaded=!0),t||o.asserts.assert("usable"!=e,"Usable keys found in closed session"),"expired"==e&&(r=!0),i=a.util.Uint8ArrayUtils.toHex(new Uint8Array(n)),this.keyStatusByKeyId_.set(i,e)}.bind(this));var n=e.expiration-Date.now();(0>n||r&&1e3>n)&&t&&!t.updatePromise&&(a.log.debug("Session has expired",e.sessionId),this.activeSessions_.delete(e),e.close().catch((function(){}))),this.areAllSessionsLoaded_()&&(this.allSessionsLoaded_.resolve(),this.keyStatusTimer_.tickAfter(a.media.DrmEngine.KEY_STATUS_BATCH_TIME_))},a.media.DrmEngine.prototype.processKeyStatusChanges_=function(){var e=this.keyStatusByKeyId_,t=this.announcedKeyStatusByKeyId_;t.clear(),e.forEach((function(e,r){return t.set(r,e)})),(e=Array.from(t.values())).length&&e.every((function(e){return"expired"==e}))&&this.onError_(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.DRM,a.util.Error.Code.EXPIRED)),this.playerInterface_.onKeyStatus(a.util.MapUtils.asObject(t))},a.media.DrmEngine.isBrowserSupported=function(){return!!(e.MediaKeys&&e.navigator&&e.navigator.requestMediaKeySystemAccess&&e.MediaKeySystemAccess&&e.MediaKeySystemAccess.prototype.getConfiguration)},a.media.DrmEngine.probeSupport=function(){o.asserts.assert(a.media.DrmEngine.isBrowserSupported(),"Must have basic EME support");var e=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],t=[{videoCapabilities:e,persistentState:"required",sessionTypes:["persistent-license"]},{videoCapabilities:e}],r=new Map;return e="org.w3.clearkey com.widevine.alpha com.microsoft.playready com.apple.fps.3_0 com.apple.fps.2_0 com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" ").map((function(e){return function(e){return i.asyncExecutePromiseGeneratorFunction((function n(){var o,s,l;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return n.setCatchFinallyBlocks(2),n.yield(navigator.requestMediaKeySystemAccess(e,t),4);case 4:return o=n.yieldResult,l=!!(s=o.getConfiguration().sessionTypes)&&s.includes("persistent-license"),a.util.Platform.isTizen3()&&(l=!1),r.set(e,{persistentState:l}),n.yield(o.createMediaKeys(),5);case 5:n.leaveTryBlock(0);break;case 2:n.enterCatchBlock(),r.set(e,null),n.jumpToEnd()}}))}))}(e)})),Promise.all(e).then((function(){return a.util.MapUtils.asObject(r)}))},a.media.DrmEngine.prototype.onPlay_=function(){for(var e=0;e<this.mediaKeyMessageEvents_.length;e++)this.sendLicenseRequest_(this.mediaKeyMessageEvents_[e]);this.initialRequestsSent_=!0,this.mediaKeyMessageEvents_=[]},a.media.DrmEngine.prototype.supportsVariant=function(e){var t=e.audio,r=e.video;if(t&&t.encrypted&&(t=a.util.MimeUtils.getFullType(t.mimeType,t.codecs),!this.willSupport(t))||r&&r.encrypted&&(r=a.util.MimeUtils.getFullType(r.mimeType,r.codecs),!this.willSupport(r)))return!1;var n=a.media.DrmEngine.keySystem(this.currentDrmInfo_);return 0==e.drmInfos.length||e.drmInfos.some((function(e){return e.keySystem==n}))},a.media.DrmEngine.areDrmCompatible=function(e,t){return!e.length||!t.length||0<a.media.DrmEngine.getCommonDrmInfos(e,t).length},a.media.DrmEngine.getCommonDrmInfos=function(e,t){if(!e.length)return t;if(!t.length)return e;for(var r=[],n=0;n<e.length;n++)for(var i=0;i<t.length;i++)if(e[n].keySystem==t[i].keySystem){var o=e[n];i=t[i];var a=[];a=(a=a.concat(o.initData||[])).concat(i.initData||[]);var s=[];s=(s=s.concat(o.keyIds)).concat(i.keyIds),r.push({keySystem:o.keySystem,licenseServerUri:o.licenseServerUri||i.licenseServerUri,distinctiveIdentifierRequired:o.distinctiveIdentifierRequired||i.distinctiveIdentifierRequired,persistentStateRequired:o.persistentStateRequired||i.persistentStateRequired,videoRobustness:o.videoRobustness||i.videoRobustness,audioRobustness:o.audioRobustness||i.audioRobustness,serverCertificate:o.serverCertificate||i.serverCertificate,initData:a,keyIds:s});break}return r},a.media.DrmEngine.prototype.closeOpenSessions_=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var r;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return r=Array.from(e.activeSessions_.keys()),e.activeSessions_.clear(),t.yield(Promise.all(r.map((function(e){return i.asyncExecutePromiseGeneratorFunction((function t(){return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return a.log.v1("Closing session",e.sessionId),t.setCatchFinallyBlocks(2),t.yield(Promise.all([e.close(),e.closed]),4);case 4:t.leaveTryBlock(0);break;case 2:t.enterCatchBlock(),t.jumpToEnd()}}))}))}))),0)}}))}))},a.media.DrmEngine.prototype.pollExpiration_=function(){var e=this;this.activeSessions_.forEach((function(t,r){var n=t.oldExpiration,i=r.expiration;isNaN(i)&&(i=1/0),i!=n&&(e.playerInterface_.onExpirationUpdated(r.sessionId,i),t.oldExpiration=i)}))},a.media.DrmEngine.prototype.areAllSessionsLoaded_=function(){var e=this.activeSessions_.values();return a.util.Iterables.every(e,(function(e){return e.loaded}))},a.media.DrmEngine.replaceDrmInfo_=function(e,t){var r=[];t.forEach((function(e,t){r.push({keySystem:t,licenseServerUri:e,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:[],keyIds:[]})}));for(var n=i.makeIterator(e),o=n.next();!o.done;o=n.next())o.value.drmInfos=r},a.media.DrmEngine.createDrmInfoFor_=function(e,t){var r=[],n=[],i=[],o=[];return a.media.DrmEngine.processDrmInfos_(t.drmInfos,r,n,i,o),1<n.length&&a.log.warning("Multiple unique server certificates found! Only the first will be used."),1<r.length&&a.log.warning("Multiple unique license server URIs found! Only the first will be used."),{keySystem:e,licenseServerUri:r[0],distinctiveIdentifierRequired:"required"==t.distinctiveIdentifier,persistentStateRequired:"required"==t.persistentState,audioRobustness:(t.audioCapabilities?t.audioCapabilities[0].robustness:"")||"",videoRobustness:(t.videoCapabilities?t.videoCapabilities[0].robustness:"")||"",serverCertificate:n[0],initData:i,keyIds:o}},a.media.DrmEngine.processDrmInfos_=function(e,t,r,n,i){e.forEach((function(e){var o=a.util.Uint8ArrayUtils;if(t.includes(e.licenseServerUri)||t.push(e.licenseServerUri),e.serverCertificate&&(r.some((function(t){return o.equal(t,e.serverCertificate)}))||r.push(e.serverCertificate)),e.initData&&e.initData.forEach((function(e){n.some((function(t){return t=!(!t.keyId||t.keyId!=e.keyId)||t.initDataType==e.initDataType&&a.util.Uint8ArrayUtils.equal(t.initData,e.initData)}))||n.push(e)})),e.keyIds)for(var s=0;s<e.keyIds.length;++s)i.includes(e.keyIds[s])||i.push(e.keyIds[s])}))},a.media.DrmEngine.fillInDrmInfoDefaults_=function(t,r,n){!t.keySystem||"org.w3.clearkey"==t.keySystem&&t.licenseServerUri||(r.size&&(r=r.get(t.keySystem)||"",t.licenseServerUri=r),t.keyIds||(t.keyIds=[]),(n=n.get(t.keySystem))&&(t.distinctiveIdentifierRequired||(t.distinctiveIdentifierRequired=n.distinctiveIdentifierRequired),t.persistentStateRequired||(t.persistentStateRequired=n.persistentStateRequired),t.videoRobustness||(t.videoRobustness=n.videoRobustness),t.audioRobustness||(t.audioRobustness=n.audioRobustness),t.serverCertificate||(t.serverCertificate=n.serverCertificate)),e.cast&&e.cast.__platform__&&"com.microsoft.playready"==t.keySystem&&(t.keySystem="com.chromecast.playready"))},a.media.DrmEngine.SESSION_LOAD_TIMEOUT_=5,a.media.DrmEngine.KEY_STATUS_BATCH_TIME_=.5,a.media.IClosedCaptionParser=function(){},a.media.IClosedCaptionParser.prototype.init=function(e){},a.media.IClosedCaptionParser.prototype.parseFrom=function(e,t){},a.media.IClosedCaptionParser.prototype.reset=function(){},a.media.MuxJSClosedCaptionParser=function(){this.muxCaptionParser_=new muxjs.mp4.CaptionParser,this.videoTrackIds_=[],this.timescales_={}},a.media.MuxJSClosedCaptionParser.prototype.init=function(e){var t=muxjs.mp4.probe;e=new Uint8Array(e),this.videoTrackIds_=t.videoTrackIds(e),this.timescales_=t.timescale(e),this.muxCaptionParser_.init()},a.media.MuxJSClosedCaptionParser.prototype.parseFrom=function(e,t){var r=new Uint8Array(e);(r=this.muxCaptionParser_.parse(r,this.videoTrackIds_,this.timescales_))&&r.captions&&t(r.captions),this.muxCaptionParser_.clearParsedCaptions()},a.media.MuxJSClosedCaptionParser.prototype.reset=function(){this.muxCaptionParser_.resetCaptionStream()},a.media.MuxJSClosedCaptionParser.isSupported=function(){return!!e.muxjs},a.media.NoopCaptionParser=function(){},a.media.NoopCaptionParser.prototype.init=function(e){},a.media.NoopCaptionParser.prototype.parseFrom=function(e,t){},a.media.NoopCaptionParser.prototype.reset=function(){},a.media.TimeRangesUtils={},a.media.TimeRangesUtils.bufferStart=function(e){return!e||1==e.length&&1e-6>e.end(0)-e.start(0)?null:1==e.length&&0>e.start(0)?0:e.length?e.start(0):null},a.media.TimeRangesUtils.bufferEnd=function(e){return!e||1==e.length&&1e-6>e.end(0)-e.start(0)?null:e.length?e.end(e.length-1):null},a.media.TimeRangesUtils.isBuffered=function(e,t,r){return r=void 0===r?0:r,!(!e||!e.length||1==e.length&&1e-6>e.end(0)-e.start(0)||t>e.end(e.length-1))&&t+r>=e.start(0)},a.media.TimeRangesUtils.bufferedAheadOf=function(e,t){if(!e||!e.length||1==e.length&&1e-6>e.end(0)-e.start(0))return 0;for(var r=0,n=e.length-1;0<=n&&e.end(n)>t;--n)r+=e.end(n)-Math.max(e.start(n),t);return r},a.media.TimeRangesUtils.getGapIndex=function(e,t){var r=a.util.Platform;if(!e||!e.length||1==e.length&&1e-6>e.end(0)-e.start(0))return null;r=r.isEdge()||r.isIE()||r.isTizen()||r.isChromecast()?.5:.1;for(var n=0;n<e.length;n++)if(e.start(n)>t&&(0==n||e.end(n-1)-t<=r))return n;return null},a.media.TimeRangesUtils.getBufferedInfo=function(e){if(!e)return[];for(var t=[],r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t},a.util.Functional={},a.util.Functional.createFallbackPromiseChain=function(e,t){return e.reduce(function(e,t,r){return t.catch(e.bind(null,r))}.bind(null,t),Promise.reject())},a.util.Functional.collapseArrays=function(e,t){return e.concat(t)},a.util.Functional.noop=function(){},a.util.Functional.isNotNull=function(e){return null!=e},a.util.ManifestParserUtils={},a.util.ManifestParserUtils.resolveUris=function(e,t){var r=a.util.Functional;if(0==t.length)return e;var n=t.map((function(e){return new o.Uri(e)}));return e.map((function(e){return new o.Uri(e)})).map((function(e){return n.map(e.resolve.bind(e))})).reduce(r.collapseArrays,[]).map((function(e){return e.toString()}))},a.util.ManifestParserUtils.createDrmInfo=function(e,t){return{keySystem:e,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:t||[],keyIds:[]}},a.util.ManifestParserUtils.ContentType={VIDEO:"video",AUDIO:"audio",TEXT:"text",IMAGE:"image",APPLICATION:"application"},a.util.ManifestParserUtils.TextStreamKind={SUBTITLE:"subtitle",CLOSED_CAPTION:"caption"},a.util.ManifestParserUtils.GAP_OVERLAP_TOLERANCE_SECONDS=1/15,a.media.Transmuxer=function(){this.muxTransmuxer_=new muxjs.mp4.Transmuxer({keepOriginalTimestamps:!0}),this.transmuxPromise_=null,this.transmuxedData_=[],this.captions_=[],this.isTransmuxing_=!1,this.muxTransmuxer_.on("data",this.onTransmuxed_.bind(this)),this.muxTransmuxer_.on("done",this.onTransmuxDone_.bind(this))},a.media.Transmuxer.prototype.destroy=function(){return this.muxTransmuxer_.dispose(),this.muxTransmuxer_=null,Promise.resolve()},a.media.Transmuxer.isSupported=function(t,r){if(!e.muxjs||!a.media.Transmuxer.isTsContainer(t))return!1;var n=a.media.Transmuxer.convertTsCodecs;if(r)return MediaSource.isTypeSupported(n(r,t));var i=a.util.ManifestParserUtils.ContentType;return MediaSource.isTypeSupported(n(i.AUDIO,t))||MediaSource.isTypeSupported(n(i.VIDEO,t))},a.media.Transmuxer.isTsContainer=function(e){return"mp2t"==e.toLowerCase().split(";")[0].split("/")[1]},a.media.Transmuxer.convertTsCodecs=function(e,t){var r=a.util.ManifestParserUtils.ContentType,n=t.replace(/mp2t/i,"mp4");if(e==r.AUDIO&&(n=n.replace("video","audio")),r=/avc1\.(66|77|100)\.(\d+)/.exec(n)){var i="avc1.",s=r[1];"66"==s?i+="4200":"77"==s?i+="4d00":(o.asserts.assert("100"==s,"Legacy avc1 parsing code out of sync with regex!"),i+="6400"),s=Number(r[2]),o.asserts.assert(256>s,"Invalid legacy avc1 level number!"),i+=(s>>4).toString(16),i+=(15&s).toString(16),n=n.replace(r[0],i)}return n},a.media.Transmuxer.prototype.transmux=function(e){return o.asserts.assert(!this.isTransmuxing_,"No transmuxing should be in progress."),this.isTransmuxing_=!0,this.transmuxPromise_=new a.util.PublicPromise,this.transmuxedData_=[],this.captions_=[],e=new Uint8Array(e),this.muxTransmuxer_.push(e),this.muxTransmuxer_.flush(),this.isTransmuxing_&&this.transmuxPromise_.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.TRANSMUXING_FAILED)),this.transmuxPromise_},a.media.Transmuxer.prototype.onTransmuxed_=function(e){this.captions_=e.captions;var t=new Uint8Array(e.data.byteLength+e.initSegment.byteLength);t.set(e.initSegment,0),t.set(e.data,e.initSegment.byteLength),this.transmuxedData_.push(t)},a.media.Transmuxer.prototype.onTransmuxDone_=function(){var e={data:a.util.Uint8ArrayUtils.concat.apply(null,this.transmuxedData_),captions:this.captions_};this.transmuxPromise_.resolve(e),this.isTransmuxing_=!1},a.text={},a.text.Cue=function(e,t,r){var n=a.text.Cue;this.startTime=e,this.direction=n.direction.HORIZONTAL_LEFT_TO_RIGHT,this.endTime=t,this.payload=r,this.region=new a.text.CueRegion,this.position=null,this.positionAlign=n.positionAlign.AUTO,this.size=0,this.textAlign=n.textAlign.CENTER,this.writingMode=n.writingMode.HORIZONTAL_TOP_TO_BOTTOM,this.lineInterpretation=n.lineInterpretation.LINE_NUMBER,this.line=null,this.lineHeight="",this.lineAlign=n.lineAlign.START,this.displayAlign=n.displayAlign.AFTER,this.fontSize=this.backgroundImage=this.backgroundColor=this.color="",this.fontWeight=n.fontWeight.NORMAL,this.fontStyle=n.fontStyle.NORMAL,this.fontFamily="",this.textDecoration=[],this.wrapLine=!0,this.id="",this.nestedCues=[],this.spacer=!1},o.exportSymbol("shaka.text.Cue",a.text.Cue),a.text.Cue.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:"auto"},o.exportProperty(a.text.Cue,"positionAlign",a.text.Cue.positionAlign),a.text.Cue.textAlign={LEFT:"left",RIGHT:"right",CENTER:"center",START:"start",END:"end"},o.exportProperty(a.text.Cue,"textAlign",a.text.Cue.textAlign),a.text.Cue.displayAlign={BEFORE:"before",CENTER:"center",AFTER:"after"},o.exportProperty(a.text.Cue,"displayAlign",a.text.Cue.displayAlign),a.text.Cue.direction={HORIZONTAL_LEFT_TO_RIGHT:"ltr",HORIZONTAL_RIGHT_TO_LEFT:"rtl"},o.exportProperty(a.text.Cue,"direction",a.text.Cue.direction),a.text.Cue.writingMode={HORIZONTAL_TOP_TO_BOTTOM:"horizontal-tb",VERTICAL_LEFT_TO_RIGHT:"vertical-lr",VERTICAL_RIGHT_TO_LEFT:"vertical-rl"},o.exportProperty(a.text.Cue,"writingMode",a.text.Cue.writingMode),a.text.Cue.lineInterpretation={LINE_NUMBER:0,PERCENTAGE:1},o.exportProperty(a.text.Cue,"lineInterpretation",a.text.Cue.lineInterpretation),a.text.Cue.lineAlign={CENTER:"center",START:"start",END:"end"},o.exportProperty(a.text.Cue,"lineAlign",a.text.Cue.lineAlign),a.text.Cue.fontWeight={NORMAL:400,BOLD:700},o.exportProperty(a.text.Cue,"fontWeight",a.text.Cue.fontWeight),a.text.Cue.fontStyle={NORMAL:"normal",ITALIC:"italic",OBLIQUE:"oblique"},o.exportProperty(a.text.Cue,"fontStyle",a.text.Cue.fontStyle),a.text.Cue.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"},o.exportProperty(a.text.Cue,"textDecoration",a.text.Cue.textDecoration),a.text.CueRegion=function(){var e=a.text.CueRegion;this.id="",this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0,this.height=this.width=100,this.viewportAnchorUnits=this.widthUnits=this.heightUnits=e.units.PERCENTAGE,this.scroll=e.scrollMode.NONE},o.exportSymbol("shaka.text.CueRegion",a.text.CueRegion),a.text.CueRegion.units={PX:0,PERCENTAGE:1,LINES:2},o.exportProperty(a.text.CueRegion,"units",a.text.CueRegion.units),a.text.CueRegion.scrollMode={NONE:"",UP:"up"},o.exportProperty(a.text.CueRegion,"scrollMode",a.text.CueRegion.scrollMode),a.text.TextEngine=function(e){this.parser_=null,this.displayer_=e,this.appendWindowStart_=this.timestampOffset_=0,this.appendWindowEnd_=1/0,this.bufferEnd_=this.bufferStart_=null,this.selectedClosedCaptionId_="",this.closedCaptionsMap_=new Map},a.text.TextEngine.parserMap_={},a.text.TextEngine.registerParser=function(e,t){a.text.TextEngine.parserMap_[e]=t},o.exportSymbol("shaka.text.TextEngine.registerParser",a.text.TextEngine.registerParser),a.text.TextEngine.unregisterParser=function(e){delete a.text.TextEngine.parserMap_[e]},o.exportSymbol("shaka.text.TextEngine.unregisterParser",a.text.TextEngine.unregisterParser),a.text.TextEngine.isTypeSupported=function(t){return!!(a.text.TextEngine.parserMap_[t]||e.muxjs&&t==a.util.MimeUtils.CLOSED_CAPTION_MIMETYPE)},a.text.TextEngine.prototype.destroy=function(){return this.displayer_=this.parser_=null,this.closedCaptionsMap_.clear(),Promise.resolve()},a.text.TextEngine.prototype.setDisplayer=function(e){this.displayer_=e},a.text.TextEngine.prototype.initParser=function(e){e!=a.util.MimeUtils.CLOSED_CAPTION_MIMETYPE&&(e=a.text.TextEngine.parserMap_[e],o.asserts.assert(e,"Text type negotiation should have happened already"),this.parser_=new e)},a.text.TextEngine.prototype.getStartTime=function(e){o.asserts.assert(this.parser_,"The parser should already be initialized");try{return this.parser_.parseMedia(new Uint8Array(e),{periodStart:0,segmentStart:null,segmentEnd:0})[0].startTime}catch(e){throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.UNABLE_TO_EXTRACT_CUE_START_TIME,e)}},a.text.TextEngine.prototype.appendBuffer=function(e,t,r){return o.asserts.assert(this.parser_,"The parser should already be initialized"),Promise.resolve().then(function(){if(this.parser_&&this.displayer_)if(null==t||null==r)this.parser_.parseInit(new Uint8Array(e));else{var n={periodStart:this.timestampOffset_,segmentStart:t,segmentEnd:r};n=this.parser_.parseMedia(new Uint8Array(e),n).filter(function(e){return e.startTime>=this.appendWindowStart_&&e.startTime<this.appendWindowEnd_}.bind(this)),this.displayer_.append(n),null==this.bufferStart_?this.bufferStart_=Math.max(t,this.appendWindowStart_):(o.asserts.assert(null!=this.bufferEnd_,"There should already be a buffered range end."),o.asserts.assert(1>=t-this.bufferEnd_,"There should not be a gap in text references >1s")),this.bufferEnd_=Math.min(r,this.appendWindowEnd_)}}.bind(this))},a.text.TextEngine.prototype.remove=function(e,t){return Promise.resolve().then(function(){this.displayer_&&this.displayer_.remove(e,t)&&(null==this.bufferStart_?o.asserts.assert(null==this.bufferEnd_,"end must be null if startTime is null"):(o.asserts.assert(null!=this.bufferEnd_,"end must be non-null if startTime is non-null"),t<=this.bufferStart_||e>=this.bufferEnd_||(e<=this.bufferStart_&&t>=this.bufferEnd_?this.bufferStart_=this.bufferEnd_=null:e<=this.bufferStart_&&t<this.bufferEnd_?this.bufferStart_=t:e>this.bufferStart_&&t>=this.bufferEnd_?this.bufferEnd_=e:o.asserts.assert(!1,"removal from the middle is not supported by TextEngine"))))}.bind(this))},a.text.TextEngine.prototype.setTimestampOffset=function(e){this.timestampOffset_=e},a.text.TextEngine.prototype.setAppendWindow=function(e,t){this.appendWindowStart_=e,this.appendWindowEnd_=t},a.text.TextEngine.prototype.bufferStart=function(){return this.bufferStart_},a.text.TextEngine.prototype.bufferEnd=function(){return this.bufferEnd_},a.text.TextEngine.prototype.isBuffered=function(e){return null!=this.bufferStart_&&null!=this.bufferEnd_&&(e>=this.bufferStart_&&e<this.bufferEnd_)},a.text.TextEngine.prototype.bufferedAheadOf=function(e){return null==this.bufferEnd_||this.bufferEnd_<e?0:(o.asserts.assert(null!=this.bufferStart_,"start should not be null if end is not null"),this.bufferEnd_-Math.max(e,this.bufferStart_))},a.text.TextEngine.prototype.setSelectedClosedCaptionId=function(e,t){this.selectedClosedCaptionId_=e;var r=this.closedCaptionsMap_.get(e);if(r)for(var n=i.makeIterator(r.keys()),o=n.next();!o.done;o=n.next())(o=r.get(o.value).filter((function(e){return e.endTime<=t})))&&this.displayer_.append(o)},a.text.TextEngine.prototype.storeAndAppendClosedCaptions=function(e,t,r,n){for(var o=t+" "+r,s=new Map,l=(e=i.makeIterator(e)).next();!l.done;l=e.next()){var u=l.value;l=u.stream,s.has(l)||s.set(l,new Map),s.get(l).has(o)||s.get(l).set(o,[]),u.startTime+=n,u.endTime+=n,u.startTime>=this.appendWindowStart_&&u.startTime<this.appendWindowEnd_&&(u=new a.text.Cue(u.startTime,u.endTime,u.text),s.get(l).get(o).push(u),l==this.selectedClosedCaptionId_&&this.displayer_.append([u]))}for(o=(n=i.makeIterator(s.keys())).next();!o.done;o=n.next())for(o=o.value,this.closedCaptionsMap_.has(o)||this.closedCaptionsMap_.set(o,new Map),l=(e=i.makeIterator(s.get(o).keys())).next();!l.done;l=e.next())l=l.value,u=s.get(o).get(l),this.closedCaptionsMap_.get(o).set(l,u);this.bufferStart_=null==this.bufferStart_?Math.max(t,this.appendWindowStart_):Math.min(this.bufferStart_,Math.max(t,this.appendWindowStart_)),this.bufferEnd_=Math.max(this.bufferEnd_,Math.min(r,this.appendWindowEnd_))},a.text.TextEngine.prototype.getNumberOfClosedCaptionChannels=function(){return this.closedCaptionsMap_.size},a.text.TextEngine.prototype.getNumberOfClosedCaptionsInChannel=function(e){return(e=this.closedCaptionsMap_.get(e))?e.size:0},a.media.MediaSourceEngine=function(e,t,r){this.video_=e,this.textDisplayer_=r,this.sourceBuffers_={},this.textEngine_=null,this.queues_={},this.eventManager_=new a.util.EventManager,this.destroyed_=!1,this.transmuxers_={},this.captionParser_=t,this.mediaSourceOpen_=new a.util.PublicPromise,this.mediaSource_=this.createMediaSource(this.mediaSourceOpen_)},a.media.MediaSourceEngine.createObjectURL=e.URL.createObjectURL,a.media.MediaSourceEngine.prototype.createMediaSource=function(e){var t=new MediaSource;return this.eventManager_.listenOnce(t,"sourceopen",e.resolve),this.video_.src=a.media.MediaSourceEngine.createObjectURL(t),t},a.media.MediaSourceEngine.isStreamSupported=function(e){var t=a.util.MimeUtils.getFullType(e.mimeType,e.codecs),r=a.util.MimeUtils.getExtendedType(e);return a.text.TextEngine.isTypeSupported(t)||MediaSource.isTypeSupported(r)||a.media.Transmuxer.isSupported(t,e.type)},a.media.MediaSourceEngine.probeSupport=function(){for(var e={},t=i.makeIterator('video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",video/mp4; codecs="av01.0.01M.08",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="opus",audio/mp4; codecs="flac",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",")),r=t.next();!r.done;r=t.next()){r=r.value,a.util.Platform.supportsMediaSource()?a.text.TextEngine.isTypeSupported(r)?e[r]=!0:e[r]=MediaSource.isTypeSupported(r)||a.media.Transmuxer.isSupported(r):e[r]=a.util.Platform.supportsMediaType(r);var n=r.split(";")[0];e[n]=e[n]||e[r]}return e},a.media.MediaSourceEngine.prototype.destroy=function(){var e=this,t=a.util.Functional;this.destroyed_=!0;var r,n=[];for(r in this.queues_){var i=this.queues_[r],s=i[0];for(this.queues_[r]=i.slice(0,1),s&&n.push(s.p.catch(t.noop)),s=1;s<i.length;++s)i[s].p.reject()}for(var l in this.textEngine_&&n.push(this.textEngine_.destroy()),this.textDisplayer_&&n.push(this.textDisplayer_.destroy()),this.transmuxers_)n.push(this.transmuxers_[l].destroy());return Promise.all(n).then((function(){if(e.eventManager_&&(e.eventManager_.release(),e.eventManager_=null),e.video_&&(e.video_.removeAttribute("src"),e.video_.load(),e.video_=null),e.mediaSource_=null,e.textEngine_=null,e.textDisplayer_=null,e.sourceBuffers_={},e.transmuxers_={},e.captionParser_=null,o.DEBUG)for(var t in e.queues_)o.asserts.assert(0==e.queues_[t].length,t+" queue should be empty after destroy!");e.queues_={}}))},a.media.MediaSourceEngine.prototype.open=function(){return this.mediaSourceOpen_},a.media.MediaSourceEngine.prototype.init=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var s;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return s=a.util.ManifestParserUtils.ContentType,n.yield(r.mediaSourceOpen_,2);case 2:e.forEach((function(e,n){o.asserts.assert(a.media.MediaSourceEngine.isStreamSupported(e),"Type negotiation should happen before MediaSourceEngine.init!");var i=a.util.MimeUtils.getFullType(e.mimeType,e.codecs);n==s.TEXT?r.reinitText(i):(!t&&MediaSource.isTypeSupported(i)||!a.media.Transmuxer.isSupported(i,n)||(r.transmuxers_[n]=new a.media.Transmuxer,i=a.media.Transmuxer.convertTsCodecs(n,i)),i=r.mediaSource_.addSourceBuffer(i),r.eventManager_.listen(i,"error",r.onError_.bind(r,n)),r.eventManager_.listen(i,"updateend",r.onUpdateEnd_.bind(r,n)),r.sourceBuffers_[n]=i,r.queues_[n]=[])})),n.jumpToEnd()}}))}))},a.media.MediaSourceEngine.prototype.reinitText=function(e){this.textEngine_||(this.textEngine_=new a.text.TextEngine(this.textDisplayer_)),this.textEngine_.initParser(e)},a.media.MediaSourceEngine.prototype.ended=function(){return!this.mediaSource_||"ended"==this.mediaSource_.readyState},a.media.MediaSourceEngine.prototype.bufferStart=function(e){return e==a.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_.bufferStart():a.media.TimeRangesUtils.bufferStart(this.getBuffered_(e))},a.media.MediaSourceEngine.prototype.bufferEnd=function(e){return e==a.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_.bufferEnd():a.media.TimeRangesUtils.bufferEnd(this.getBuffered_(e))},a.media.MediaSourceEngine.prototype.isBuffered=function(e,t,r){return e==a.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_.isBuffered(t):(e=this.getBuffered_(e),a.media.TimeRangesUtils.isBuffered(e,t,r))},a.media.MediaSourceEngine.prototype.bufferedAheadOf=function(e,t){if(e==a.util.ManifestParserUtils.ContentType.TEXT)return this.textEngine_.bufferedAheadOf(t);var r=this.getBuffered_(e);return a.media.TimeRangesUtils.bufferedAheadOf(r,t)},a.media.MediaSourceEngine.prototype.getBufferedInfo=function(e){var t=a.util.ManifestParserUtils.ContentType,r=a.media.TimeRangesUtils.getBufferedInfo;e.total=r(this.video_.buffered),e.audio=r(this.getBuffered_(t.AUDIO)),e.video=r(this.getBuffered_(t.VIDEO)),e.text=[],this.textEngine_&&(t=this.textEngine_.bufferStart(),r=this.textEngine_.bufferEnd(),null!=t&&null!=r&&e.text.push({start:t,end:r}))},a.media.MediaSourceEngine.prototype.getBuffered_=function(e){try{return this.sourceBuffers_[e].buffered}catch(t){return e in this.sourceBuffers_&&a.log.error("failed to get buffered range for "+e,t),null}},a.media.MediaSourceEngine.prototype.appendBuffer=function(t,r,n,i,o){var s=this,l=a.util.ManifestParserUtils.ContentType;return t==l.TEXT?this.textEngine_.appendBuffer(r,n,i):this.transmuxers_[t]?this.transmuxers_[t].transmux(r).then(function(e){return this.textEngine_||this.reinitText("text/vtt"),e.captions&&e.captions.length&&this.textEngine_.storeAndAppendClosedCaptions(e.captions,n,i,this.sourceBuffers_[l.VIDEO].timestampOffset),this.enqueueOperation_(t,this.append_.bind(this,t,e.data.buffer))}.bind(this)):(o&&e.muxjs&&(this.textEngine_||this.reinitText("text/vtt"),null==n&&null==i?this.captionParser_.init(r):this.captionParser_.parseFrom(r,(function(e){e.length&&s.textEngine_.storeAndAppendClosedCaptions(e,n,i,s.sourceBuffers_[l.VIDEO].timestampOffset)}))),this.enqueueOperation_(t,this.append_.bind(this,t,r)))},a.media.MediaSourceEngine.prototype.setSelectedClosedCaptionId=function(e){var t=this.bufferEnd(a.util.ManifestParserUtils.ContentType.VIDEO)||0;this.textEngine_.setSelectedClosedCaptionId(e,t)},a.media.MediaSourceEngine.prototype.remove=function(e,t,r){return o.asserts.assert(r<Number.MAX_VALUE,"remove() with MAX_VALUE or Infinity is not IE-compatible!"),e==a.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_.remove(t,r):this.enqueueOperation_(e,this.remove_.bind(this,e,t,r))},a.media.MediaSourceEngine.prototype.clear=function(e){return e==a.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_?(this.captionParser_.reset(),this.textEngine_.remove(0,1/0)):Promise.resolve():this.enqueueOperation_(e,this.remove_.bind(this,e,0,this.mediaSource_.duration))},a.media.MediaSourceEngine.prototype.flush=function(e){return e==a.util.ManifestParserUtils.ContentType.TEXT?Promise.resolve():this.enqueueOperation_(e,this.flush_.bind(this,e))},a.media.MediaSourceEngine.prototype.setStreamProperties=function(e,t,r,n){return e==a.util.ManifestParserUtils.ContentType.TEXT?(this.textEngine_.setTimestampOffset(t),this.textEngine_.setAppendWindow(r,n),Promise.resolve()):Promise.all([this.enqueueOperation_(e,this.abort_.bind(this,e)),this.enqueueOperation_(e,this.setTimestampOffset_.bind(this,e,t)),this.enqueueOperation_(e,this.setAppendWindow_.bind(this,e,r,n))])},a.media.MediaSourceEngine.prototype.endOfStream=function(e){return this.enqueueBlockingOperation_(function(){this.ended()||(e?this.mediaSource_.endOfStream(e):this.mediaSource_.endOfStream())}.bind(this))},a.media.MediaSourceEngine.prototype.setDuration=function(e){return o.asserts.assert(isNaN(this.mediaSource_.duration)||this.mediaSource_.duration<=e,"duration cannot decrease: "+this.mediaSource_.duration+" -> "+e),this.enqueueBlockingOperation_(function(){this.mediaSource_.duration=e}.bind(this))},a.media.MediaSourceEngine.prototype.getDuration=function(){return this.mediaSource_.duration},a.media.MediaSourceEngine.prototype.append_=function(e,t){this.sourceBuffers_[e].appendBuffer(t)},a.media.MediaSourceEngine.prototype.remove_=function(e,t,r){r<=t?this.onUpdateEnd_(e):this.sourceBuffers_[e].remove(t,r)},a.media.MediaSourceEngine.prototype.abort_=function(e){var t=this.sourceBuffers_[e].appendWindowStart,r=this.sourceBuffers_[e].appendWindowEnd;this.sourceBuffers_[e].abort(),this.sourceBuffers_[e].appendWindowStart=t,this.sourceBuffers_[e].appendWindowEnd=r,this.onUpdateEnd_(e)},a.media.MediaSourceEngine.prototype.flush_=function(e){o.asserts.assert(0==this.video_.buffered.length,"MediaSourceEngine.flush_ should only be used after clearing all data!"),this.video_.currentTime-=.001,this.onUpdateEnd_(e)},a.media.MediaSourceEngine.prototype.setTimestampOffset_=function(e,t){0>t&&(t+=.001),this.sourceBuffers_[e].timestampOffset=t,this.onUpdateEnd_(e)},a.media.MediaSourceEngine.prototype.setAppendWindow_=function(e,t,r){this.sourceBuffers_[e].appendWindowStart=0,this.sourceBuffers_[e].appendWindowEnd=r,this.sourceBuffers_[e].appendWindowStart=t,this.onUpdateEnd_(e)},a.media.MediaSourceEngine.prototype.onError_=function(e,t){var r=this.queues_[e][0];o.asserts.assert(r,"Spurious error event!"),o.asserts.assert(!this.sourceBuffers_[e].updating,"SourceBuffer should not be updating on error!"),r.p.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.MEDIA_SOURCE_OPERATION_FAILED,this.video_.error?this.video_.error.code:0))},a.media.MediaSourceEngine.prototype.onUpdateEnd_=function(e){var t=this.queues_[e][0];o.asserts.assert(t,"Spurious updateend event!"),t&&(o.asserts.assert(!this.sourceBuffers_[e].updating,"SourceBuffer should not be updating on updateend!"),t.p.resolve(),this.popFromQueue_(e))},a.media.MediaSourceEngine.prototype.enqueueOperation_=function(e,t){if(this.destroyed_)return Promise.reject();var r={start:t,p:new a.util.PublicPromise};if(this.queues_[e].push(r),1==this.queues_[e].length)try{r.start()}catch(t){"QuotaExceededError"==t.name?r.p.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.QUOTA_EXCEEDED_ERROR,e)):r.p.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.MEDIA_SOURCE_OPERATION_THREW,t)),this.popFromQueue_(e)}return r.p},a.media.MediaSourceEngine.prototype.enqueueBlockingOperation_=function(e){if(this.destroyed_)return Promise.reject();var t,r=[];for(t in this.sourceBuffers_){var n=new a.util.PublicPromise,i={start:function(e){e.resolve()}.bind(null,n),p:n};this.queues_[t].push(i),r.push(n),1==this.queues_[t].length&&i.start()}return Promise.all(r).then(function(){if(o.DEBUG)for(var t in this.sourceBuffers_)o.asserts.assert(0==this.sourceBuffers_[t].updating,"SourceBuffers should not be updating after a blocking op!");try{e()}catch(e){var r=Promise.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.MEDIA_SOURCE_OPERATION_THREW,e))}for(var n in this.sourceBuffers_)this.popFromQueue_(n);return r}.bind(this),function(e){if(o.asserts.assert(this.destroyed_,"Should be destroyed by now"),o.DEBUG)for(var t in this.sourceBuffers_)this.queues_[t].length&&(o.asserts.assert(1==this.queues_[t].length,"Should be at most one item in queue!"),o.asserts.assert(r.includes(this.queues_[t][0].p),"The item in queue should be one of our waiters!"),this.queues_[t].shift());throw e}.bind(this))},a.media.MediaSourceEngine.prototype.popFromQueue_=function(e){this.queues_[e].shift();var t=this.queues_[e][0];if(t)try{t.start()}catch(r){t.p.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.MEDIA_SOURCE_OPERATION_THREW,r)),this.popFromQueue_(e)}},a.media.MediaSourceEngine.prototype.getTextDisplayer=function(){return o.asserts.assert(this.textDisplayer_,"TextDisplayer should only be null when this is destroyed"),this.textDisplayer_},a.media.MediaSourceEngine.prototype.setTextDisplayer=function(e){var t=this.textDisplayer_;this.textDisplayer_=e,t&&(e.setTextVisibility(t.isTextVisible()),t.destroy()),this.textEngine_&&this.textEngine_.setDisplayer(e)},a.util.LanguageUtils=function(){},a.util.LanguageUtils.areLocaleCompatible=function(e,t){var r=a.util.LanguageUtils;return(e=r.normalize(e))==(t=r.normalize(t))},a.util.LanguageUtils.areLanguageCompatible=function(e,t){var r=a.util.LanguageUtils;e=r.normalize(e),t=r.normalize(t);var n=r.disassembleLocale_(e);return r=r.disassembleLocale_(t),n[0]==r[0]},a.util.LanguageUtils.isParentOf=function(e,t){var r=a.util.LanguageUtils;e=r.normalize(e),t=r.normalize(t);var n=r.disassembleLocale_(e);return r=r.disassembleLocale_(t),n[0]==r[0]&&1==n.length&&2==r.length},a.util.LanguageUtils.isSiblingOf=function(e,t){var r=a.util.LanguageUtils;e=r.normalize(e),t=r.normalize(t);var n=r.disassembleLocale_(e);return r=r.disassembleLocale_(t),2==n.length&&2==r.length&&n[0]==r[0]},a.util.LanguageUtils.normalize=function(e){var t=a.util.LanguageUtils,r=e.split("-");return e=r[0]||"",r=r[1]||"",e=e.toLowerCase(),e=t.isoMap_.get(e)||e,(r=r.toUpperCase())?e+"-"+r:e},a.util.LanguageUtils.areSiblings=function(e,t){var r=a.util.LanguageUtils,n=r.getBase(e);return r=r.getBase(t),e!=n&&t!=r&&n==r},a.util.LanguageUtils.getBase=function(e){var t=a.util.LanguageUtils,r=e.indexOf("-");return e=(e=0<=r?e.substring(0,r):e).toLowerCase(),t.isoMap_.get(e)||e},a.util.LanguageUtils.getLocaleForText=function(e){var t=a.util.LanguageUtils;return o.asserts.assert(e.type==a.util.ManifestParserUtils.ContentType.TEXT,"Can only get language from text streams"),t.normalize(e.language||"und")},a.util.LanguageUtils.getLocaleForVariant=function(e){var t=a.util.LanguageUtils;return e.language?t.normalize(e.language):e.audio&&e.audio.language?t.normalize(e.audio.language):e.video&&e.video.language?t.normalize(e.video.language):"und"},a.util.LanguageUtils.findClosestLocale=function(e,t){for(var r=a.util.LanguageUtils,n=r.normalize(e),o=new Set,s=i.makeIterator(t),l=s.next();!l.done;l=s.next())o.add(r.normalize(l.value));for(l=(s=i.makeIterator(o)).next();!l.done;l=s.next())if((l=l.value)==n)return l;for(l=(s=i.makeIterator(o)).next();!l.done;l=s.next())if(l=l.value,r.isParentOf(l,n))return l;for(l=(s=i.makeIterator(o)).next();!l.done;l=s.next())if(l=l.value,r.isSiblingOf(l,n))return l;for(l=(o=i.makeIterator(o)).next();!l.done;l=o.next())if(l=l.value,r.isParentOf(n,l))return l;return null},a.util.LanguageUtils.disassembleLocale_=function(e){var t=e.split("-");return o.asserts.assert(2>=t.length,["Locales should not have more than 2 components. ",e," has too many components."].join()),t},a.util.LanguageUtils.isoMap_=new Map([["aar","aa"],["abk","ab"],["afr","af"],["aka","ak"],["alb","sq"],["amh","am"],["ara","ar"],["arg","an"],["arm","hy"],["asm","as"],["ava","av"],["ave","ae"],["aym","ay"],["aze","az"],["bak","ba"],["bam","bm"],["baq","eu"],["bel","be"],["ben","bn"],["bih","bh"],["bis","bi"],["bod","bo"],["bos","bs"],["bre","br"],["bul","bg"],["bur","my"],["cat","ca"],["ces","cs"],["cha","ch"],["che","ce"],["chi","zh"],["chu","cu"],["chv","cv"],["cor","kw"],["cos","co"],["cre","cr"],["cym","cy"],["cze","cs"],["dan","da"],["deu","de"],["div","dv"],["dut","nl"],["dzo","dz"],["ell","el"],["eng","en"],["epo","eo"],["est","et"],["eus","eu"],["ewe","ee"],["fao","fo"],["fas","fa"],["fij","fj"],["fin","fi"],["fra","fr"],["fre","fr"],["fry","fy"],["ful","ff"],["geo","ka"],["ger","de"],["gla","gd"],["gle","ga"],["glg","gl"],["glv","gv"],["gre","el"],["grn","gn"],["guj","gu"],["hat","ht"],["hau","ha"],["heb","he"],["her","hz"],["hin","hi"],["hmo","ho"],["hrv","hr"],["hun","hu"],["hye","hy"],["ibo","ig"],["ice","is"],["ido","io"],["iii","ii"],["iku","iu"],["ile","ie"],["ina","ia"],["ind","id"],["ipk","ik"],["isl","is"],["ita","it"],["jav","jv"],["jpn","ja"],["kal","kl"],["kan","kn"],["kas","ks"],["kat","ka"],["kau","kr"],["kaz","kk"],["khm","km"],["kik","ki"],["kin","rw"],["kir","ky"],["kom","kv"],["kon","kg"],["kor","ko"],["kua","kj"],["kur","ku"],["lao","lo"],["lat","la"],["lav","lv"],["lim","li"],["lin","ln"],["lit","lt"],["ltz","lb"],["lub","lu"],["lug","lg"],["mac","mk"],["mah","mh"],["mal","ml"],["mao","mi"],["mar","mr"],["may","ms"],["mkd","mk"],["mlg","mg"],["mlt","mt"],["mon","mn"],["mri","mi"],["msa","ms"],["mya","my"],["nau","na"],["nav","nv"],["nbl","nr"],["nde","nd"],["ndo","ng"],["nep","ne"],["nld","nl"],["nno","nn"],["nob","nb"],["nor","no"],["nya","ny"],["oci","oc"],["oji","oj"],["ori","or"],["orm","om"],["oss","os"],["pan","pa"],["per","fa"],["pli","pi"],["pol","pl"],["por","pt"],["pus","ps"],["que","qu"],["roh","rm"],["ron","ro"],["rum","ro"],["run","rn"],["rus","ru"],["sag","sg"],["san","sa"],["sin","si"],["slk","sk"],["slo","sk"],["slv","sl"],["sme","se"],["smo","sm"],["sna","sn"],["snd","sd"],["som","so"],["sot","st"],["spa","es"],["sqi","sq"],["srd","sc"],["srp","sr"],["ssw","ss"],["sun","su"],["swa","sw"],["swe","sv"],["tah","ty"],["tam","ta"],["tat","tt"],["tel","te"],["tgk","tg"],["tgl","tl"],["tha","th"],["tib","bo"],["tir","ti"],["ton","to"],["tsn","tn"],["tso","ts"],["tuk","tk"],["tur","tr"],["twi","tw"],["uig","ug"],["ukr","uk"],["urd","ur"],["uzb","uz"],["ven","ve"],["vie","vi"],["vol","vo"],["wel","cy"],["wln","wa"],["wol","wo"],["xho","xh"],["yid","yi"],["yor","yo"],["zha","za"],["zho","zh"],["zul","zu"]]),a.util.StreamUtils={},a.util.StreamUtils.chooseCodecsAndFilterManifest=function(e,t){function r(e){var t="";e.video&&(t=n.getCodecBase(e.video.codecs));var r="";return e.audio&&(r=n.getCodecBase(e.audio.codecs)),t+"-"+r}var n=a.util.MimeUtils,s=e.periods.reduce((function(e,t){return e.concat(t.variants)}),[]);s=a.util.StreamUtils.filterVariantsByAudioChannelCount(s,t);for(var l=new a.util.MultiMap,u=(s=i.makeIterator(s)).next();!u.done;u=s.next()){var c=r(u=u.value);l.push(c,u)}var d=null,p=1/0;for(l.forEach((function(e,t){for(var r=0,n=0,o=i.makeIterator(t),s=o.next();!s.done;s=o.next())r+=s.value.bandwidth||0,++n;r/=n,a.log.debug("codecs",e,"avg bandwidth",r),r<p&&(d=e,p=r)})),o.asserts.assert(null!=d,"Should have chosen codecs!"),o.asserts.assert(!isNaN(p),"Bandwidth should be a number!"),s=(l=i.makeIterator(e.periods)).next();!s.done;s=l.next())(s=s.value).variants=s.variants.filter((function(e){return r(e)==d||(a.log.debug("Dropping Variant (better codec available)",e),!1)}))},a.util.StreamUtils.meetsRestrictions=function(e,t,r){var n=function(e,t,r){return e>=t&&e<=r},i=e.video;return!(i&&i.width&&i.height&&(!n(i.width,t.minWidth,Math.min(t.maxWidth,r.width))||!n(i.height,t.minHeight,Math.min(t.maxHeight,r.height))||!n(i.width*i.height,t.minPixels,t.maxPixels))||e&&e.video&&e.video.frameRate&&!n(e.video.frameRate,t.minFrameRate,t.maxFrameRate)||!n(e.bandwidth,t.minBandwidth,t.maxBandwidth))},a.util.StreamUtils.applyRestrictions=function(e,t,r){var n=!1;return e.forEach((function(e){var i=e.allowedByApplication;e.allowedByApplication=a.util.StreamUtils.meetsRestrictions(e,t,r),i!=e.allowedByApplication&&(n=!0)})),n},a.util.StreamUtils.filterNewPeriod=function(e,t,r,n){var i=a.util.StreamUtils;t&&o.asserts.assert(i.isAudio(t),"Audio streams must have the audio type."),r&&o.asserts.assert(i.isVideo(r),"Video streams must have the video type."),n.variants=n.variants.filter((function(n){if(e&&e.initialized()&&!e.supportsVariant(n))return a.log.debug("Dropping variant - not compatible with key system",n),!1;var o=n.audio;return n=n.video,o&&!a.media.MediaSourceEngine.isStreamSupported(o)?(a.log.debug("Dropping variant - audio not compatible with platform",i.getStreamSummaryString_(o)),!1):n&&!a.media.MediaSourceEngine.isStreamSupported(n)?(a.log.debug("Dropping variant - video not compatible with platform",i.getStreamSummaryString_(n)),!1):o&&t&&!i.areStreamsCompatible_(o,t)?(a.log.debug("Droping variant - not compatible with active audio","active audio",i.getStreamSummaryString_(t),"variant.audio",i.getStreamSummaryString_(o)),!1):!(n&&r&&!i.areStreamsCompatible_(n,r))||(a.log.debug("Droping variant - not compatible with active video","active video",i.getStreamSummaryString_(r),"variant.video",i.getStreamSummaryString_(n)),!1)})),n.textStreams=n.textStreams.filter((function(e){var t=a.util.MimeUtils.getFullType(e.mimeType,e.codecs);return(t=a.text.TextEngine.isTypeSupported(t))||a.log.debug("Dropping text stream. Is not supported by the platform.",e),t}))},a.util.StreamUtils.areStreamsCompatible_=function(e,t){return e.mimeType==t.mimeType&&e.codecs.split(".")[0]==t.codecs.split(".")[0]},a.util.StreamUtils.variantToTrack=function(e){var t=e.audio,r=e.video,n=t?t.codecs:null,i=r?r.codecs:null,o=[];i&&o.push(i),n&&o.push(n);var a=[];r&&a.push(r.mimeType),t&&a.push(t.mimeType),a=a[0]||null;var s=[];t&&s.push(t.kind),r&&s.push(r.kind),s=s[0]||null;var l=new Set;return t&&t.roles.forEach((function(e){return l.add(e)})),r&&r.roles.forEach((function(e){return l.add(e)})),e={id:e.id,active:!1,type:"variant",bandwidth:e.bandwidth,language:e.language,label:null,kind:s,width:null,height:null,frameRate:null,pixelAspectRatio:null,mimeType:a,codecs:o.join(", "),audioCodec:n,videoCodec:i,primary:e.primary,roles:Array.from(l),audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null},r&&(e.videoId=r.id,e.originalVideoId=r.originalId,e.width=r.width||null,e.height=r.height||null,e.frameRate=r.frameRate||null,e.pixelAspectRatio=r.pixelAspectRatio||null,e.videoBandwidth=r.bandwidth||null),t&&(e.audioId=t.id,e.originalAudioId=t.originalId,e.channelsCount=t.channelsCount,e.audioSamplingRate=t.audioSamplingRate,e.audioBandwidth=t.bandwidth||null,e.label=t.label,e.audioRoles=t.roles),e},a.util.StreamUtils.textStreamToTrack=function(e){return{id:e.id,active:!1,type:a.util.ManifestParserUtils.ContentType.TEXT,bandwidth:0,language:e.language,label:e.label,kind:e.kind||null,width:null,height:null,frameRate:null,pixelAspectRatio:null,mimeType:e.mimeType,codecs:e.codecs||null,audioCodec:null,videoCodec:null,primary:e.primary,roles:e.roles,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:e.originalId}},a.util.StreamUtils.html5TrackId=function(e){return e.__shaka_id||(e.__shaka_id=a.util.StreamUtils.nextTrackId_++),e.__shaka_id},a.util.StreamUtils.nextTrackId_=0,a.util.StreamUtils.html5TextTrackToTrack=function(e){var t=a.util.MimeUtils.CLOSED_CAPTION_MIMETYPE,r=a.util.StreamUtils.html5TrackToGenericShakaTrack_(e);return r.active="disabled"!=e.mode,r.type="text",r.originalTextId=e.id,"captions"==e.kind&&(r.mimeType=t),e.kind&&(r.roles=[e.kind]),r},a.util.StreamUtils.html5AudioTrackToTrack=function(e){var t=a.util.StreamUtils.html5TrackToGenericShakaTrack_(e);return t.active=e.enabled,t.type="variant",t.originalAudioId=e.id,"main"==e.kind&&(t.primary=!0),e.kind&&(t.roles=[e.kind],t.audioRoles=[e.kind]),t},a.util.StreamUtils.html5TrackToGenericShakaTrack_=function(e){return{id:a.util.StreamUtils.html5TrackId(e),active:!1,type:"",bandwidth:0,language:a.util.LanguageUtils.normalize(e.language),label:e.label,kind:e.kind,width:null,height:null,frameRate:null,pixelAspectRatio:null,mimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null}},a.util.StreamUtils.isPlayable=function(e){return e.allowedByApplication&&e.allowedByKeySystem},a.util.StreamUtils.getPlayableVariants=function(e){return e.filter((function(e){return a.util.StreamUtils.isPlayable(e)}))},a.util.StreamUtils.filterVariantsByAudioChannelCount=function(e,t){for(var r=e.filter((function(e){return e.audio&&e.audio.channelsCount})),n=new Map,a=(r=i.makeIterator(r)).next();!a.done;a=r.next()){var s=(a=a.value).audio.channelsCount;o.asserts.assert(null!=s,"Must have count after filtering!"),n.has(s)||n.set(s,[]),n.get(s).push(a)}return 0==(r=Array.from(n.keys())).length?e:(a=r.filter((function(e){return e<=t}))).length?n.get(Math.max.apply(null,a)):n.get(Math.min.apply(null,r))},a.util.StreamUtils.filterStreamsByLanguageAndRole=function(e,t,r){var n=a.util.LanguageUtils,i=e,o=e.filter((function(e){return e.primary}));o.length&&(i=o);var s=i.length?i[0].language:"";if(i=i.filter((function(e){return e.language==s})),t){var l=n.findClosestLocale(n.normalize(t),e.map((function(e){return e.language})));l&&(i=e.filter((function(e){return n.normalize(e.language)==l})))}if(r){if((e=a.util.StreamUtils.filterTextStreamsByRole_(i,r)).length)return e;a.log.warning("No exact match for the text role could be found.")}else if((e=i.filter((function(e){return 0==e.roles.length}))).length)return e;return(e=i.map((function(e){return e.roles})).reduce(a.util.Functional.collapseArrays,[])).length?a.util.StreamUtils.filterTextStreamsByRole_(i,e[0]):i},a.util.StreamUtils.filterTextStreamsByRole_=function(e,t){return e.filter((function(e){return e.roles.includes(t)}))},a.util.StreamUtils.getVariantByStreams=function(e,t,r){e&&o.asserts.assert(a.util.StreamUtils.isAudio(e),"Audio streams must have the audio type."),t&&o.asserts.assert(a.util.StreamUtils.isVideo(t),"Video streams must have the video type.");for(var n=0;n<r.length;n++)if(r[n].audio==e&&r[n].video==t)return r[n];return null},a.util.StreamUtils.isAudio=function(e){return e.type==a.util.ManifestParserUtils.ContentType.AUDIO},a.util.StreamUtils.isVideo=function(e){return e.type==a.util.ManifestParserUtils.ContentType.VIDEO},a.util.StreamUtils.getVariantStreams=function(e){var t=[];return e.audio&&t.push(e.audio),e.video&&t.push(e.video),t},a.util.StreamUtils.getStreamSummaryString_=function(e){return a.util.StreamUtils.isAudio(e)?"type=audio codecs="+e.codecs+" bandwidth="+e.bandwidth+" channelsCount="+e.channelsCount+" audioSamplingRate="+e.audioSamplingRate:a.util.StreamUtils.isVideo(e)?"type=video codecs="+e.codecs+" bandwidth="+e.bandwidth+" frameRate="+e.frameRate+" width="+e.width+" height="+e.height:"unexpected stream type"},a.abr.SimpleAbrManager=function(){this.switch_=null,this.enabled_=!1,this.bandwidthEstimator_=new a.abr.EwmaBandwidthEstimator,this.variants_=[],this.startupComplete_=!1,this.config_=this.lastTimeChosenMs_=null},o.exportSymbol("shaka.abr.SimpleAbrManager",a.abr.SimpleAbrManager),a.abr.SimpleAbrManager.prototype.stop=function(){this.switch_=null,this.enabled_=!1,this.variants_=[],this.lastTimeChosenMs_=null},o.exportProperty(a.abr.SimpleAbrManager.prototype,"stop",a.abr.SimpleAbrManager.prototype.stop),a.abr.SimpleAbrManager.prototype.init=function(e){this.switch_=e},o.exportProperty(a.abr.SimpleAbrManager.prototype,"init",a.abr.SimpleAbrManager.prototype.init),a.abr.SimpleAbrManager.prototype.chooseVariant=function(){var e=a.abr.SimpleAbrManager,t=e.filterAndSortVariants_(this.config_.restrictions,this.variants_),r=this.bandwidthEstimator_.getBandwidthEstimate(this.config_.defaultBandwidthEstimate);this.variants_.length&&!t.length&&(a.log.warning("No variants met the ABR restrictions. Choosing a variant by lowest bandwidth."),t=[(t=e.filterAndSortVariants_(null,this.variants_))[0]]),e=t[0]||null;for(var n=0;n<t.length;++n){var i=t[n],o=i.bandwidth/this.config_.bandwidthDowngradeTarget,s=(t[n+1]||{bandwidth:1/0}).bandwidth/this.config_.bandwidthUpgradeTarget;a.log.v2("Bandwidth ranges:",(i.bandwidth/1e6).toFixed(3),(o/1e6).toFixed(3),(s/1e6).toFixed(3)),r>=o&&r<=s&&(e=i)}return this.lastTimeChosenMs_=Date.now(),e},o.exportProperty(a.abr.SimpleAbrManager.prototype,"chooseVariant",a.abr.SimpleAbrManager.prototype.chooseVariant),a.abr.SimpleAbrManager.prototype.enable=function(){this.enabled_=!0},o.exportProperty(a.abr.SimpleAbrManager.prototype,"enable",a.abr.SimpleAbrManager.prototype.enable),a.abr.SimpleAbrManager.prototype.disable=function(){this.enabled_=!1},o.exportProperty(a.abr.SimpleAbrManager.prototype,"disable",a.abr.SimpleAbrManager.prototype.disable),a.abr.SimpleAbrManager.prototype.segmentDownloaded=function(e,t){a.log.v2("Segment downloaded:","deltaTimeMs="+e,"numBytes="+t,"lastTimeChosenMs="+this.lastTimeChosenMs_,"enabled="+this.enabled_),o.asserts.assert(0<=e,"expected a non-negative duration"),this.bandwidthEstimator_.sample(e,t),null!=this.lastTimeChosenMs_&&this.enabled_&&this.suggestStreams_()},o.exportProperty(a.abr.SimpleAbrManager.prototype,"segmentDownloaded",a.abr.SimpleAbrManager.prototype.segmentDownloaded),a.abr.SimpleAbrManager.prototype.getBandwidthEstimate=function(){return this.bandwidthEstimator_.getBandwidthEstimate(this.config_.defaultBandwidthEstimate)},o.exportProperty(a.abr.SimpleAbrManager.prototype,"getBandwidthEstimate",a.abr.SimpleAbrManager.prototype.getBandwidthEstimate),a.abr.SimpleAbrManager.prototype.setVariants=function(e){this.variants_=e},o.exportProperty(a.abr.SimpleAbrManager.prototype,"setVariants",a.abr.SimpleAbrManager.prototype.setVariants),a.abr.SimpleAbrManager.prototype.configure=function(e){this.config_=e},o.exportProperty(a.abr.SimpleAbrManager.prototype,"configure",a.abr.SimpleAbrManager.prototype.configure),a.abr.SimpleAbrManager.prototype.suggestStreams_=function(){if(a.log.v2("Suggesting Streams..."),o.asserts.assert(null!=this.lastTimeChosenMs_,"lastTimeChosenMs_ should not be null"),this.startupComplete_){if(Date.now()-this.lastTimeChosenMs_<1e3*this.config_.switchInterval)return void a.log.v2("Still within switch interval...")}else{if(!this.bandwidthEstimator_.hasGoodEstimate())return void a.log.v2("Still waiting for a good estimate...");this.startupComplete_=!0}var e=this.chooseVariant(),t=this.bandwidthEstimator_.getBandwidthEstimate(this.config_.defaultBandwidthEstimate);a.log.debug("Calling switch_(), bandwidth="+Math.round(t/1e3)+" kbps"),this.switch_(e)},a.abr.SimpleAbrManager.filterAndSortVariants_=function(e,t){return e&&(t=t.filter((function(t){return o.asserts.assert(e,"Restrictions should exist!"),a.util.StreamUtils.meetsRestrictions(t,e,{width:1/0,height:1/0})}))),t.sort((function(e,t){return e.bandwidth-t.bandwidth}))},a.deprecate={},a.deprecate.Version=function(e,t){this.major_=e,this.minor_=t},a.deprecate.Version.prototype.major=function(){return this.major_},a.deprecate.Version.prototype.minor=function(){return this.minor_},a.deprecate.Version.prototype.compareTo=function(e){var t=this.minor_-e.minor_;return this.major_-e.major_||t},a.deprecate.Version.prototype.toString=function(){return"v"+this.major_+"."+this.minor_},a.deprecate.Version.parse=function(e){return e=e.substring(1).split(".",2),new a.deprecate.Version(Number(e[0]),Number(e[1]))},a.deprecate.Enforcer=function(e,t,r){this.libraryVersion_=e,this.onPending_=t,this.onExpired_=r},a.deprecate.Enforcer.prototype.enforce=function(e,t,r){(0<e.compareTo(this.libraryVersion_)?this.onPending_:this.onExpired_)(this.libraryVersion_,e,t,r)},a.Deprecate=function(){},a.Deprecate.init=function(e){o.asserts.assert(null==a.Deprecate.enforcer_,"Deprecate.init should only be called once."),a.Deprecate.enforcer_=new a.deprecate.Enforcer(a.deprecate.Version.parse(e),a.Deprecate.onPending_,a.Deprecate.onExpired_)},a.Deprecate.deprecateFeature=function(e,t,r,n){var i=a.Deprecate.enforcer_;o.asserts.assert(i,"Missing deprecation enforcer. Was |init| called?"),e=new a.deprecate.Version(e,t),i.enforce(e,r,n)},a.Deprecate.onPending_=function(e,t,r,n){a.log.alwaysWarn([r,"has been deprecated and will be removed in",t,". We are currently at version",e,". Additional information:",n].join(" "))},a.Deprecate.onExpired_=function(e,t,r,n){e=[r,"has been deprecated and has been removed in",t,". We are now at version",e,". Additional information:",n].join(""),a.log.alwaysError(e),o.asserts.assert(!1,e)},a.Deprecate.enforcer_=null,a.cast={},a.cast.CastUtils={},a.cast.CastUtils.VideoEvents="ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),a.cast.CastUtils.VideoAttributes="buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),a.cast.CastUtils.VideoInitStateAttributes=["loop","playbackRate"],a.cast.CastUtils.VideoVoidMethods=["pause","play"],a.cast.CastUtils.PlayerEvents="abrstatuschanged adaptation buffering drmsessionupdate emsg error expirationupdated largegap loading manifestparsed onstatechange onstateidle streaming textchanged texttrackvisibility timelineregionadded timelineregionenter timelineregionexit trackschanged unloading variantchanged".split(" "),a.cast.CastUtils.PlayerGetterMethods={getAssetUri:2,getAudioLanguages:2,getAudioLanguagesAndRoles:2,getBufferedInfo:2,getConfiguration:2,getExpiration:2,getPlaybackRate:2,getTextLanguages:2,getTextLanguagesAndRoles:2,getTextTracks:2,getStats:5,getVariantTracks:2,isAudioOnly:10,isBuffering:1,isInProgress:1,isLive:10,isTextTrackVisible:1,keySystem:10,seekRange:1,usingEmbeddedTextTrack:2,getLoadMode:10},a.cast.CastUtils.PlayerGetterMethodsThatRequireLive={getPlayheadTimeAsDate:1,getPresentationStartTimeAsDate:20},a.cast.CastUtils.PlayerInitState=[["getConfiguration","configure"]],a.cast.CastUtils.PlayerInitAfterLoadState=[["isTextTrackVisible","setTextTrackVisibility"]],a.cast.CastUtils.PlayerVoidMethods="addTextTrack cancelTrickPlay configure resetConfiguration retryStreaming selectAudioLanguage selectEmbeddedTextTrack selectTextLanguage selectTextTrack selectVariantTrack selectVariantsByLabel setTextTrackVisibility trickPlay".split(" "),a.cast.CastUtils.PlayerPromiseMethods=["attach","detach","load","unload"],a.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE="urn:x-cast:com.google.shaka.v2",a.cast.CastUtils.GENERIC_MESSAGE_NAMESPACE="urn:x-cast:com.google.cast.media",a.cast.CastUtils.serialize=function(e){return JSON.stringify(e,(function(e,t){if("function"!=typeof t){if(t instanceof Event||t instanceof a.util.FakeEvent){var r,n={};for(r in t){var i=t[r];i&&"object"==typeof i?"detail"==r&&(n[r]=i):r in Event||(n[r]=i)}return n}return t instanceof Error?a.cast.CastUtils.unpackError_(t):t instanceof TimeRanges?a.cast.CastUtils.unpackTimeRanges_(t):t instanceof Uint8Array?a.cast.CastUtils.unpackUint8Array_(t):"number"==typeof t?isNaN(t)?"NaN":isFinite(t)?t:0>t?"-Infinity":"Infinity":t}}))},a.cast.CastUtils.deserialize=function(e){return JSON.parse(e,(function(e,t){return"NaN"==t?NaN:"-Infinity"==t?-1/0:"Infinity"==t?1/0:t&&"object"==typeof t&&"TimeRanges"==t.__type__?a.cast.CastUtils.simulateTimeRanges_(t):t&&"object"==typeof t&&"Uint8Array"==t.__type__?a.cast.CastUtils.makeUint8Array_(t):t&&"object"==typeof t&&"Error"==t.__type__?a.cast.CastUtils.makeError_(t):t}))},a.cast.CastUtils.unpackTimeRanges_=function(e){for(var t={__type__:"TimeRanges",length:e.length,start:[],end:[]},r=0;r<e.length;++r)t.start.push(e.start(r)),t.end.push(e.end(r));return t},a.cast.CastUtils.simulateTimeRanges_=function(e){return{length:e.length,start:function(t){return e.start[t]},end:function(t){return e.end[t]}}},a.cast.CastUtils.unpackUint8Array_=function(e){return{__type__:"Uint8Array",entries:Array.from(e)}},a.cast.CastUtils.makeUint8Array_=function(e){return new Uint8Array(e.entries)},a.cast.CastUtils.unpackError_=function(e){var t,r=new Set(["name","message","stack"]);for(t in e)r.add(t);var n=i.makeIterator(Object.getOwnPropertyNames(e));for(t=n.next();!t.done;t=n.next())r.add(t.value);for(n={},t=(r=i.makeIterator(r)).next();!t.done;t=r.next())n[t=t.value]=e[t];return{__type__:"Error",contents:n}},a.cast.CastUtils.makeError_=function(e){e=e.contents;var t,r=Error(e.message);for(t in e)r[t]=e[t];return r},a.cast.CastSender=function(e,t,r,n,i,o){this.receiverAppId_=e,this.statusChangeTimer_=new a.util.Timer(t),this.onFirstCastStateUpdate_=r,this.hasJoinedExistingSession_=!1,this.onRemoteEvent_=n,this.onResumeLocal_=i,this.onInitStateRequired_=o,this.isCasting_=this.apiReady_=!1,this.receiverName_="",this.appData_=null,this.onConnectionStatusChangedBound_=this.onConnectionStatusChanged_.bind(this),this.onMessageReceivedBound_=this.onMessageReceived_.bind(this),this.cachedProperties_={video:{},player:{}},this.nextAsyncCallId_=0,this.asyncCallPromises_={},this.castPromise_=null,a.cast.CastSender.instances_.add(this)},a.cast.CastSender.hasReceivers_=!1,a.cast.CastSender.session_=null,a.cast.CastSender.prototype.destroy=function(){return a.cast.CastSender.instances_.delete(this),this.rejectAllPromises_(),a.cast.CastSender.session_&&this.removeListeners_(),this.statusChangeTimer_&&(this.statusChangeTimer_.stop(),this.statusChangeTimer_=null),this.onResumeLocal_=this.onRemoteEvent_=null,this.isCasting_=this.apiReady_=!1,this.onMessageReceivedBound_=this.onConnectionStatusChangedBound_=this.castPromise_=this.asyncCallPromises_=this.cachedProperties_=this.appData_=null,Promise.resolve()},a.cast.CastSender.prototype.apiReady=function(){return this.apiReady_},a.cast.CastSender.prototype.hasReceivers=function(){return a.cast.CastSender.hasReceivers_},a.cast.CastSender.prototype.isCasting=function(){return this.isCasting_},a.cast.CastSender.prototype.receiverName=function(){return this.receiverName_},a.cast.CastSender.prototype.hasRemoteProperties=function(){return 0!=Object.keys(this.cachedProperties_.video).length},a.cast.CastSender.prototype.init=function(){var t=a.cast.CastSender;if(e.chrome&&chrome.cast&&chrome.cast.isAvailable&&this.receiverAppId_.length){this.apiReady_=!0,this.statusChangeTimer_.tickNow();var r=new chrome.cast.SessionRequest(this.receiverAppId_);t=new chrome.cast.ApiConfig(r,t.onExistingSessionJoined_.bind(this),t.onReceiverStatusChanged_.bind(this),"origin_scoped"),chrome.cast.initialize(t,(function(){a.log.debug("CastSender: init")}),(function(e){a.log.error("CastSender: init error",e)})),a.cast.CastSender.hasReceivers_&&this.statusChangeTimer_.tickAfter(.02),(t=a.cast.CastSender.session_)&&t.status!=chrome.cast.SessionStatus.STOPPED?(a.log.debug("CastSender: re-using existing connection"),this.onExistingSessionJoined_(t)):a.cast.CastSender.session_=null}},a.cast.CastSender.prototype.setAppData=function(e){this.appData_=e,this.isCasting_&&this.sendMessage_({type:"appData",appData:this.appData_})},a.cast.CastSender.prototype.cast=function(e){return this.apiReady_?a.cast.CastSender.hasReceivers_?this.isCasting_?Promise.reject(new a.util.Error(a.util.Error.Severity.RECOVERABLE,a.util.Error.Category.CAST,a.util.Error.Code.ALREADY_CASTING)):(this.castPromise_=new a.util.PublicPromise,chrome.cast.requestSession(this.onSessionInitiated_.bind(this,e),this.onConnectionError_.bind(this)),this.castPromise_):Promise.reject(new a.util.Error(a.util.Error.Severity.RECOVERABLE,a.util.Error.Category.CAST,a.util.Error.Code.NO_CAST_RECEIVERS)):Promise.reject(new a.util.Error(a.util.Error.Severity.RECOVERABLE,a.util.Error.Category.CAST,a.util.Error.Code.CAST_API_UNAVAILABLE))},a.cast.CastSender.prototype.showDisconnectDialog=function(){if(this.isCasting_){var e=this.onInitStateRequired_();chrome.cast.requestSession(this.onSessionInitiated_.bind(this,e),this.onConnectionError_.bind(this))}},a.cast.CastSender.prototype.forceDisconnect=function(){if(this.isCasting_){if(this.rejectAllPromises_(),a.cast.CastSender.session_){this.removeListeners_();try{a.cast.CastSender.session_.stop((function(){}),(function(){}))}catch(e){}a.cast.CastSender.session_=null}this.onConnectionStatusChanged_()}},a.cast.CastSender.prototype.get=function(e,t){o.asserts.assert("video"==e||"player"==e,"Unexpected target name");var r=a.cast.CastUtils;if("video"==e){if(r.VideoVoidMethods.includes(t))return this.remoteCall_.bind(this,e,t)}else if("player"==e){if(r.PlayerGetterMethodsThatRequireLive[t]){var n=this.get("player","isLive")();if(o.asserts.assert(n,t+" should be called on a live stream!"),!n)return function(){}}if(r.PlayerVoidMethods.includes(t))return this.remoteCall_.bind(this,e,t);if(r.PlayerPromiseMethods.includes(t))return this.remoteAsyncCall_.bind(this,e,t);if(r.PlayerGetterMethods[t])return this.propertyGetter_.bind(this,e,t)}return this.propertyGetter_(e,t)},a.cast.CastSender.prototype.set=function(e,t,r){o.asserts.assert("video"==e||"player"==e,"Unexpected target name"),this.cachedProperties_[e][t]=r,this.sendMessage_({type:"set",targetName:e,property:t,value:r})},a.cast.CastSender.prototype.onSessionInitiated_=function(e,t){a.log.debug("CastSender: onSessionInitiated"),this.onSessionCreated_(t),this.sendMessage_({type:"init",initState:e,appData:this.appData_}),this.castPromise_.resolve()},a.cast.CastSender.prototype.onConnectionError_=function(e){var t=a.util.Error.Code.UNEXPECTED_CAST_ERROR;switch(e.code){case"cancel":t=a.util.Error.Code.CAST_CANCELED_BY_USER;break;case"timeout":t=a.util.Error.Code.CAST_CONNECTION_TIMED_OUT;break;case"receiver_unavailable":t=a.util.Error.Code.CAST_RECEIVER_APP_UNAVAILABLE}this.castPromise_.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.CAST,t,e))},a.cast.CastSender.prototype.propertyGetter_=function(e,t){return o.asserts.assert("video"==e||"player"==e,"Unexpected target name"),this.cachedProperties_[e][t]},a.cast.CastSender.prototype.remoteCall_=function(e,t,r){for(var n=[],i=2;i<arguments.length;++i)n[i-2]=arguments[i];o.asserts.assert("video"==e||"player"==e,"Unexpected target name"),this.sendMessage_({type:"call",targetName:e,methodName:t,args:n})},a.cast.CastSender.prototype.remoteAsyncCall_=function(e,t,r){for(var n=[],i=2;i<arguments.length;++i)n[i-2]=arguments[i];o.asserts.assert("video"==e||"player"==e,"Unexpected target name"),i=new a.util.PublicPromise;var s=this.nextAsyncCallId_.toString();this.nextAsyncCallId_++,this.asyncCallPromises_[s]=i;try{this.sendMessage_({type:"asyncCall",targetName:e,methodName:t,args:n,id:s})}catch(e){i.reject(e)}return i},a.cast.CastSender.onExistingSessionJoined_=function(e){for(var t=i.makeIterator(a.cast.CastSender.instances_),r=t.next();!r.done;r=t.next())r.value.onExistingSessionJoined_(e)},a.cast.CastSender.prototype.onExistingSessionJoined_=function(e){a.log.debug("CastSender: onExistingSessionJoined");var t=this.onInitStateRequired_();this.castPromise_=new a.util.PublicPromise,this.hasJoinedExistingSession_=!0,this.onSessionInitiated_(t,e)},a.cast.CastSender.onReceiverStatusChanged_=function(e){for(var t=i.makeIterator(a.cast.CastSender.instances_),r=t.next();!r.done;r=t.next())r.value.onReceiverStatusChanged_(e)},a.cast.CastSender.prototype.onReceiverStatusChanged_=function(e){a.log.debug("CastSender: receiver status",e),a.cast.CastSender.hasReceivers_="available"==e,this.statusChangeTimer_.tickNow()},a.cast.CastSender.prototype.onSessionCreated_=function(e){a.cast.CastSender.session_=e,e.addUpdateListener(this.onConnectionStatusChangedBound_),e.addMessageListener(a.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE,this.onMessageReceivedBound_),this.onConnectionStatusChanged_()},a.cast.CastSender.prototype.removeListeners_=function(){var e=a.cast.CastSender.session_;e.removeUpdateListener(this.onConnectionStatusChangedBound_),e.removeMessageListener(a.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE,this.onMessageReceivedBound_)},a.cast.CastSender.prototype.onConnectionStatusChanged_=function(){var e=!!a.cast.CastSender.session_&&"connected"==a.cast.CastSender.session_.status;if(a.log.debug("CastSender: connection status",e),this.isCasting_&&!e){for(var t in this.onResumeLocal_(),this.cachedProperties_)this.cachedProperties_[t]={};this.rejectAllPromises_()}this.receiverName_=(this.isCasting_=e)?a.cast.CastSender.session_.receiver.friendlyName:"",this.statusChangeTimer_.tickNow()},a.cast.CastSender.prototype.rejectAllPromises_=function(){for(var e in this.asyncCallPromises_){var t=this.asyncCallPromises_[e];delete this.asyncCallPromises_[e],t.reject(new a.util.Error(a.util.Error.Severity.RECOVERABLE,a.util.Error.Category.PLAYER,a.util.Error.Code.LOAD_INTERRUPTED))}},a.cast.CastSender.prototype.onMessageReceived_=function(e,t){var r=a.cast.CastUtils.deserialize(t);switch(a.log.v2("CastSender: message",r),r.type){case"event":var n=r.targetName;r=r.event,r=new a.util.FakeEvent(r.type,r),this.onRemoteEvent_(n,r);break;case"update":for(var i in n=r.update)for(var s in r=this.cachedProperties_[i]||{},n[i])r[s]=n[i][s];this.hasJoinedExistingSession_&&(this.onFirstCastStateUpdate_(),this.hasJoinedExistingSession_=!1);break;case"asyncComplete":if(i=r.id,r=r.error,s=this.asyncCallPromises_[i],delete this.asyncCallPromises_[i],o.asserts.assert(s,"Unexpected async id"),s)if(r){for(n in i=new a.util.Error(r.severity,r.category,r.code),r)i[n]=r[n];s.reject(i)}else s.resolve()}},a.cast.CastSender.prototype.sendMessage_=function(e){e=a.cast.CastUtils.serialize(e);var t=a.cast.CastSender.session_;try{t.sendMessage(a.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE,e,(function(){}),a.log.error)}catch(r){throw a.log.error("Cast session sendMessage threw",r),e=new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.CAST,a.util.Error.Code.CAST_CONNECTION_TIMED_OUT,r),t=new a.util.FakeEvent("error",{detail:e}),this.onRemoteEvent_("player",t),this.forceDisconnect(),e}},a.cast.CastSender.instances_=new Set,a.cast.CastSender.onSdkLoaded_=function(e){if(e)for(var t=(e=i.makeIterator(a.cast.CastSender.instances_)).next();!t.done;t=e.next())t.value.init()},e.__onGCastApiAvailable=a.cast.CastSender.onSdkLoaded_,a.cast.CastProxy=function(e,t,r){var n=this;a.util.FakeEventTarget.call(this),this.localVideo_=e,this.localPlayer_=t,this.eventManager_=this.playerEventTarget_=this.videoEventTarget_=this.playerProxy_=this.videoProxy_=null,this.receiverAppId_=r,this.compiledToExternNames_=new Map,this.sender_=new a.cast.CastSender(r,(function(){return n.onCastStatusChanged_()}),(function(){return n.onFirstCastStateUpdate_()}),(function(e,t){return n.onRemoteEvent_(e,t)}),(function(){return n.onResumeLocal_()}),(function(){return n.getInitState_()})),this.init_()},o.inherits(a.cast.CastProxy,a.util.FakeEventTarget),o.exportSymbol("shaka.cast.CastProxy",a.cast.CastProxy),a.cast.CastProxy.prototype.destroy=function(e){return e&&this.sender_.forceDisconnect(),this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),e=[],this.localPlayer_&&(e.push(this.localPlayer_.destroy()),this.localPlayer_=null),this.sender_&&(e.push(this.sender_.destroy()),this.sender_=null),this.playerProxy_=this.videoProxy_=this.localVideo_=null,Promise.all(e)},o.exportProperty(a.cast.CastProxy.prototype,"destroy",a.cast.CastProxy.prototype.destroy),a.cast.CastProxy.prototype.getVideo=function(){return this.videoProxy_},o.exportProperty(a.cast.CastProxy.prototype,"getVideo",a.cast.CastProxy.prototype.getVideo),a.cast.CastProxy.prototype.getPlayer=function(){return this.playerProxy_},o.exportProperty(a.cast.CastProxy.prototype,"getPlayer",a.cast.CastProxy.prototype.getPlayer),a.cast.CastProxy.prototype.canCast=function(){return this.sender_.apiReady()&&this.sender_.hasReceivers()},o.exportProperty(a.cast.CastProxy.prototype,"canCast",a.cast.CastProxy.prototype.canCast),a.cast.CastProxy.prototype.isCasting=function(){return this.sender_.isCasting()},o.exportProperty(a.cast.CastProxy.prototype,"isCasting",a.cast.CastProxy.prototype.isCasting),a.cast.CastProxy.prototype.receiverName=function(){return this.sender_.receiverName()},o.exportProperty(a.cast.CastProxy.prototype,"receiverName",a.cast.CastProxy.prototype.receiverName),a.cast.CastProxy.prototype.cast=function(){var e=this.getInitState_();return this.sender_.cast(e).then(function(){if(this.localPlayer_)return this.localPlayer_.unload()}.bind(this))},o.exportProperty(a.cast.CastProxy.prototype,"cast",a.cast.CastProxy.prototype.cast),a.cast.CastProxy.prototype.setAppData=function(e){this.sender_.setAppData(e)},o.exportProperty(a.cast.CastProxy.prototype,"setAppData",a.cast.CastProxy.prototype.setAppData),a.cast.CastProxy.prototype.suggestDisconnect=function(){this.sender_.showDisconnectDialog()},o.exportProperty(a.cast.CastProxy.prototype,"suggestDisconnect",a.cast.CastProxy.prototype.suggestDisconnect),a.cast.CastProxy.prototype.changeReceiverId=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return e==t.receiverAppId_?r.return():(t.receiverAppId_=e,t.sender_.forceDisconnect(),r.yield(t.sender_.destroy(),2));case 2:t.sender_=null,t.sender_=new a.cast.CastSender(e,(function(){return t.onCastStatusChanged_()}),(function(){return t.onFirstCastStateUpdate_()}),(function(e,r){return t.onRemoteEvent_(e,r)}),(function(){return t.onResumeLocal_()}),(function(){return t.getInitState_()})),t.sender_.init(),r.jumpToEnd()}}))}))},o.exportProperty(a.cast.CastProxy.prototype,"changeReceiverId",a.cast.CastProxy.prototype.changeReceiverId),a.cast.CastProxy.prototype.forceDisconnect=function(){this.sender_.forceDisconnect()},o.exportProperty(a.cast.CastProxy.prototype,"forceDisconnect",a.cast.CastProxy.prototype.forceDisconnect),a.cast.CastProxy.prototype.init_=function(){var e=this;for(var t in this.sender_.init(),this.eventManager_=new a.util.EventManager,a.cast.CastUtils.VideoEvents.forEach(function(e){this.eventManager_.listen(this.localVideo_,e,this.videoProxyLocalEvent_.bind(this))}.bind(this)),a.cast.CastUtils.PlayerEvents.forEach(function(e){this.eventManager_.listen(this.localPlayer_,e,this.playerProxyLocalEvent_.bind(this))}.bind(this)),this.videoProxy_={},this.localVideo_)Object.defineProperty(this.videoProxy_,t,{configurable:!1,enumerable:!0,get:this.videoProxyGet_.bind(this,t),set:this.videoProxySet_.bind(this,t)});this.playerProxy_={},this.iterateOverPlayerMethods_((function(t,r){o.asserts.assert(e.playerProxy_,"Must have player proxy!"),Object.defineProperty(e.playerProxy_,t,{configurable:!1,enumerable:!0,get:function(){return e.playerProxyGet_(t)}})})),this.mapCompiledToUncompiledPlayerMethodNames_(),this.videoEventTarget_=new a.util.FakeEventTarget,this.videoEventTarget_.dispatchTarget=this.videoProxy_,this.playerEventTarget_=new a.util.FakeEventTarget,this.playerEventTarget_.dispatchTarget=this.playerProxy_},a.cast.CastProxy.prototype.mapCompiledToUncompiledPlayerMethodNames_=function(){var e=this,t=new Map;this.iterateOverPlayerMethods_((function(r,n){if(t.has(n)){var i=t.get(n);r.length<i.length?e.compiledToExternNames_.set(r,i):e.compiledToExternNames_.set(i,r)}else t.set(n,r)}))},a.cast.CastProxy.prototype.iterateOverPlayerMethods_=function(e){function t(e){return"constructor"!=e&&"function"==typeof r[e]&&!n.has(e)}o.asserts.assert(this.localPlayer_,"Must have player!");var r=this.localPlayer_,n=new Set;for(a in r)t(a)&&(n.add(a),e(a,r[a]));for(var a=Object.getPrototypeOf(r),s=Object.getPrototypeOf({});a&&a!=s;){for(var l=i.makeIterator(Object.getOwnPropertyNames(a)),u=l.next();!u.done;u=l.next())t(u=u.value)&&(n.add(u),e(u,r[u]));a=Object.getPrototypeOf(a)}},a.cast.CastProxy.prototype.getInitState_=function(){var e={video:{},player:{},playerAfterLoad:{},manifest:this.localPlayer_.getAssetUri(),startTime:null};return this.localVideo_.pause(),a.cast.CastUtils.VideoInitStateAttributes.forEach(function(t){e.video[t]=this.localVideo_[t]}.bind(this)),this.localVideo_.ended||(e.startTime=this.localVideo_.currentTime),a.cast.CastUtils.PlayerInitState.forEach(function(t){var r=t[1];t=this.localPlayer_[t[0]](),e.player[r]=t}.bind(this)),a.cast.CastUtils.PlayerInitAfterLoadState.forEach(function(t){var r=t[1];t=this.localPlayer_[t[0]](),e.playerAfterLoad[r]=t}.bind(this)),e},a.cast.CastProxy.prototype.onCastStatusChanged_=function(){var e=new a.util.FakeEvent("caststatuschanged");this.dispatchEvent(e)},a.cast.CastProxy.prototype.onFirstCastStateUpdate_=function(){var e=new a.util.FakeEvent(this.videoProxy_.paused?"pause":"play");this.videoEventTarget_.dispatchEvent(e)},a.cast.CastProxy.prototype.onResumeLocal_=function(){var e=this;a.cast.CastUtils.PlayerInitState.forEach(function(e){var t=e[1];e=this.sender_.get("player",e[0])(),this.localPlayer_[t](e)}.bind(this));var t=this.sender_.get("player","getAssetUri")(),r=this.sender_.get("video","ended"),n=Promise.resolve(),i=this.localVideo_.autoplay,s=null;r||(s=this.sender_.get("video","currentTime")),t&&(this.localVideo_.autoplay=!1,n=this.localPlayer_.load(t,s));var l={};a.cast.CastUtils.VideoInitStateAttributes.forEach(function(e){l[e]=this.sender_.get("video",e)}.bind(this)),n.then((function(){e.localVideo_&&(a.cast.CastUtils.VideoInitStateAttributes.forEach(function(e){this.localVideo_[e]=l[e]}.bind(e)),a.cast.CastUtils.PlayerInitAfterLoadState.forEach(function(e){var t=e[1];e=this.sender_.get("player",e[0])(),this.localPlayer_[t](e)}.bind(e)),e.localVideo_.autoplay=i,t&&e.localVideo_.play())}),(function(t){o.asserts.assert(t instanceof a.util.Error,"Wrong error type!"),t=new a.util.FakeEvent("error",{detail:t}),e.localPlayer_.dispatchEvent(t)}))},a.cast.CastProxy.prototype.videoProxyGet_=function(e){if("addEventListener"==e)return this.videoEventTarget_.addEventListener.bind(this.videoEventTarget_);if("removeEventListener"==e)return this.videoEventTarget_.removeEventListener.bind(this.videoEventTarget_);if(this.sender_.isCasting()&&!this.sender_.hasRemoteProperties()){var t=this.localVideo_[e];if("function"!=typeof t)return t}return this.sender_.isCasting()?this.sender_.get("video",e):("function"==typeof(e=this.localVideo_[e])&&(e=e.bind(this.localVideo_)),e)},a.cast.CastProxy.prototype.videoProxySet_=function(e,t){this.sender_.isCasting()?this.sender_.set("video",e,t):this.localVideo_[e]=t},a.cast.CastProxy.prototype.videoProxyLocalEvent_=function(e){this.sender_.isCasting()||(e=new a.util.FakeEvent(e.type,e),this.videoEventTarget_.dispatchEvent(e))},a.cast.CastProxy.prototype.playerProxyGet_=function(e){if(this.compiledToExternNames_.has(e)&&(e=this.compiledToExternNames_.get(e)),"addEventListener"==e)return this.playerEventTarget_.addEventListener.bind(this.playerEventTarget_);if("removeEventListener"==e)return this.playerEventTarget_.removeEventListener.bind(this.playerEventTarget_);if("getMediaElement"==e)return function(){return this.videoProxy_}.bind(this);if("getSharedConfiguration"==e)return a.log.warning("Can't share configuration across a network. Returning copy."),this.sender_.get("player","getConfiguration");if("getNetworkingEngine"==e)return this.sender_.isCasting()&&a.log.warning("NOTE: getNetworkingEngine() is always local!"),this.localPlayer_.getNetworkingEngine.bind(this.localPlayer_);if(this.sender_.isCasting()){if("getManifest"==e||"drmInfo"==e)return function(){return a.log.alwaysWarn(e+"() does not work while casting!"),null};if("getManifestUri"==e)return a.Deprecate.deprecateFeature(2,6,"getManifestUri",'Please use "getAssetUri" instead.'),this.playerProxyGet_("getAssetUri");if("attach"==e||"detach"==e)return function(){return a.log.alwaysWarn(e+"() does not work while casting!"),Promise.resolve()}}if(this.sender_.isCasting()&&!this.sender_.hasRemoteProperties()&&a.cast.CastUtils.PlayerGetterMethods[e]){var t=this.localPlayer_[e];return o.asserts.assert("function"==typeof t,"only methods on Player"),t.bind(this.localPlayer_)}return this.sender_.isCasting()?this.sender_.get("player",e):(t=this.localPlayer_[e],o.asserts.assert("function"==typeof t,"only methods on Player"),t.bind(this.localPlayer_))},a.cast.CastProxy.prototype.playerProxyLocalEvent_=function(e){this.sender_.isCasting()||this.playerEventTarget_.dispatchEvent(e)},a.cast.CastProxy.prototype.onRemoteEvent_=function(e,t){o.asserts.assert(this.sender_.isCasting(),"Should only receive remote events while casting"),this.sender_.isCasting()&&("video"==e?this.videoEventTarget_.dispatchEvent(t):"player"==e&&this.playerEventTarget_.dispatchEvent(t))},a.cast.CastReceiver=function(e,t,r,n){var i=this;a.util.FakeEventTarget.call(this),this.video_=e,this.player_=t,this.eventManager_=new a.util.EventManager,this.targets_={video:e,player:t},this.appDataCallback_=r||function(){},this.contentIdCallback_=n||function(e){return e},this.isConnected_=!1,this.isIdle_=!0,this.updateNumber_=0,this.startUpdatingUpdateNumber_=!1,this.initialStatusUpdatePending_=!0,this.genericBus_=this.shakaBus_=null,this.pollTimer_=new a.util.Timer((function(){i.pollAttributes_()})),this.init_()},o.inherits(a.cast.CastReceiver,a.util.FakeEventTarget),o.exportSymbol("shaka.cast.CastReceiver",a.cast.CastReceiver),a.cast.CastReceiver.prototype.isConnected=function(){return this.isConnected_},o.exportProperty(a.cast.CastReceiver.prototype,"isConnected",a.cast.CastReceiver.prototype.isConnected),a.cast.CastReceiver.prototype.isIdle=function(){return this.isIdle_},o.exportProperty(a.cast.CastReceiver.prototype,"isIdle",a.cast.CastReceiver.prototype.isIdle),a.cast.CastReceiver.prototype.destroy=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var r;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return e.eventManager_&&(e.eventManager_.release(),e.eventManager_=null),r=[],e.player_&&(r.push(e.player_.destroy()),e.player_=null),e.pollTimer_&&(e.pollTimer_.stop(),e.pollTimer_=null),e.video_=null,e.targets_=null,e.appDataCallback_=null,e.isConnected_=!1,e.isIdle_=!0,e.shakaBus_=null,e.genericBus_=null,t.yield(Promise.all(r),2);case 2:cast.receiver.CastReceiverManager.getInstance().stop(),t.jumpToEnd()}}))}))},o.exportProperty(a.cast.CastReceiver.prototype,"destroy",a.cast.CastReceiver.prototype.destroy),a.cast.CastReceiver.prototype.init_=function(){var e=cast.receiver.CastReceiverManager.getInstance();e.onSenderConnected=this.onSendersChanged_.bind(this),e.onSenderDisconnected=this.onSendersChanged_.bind(this),e.onSystemVolumeChanged=this.fakeVolumeChangeEvent_.bind(this),this.genericBus_=e.getCastMessageBus(a.cast.CastUtils.GENERIC_MESSAGE_NAMESPACE),this.genericBus_.onMessage=this.onGenericMessage_.bind(this),this.shakaBus_=e.getCastMessageBus(a.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE),this.shakaBus_.onMessage=this.onShakaMessage_.bind(this),o.DEBUG?a.util.Platform.isChromecast()&&e.start():e.start(),a.cast.CastUtils.VideoEvents.forEach(function(e){this.eventManager_.listen(this.video_,e,this.proxyEvent_.bind(this,"video"))}.bind(this)),a.cast.CastUtils.PlayerEvents.forEach(function(e){this.eventManager_.listen(this.player_,e,this.proxyEvent_.bind(this,"player"))}.bind(this)),cast.__platform__&&cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160')?this.player_.setMaxHardwareResolution(3840,2160):this.player_.setMaxHardwareResolution(1920,1080),this.eventManager_.listen(this.video_,"loadeddata",function(){this.startUpdatingUpdateNumber_=!0}.bind(this)),this.eventManager_.listen(this.player_,"loading",function(){this.isIdle_=!1,this.onCastStatusChanged_()}.bind(this)),this.eventManager_.listen(this.video_,"playing",function(){this.isIdle_=!1,this.onCastStatusChanged_()}.bind(this)),this.eventManager_.listen(this.video_,"pause",function(){this.onCastStatusChanged_()}.bind(this)),this.eventManager_.listen(this.player_,"unloading",function(){this.isIdle_=!0,this.onCastStatusChanged_()}.bind(this)),this.eventManager_.listen(this.video_,"ended",function(){var e=this;new a.util.Timer((function(){e.video_&&e.video_.ended&&(e.isIdle_=!0,e.onCastStatusChanged_())})).tickAfter(5)}.bind(this))},a.cast.CastReceiver.prototype.onSendersChanged_=function(){this.updateNumber_=0,this.initialStatusUpdatePending_=!0,this.isConnected_=0!=cast.receiver.CastReceiverManager.getInstance().getSenders().length,this.onCastStatusChanged_()},a.cast.CastReceiver.prototype.onCastStatusChanged_=function(){Promise.resolve().then(function(){if(this.player_){var e=new a.util.FakeEvent("caststatuschanged");this.dispatchEvent(e),this.maybeSendMediaInfoMessage_()||this.sendMediaStatus_()}}.bind(this))},a.cast.CastReceiver.prototype.initState_=function(e,t){var r=this;for(n in e.player)this.player_[n](e.player[n]);this.appDataCallback_(t);var n=Promise.resolve(),i=this.video_.autoplay;e.manifest&&(this.video_.autoplay=!1,n=this.player_.load(e.manifest,e.startTime)),n.then((function(){if(r.player_){for(var t in e.video)r.video_[t]=e.video[t];for(var n in e.playerAfterLoad)r.player_[n](e.playerAfterLoad[n]);r.video_.autoplay=i,e.manifest&&(r.video_.play(),r.sendMediaStatus_())}}),(function(e){o.asserts.assert(e instanceof a.util.Error,"Wrong error type!"),e=new a.util.FakeEvent("error",{detail:e}),r.player_.dispatchEvent(e)}))},a.cast.CastReceiver.prototype.proxyEvent_=function(e,t){this.player_&&(this.pollAttributes_(),this.sendMessage_({type:"event",targetName:e,event:t},this.shakaBus_))},a.cast.CastReceiver.prototype.pollAttributes_=function(){this.pollTimer_.tickAfter(.5);var e={video:{},player:{}};if(a.cast.CastUtils.VideoAttributes.forEach(function(t){e.video[t]=this.video_[t]}.bind(this)),this.player_.isLive())for(var t in a.cast.CastUtils.PlayerGetterMethodsThatRequireLive)0==this.updateNumber_%a.cast.CastUtils.PlayerGetterMethodsThatRequireLive[t]&&(e.player[t]=this.player_[t]());for(var r in a.cast.CastUtils.PlayerGetterMethods)0==this.updateNumber_%a.cast.CastUtils.PlayerGetterMethods[r]&&(e.player[r]=this.player_[r]());(t=cast.receiver.CastReceiverManager.getInstance().getSystemVolume())&&(e.video.volume=t.level,e.video.muted=t.muted),this.startUpdatingUpdateNumber_&&(this.updateNumber_+=1),this.sendMessage_({type:"update",update:e},this.shakaBus_),this.maybeSendMediaInfoMessage_()},a.cast.CastReceiver.prototype.maybeSendMediaInfoMessage_=function(){return!(!this.initialStatusUpdatePending_||!this.video_.duration&&!this.player_.isLive())&&(this.sendMediaInfoMessage_(),this.initialStatusUpdatePending_=!1,!0)},a.cast.CastReceiver.prototype.sendMediaInfoMessage_=function(e){e=void 0===e?0:e;var t={contentId:this.player_.getAssetUri(),streamType:this.player_.isLive()?"LIVE":"BUFFERED",contentType:""};this.player_.isLive()||(t.duration=this.video_.duration),this.sendMediaStatus_(e,t)},a.cast.CastReceiver.prototype.fakeVolumeChangeEvent_=function(){var e=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();o.asserts.assert(e,"System volume should not be null!"),e&&this.sendMessage_({type:"update",update:{video:{volume:e.level,muted:e.muted}}},this.shakaBus_),this.sendMessage_({type:"event",targetName:"video",event:{type:"volumechange"}},this.shakaBus_)},a.cast.CastReceiver.prototype.onShakaMessage_=function(e){var t=a.cast.CastUtils.deserialize(e.data);switch(a.log.debug("CastReceiver: message",t),t.type){case"init":this.updateNumber_=0,this.startUpdatingUpdateNumber_=!1,this.initialStatusUpdatePending_=!0,this.initState_(t.initState,t.appData),this.pollAttributes_();break;case"appData":this.appDataCallback_(t.appData);break;case"set":var r=t.targetName,n=t.property;if(t=t.value,"video"==r){var i=cast.receiver.CastReceiverManager.getInstance();if("volume"==n){i.setSystemVolumeLevel(t);break}if("muted"==n){i.setSystemVolumeMuted(t);break}}this.targets_[r][n]=t;break;case"call":(r=this.targets_[t.targetName])[t.methodName].apply(r,t.args);break;case"asyncCall":r=t.targetName,n=t.methodName,"player"==r&&"load"==n&&(this.updateNumber_=0,this.startUpdatingUpdateNumber_=!1),i=t.id,e=e.senderId;var o=this.targets_[r];t=o[n].apply(o,t.args),"player"==r&&"load"==n&&(t=t.then(function(){this.initialStatusUpdatePending_=!0}.bind(this))),t.then(this.sendAsyncComplete_.bind(this,e,i,null),this.sendAsyncComplete_.bind(this,e,i))}},a.cast.CastReceiver.prototype.onGenericMessage_=function(e){var t=a.cast.CastUtils.deserialize(e.data);switch(a.log.debug("CastReceiver: message",t),t.type){case"PLAY":this.video_.play(),this.sendMediaStatus_();break;case"PAUSE":this.video_.pause(),this.sendMediaStatus_();break;case"SEEK":e=t.currentTime;var r=t.resumeState;null!=e&&(this.video_.currentTime=Number(e)),r&&"PLAYBACK_START"==r?(this.video_.play(),this.sendMediaStatus_()):r&&"PLAYBACK_PAUSE"==r&&(this.video_.pause(),this.sendMediaStatus_());break;case"STOP":this.player_.unload().then(function(){this.player_&&this.sendMediaStatus_()}.bind(this));break;case"GET_STATUS":this.sendMediaInfoMessage_(Number(t.requestId));break;case"VOLUME":e=(r=t.volume).level,r=r.muted;var n=this.video_.volume,i=this.video_.muted;null!=e&&(this.video_.volume=Number(e)),null!=r&&(this.video_.muted=r),n==this.video_.volume&&i==this.video_.muted||this.sendMediaStatus_();break;case"LOAD":this.updateNumber_=0,this.initialStatusUpdatePending_=this.startUpdatingUpdateNumber_=!1,e=t.media,r=t.currentTime,n=this.contentIdCallback_(e.contentId),i=t.autoplay||!0,this.appDataCallback_(e.customData),i&&(this.video_.autoplay=!0),this.player_.load(n,r).then(function(){this.player_&&this.sendMediaInfoMessage_()}.bind(this)).catch(function(e){var r="LOAD_FAILED";e.category==a.util.Error.Category.PLAYER&&e.code==a.util.Error.Code.LOAD_INTERRUPTED&&(r="LOAD_CANCELLED"),this.sendMessage_({requestId:Number(t.requestId),type:r},this.genericBus_)}.bind(this));break;default:a.log.warning("Unrecognized message type from the generic Chromecast controller!",t.type),this.sendMessage_({requestId:Number(t.requestId),type:"INVALID_REQUEST",reason:"INVALID_COMMAND"},this.genericBus_)}},a.cast.CastReceiver.prototype.sendAsyncComplete_=function(e,t,r){this.player_&&this.sendMessage_({type:"asyncComplete",id:t,error:r},this.shakaBus_,e)},a.cast.CastReceiver.prototype.sendMessage_=function(e,t,r){this.isConnected_&&(e=a.cast.CastUtils.serialize(e),r?t.getCastChannel(r).send(e):t.broadcast(e))},a.cast.CastReceiver.prototype.getPlayState_=function(){var e=a.cast.CastReceiver.PLAY_STATE;return this.isIdle_?e.IDLE:this.player_.isBuffering()?e.BUFFERING:this.video_.paused?e.PAUSED:e.PLAYING},a.cast.CastReceiver.prototype.sendMediaStatus_=function(e,t){e=void 0===e?0:e,t=void 0===t?null:t;var r={mediaSessionId:0,playbackRate:this.video_.playbackRate,playerState:this.getPlayState_(),currentTime:this.video_.currentTime,supportedMediaCommands:63,volume:{level:this.video_.volume,muted:this.video_.muted}};t&&(r.media=t),this.sendMessage_({requestId:e,type:"MEDIA_STATUS",status:[r]},this.genericBus_)},a.cast.CastReceiver.PLAY_STATE={IDLE:"IDLE",PLAYING:"PLAYING",BUFFERING:"BUFFERING",PAUSED:"PAUSED"},a.util.DataViewReader=function(e,t){this.dataView_=e,this.littleEndian_=t==a.util.DataViewReader.Endianness.LITTLE_ENDIAN,this.position_=0},o.exportSymbol("shaka.util.DataViewReader",a.util.DataViewReader),a.util.DataViewReader.Endianness={BIG_ENDIAN:0,LITTLE_ENDIAN:1},o.exportProperty(a.util.DataViewReader,"Endianness",a.util.DataViewReader.Endianness),a.util.DataViewReader.prototype.getDataView=function(){return this.dataView_},a.util.DataViewReader.prototype.hasMoreData=function(){return this.position_<this.dataView_.byteLength},o.exportProperty(a.util.DataViewReader.prototype,"hasMoreData",a.util.DataViewReader.prototype.hasMoreData),a.util.DataViewReader.prototype.getPosition=function(){return this.position_},o.exportProperty(a.util.DataViewReader.prototype,"getPosition",a.util.DataViewReader.prototype.getPosition),a.util.DataViewReader.prototype.getLength=function(){return this.dataView_.byteLength},o.exportProperty(a.util.DataViewReader.prototype,"getLength",a.util.DataViewReader.prototype.getLength),a.util.DataViewReader.prototype.readUint8=function(){try{var e=this.dataView_.getUint8(this.position_);return this.position_+=1,e}catch(e){this.throwOutOfBounds_()}},o.exportProperty(a.util.DataViewReader.prototype,"readUint8",a.util.DataViewReader.prototype.readUint8),a.util.DataViewReader.prototype.readUint16=function(){try{var e=this.dataView_.getUint16(this.position_,this.littleEndian_);return this.position_+=2,e}catch(e){this.throwOutOfBounds_()}},o.exportProperty(a.util.DataViewReader.prototype,"readUint16",a.util.DataViewReader.prototype.readUint16),a.util.DataViewReader.prototype.readUint32=function(){try{var e=this.dataView_.getUint32(this.position_,this.littleEndian_);return this.position_+=4,e}catch(e){this.throwOutOfBounds_()}},o.exportProperty(a.util.DataViewReader.prototype,"readUint32",a.util.DataViewReader.prototype.readUint32),a.util.DataViewReader.prototype.readInt32=function(){try{var e=this.dataView_.getInt32(this.position_,this.littleEndian_);return this.position_+=4,e}catch(e){this.throwOutOfBounds_()}},o.exportProperty(a.util.DataViewReader.prototype,"readInt32",a.util.DataViewReader.prototype.readInt32),a.util.DataViewReader.prototype.readUint64=function(){try{if(this.littleEndian_)var e=this.dataView_.getUint32(this.position_,!0),t=this.dataView_.getUint32(this.position_+4,!0);else t=this.dataView_.getUint32(this.position_,!1),e=this.dataView_.getUint32(this.position_+4,!1)}catch(e){this.throwOutOfBounds_()}if(2097151<t)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.JS_INTEGER_OVERFLOW);return this.position_+=8,t*Math.pow(2,32)+e},o.exportProperty(a.util.DataViewReader.prototype,"readUint64",a.util.DataViewReader.prototype.readUint64),a.util.DataViewReader.prototype.readBytes=function(e){o.asserts.assert(0<=e,"Bad call to DataViewReader.readBytes"),this.position_+e>this.dataView_.byteLength&&this.throwOutOfBounds_();var t=new Uint8Array(this.dataView_.buffer,this.dataView_.byteOffset+this.position_,e);return this.position_+=e,t},o.exportProperty(a.util.DataViewReader.prototype,"readBytes",a.util.DataViewReader.prototype.readBytes),a.util.DataViewReader.prototype.skip=function(e){o.asserts.assert(0<=e,"Bad call to DataViewReader.skip"),this.position_+e>this.dataView_.byteLength&&this.throwOutOfBounds_(),this.position_+=e},o.exportProperty(a.util.DataViewReader.prototype,"skip",a.util.DataViewReader.prototype.skip),a.util.DataViewReader.prototype.rewind=function(e){o.asserts.assert(0<=e,"Bad call to DataViewReader.rewind"),this.position_<e&&this.throwOutOfBounds_(),this.position_-=e},o.exportProperty(a.util.DataViewReader.prototype,"rewind",a.util.DataViewReader.prototype.rewind),a.util.DataViewReader.prototype.seek=function(e){o.asserts.assert(0<=e,"Bad call to DataViewReader.seek"),(0>e||e>this.dataView_.byteLength)&&this.throwOutOfBounds_(),this.position_=e},o.exportProperty(a.util.DataViewReader.prototype,"seek",a.util.DataViewReader.prototype.seek),a.util.DataViewReader.prototype.readTerminatedString=function(){for(var e=this.position_;this.hasMoreData()&&0!=this.dataView_.getUint8(this.position_);)this.position_+=1;return e=new Uint8Array(this.dataView_.buffer,this.dataView_.byteOffset+e,this.position_-e),this.position_+=1,a.util.StringUtils.fromUTF8(e)},o.exportProperty(a.util.DataViewReader.prototype,"readTerminatedString",a.util.DataViewReader.prototype.readTerminatedString),a.util.DataViewReader.prototype.throwOutOfBounds_=function(){throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.BUFFER_READ_OUT_OF_BOUNDS)},a.util.Mp4Parser=function(){this.headers_=[],this.boxDefinitions_=[],this.done_=!1},o.exportSymbol("shaka.util.Mp4Parser",a.util.Mp4Parser),a.util.Mp4Parser.BoxType_={BASIC_BOX:0,FULL_BOX:1},a.util.Mp4Parser.prototype.box=function(e,t){var r=a.util.Mp4Parser.typeFromString_(e);return this.headers_[r]=a.util.Mp4Parser.BoxType_.BASIC_BOX,this.boxDefinitions_[r]=t,this},o.exportProperty(a.util.Mp4Parser.prototype,"box",a.util.Mp4Parser.prototype.box),a.util.Mp4Parser.prototype.fullBox=function(e,t){var r=a.util.Mp4Parser.typeFromString_(e);return this.headers_[r]=a.util.Mp4Parser.BoxType_.FULL_BOX,this.boxDefinitions_[r]=t,this},o.exportProperty(a.util.Mp4Parser.prototype,"fullBox",a.util.Mp4Parser.prototype.fullBox),a.util.Mp4Parser.prototype.stop=function(){this.done_=!0},o.exportProperty(a.util.Mp4Parser.prototype,"stop",a.util.Mp4Parser.prototype.stop),a.util.Mp4Parser.prototype.parse=function(e,t){var r=new Uint8Array(e);for(r=new a.util.DataViewReader(new DataView(r.buffer,r.byteOffset,r.byteLength),a.util.DataViewReader.Endianness.BIG_ENDIAN),this.done_=!1;r.hasMoreData()&&!this.done_;)this.parseNext(0,r,t)},o.exportProperty(a.util.Mp4Parser.prototype,"parse",a.util.Mp4Parser.prototype.parse),a.util.Mp4Parser.prototype.parseNext=function(e,t,r){var n=t.getPosition(),i=t.readUint32(),o=t.readUint32(),s=a.util.Mp4Parser.typeToString(o);switch(a.log.v2("Parsing MP4 box",s),i){case 0:i=t.getLength()-n;break;case 1:i=t.readUint64()}if(s=this.boxDefinitions_[o]){var l=null,u=null;this.headers_[o]==a.util.Mp4Parser.BoxType_.FULL_BOX&&(l=(u=t.readUint32())>>>24,u&=16777215),o=n+i,r&&o>t.getLength()&&(o=t.getLength()),o-=t.getPosition(),t=0<o?t.readBytes(o):new Uint8Array(0),s({parser:this,partialOkay:r||!1,version:l,flags:u,reader:t=new a.util.DataViewReader(new DataView(t.buffer,t.byteOffset,t.byteLength),a.util.DataViewReader.Endianness.BIG_ENDIAN),size:i,start:n+e})}else e=Math.min(n+i-t.getPosition(),t.getLength()-t.getPosition()),t.skip(e)},o.exportProperty(a.util.Mp4Parser.prototype,"parseNext",a.util.Mp4Parser.prototype.parseNext),a.util.Mp4Parser.children=function(e){for(var t=null!=e.flags?12:8;e.reader.hasMoreData()&&!e.parser.done_;)e.parser.parseNext(e.start+t,e.reader,e.partialOkay)},o.exportProperty(a.util.Mp4Parser,"children",a.util.Mp4Parser.children),a.util.Mp4Parser.sampleDescription=function(e){for(var t=null!=e.flags?12:8,r=e.reader.readUint32();0<r&&!e.parser.done_;--r)e.parser.parseNext(e.start+t,e.reader,e.partialOkay)},o.exportProperty(a.util.Mp4Parser,"sampleDescription",a.util.Mp4Parser.sampleDescription),a.util.Mp4Parser.allData=function(e){return function(t){var r=t.reader.getLength()-t.reader.getPosition();e(t.reader.readBytes(r))}},o.exportProperty(a.util.Mp4Parser,"allData",a.util.Mp4Parser.allData),a.util.Mp4Parser.typeFromString_=function(e){o.asserts.assert(4==e.length,"Mp4 box names must be 4 characters long");for(var t=0,r=0;r<e.length;r++)t=t<<8|e.charCodeAt(r);return t},a.util.Mp4Parser.typeToString=function(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)},o.exportProperty(a.util.Mp4Parser,"typeToString",a.util.Mp4Parser.typeToString),a.util.Pssh=function(e){var t=this;this.systemIds=[],this.cencKeyIds=[],this.data=[],(new a.util.Mp4Parser).box("moov",a.util.Mp4Parser.children).fullBox("pssh",(function(e){return t.parsePsshBox_(e)})).parse(e),0==this.data.length&&a.log.warning("No pssh box found!")},a.util.Pssh.prototype.parsePsshBox_=function(e){if(o.asserts.assert(null!=e.version,"PSSH boxes are full boxes and must have a valid version"),o.asserts.assert(null!=e.flags,"PSSH boxes are full boxes and must have a valid flag"),1<e.version)a.log.warning("Unrecognized PSSH version found!");else{var t=e.reader.getDataView();if(o.asserts.assert(12<=t.byteOffset,"DataView at incorrect position"),t=new Uint8Array(t.buffer,t.byteOffset-12,e.size),this.data.push(t),this.systemIds.push(a.util.Uint8ArrayUtils.toHex(e.reader.readBytes(16))),0<e.version){t=e.reader.readUint32();for(var r=0;r<t;++r){var n=a.util.Uint8ArrayUtils.toHex(e.reader.readBytes(16));this.cencKeyIds.push(n)}}}},a.util.Pssh.createPssh=function(e,t){var r=e.length,n=12+t.length+4+r,i=new ArrayBuffer(n),a=new Uint8Array(i),s=0;return(i=new DataView(i)).setUint32(s,n),s+=4,i.setUint32(s,1886614376),s+=4,i.setUint32(s,0),s+=4,a.set(t,s),s+=t.length,i.setUint32(s,r),s+=4,a.set(e,s),o.asserts.assert(s+r===n,"PSSH invalid length."),a},a.util.Pssh.normaliseInitData=function(e){if(!e)return e;var t=new a.util.Pssh(e);if(1>=t.data.length)return e;e=[];for(var r={},n=(t=i.makeIterator(t.data)).next();!n.done;r={initData$225:r.initData$225},n=t.next())r.initData$225=n.value,e.some(function(e){return function(t){return a.util.Uint8ArrayUtils.equal(t,e.initData$225)}}(r))||e.push(r.initData$225);return a.util.Uint8ArrayUtils.concat.apply(a.util.Uint8ArrayUtils,i.arrayFromIterable(e))},a.util.XmlUtils={},a.util.XmlUtils.findChild=function(e,t){var r=a.util.XmlUtils.findChildren(e,t);return 1!=r.length?null:r[0]},a.util.XmlUtils.findChildNS=function(e,t,r){return 1!=(e=a.util.XmlUtils.findChildrenNS(e,t,r)).length?null:e[0]},a.util.XmlUtils.findChildren=function(e,t){return Array.prototype.filter.call(e.childNodes,(function(e){return e instanceof Element&&e.tagName==t}))},a.util.XmlUtils.findChildrenNS=function(e,t,r){return Array.prototype.filter.call(e.childNodes,(function(e){return e instanceof Element&&e.localName==r&&e.namespaceURI==t}))},a.util.XmlUtils.getAttributeNS=function(e,t,r){return e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null},a.util.XmlUtils.getContents=function(e){return Array.prototype.every.call(e.childNodes,(function(e){return e.nodeType==Node.TEXT_NODE||e.nodeType==Node.CDATA_SECTION_NODE}))?e.textContent.trim():null},a.util.XmlUtils.parseAttr=function(e,t,r,n){n=void 0===n?null:n;var i=null;return null!=(e=e.getAttribute(t))&&(i=r(e)),null==i?n:i},a.util.XmlUtils.parseDate=function(e){return e?(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e)&&(e+="Z"),e=Date.parse(e),isNaN(e)?null:Math.floor(e/1e3)):null},a.util.XmlUtils.parseDuration=function(e){if(!e)return null;var t=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(e);return t?(e=31536e3*Number(t[1]||null)+2592e3*Number(t[2]||null)+86400*Number(t[3]||null)+3600*Number(t[4]||null)+60*Number(t[5]||null)+Number(t[6]||null),isFinite(e)?e:null):(a.log.warning("Invalid duration string:",e),null)},a.util.XmlUtils.parseRange=function(e){var t=/([0-9]+)-([0-9]+)/.exec(e);return t?(e=Number(t[1]),isFinite(e)?(t=Number(t[2]),isFinite(t)?{start:e,end:t}:null):null):null},a.util.XmlUtils.parseInt=function(e){return 0==(e=Number(e))%1?e:null},a.util.XmlUtils.parsePositiveInt=function(e){return 0==(e=Number(e))%1&&0<e?e:null},a.util.XmlUtils.parseNonNegativeInt=function(e){return 0==(e=Number(e))%1&&0<=e?e:null},a.util.XmlUtils.parseFloat=function(e){return e=Number(e),isNaN(e)?null:e},a.util.XmlUtils.evalDivision=function(e){var t;return e=(t=e.match(/^(\d+)\/(\d+)$/))?Number(t[1])/Number(t[2]):Number(e),isNaN(e)?null:e},a.util.XmlUtils.parseXmlString=function(e,t){var r=new DOMParser;try{var n=r.parseFromString(e,"text/xml")}catch(e){}if(n&&n.documentElement.tagName==t)var i=n.documentElement;return i&&0<i.getElementsByTagName("parsererror").length?null:i},a.util.XmlUtils.parseXml=function(e,t){try{var r=a.util.StringUtils.fromUTF8(e);return a.util.XmlUtils.parseXmlString(r,t)}catch(e){}},a.dash={},a.dash.ContentProtection={},a.dash.ContentProtection.defaultKeySystems_=(new Map).set("urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b","org.w3.clearkey").set("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine.alpha").set("urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95","com.microsoft.playready").set("urn:uuid:79f0049a-4098-8642-ab92-e65be0885f95","com.microsoft.playready").set("urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb","com.adobe.primetime"),a.dash.ContentProtection.MP4Protection_="urn:mpeg:dash:mp4protection:2011",a.dash.ContentProtection.CencNamespaceUri_="urn:mpeg:cenc:2013",a.dash.ContentProtection.parseFromAdaptationSet=function(e,t,r){var n=a.dash.ContentProtection,s=a.util.ManifestParserUtils,l=n.parseElements_(e),u=null;e=[];var c=[],d=new Set(l.map((function(e){return e.keyId})));if(d.delete(null),1<d.size)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.DASH_CONFLICTING_KEY_IDS);if(r||(c=l.filter((function(e){return e.schemeUri!=n.MP4Protection_||(o.asserts.assert(!e.init||e.init.length,"Init data must be null or non-empty."),u=e.init||u,!1)}))).length&&(0==(e=n.convertElements_(u,t,c)).length&&(e=[s.createDrmInfo("",u)])),l.length&&(r||!c.length))for(e=[],r=(t=i.makeIterator(n.defaultKeySystems_.values())).next();!r.done;r=t.next())"org.w3.clearkey"!=(r=r.value)&&(r=s.createDrmInfo(r,u),e.push(r));if(s=Array.from(d)[0]||null)for(t=(d=i.makeIterator(e)).next();!t.done;t=d.next())for(r=(t=i.makeIterator(t.value.initData)).next();!r.done;r=t.next())r.value.keyId=s;return{defaultKeyId:s,defaultInit:u,drmInfos:e,firstRepresentation:!0}},a.dash.ContentProtection.parseFromRepresentation=function(e,t,r,n){var i=a.dash.ContentProtection.parseFromAdaptationSet(e,t,n);if(r.firstRepresentation)e=1==r.drmInfos.length&&!r.drmInfos[0].keySystem,t=0==i.drmInfos.length,(0==r.drmInfos.length||e&&!t)&&(r.drmInfos=i.drmInfos),r.firstRepresentation=!1;else if(0<i.drmInfos.length&&(r.drmInfos=r.drmInfos.filter((function(e){return i.drmInfos.some((function(t){return t.keySystem==e.keySystem}))})),0==r.drmInfos.length))throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.DASH_NO_COMMON_KEY_SYSTEM);return i.defaultKeyId||r.defaultKeyId},a.dash.ContentProtection.getWidevineLicenseUrl=function(e){return(e=a.util.XmlUtils.findChildNS(e.node,"urn:microsoft","laurl"))&&e.getAttribute("licenseUrl")||""},a.dash.ContentProtection.PLAYREADY_RECORD_TYPES={RIGHTS_MANAGEMENT:1,RESERVED:2,EMBEDDED_LICENSE:3},a.dash.ContentProtection.parseMsProRecords_=function(e,t){for(var r=[],n=new DataView(e);t<e.byteLength-1;){var i=n.getUint16(t,!0);t+=2;var a=n.getUint16(t,!0);t+=2,o.asserts.assert(0==(1&a),"expected byteLength to be an even number");var s=new Uint8Array(e,t,a);r.push({type:i,value:s}),t+=a}return r},a.dash.ContentProtection.parseMsPro_=function(e){var t=0,r=new DataView(e).getUint32(t,!0);return t+=4,r!==e.byteLength?(a.log.warning("PlayReady Object with invalid length encountered."),[]):a.dash.ContentProtection.parseMsProRecords_(e,t+2)},a.dash.ContentProtection.getLaurl_=function(e){for(var t=(e=i.makeIterator(e.getElementsByTagName("DATA"))).next();!t.done;t=e.next())for(var r=(t=i.makeIterator(t.value.childNodes)).next();!r.done;r=t.next())if((r=r.value)instanceof Element&&"LA_URL"==r.tagName)return r.textContent;return""},a.dash.ContentProtection.getPlayReadyLicenseUrl=function(e){var t=a.util.XmlUtils.findChildNS(e.node,"urn:microsoft:playready","pro");if(!t)return"";var r=(e=a.dash.ContentProtection).PLAYREADY_RECORD_TYPES;return t=a.util.Uint8ArrayUtils.fromBase64(t.textContent),(t=e.parseMsPro_(t.buffer).filter((function(e){return e.type===r.RIGHTS_MANAGEMENT}))[0])?(t=a.util.StringUtils.fromUTF16(t.value,!0),(t=a.util.XmlUtils.parseXmlString(t,"WRMHEADER"))?e.getLaurl_(t):""):""},a.dash.ContentProtection.getInitDataFromPro_=function(e){var t=a.util.XmlUtils.findChildNS(e.node,"urn:microsoft:playready","pro");if(!t)return null;t=a.util.Uint8ArrayUtils.fromBase64(t.textContent);var r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);return[{initData:a.util.Pssh.createPssh(t,r),initDataType:"cenc",keyId:e.keyId}]},a.dash.ContentProtection.convertElements_=function(e,t,r){for(var n=a.dash.ContentProtection,s=a.util.ManifestParserUtils,l=n.defaultKeySystems_,u=n.licenseUrlParsers_,c=[],d=(r=i.makeIterator(r)).next();!d.done;d=r.next()){d=d.value;var p=l.get(d.schemeUri);if(p){o.asserts.assert(!d.init||d.init.length,"Init data must be null or non-empty.");var f=n.getInitDataFromPro_(d);f=s.createDrmInfo(p,d.init||e||f),(p=u.get(p))&&(f.licenseServerUri=p(d)),c.push(f)}else for(o.asserts.assert(t,"ContentProtection callback is required"),d=t(d.node)||[],p=(d=i.makeIterator(d)).next();!p.done;p=d.next())c.push(p.value)}return c},a.dash.ContentProtection.licenseUrlParsers_=(new Map).set("com.widevine.alpha",a.dash.ContentProtection.getWidevineLicenseUrl).set("com.microsoft.playready",a.dash.ContentProtection.getPlayReadyLicenseUrl),a.dash.ContentProtection.parseElements_=function(e){for(var t=[],r=(e=i.makeIterator(e)).next();!r.done;r=e.next())(r=a.dash.ContentProtection.parseElement_(r.value))&&t.push(r);return t},a.dash.ContentProtection.parseElement_=function(e){var t=a.dash.ContentProtection.CencNamespaceUri_,r=e.getAttribute("schemeIdUri"),n=a.util.XmlUtils.getAttributeNS(e,t,"default_KID");if(t=a.util.XmlUtils.findChildrenNS(e,t,"pssh").map(a.util.XmlUtils.getContents),!r)return a.log.error("Missing required schemeIdUri attribute on","ContentProtection element",e),null;if(r=r.toLowerCase(),n&&(n=n.replace(/-/g,"").toLowerCase()).includes(" "))throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED);var i=[];try{i=t.map((function(e){return{initDataType:"cenc",initData:a.util.Uint8ArrayUtils.fromBase64(e),keyId:null}}))}catch(e){throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.DASH_PSSH_BAD_ENCODING)}return{node:e,schemeUri:r,keyId:n,init:0<i.length?i:null}},a.dash.MpdUtils={},a.dash.MpdUtils.XlinkNamespaceUri_="http://www.w3.org/1999/xlink",a.dash.MpdUtils.fillUriTemplate=function(t,r,n,i,s){var l={RepresentationID:r,Number:n,Bandwidth:i,Time:s};return t.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,(function(r,n,i,s){if("$$"==r)return"$";var u=l[n];if(o.asserts.assert(void 0!==u,"Unrecognized identifier"),null==u)return a.log.warning("URL template does not have an available substitution for identifier",'"'+n+'":',t),r;switch("RepresentationID"==n&&i&&(a.log.warning("URL template should not contain a width specifier for identifier",'"RepresentationID":',t),i=void 0),"Time"==n&&(o.asserts.assert(.2>Math.abs(u-Math.round(u)),"Calculated $Time$ values must be close to integers"),u=Math.round(u)),s){case void 0:case"d":case"i":case"u":r=u.toString();break;case"o":r=u.toString(8);break;case"x":r=u.toString(16);break;case"X":r=u.toString(16).toUpperCase();break;default:o.asserts.assert(!1,"Unhandled format specifier"),r=u.toString()}return i=e.parseInt(i,10)||1,Array(Math.max(0,i-r.length)+1).join("0")+r}))},a.dash.MpdUtils.createTimeline=function(e,t,r,n){o.asserts.assert(0<t&&1/0>t,"timescale must be a positive, finite integer"),o.asserts.assert(0<n,"period duration must be a positive integer");var i=a.util.XmlUtils;e=i.findChildren(e,"S");for(var s=[],l=-r,u=0;u<e.length;++u){var c=e[u],d=i.parseAttr(c,"t",i.parseNonNegativeInt),p=i.parseAttr(c,"d",i.parseNonNegativeInt),f=i.parseAttr(c,"r",i.parseInt);if(null!=d&&(d-=r),!p){a.log.warning('"S" element must have a duration:','ignoring the remaining "S" elements.',c);break}if(d=null!=d?d:l,0>(f=f||0))if(u+1<e.length){if(null==(f=i.parseAttr(e[u+1],"t",i.parseNonNegativeInt))){a.log.warning('An "S" element cannot have a negative repeat','if the next "S" element does not have a valid start time:','ignoring the remaining "S" elements.',c);break}if(d>=f){a.log.warning('An "S" element cannot have a negative repeat','if its start time exceeds the next "S" element\'s start time:','ignoring the remaining "S" elements.',c);break}f=Math.ceil((f-d)/p)-1}else{if(1/0==n){a.log.warning('The last "S" element cannot have a negative repeat',"if the Period has an infinite duration:",'ignoring the last "S" element.',c);break}if(d/t>=n){a.log.warning('The last "S" element cannot have a negative repeat',"if its start time exceeds the Period's duration:",'igoring the last "S" element.',c);break}f=Math.ceil((n*t-d)/p)-1}for(0<s.length&&d!=l&&(Math.abs((d-l)/t)>=a.util.ManifestParserUtils.GAP_OVERLAP_TOLERANCE_SECONDS&&a.log.warning("SegmentTimeline contains a large gap/overlap:","the content may have errors in it.",c),s[s.length-1].end=d/t),c=0;c<=f;++c)l=d+p,s.push({start:d/t,end:l/t,unscaledStart:d}),d=l}return s},a.dash.MpdUtils.parseSegmentInfo=function(e,t){o.asserts.assert(t(e.representation),"There must be at least one element of the given type.");var r=a.dash.MpdUtils,n=a.util.XmlUtils,i=r.inheritAttribute(e,t,"timescale"),s=1;i&&(s=n.parsePositiveInt(i)||1),i=r.inheritAttribute(e,t,"duration"),(i=n.parsePositiveInt(i||""))&&(i/=s);var l=r.inheritAttribute(e,t,"startNumber"),u=Number(r.inheritAttribute(e,t,"presentationTimeOffset"))||0;n=n.parseNonNegativeInt(l||""),null!=l&&null!=n||(n=1);var c=null;return(l=r.inheritChild(e,t,"SegmentTimeline"))&&(c=r.createTimeline(l,s,u,e.periodInfo.duration||1/0)),{timescale:s,segmentDuration:i,startNumber:n,scaledPresentationTimeOffset:u/s||0,unscaledPresentationTimeOffset:u,timeline:c}},a.dash.MpdUtils.inheritAttribute=function(e,t,r){var n=a.util.Functional;return o.asserts.assert(t(e.representation),"There must be at least one element of the given type"),[t(e.representation),t(e.adaptationSet),t(e.period)].filter(n.isNotNull).map((function(e){return e.getAttribute(r)})).reduce((function(e,t){return e||t}))},a.dash.MpdUtils.inheritChild=function(e,t,r){var n=a.util.Functional;o.asserts.assert(t(e.representation),"There must be at least one element of the given type"),e=[t(e.representation),t(e.adaptationSet),t(e.period)].filter(n.isNotNull);var i=a.util.XmlUtils;return e.map((function(e){return i.findChild(e,r)})).reduce((function(e,t){return e||t}))},a.dash.MpdUtils.handleXlinkInElement_=function(e,t,r,n,i,s){var l=a.util.XmlUtils,u=a.util.Error,c=a.util.ManifestParserUtils,d=a.dash.MpdUtils.XlinkNamespaceUri_,p=l.getAttributeNS(e,d,"href");l=l.getAttributeNS(e,d,"actuate")||"onRequest";for(var f=0;f<e.attributes.length;f++){var h=e.attributes[f];h.namespaceURI==d&&(e.removeAttributeNS(h.namespaceURI,h.localName),--f)}if(5<=s)return a.util.AbortableOperation.failed(new u(u.Severity.CRITICAL,u.Category.MANIFEST,u.Code.DASH_XLINK_DEPTH_LIMIT));if("onLoad"!=l)return a.util.AbortableOperation.failed(new u(u.Severity.CRITICAL,u.Category.MANIFEST,u.Code.DASH_UNSUPPORTED_XLINK_ACTUATE));var m=c.resolveUris([n],[p]);return n=a.net.NetworkingEngine.RequestType.MANIFEST,c=a.net.NetworkingEngine.makeRequest(m,t),n=i.request(n,c),o.asserts.assert(n instanceof a.util.AbortableOperation,"Unexpected implementation of IAbortableOperation!"),n.chain((function(n){if(!(n=a.util.XmlUtils.parseXml(n.data,e.tagName)))return a.util.AbortableOperation.failed(new u(u.Severity.CRITICAL,u.Category.MANIFEST,u.Code.DASH_INVALID_XML,p));for(;e.childNodes.length;)e.removeChild(e.childNodes[0]);for(;n.childNodes.length;){var o=n.childNodes[0];n.removeChild(o),e.appendChild(o)}for(o=0;o<n.attributes.length;o++){var l=n.attributes[o].nodeName,c=n.getAttribute(l);e.setAttribute(l,c)}return a.dash.MpdUtils.processXlinks(e,t,r,m[0],i,s+1)}))},a.dash.MpdUtils.processXlinks=function(e,t,r,n,i,o){o=void 0===o?0:o;var s=a.dash.MpdUtils,l=a.util.XmlUtils,u=s.XlinkNamespaceUri_;if(l.getAttributeNS(e,u,"href"))return l=s.handleXlinkInElement_(e,t,r,n,i,o),r&&(l=l.chain(void 0,(function(a){return s.processXlinks(e,t,r,n,i,o)}))),l;for(var c=[],d=0;d<e.childNodes.length;d++){var p=e.childNodes[d];p instanceof Element&&("urn:mpeg:dash:resolve-to-zero:2013"==l.getAttributeNS(p,u,"href")?(e.removeChild(p),--d):"SegmentTimeline"!=p.tagName&&c.push(a.dash.MpdUtils.processXlinks(p,t,r,n,i,o)))}return a.util.AbortableOperation.all(c).chain((function(){return e}))},a.media.InitSegmentReference=function(e,t,r){this.getUris=e,this.startByte=t,this.endByte=r},o.exportSymbol("shaka.media.InitSegmentReference",a.media.InitSegmentReference),a.media.InitSegmentReference.prototype.createUris=function(){return this.getUris()},o.exportProperty(a.media.InitSegmentReference.prototype,"createUris",a.media.InitSegmentReference.prototype.createUris),a.media.InitSegmentReference.prototype.getStartByte=function(){return this.startByte},o.exportProperty(a.media.InitSegmentReference.prototype,"getStartByte",a.media.InitSegmentReference.prototype.getStartByte),a.media.InitSegmentReference.prototype.getEndByte=function(){return this.endByte},o.exportProperty(a.media.InitSegmentReference.prototype,"getEndByte",a.media.InitSegmentReference.prototype.getEndByte),a.media.InitSegmentReference.prototype.getSize=function(){return this.endByte?this.endByte-this.startByte:null},a.media.SegmentReference=function(e,t,r,n,i,a){o.asserts.assert(t<r,"startTime must be less than endTime"),o.asserts.assert(i<a||null==a,"startByte must be < endByte"),this.position=e,this.startTime=t,this.endTime=r,this.getUris=n,this.startByte=i,this.endByte=a},o.exportSymbol("shaka.media.SegmentReference",a.media.SegmentReference),a.media.SegmentReference.prototype.getPosition=function(){return this.position},o.exportProperty(a.media.SegmentReference.prototype,"getPosition",a.media.SegmentReference.prototype.getPosition),a.media.SegmentReference.prototype.getStartTime=function(){return this.startTime},o.exportProperty(a.media.SegmentReference.prototype,"getStartTime",a.media.SegmentReference.prototype.getStartTime),a.media.SegmentReference.prototype.getEndTime=function(){return this.endTime},o.exportProperty(a.media.SegmentReference.prototype,"getEndTime",a.media.SegmentReference.prototype.getEndTime),a.media.SegmentReference.prototype.createUris=function(){return this.getUris()},o.exportProperty(a.media.SegmentReference.prototype,"createUris",a.media.SegmentReference.prototype.createUris);a.media.SegmentReference.prototype.getStartByte=function(){return this.startByte},o.exportProperty(a.media.SegmentReference.prototype,"getStartByte",a.media.SegmentReference.prototype.getStartByte),a.media.SegmentReference.prototype.getEndByte=function(){return this.endByte},o.exportProperty(a.media.SegmentReference.prototype,"getEndByte",a.media.SegmentReference.prototype.getEndByte),a.media.SegmentReference.prototype.getSize=function(){return this.endByte?this.endByte-this.startByte:null},a.media.Mp4SegmentIndexParser=function(e,t,r,n){var i,o=a.media.Mp4SegmentIndexParser,s=(new a.util.Mp4Parser).fullBox("sidx",(function(e){i=o.parseSIDX_(t,n,r,e)}));if(e&&s.parse(e),i)return i;throw a.log.error('Invalid box type, expected "sidx".'),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.MP4_SIDX_WRONG_BOX_TYPE)},a.media.Mp4SegmentIndexParser.parseSIDX_=function(e,t,r,n){o.asserts.assert(null!=n.version,"SIDX is a full box and should have a valid version.");var i=[];n.reader.skip(4);var s=n.reader.readUint32();if(0==s)throw a.log.error("Invalid timescale."),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.MP4_SIDX_INVALID_TIMESCALE);if(0==n.version)var l=n.reader.readUint32(),u=n.reader.readUint32();else l=n.reader.readUint64(),u=n.reader.readUint64();n.reader.skip(2);var c=n.reader.readUint16();for(e=e+n.size+u,u=0;u<c;u++){var d=n.reader.readUint32(),p=(2147483648&d)>>>31;d&=2147483647;var f=n.reader.readUint32();if(n.reader.skip(4),1==p)throw a.log.error("Heirarchical SIDXs are not supported."),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.MP4_SIDX_TYPE_NOT_SUPPORTED);i.push(new a.media.SegmentReference(i.length,l/s-t,(l+f)/s-t,(function(){return r}),e,e+d-1)),l+=f,e+=d}return n.parser.stop(),i},a.media.SegmentIndex=function(e){o.DEBUG&&a.media.SegmentIndex.assertCorrectReferences_(e),this.references_=e},o.exportSymbol("shaka.media.SegmentIndex",a.media.SegmentIndex),a.media.SegmentIndex.prototype.destroy=function(){return this.references_=null,Promise.resolve()},o.exportProperty(a.media.SegmentIndex.prototype,"destroy",a.media.SegmentIndex.prototype.destroy),a.media.SegmentIndex.prototype.find=function(e){for(var t=this.references_.length-1;0<=t;--t){var r=this.references_[t];if(e>=r.startTime&&e<r.endTime)return r.position}return this.references_.length&&e<this.references_[0].startTime?this.references_[0].position:null},o.exportProperty(a.media.SegmentIndex.prototype,"find",a.media.SegmentIndex.prototype.find),a.media.SegmentIndex.prototype.get=function(e){return 0==this.references_.length||0>(e-=this.references_[0].position)||e>=this.references_.length?null:this.references_[e]},o.exportProperty(a.media.SegmentIndex.prototype,"get",a.media.SegmentIndex.prototype.get),a.media.SegmentIndex.prototype.offset=function(e){for(var t=0;t<this.references_.length;++t)this.references_[t].startTime+=e,this.references_[t].endTime+=e},o.exportProperty(a.media.SegmentIndex.prototype,"offset",a.media.SegmentIndex.prototype.offset),a.media.SegmentIndex.prototype.merge=function(e){o.DEBUG&&a.media.SegmentIndex.assertCorrectReferences_(e);for(var t=[],r=0,n=0;r<this.references_.length&&n<e.length;){var i=this.references_[r],s=e[n];i.startTime<s.startTime?(t.push(i),r++):(i.startTime>s.startTime?0==r?t.push(s):a.log.warning("Refusing to rewrite original references on update!"):(.1<Math.abs(i.endTime-s.endTime)?(o.asserts.assert(s.endTime>i.endTime&&r==this.references_.length-1&&n==e.length-1,"This should be an update of the last segment in a period"),i=new a.media.SegmentReference(i.position,s.startTime,s.endTime,s.getUris,s.startByte,s.endByte),t.push(i)):t.push(i),r++),n++)}for(;r<this.references_.length;)t.push(this.references_[r++]);if(t.length)for(r=t[t.length-1].position+1;n<e.length;)i=e[n++],i=new a.media.SegmentReference(r++,i.startTime,i.endTime,i.getUris,i.startByte,i.endByte),t.push(i);else t=e;o.DEBUG&&a.media.SegmentIndex.assertCorrectReferences_(t),this.references_=t},o.exportProperty(a.media.SegmentIndex.prototype,"merge",a.media.SegmentIndex.prototype.merge),a.media.SegmentIndex.prototype.replace=function(e){o.DEBUG&&a.media.SegmentIndex.assertCorrectReferences_(e),this.references_=e},a.media.SegmentIndex.prototype.evict=function(e){for(var t=0;t<this.references_.length;++t)if(this.references_[t].endTime>e)return void this.references_.splice(0,t);this.references_=[]},o.exportProperty(a.media.SegmentIndex.prototype,"evict",a.media.SegmentIndex.prototype.evict),a.media.SegmentIndex.prototype.fit=function(e){for(o.asserts.assert(null!=e,"Period duration must be known for static content!"),o.asserts.assert(1/0!=e,"Period duration must be finite for static content!");this.references_.length&&this.references_[this.references_.length-1].startTime>=e;)this.references_.pop();for(;this.references_.length&&0>=this.references_[0].endTime;)this.references_.shift();if(0!=this.references_.length){var t=this.references_[this.references_.length-1];this.references_[this.references_.length-1]=new a.media.SegmentReference(t.position,t.startTime,e,t.getUris,t.startByte,t.endByte)}},o.DEBUG&&(a.media.SegmentIndex.assertCorrectReferences_=function(e){o.asserts.assert(e.every((function(t,r){if(0==r)return!0;var n=e[r-1];return t.position==n.position+1&&(n.startTime<t.startTime||!(n.startTime>t.startTime)&&n.endTime<=t.endTime)})),"SegmentReferences are incorrect")}),a.util.EbmlParser=function(e){this.dataView_=e,this.reader_=new a.util.DataViewReader(e,a.util.DataViewReader.Endianness.BIG_ENDIAN),a.util.EbmlParser.DYNAMIC_SIZES||(a.util.EbmlParser.DYNAMIC_SIZES=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])},a.util.EbmlParser.prototype.hasMoreData=function(){return this.reader_.hasMoreData()},a.util.EbmlParser.prototype.parseElement=function(){var e=this.parseId_(),t=this.parseVint_();t=a.util.EbmlParser.isDynamicSizeValue_(t)?this.dataView_.byteLength-this.reader_.getPosition():a.util.EbmlParser.getVintValue_(t),t=this.reader_.getPosition()+t<=this.dataView_.byteLength?t:this.dataView_.byteLength-this.reader_.getPosition();var r=new DataView(this.dataView_.buffer,this.dataView_.byteOffset+this.reader_.getPosition(),t);return this.reader_.skip(t),new a.util.EbmlElement(e,r)},a.util.EbmlParser.prototype.parseId_=function(){var e=this.parseVint_();if(7<e.length)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.EBML_OVERFLOW);for(var t=0,r=0;r<e.length;r++)t=256*t+e[r];return t},a.util.EbmlParser.prototype.parseVint_=function(){var e,t=this.reader_.readUint8();for(e=1;8>=e&&!(t&1<<8-e);e++);if(8<e)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.EBML_OVERFLOW);var r=new Uint8Array(e);for(r[0]=t,t=1;t<e;t++)r[t]=this.reader_.readUint8();return r},a.util.EbmlParser.getVintValue_=function(e){if(8==e.length&&224&e[1])throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.JS_INTEGER_OVERFLOW);for(var t=e[0]&(1<<8-e.length)-1,r=1;r<e.length;r++)t=256*t+e[r];return t},a.util.EbmlParser.isDynamicSizeValue_=function(e){for(var t=a.util.EbmlParser,r=a.util.Uint8ArrayUtils.equal,n=0;n<t.DYNAMIC_SIZES.length;n++)if(r(e,t.DYNAMIC_SIZES[n]))return!0;return!1},a.util.EbmlElement=function(e,t){this.id=e,this.dataView_=t},a.util.EbmlElement.prototype.getOffset=function(){return this.dataView_.byteOffset},a.util.EbmlElement.prototype.createParser=function(){return new a.util.EbmlParser(this.dataView_)},a.util.EbmlElement.prototype.getUint=function(){if(8<this.dataView_.byteLength)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.EBML_OVERFLOW);if(8==this.dataView_.byteLength&&224&this.dataView_.getUint8(0))throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.JS_INTEGER_OVERFLOW);for(var e=0,t=0;t<this.dataView_.byteLength;t++){e=256*e+this.dataView_.getUint8(t)}return e},a.util.EbmlElement.prototype.getFloat=function(){if(4==this.dataView_.byteLength)return this.dataView_.getFloat32(0);if(8==this.dataView_.byteLength)return this.dataView_.getFloat64(0);throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.EBML_BAD_FLOATING_POINT_SIZE)},a.media.WebmSegmentIndexParser=function(){},a.media.WebmSegmentIndexParser.EBML_ID=440786851,a.media.WebmSegmentIndexParser.SEGMENT_ID=408125543,a.media.WebmSegmentIndexParser.INFO_ID=357149030,a.media.WebmSegmentIndexParser.TIMECODE_SCALE_ID=2807729,a.media.WebmSegmentIndexParser.DURATION_ID=17545,a.media.WebmSegmentIndexParser.CUES_ID=475249515,a.media.WebmSegmentIndexParser.CUE_POINT_ID=187,a.media.WebmSegmentIndexParser.CUE_TIME_ID=179,a.media.WebmSegmentIndexParser.CUE_TRACK_POSITIONS_ID=183,a.media.WebmSegmentIndexParser.CUE_CLUSTER_POSITION=241,a.media.WebmSegmentIndexParser.prototype.parse=function(e,t,r,n){if(t=this.parseWebmContainer_(t),(e=new a.util.EbmlParser(new DataView(e)).parseElement()).id!=a.media.WebmSegmentIndexParser.CUES_ID)throw a.log.error("Not a Cues element."),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.WEBM_CUES_ELEMENT_MISSING);return this.parseCues_(e,t.segmentOffset,t.timecodeScale,t.duration,r,n)},a.media.WebmSegmentIndexParser.prototype.parseWebmContainer_=function(e){if((e=new a.util.EbmlParser(new DataView(e))).parseElement().id!=a.media.WebmSegmentIndexParser.EBML_ID)throw a.log.error("Not an EBML element."),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.WEBM_EBML_HEADER_ELEMENT_MISSING);var t=e.parseElement();if(t.id!=a.media.WebmSegmentIndexParser.SEGMENT_ID)throw a.log.error("Not a Segment element."),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.WEBM_SEGMENT_ELEMENT_MISSING);return{segmentOffset:e=t.getOffset(),timecodeScale:(t=this.parseSegment_(t)).timecodeScale,duration:t.duration}},a.media.WebmSegmentIndexParser.prototype.parseSegment_=function(e){e=e.createParser();for(var t=null;e.hasMoreData();){var r=e.parseElement();if(r.id==a.media.WebmSegmentIndexParser.INFO_ID){t=r;break}}if(!t)throw a.log.error("Not an Info element."),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.WEBM_INFO_ELEMENT_MISSING);return this.parseInfo_(t)},a.media.WebmSegmentIndexParser.prototype.parseInfo_=function(e){var t=e.createParser(),r=1e6;for(e=null;t.hasMoreData();){var n=t.parseElement();n.id==a.media.WebmSegmentIndexParser.TIMECODE_SCALE_ID?r=n.getUint():n.id==a.media.WebmSegmentIndexParser.DURATION_ID&&(e=n.getFloat())}if(null==e)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.WEBM_DURATION_ELEMENT_MISSING);return{timecodeScale:t=r/1e9,duration:e*t}},a.media.WebmSegmentIndexParser.prototype.parseCues_=function(e,t,r,n,i,s){var l=[],u=function(){return i};e=e.createParser();for(var c=null,d=null;e.hasMoreData();){var p=e.parseElement();if(p.id==a.media.WebmSegmentIndexParser.CUE_POINT_ID){var f=this.parseCuePoint_(p);f&&(p=r*f.unscaledTime,f=t+f.relativeOffset,null!=c&&(o.asserts.assert(null!=d,"last offset cannot be null"),l.push(new a.media.SegmentReference(l.length,c-s,p-s,u,d,f-1))),c=p,d=f)}}return null!=c&&(o.asserts.assert(null!=d,"last offset cannot be null"),l.push(new a.media.SegmentReference(l.length,c-s,n-s,u,d,null))),l},a.media.WebmSegmentIndexParser.prototype.parseCuePoint_=function(e){var t=e.createParser();if((e=t.parseElement()).id!=a.media.WebmSegmentIndexParser.CUE_TIME_ID)throw a.log.warning("Not a CueTime element."),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.WEBM_CUE_TIME_ELEMENT_MISSING);if(e=e.getUint(),(t=t.parseElement()).id!=a.media.WebmSegmentIndexParser.CUE_TRACK_POSITIONS_ID)throw a.log.warning("Not a CueTrackPositions element."),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING);t=t.createParser();for(var r=0;t.hasMoreData();){var n=t.parseElement();if(n.id==a.media.WebmSegmentIndexParser.CUE_CLUSTER_POSITION){r=n.getUint();break}}return{unscaledTime:e,relativeOffset:r}},a.dash.SegmentBase={},a.dash.SegmentBase.createInitSegment=function(e,t){var r=a.util.XmlUtils,n=a.util.ManifestParserUtils,i=a.dash.MpdUtils.inheritChild(e,t,"Initialization");if(!i)return null;var o=e.representation.baseUris,s=i.getAttribute("sourceURL");return s&&(o=n.resolveUris(e.representation.baseUris,[s])),n=0,s=null,(r=r.parseAttr(i,"range",r.parseRange))&&(n=r.start,s=r.end),new a.media.InitSegmentReference((function(){return o}),n,s)},a.dash.SegmentBase.createStream=function(e,t){o.asserts.assert(e.representation.segmentBase,"Should only be called with SegmentBase");var r=a.dash.MpdUtils,n=a.dash.SegmentBase,i=a.util.XmlUtils,s=Number(r.inheritAttribute(e,n.fromInheritance_,"presentationTimeOffset"))||0,l=1;return(r=r.inheritAttribute(e,n.fromInheritance_,"timescale"))&&(l=i.parsePositiveInt(r)||1),i=s/l||0,s=n.createInitSegment(e,n.fromInheritance_),{createSegmentIndex:(n=n.createSegmentIndex_(e,t,s,i)).createSegmentIndex,findSegmentPosition:n.findSegmentPosition,getSegmentReference:n.getSegmentReference,initSegmentReference:s,scaledPresentationTimeOffset:i}},a.dash.SegmentBase.createSegmentIndexFromUris=function(e,t,r,n,i,s,l,u){var c=e.presentationTimeline,d=!e.dynamic||!e.periodInfo.isLastPeriod,p=e.periodInfo.start,f=e.periodInfo.duration,h=t,m=null;return{createSegmentIndex:function(){var e=[h(n,i,s),"webm"==l?h(r.getUris(),r.startByte,r.endByte):null];return h=null,Promise.all(e).then((function(e){var t=e[0];e=e[1]||null,"mp4"==l?t=a.media.Mp4SegmentIndexParser(t,i,n,u):(o.asserts.assert(e,"WebM requires init data"),t=(new a.media.WebmSegmentIndexParser).parse(t,e,n,u)),c.notifySegments(t,p),o.asserts.assert(!m,"Should not call createSegmentIndex twice"),m=new a.media.SegmentIndex(t),d&&m.fit(f)}))},findSegmentPosition:function(e){return o.asserts.assert(m,"Must call createSegmentIndex first"),m.find(e)},getSegmentReference:function(e){return o.asserts.assert(m,"Must call createSegmentIndex first"),m.get(e)}}},a.dash.SegmentBase.fromInheritance_=function(e){return e.segmentBase},a.dash.SegmentBase.createSegmentIndex_=function(e,t,r,n){var i=a.dash.MpdUtils,o=a.dash.SegmentBase,s=a.util.XmlUtils,l=a.util.ManifestParserUtils,u=a.util.ManifestParserUtils.ContentType,c=e.representation.contentType,d=e.representation.mimeType.split("/")[1];if(c!=u.TEXT&&"mp4"!=d&&"webm"!=d)throw a.log.error("SegmentBase specifies an unsupported container type.",e.representation),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.DASH_UNSUPPORTED_CONTAINER);if("webm"==d&&!r)throw a.log.error("SegmentBase does not contain sufficient segment information:","the SegmentBase uses a WebM container,","but does not contain an Initialization element.",e.representation),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.DASH_WEBM_MISSING_INIT);if(u=i.inheritChild(e,o.fromInheritance_,"RepresentationIndex"),o=i.inheritAttribute(e,o.fromInheritance_,"indexRange"),i=e.representation.baseUris,o=s.parseRange(o||""),u&&((c=u.getAttribute("sourceURL"))&&(i=l.resolveUris(e.representation.baseUris,[c])),o=s.parseAttr(u,"range",s.parseRange,o)),!o)throw a.log.error("SegmentBase does not contain sufficient segment information:","the SegmentBase does not contain @indexRange","or a RepresentationIndex element.",e.representation),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.DASH_NO_SEGMENT_INFO);return a.dash.SegmentBase.createSegmentIndexFromUris(e,t,r,i,o.start,o.end,d,n)},a.dash.SegmentList={},a.dash.SegmentList.createStream=function(e,t){o.asserts.assert(e.representation.segmentList,"Should only be called with SegmentList");var r=a.dash.SegmentList,n=a.dash.SegmentBase.createInitSegment(e,r.fromInheritance_),i=r.parseSegmentListInfo_(e);r.checkSegmentListInfo_(e,i);var s=null,l=null;return e.period.id&&e.representation.id&&(s=t[l=e.period.id+","+e.representation.id]),r=r.createSegmentReferences_(e.periodInfo.duration,i.startNumber,e.representation.baseUris,i),s?(s.merge(r),l=e.presentationTimeline.getSegmentAvailabilityStart(),s.evict(l-e.periodInfo.start)):(e.presentationTimeline.notifySegments(r,e.periodInfo.start),s=new a.media.SegmentIndex(r),l&&e.dynamic&&(t[l]=s)),e.dynamic&&e.periodInfo.isLastPeriod||s.fit(e.periodInfo.duration),{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:s.find.bind(s),getSegmentReference:s.get.bind(s),initSegmentReference:n,scaledPresentationTimeOffset:i.scaledPresentationTimeOffset}},a.dash.SegmentList.fromInheritance_=function(e){return e.segmentList},a.dash.SegmentList.parseSegmentListInfo_=function(e){var t=a.dash.SegmentList,r=a.dash.MpdUtils,n=t.parseMediaSegments_(e);return 0==(t=(e=r.parseSegmentInfo(e,t.fromInheritance_)).startNumber)&&(a.log.warning("SegmentList@startNumber must be > 0"),t=1),r=0,e.segmentDuration?r=e.segmentDuration*(t-1):e.timeline&&0<e.timeline.length&&(r=e.timeline[0].start),{segmentDuration:e.segmentDuration,startTime:r,startNumber:t,scaledPresentationTimeOffset:e.scaledPresentationTimeOffset,timeline:e.timeline,mediaSegments:n}},a.dash.SegmentList.checkSegmentListInfo_=function(e,t){if(!t.segmentDuration&&!t.timeline&&1<t.mediaSegments.length)throw a.log.warning("SegmentList does not contain sufficient segment information:","the SegmentList specifies multiple segments,","but does not specify a segment duration or timeline.",e.representation),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.DASH_NO_SEGMENT_INFO);if(!t.segmentDuration&&!e.periodInfo.duration&&!t.timeline&&1==t.mediaSegments.length)throw a.log.warning("SegmentList does not contain sufficient segment information:","the SegmentList specifies one segment,","but does not specify a segment duration, period duration,","or timeline.",e.representation),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.DASH_NO_SEGMENT_INFO);if(t.timeline&&0==t.timeline.length)throw a.log.warning("SegmentList does not contain sufficient segment information:","the SegmentList has an empty timeline.",e.representation),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.DASH_NO_SEGMENT_INFO)},a.dash.SegmentList.createSegmentReferences_=function(e,t,r,n){var i=a.util.ManifestParserUtils,s=n.mediaSegments.length;n.timeline&&n.timeline.length!=n.mediaSegments.length&&(s=Math.min(n.timeline.length,n.mediaSegments.length),a.log.warning("The number of items in the segment timeline and the number of segment","URLs do not match, truncating",n.mediaSegments.length,"to",s));for(var l=[],u=n.startTime,c=0;c<s;c++){var d=n.mediaSegments[c],p=i.resolveUris(r,[d.mediaUri]),f=void 0;null!=n.segmentDuration?f=u+n.segmentDuration:n.timeline?f=n.timeline[c].end:(o.asserts.assert(1==n.mediaSegments.length&&e,"There should be exactly one segment with a Period duration."),f=u+e),p=function(e){return e}.bind(null,p),l.push(new a.media.SegmentReference(c+t,u,f,p,d.start,d.end)),u=f}return l},a.dash.SegmentList.parseMediaSegments_=function(e){var t=[e.representation.segmentList,e.adaptationSet.segmentList,e.period.segmentList].filter(a.util.Functional.isNotNull),r=a.util.XmlUtils;return t.map((function(e){return r.findChildren(e,"SegmentURL")})).reduce((function(e,t){return 0<e.length?e:t})).map((function(t){return t.getAttribute("indexRange")&&!e.indexRangeWarningGiven&&(e.indexRangeWarningGiven=!0,a.log.warning("We do not support the SegmentURL@indexRange attribute on SegmentList.  We only use the SegmentList@duration attribute or SegmentTimeline, which must be accurate.")),{mediaUri:t.getAttribute("media"),start:(t=r.parseAttr(t,"mediaRange",r.parseRange,{start:0,end:null})).start,end:t.end}}))},a.dash.SegmentTemplate={},a.dash.SegmentTemplate.createStream=function(e,t,r,n){o.asserts.assert(e.representation.segmentTemplate,"Should only be called with SegmentTemplate");var i=a.dash.SegmentTemplate,s=i.createInitSegment_(e),l=i.parseSegmentTemplateInfo_(e);if(i.checkSegmentTemplateInfo_(e,l),l.indexTemplate)e=i.createFromIndexTemplate_(e,t,s,l);else if(l.segmentDuration)n||(e.presentationTimeline.notifyMaxSegmentDuration(l.segmentDuration),e.presentationTimeline.notifyMinSegmentStartTime(e.periodInfo.start)),e=i.createFromDuration_(e,l);else{n=t=null,e.period.id&&e.representation.id&&(t=r[n=e.period.id+","+e.representation.id]);var u=i.createFromTimeline_(e,l);i=!e.dynamic||!e.periodInfo.isLastPeriod,t?(i&&new a.media.SegmentIndex(u).fit(e.periodInfo.duration),t.merge(u),r=e.presentationTimeline.getSegmentAvailabilityStart(),t.evict(r-e.periodInfo.start)):(e.presentationTimeline.notifySegments(u,e.periodInfo.start),t=new a.media.SegmentIndex(u),n&&e.dynamic&&(r[n]=t)),i&&t.fit(e.periodInfo.duration),e={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:t.find.bind(t),getSegmentReference:t.get.bind(t)}}return{createSegmentIndex:e.createSegmentIndex,findSegmentPosition:e.findSegmentPosition,getSegmentReference:e.getSegmentReference,initSegmentReference:s,scaledPresentationTimeOffset:l.scaledPresentationTimeOffset}},a.dash.SegmentTemplate.fromInheritance_=function(e){return e.segmentTemplate},a.dash.SegmentTemplate.parseSegmentTemplateInfo_=function(e){var t=a.dash.SegmentTemplate,r=a.dash.MpdUtils,n=r.parseSegmentInfo(e,t.fromInheritance_),i=r.inheritAttribute(e,t.fromInheritance_,"media");return e=r.inheritAttribute(e,t.fromInheritance_,"index"),{segmentDuration:n.segmentDuration,timescale:n.timescale,startNumber:n.startNumber,scaledPresentationTimeOffset:n.scaledPresentationTimeOffset,unscaledPresentationTimeOffset:n.unscaledPresentationTimeOffset,timeline:n.timeline,mediaTemplate:i,indexTemplate:e}},a.dash.SegmentTemplate.checkSegmentTemplateInfo_=function(e,t){var r=t.indexTemplate?1:0;if(r+=t.timeline?1:0,0==(r+=t.segmentDuration?1:0))throw a.log.error("SegmentTemplate does not contain any segment information:","the SegmentTemplate must contain either an index URL template","a SegmentTimeline, or a segment duration.",e.representation),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.DASH_NO_SEGMENT_INFO);if(1!=r&&(a.log.warning("SegmentTemplate containes multiple segment information sources:","the SegmentTemplate should only contain an index URL template,","a SegmentTimeline or a segment duration.",e.representation),t.indexTemplate?(a.log.info("Using the index URL template by default."),t.timeline=null):(o.asserts.assert(t.timeline,"There should be a timeline"),a.log.info("Using the SegmentTimeline by default.")),t.segmentDuration=null),!t.indexTemplate&&!t.mediaTemplate)throw a.log.error("SegmentTemplate does not contain sufficient segment information:","the SegmentTemplate's media URL template is missing.",e.representation),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.DASH_NO_SEGMENT_INFO)},a.dash.SegmentTemplate.createFromIndexTemplate_=function(e,t,r,n){var i=a.dash.MpdUtils,s=a.util.ManifestParserUtils,l=e.representation.mimeType.split("/")[1];if("mp4"!=l&&"webm"!=l)throw a.log.error("SegmentTemplate specifies an unsupported container type.",e.representation),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.DASH_UNSUPPORTED_CONTAINER);if("webm"==l&&!r)throw a.log.error("SegmentTemplate does not contain sufficient segment information:","the SegmentTemplate uses a WebM container,","but does not contain an initialization URL template.",e.representation),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.DASH_WEBM_MISSING_INIT);return o.asserts.assert(n.indexTemplate,"must be using index template"),i=i.fillUriTemplate(n.indexTemplate,e.representation.id,null,e.bandwidth||null,null),s=s.resolveUris(e.representation.baseUris,[i]),a.dash.SegmentBase.createSegmentIndexFromUris(e,t,r,s,0,null,l,n.scaledPresentationTimeOffset)},a.dash.SegmentTemplate.createFromDuration_=function(e,t){o.asserts.assert(t.mediaTemplate,"There should be a media template with duration");var r=a.dash.MpdUtils,n=a.util.ManifestParserUtils,i=e.periodInfo.duration,s=t.segmentDuration,l=t.startNumber,u=t.timescale,c=t.mediaTemplate,d=e.bandwidth||null,p=e.representation.id,f=e.representation.baseUris;return{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(e){return 0>e||i&&e>=i?null:Math.floor(e/s)},getSegmentReference:function(e){var t=e*s,o=t+s;return i&&(o=Math.min(o,i)),0>o||i&&t>=i?null:new a.media.SegmentReference(e,t,o,(function(){var i=r.fillUriTemplate(c,p,e+l,d,t*u);return n.resolveUris(f,[i])}),0,null)}}},a.dash.SegmentTemplate.createFromTimeline_=function(e,t){o.asserts.assert(t.mediaTemplate,"There should be a media template with a timeline");for(var r=a.dash.MpdUtils,n=a.util.ManifestParserUtils,i=[],s=0;s<t.timeline.length;s++){var l=t.timeline[s].start,u=t.timeline[s].end,c=s+t.startNumber,d=function(e,t,i,o,a,s){return e=r.fillUriTemplate(e,t,a,i,s),n.resolveUris(o,[e]).map((function(e){return e.toString()}))}.bind(null,t.mediaTemplate,e.representation.id,e.bandwidth||null,e.representation.baseUris,c,t.timeline[s].unscaledStart+t.unscaledPresentationTimeOffset);i.push(new a.media.SegmentReference(c,l,u,d,0,null))}return i},a.dash.SegmentTemplate.createInitSegment_=function(e){var t=a.dash.MpdUtils,r=a.util.ManifestParserUtils,n=t.inheritAttribute(e,a.dash.SegmentTemplate.fromInheritance_,"initialization");if(!n)return null;var i=e.representation.id,s=e.bandwidth||null,l=e.representation.baseUris;return new a.media.InitSegmentReference((function(){o.asserts.assert(n,"Should have returned earler");var e=t.fillUriTemplate(n,i,null,s,null);return r.resolveUris(l,[e])}),0,null)},a.media.ManifestParser={},a.media.ManifestParser.parsersByMime={},a.media.ManifestParser.parsersByExtension={},a.media.ManifestParser.registerParserByExtension=function(e,t){a.media.ManifestParser.parsersByExtension[e]=t},o.exportSymbol("shaka.media.ManifestParser.registerParserByExtension",a.media.ManifestParser.registerParserByExtension),a.media.ManifestParser.registerParserByMime=function(e,t){a.media.ManifestParser.parsersByMime[e]=t},o.exportSymbol("shaka.media.ManifestParser.registerParserByMime",a.media.ManifestParser.registerParserByMime),a.media.ManifestParser.probeSupport=function(){var e=a.media.ManifestParser,t={};if(a.util.Platform.supportsMediaSource()){for(var r in e.parsersByMime)t[r]=!0;for(var n in e.parsersByExtension)t[n]=!0}r={mpd:"application/dash+xml",m3u8:"application/x-mpegurl",ism:"application/vnd.ms-sstr+xml"};for(var o=(n=i.makeIterator(["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"])).next();!o.done;o=n.next())o=o.value,a.util.Platform.supportsMediaSource()?t[o]=!!e.parsersByMime[o]:t[o]=a.util.Platform.supportsMediaType(o);for(var s in r)a.util.Platform.supportsMediaSource()?t[s]=!!e.parsersByExtension[s]:t[s]=a.util.Platform.supportsMediaType(r[s]);return t},a.media.ManifestParser.create=function(e,t,r,n){return i.asyncExecutePromiseGeneratorFunction((function s(){var l,u;return i.generator.createGenerator(s,(function(i){switch(i.nextAddress){case 1:return i.setCatchFinallyBlocks(2),i.yield(a.media.ManifestParser.getFactory_(e,t,r,n),4);case 4:return l=i.yieldResult,i.return(new l);case 2:throw u=i.enterCatchBlock(),o.asserts.assert(u instanceof a.util.Error,"Incorrect error type"),u.severity=a.util.Error.Severity.CRITICAL,u}}))}))},a.media.ManifestParser.getFactory_=function(e,t,r,n){return i.asyncExecutePromiseGeneratorFunction((function o(){var s,l,u,c,d;return i.generator.createGenerator(o,(function(i){switch(i.nextAddress){case 1:if(s=a.media.ManifestParser,n){if(l=s.parsersByMime[n.toLowerCase()])return i.return(l);a.log.warning("Could not determine manifest type using MIME type ",n)}if(u=s.getExtension(e)){if(c=s.parsersByExtension[u])return i.return(c);a.log.warning("Could not determine manifest type for extension ",u)}else a.log.warning("Could not find extension for ",e);if(n){i.jumpTo(2);break}return i.yield(s.getMimeType(e,t,r),3);case 3:if(n=i.yieldResult){if(d=a.media.ManifestParser.parsersByMime[n])return i.return(d);a.log.warning("Could not determine manifest type using MIME type",n)}case 2:throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.UNABLE_TO_GUESS_MANIFEST_TYPE,e)}}))}))},a.media.ManifestParser.getMimeType=function(e,t,r){return i.asyncExecutePromiseGeneratorFunction((function n(){var o,s,l,u;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return o=a.net.NetworkingEngine.RequestType.MANIFEST,(s=a.net.NetworkingEngine.makeRequest([e],r)).method="HEAD",n.yield(t.request(o,s).promise,2);case 2:return l=n.yieldResult,u=l.headers["content-type"],n.return(u?u.toLowerCase().split(";").shift():"")}}))}))},a.media.ManifestParser.getExtension=function(e){return 1==(e=new o.Uri(e).getPath().split("/").pop().split(".")).length?"":e.pop().toLowerCase()},a.media.ManifestParser.isSupported=function(e,t){return!!a.util.Platform.supportsMediaSource()&&(t in a.media.ManifestParser.parsersByMime||a.media.ManifestParser.getExtension(e)in a.media.ManifestParser.parsersByExtension)},a.media.PresentationTimeline=function(e,t,r){this.presentationStartTime_=e,this.presentationDelay_=t,this.segmentAvailabilityDuration_=this.duration_=1/0,this.maxSegmentDuration_=1,this.maxSegmentEndTime_=this.minSegmentStartTime_=null,this.clockOffset_=0,this.static_=!0,this.userSeekStart_=0,this.autoCorrectDrift_=void 0===r||r},o.exportSymbol("shaka.media.PresentationTimeline",a.media.PresentationTimeline),a.media.PresentationTimeline.prototype.getDuration=function(){return this.duration_},o.exportProperty(a.media.PresentationTimeline.prototype,"getDuration",a.media.PresentationTimeline.prototype.getDuration),a.media.PresentationTimeline.prototype.getMaxSegmentDuration=function(){return this.maxSegmentDuration_},o.exportProperty(a.media.PresentationTimeline.prototype,"getMaxSegmentDuration",a.media.PresentationTimeline.prototype.getMaxSegmentDuration),a.media.PresentationTimeline.prototype.setDuration=function(e){o.asserts.assert(0<e,"duration must be > 0"),this.duration_=e},o.exportProperty(a.media.PresentationTimeline.prototype,"setDuration",a.media.PresentationTimeline.prototype.setDuration),a.media.PresentationTimeline.prototype.getPresentationStartTime=function(){return this.presentationStartTime_},o.exportProperty(a.media.PresentationTimeline.prototype,"getPresentationStartTime",a.media.PresentationTimeline.prototype.getPresentationStartTime),a.media.PresentationTimeline.prototype.setClockOffset=function(e){this.clockOffset_=e},o.exportProperty(a.media.PresentationTimeline.prototype,"setClockOffset",a.media.PresentationTimeline.prototype.setClockOffset),a.media.PresentationTimeline.prototype.setStatic=function(e){this.static_=e},o.exportProperty(a.media.PresentationTimeline.prototype,"setStatic",a.media.PresentationTimeline.prototype.setStatic),a.media.PresentationTimeline.prototype.setSegmentAvailabilityDuration=function(e){o.asserts.assert(0<=e,"segmentAvailabilityDuration must be >= 0"),this.segmentAvailabilityDuration_=e},o.exportProperty(a.media.PresentationTimeline.prototype,"setSegmentAvailabilityDuration",a.media.PresentationTimeline.prototype.setSegmentAvailabilityDuration),a.media.PresentationTimeline.prototype.setDelay=function(e){o.asserts.assert(0<=e,"delay must be >= 0"),this.presentationDelay_=e},o.exportProperty(a.media.PresentationTimeline.prototype,"setDelay",a.media.PresentationTimeline.prototype.setDelay),a.media.PresentationTimeline.prototype.getDelay=function(){return this.presentationDelay_},o.exportProperty(a.media.PresentationTimeline.prototype,"getDelay",a.media.PresentationTimeline.prototype.getDelay),a.media.PresentationTimeline.prototype.notifySegments=function(e,t){if(0!=e.length){var r=e[e.length-1].endTime+t;this.notifyMinSegmentStartTime(e[0].startTime+t),this.maxSegmentDuration_=e.reduce((function(e,t){return Math.max(e,t.endTime-t.startTime)}),this.maxSegmentDuration_),this.maxSegmentEndTime_=Math.max(this.maxSegmentEndTime_,r),null!=this.presentationStartTime_&&this.autoCorrectDrift_&&(this.presentationStartTime_=(Date.now()+this.clockOffset_)/1e3-this.maxSegmentEndTime_-this.maxSegmentDuration_),a.log.v1("notifySegments:","maxSegmentDuration="+this.maxSegmentDuration_)}},o.exportProperty(a.media.PresentationTimeline.prototype,"notifySegments",a.media.PresentationTimeline.prototype.notifySegments),a.media.PresentationTimeline.prototype.notifyMinSegmentStartTime=function(e){this.minSegmentStartTime_=null==this.minSegmentStartTime_?e:Math.min(this.minSegmentStartTime_,e)},o.exportProperty(a.media.PresentationTimeline.prototype,"notifyMinSegmentStartTime",a.media.PresentationTimeline.prototype.notifyMinSegmentStartTime),a.media.PresentationTimeline.prototype.notifyMaxSegmentDuration=function(e){this.maxSegmentDuration_=Math.max(this.maxSegmentDuration_,e),a.log.v1("notifyNewSegmentDuration:","maxSegmentDuration="+this.maxSegmentDuration_)},o.exportProperty(a.media.PresentationTimeline.prototype,"notifyMaxSegmentDuration",a.media.PresentationTimeline.prototype.notifyMaxSegmentDuration),a.media.PresentationTimeline.prototype.offset=function(e){null!=this.minSegmentStartTime_&&(this.minSegmentStartTime_+=e),null!=this.maxSegmentEndTime_&&(this.maxSegmentEndTime_+=e)},o.exportProperty(a.media.PresentationTimeline.prototype,"offset",a.media.PresentationTimeline.prototype.offset),a.media.PresentationTimeline.prototype.isLive=function(){return 1/0==this.duration_&&!this.static_},o.exportProperty(a.media.PresentationTimeline.prototype,"isLive",a.media.PresentationTimeline.prototype.isLive),a.media.PresentationTimeline.prototype.isInProgress=function(){return 1/0!=this.duration_&&!this.static_},o.exportProperty(a.media.PresentationTimeline.prototype,"isInProgress",a.media.PresentationTimeline.prototype.isInProgress),a.media.PresentationTimeline.prototype.getSegmentAvailabilityStart=function(){if(o.asserts.assert(0<=this.segmentAvailabilityDuration_,"The availability duration should be positive"),1/0==this.segmentAvailabilityDuration_)return this.userSeekStart_;var e=this.getSegmentAvailabilityEnd()-this.segmentAvailabilityDuration_;return Math.max(this.userSeekStart_,e)},o.exportProperty(a.media.PresentationTimeline.prototype,"getSegmentAvailabilityStart",a.media.PresentationTimeline.prototype.getSegmentAvailabilityStart),a.media.PresentationTimeline.prototype.setUserSeekStart=function(e){this.userSeekStart_=e},o.exportProperty(a.media.PresentationTimeline.prototype,"setUserSeekStart",a.media.PresentationTimeline.prototype.setUserSeekStart),a.media.PresentationTimeline.prototype.getSegmentAvailabilityEnd=function(){return this.isLive()||this.isInProgress()?Math.min(this.getLiveEdge_(),this.duration_):this.duration_},o.exportProperty(a.media.PresentationTimeline.prototype,"getSegmentAvailabilityEnd",a.media.PresentationTimeline.prototype.getSegmentAvailabilityEnd),a.media.PresentationTimeline.prototype.getSafeSeekRangeStart=function(e){var t=Math.max(this.minSegmentStartTime_,this.userSeekStart_);if(1/0==this.segmentAvailabilityDuration_)return t;var r=this.getSegmentAvailabilityEnd()-this.segmentAvailabilityDuration_;return e=Math.min(r+e,this.getSeekRangeEnd()),Math.max(t,e)},o.exportProperty(a.media.PresentationTimeline.prototype,"getSafeSeekRangeStart",a.media.PresentationTimeline.prototype.getSafeSeekRangeStart),a.media.PresentationTimeline.prototype.getSeekRangeStart=function(){return this.getSafeSeekRangeStart(0)},o.exportProperty(a.media.PresentationTimeline.prototype,"getSeekRangeStart",a.media.PresentationTimeline.prototype.getSeekRangeStart),a.media.PresentationTimeline.prototype.getSeekRangeEnd=function(){var e=this.isLive()||this.isInProgress()?this.presentationDelay_:0;return Math.max(0,this.getSegmentAvailabilityEnd()-e)},o.exportProperty(a.media.PresentationTimeline.prototype,"getSeekRangeEnd",a.media.PresentationTimeline.prototype.getSeekRangeEnd),a.media.PresentationTimeline.prototype.usingPresentationStartTime=function(){return!(null==this.presentationStartTime_||null!=this.maxSegmentEndTime_&&this.autoCorrectDrift_)},o.exportProperty(a.media.PresentationTimeline.prototype,"usingPresentationStartTime",a.media.PresentationTimeline.prototype.usingPresentationStartTime),a.media.PresentationTimeline.prototype.getLiveEdge_=function(){o.asserts.assert(null!=this.presentationStartTime_,"Cannot compute timeline live edge without start time");var e=(Date.now()+this.clockOffset_)/1e3;return Math.max(0,e-this.maxSegmentDuration_-this.presentationStartTime_)},o.DEBUG&&(a.media.PresentationTimeline.prototype.assertIsValid=function(){this.isLive()?o.asserts.assert(null!=this.presentationStartTime_,"Detected as live stream, but does not match our model of live!"):this.isInProgress()?o.asserts.assert(null!=this.presentationStartTime_&&1/0==this.segmentAvailabilityDuration_,"Detected as IPR stream, but does not match our model of IPR!"):o.asserts.assert(1/0==this.segmentAvailabilityDuration_&&1/0!=this.duration_&&this.static_,"Detected as VOD stream, but does not match our model of VOD!")}),a.util.Networking=function(){},a.util.Networking.createSegmentRequest=function(e,t,r,n){return e=a.net.NetworkingEngine.makeRequest(e,n),0==t&&null==r||(e.headers.Range=r?"bytes="+t+"-"+r:"bytes="+t+"-"),e},a.dash.DashParser=function(){var e=this;this.playerInterface_=this.config_=null,this.manifestUris_=[],this.manifest_=null,this.periodIds_=[],this.globalId_=1,this.segmentIndexMap_={},this.updatePeriod_=0,this.averageUpdateDuration_=new a.abr.Ewma(5),this.updateTimer_=new a.util.Timer((function(){e.onUpdate_()})),this.operationManager_=new a.util.OperationManager},o.exportSymbol("shaka.dash.DashParser",a.dash.DashParser),a.dash.DashParser.MIN_UPDATE_PERIOD_=3,a.dash.DashParser.prototype.configure=function(e){o.asserts.assert(null!=e.dash,"DashManifestConfiguration should not be null!"),this.config_=e},a.dash.DashParser.prototype.start=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var s;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return o.asserts.assert(r.config_,"Must call configure() before start()!"),r.manifestUris_=[e],r.playerInterface_=t,n.yield(r.requestManifest_(),2);case 2:if(s=n.yieldResult,r.playerInterface_&&r.setUpdateTimer_(s),!r.playerInterface_)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.PLAYER,a.util.Error.Code.OPERATION_ABORTED);return o.asserts.assert(r.manifest_,"Manifest should be non-null!"),n.return(r.manifest_)}}))}))},a.dash.DashParser.prototype.stop=function(){return this.config_=this.playerInterface_=null,this.manifestUris_=[],this.manifest_=null,this.periodIds_=[],this.segmentIndexMap_={},null!=this.updateTimer_&&(this.updateTimer_.stop(),this.updateTimer_=null),this.operationManager_.destroy()},a.dash.DashParser.prototype.update=function(){this.requestManifest_().catch(function(e){this.playerInterface_&&this.playerInterface_.onError(e)}.bind(this))},a.dash.DashParser.prototype.onExpirationUpdated=function(e,t){},a.dash.DashParser.prototype.requestManifest_=function(){var e=this,t=a.net.NetworkingEngine.RequestType.MANIFEST,r=a.net.NetworkingEngine.makeRequest(this.manifestUris_,this.config_.retryParameters),n=this.playerInterface_.networkingEngine,i=Date.now();return t=n.request(t,r),this.operationManager_.manage(t),t.promise.then((function(t){if(e.playerInterface_)return t.uri&&!e.manifestUris_.includes(t.uri)&&e.manifestUris_.unshift(t.uri),e.parseManifest_(t.data,t.uri)})).then((function(){var t=(Date.now()-i)/1e3;return e.averageUpdateDuration_.sample(1,t),t}))},a.dash.DashParser.prototype.parseManifest_=function(e,t){var r=this,n=a.util.Error,i=a.dash.MpdUtils,o=a.util.XmlUtils.parseXml(e,"MPD");if(!o)throw new n(n.Severity.CRITICAL,n.Category.MANIFEST,n.Code.DASH_INVALID_XML,t);return n=i.processXlinks(o,this.config_.retryParameters,this.config_.dash.xlinkFailGracefully,t,this.playerInterface_.networkingEngine),this.operationManager_.manage(n),n.promise.then((function(e){return r.processManifest_(e,t)}))},a.dash.DashParser.prototype.processManifest_=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var s,l,u,c,d,p,f,h,m,g,y,_,v,E,S,b,T,w,M,x,P,I,C,A;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:if(s=a.util.Functional,l=a.util.XmlUtils,u=[t],0<(c=l.findChildren(e,"Location").map(l.getContents).filter(s.isNotNull)).length&&(d=a.util.ManifestParserUtils.resolveUris(u,c),u=r.manifestUris_=d),p=l.findChildren(e,"BaseURL").map(l.getContents),f=a.util.ManifestParserUtils.resolveUris(u,p),h=r.config_.dash.ignoreMinBufferTime,m=0,h||(m=l.parseAttr(e,"minBufferTime",l.parseDuration)),r.updatePeriod_=l.parseAttr(e,"minimumUpdatePeriod",l.parseDuration,-1),g=l.parseAttr(e,"availabilityStartTime",l.parseDate),y=l.parseAttr(e,"timeShiftBufferDepth",l.parseDuration),_=l.parseAttr(e,"maxSegmentDuration",l.parseDuration),v=e.getAttribute("type")||"static",E=r.config_.dash.ignoreSuggestedPresentationDelay,S=null,E||(S=l.parseAttr(e,"suggestedPresentationDelay",l.parseDuration)),r.manifest_?b=r.manifest_.presentationTimeline:(T=Math.max(r.config_.dash.defaultPresentationDelay,1.5*m),w=null!=S?S:T,b=new a.media.PresentationTimeline(g,w,r.config_.dash.autoCorrectDrift)),M={dynamic:"static"!=v,presentationTimeline:b,period:null,periodInfo:null,adaptationSet:null,representation:null,bandwidth:0,indexRangeWarningGiven:!1},x=r.parsePeriods_(M,f,e),P=x.duration,I=x.periods,b.setStatic("static"==v),"static"!=v&&x.durationDerivedFromPeriods||b.setDuration(P||1/0),b.isLive()&&!isNaN(r.config_.availabilityWindowOverride)&&(y=r.config_.availabilityWindowOverride),null==y&&(y=1/0),b.setSegmentAvailabilityDuration(y),b.notifyMaxSegmentDuration(_||1),o.DEBUG&&b.assertIsValid(),r.manifest_){n.jumpTo(0);break}if(r.manifest_={presentationTimeline:b,periods:I,offlineSessionIds:[],minBufferTime:m||0},!b.usingPresentationStartTime()){n.jumpTo(0);break}return C=l.findChildren(e,"UTCTiming"),n.yield(r.parseUtcTiming_(f,C),4);case 4:if(A=n.yieldResult,!r.playerInterface_)return n.return();b.setClockOffset(A),n.jumpToEnd()}}))}))},a.dash.DashParser.prototype.parsePeriods_=function(e,t,r){var n=a.util.XmlUtils,i=n.parseAttr(r,"mediaPresentationDuration",n.parseDuration),s=[],l=0;r=n.findChildren(r,"Period");for(var u=0;u<r.length;u++){var c=r[u];l=n.parseAttr(c,"start",n.parseDuration,l);var d=n.parseAttr(c,"duration",n.parseDuration),p=null;if(u!=r.length-1){var f=n.parseAttr(r[u+1],"start",n.parseDuration);null!=f&&(p=f-l)}else null!=i&&(p=i-l);if(f=a.util.ManifestParserUtils.GAP_OVERLAP_TOLERANCE_SECONDS,p&&d&&Math.abs(p-d)>f&&a.log.warning("There is a gap/overlap between Periods",c),null==p&&(p=d),c=this.parsePeriod_(e,t,{start:l,duration:p,node:c,isLastPeriod:null==p||u==r.length-1}),s.push(c),d=e.period.id,o.asserts.assert(d,"Period IDs should not be null!"),this.periodIds_.includes(d)||(this.periodIds_.push(d),this.manifest_&&(this.playerInterface_.filterNewPeriod(c),this.manifest_.periods.push(c))),null==p){u!=r.length-1&&a.log.warning("Skipping Period",u+1,"and any subsequent Periods:","Period",u+1,"does not have a valid start time.",s[u+1]),l=null;break}l+=p}return null==this.manifest_&&this.playerInterface_.filterAllPeriods(s),null!=i?(l!=i&&a.log.warning("@mediaPresentationDuration does not match the total duration of all","Periods."),{periods:s,duration:i,durationDerivedFromPeriods:!1}):{periods:s,duration:l,durationDerivedFromPeriods:!0}},a.dash.DashParser.prototype.parsePeriod_=function(e,t,r){var n=a.util.Functional,o=a.util.XmlUtils,s=a.util.ManifestParserUtils.ContentType;if(e.period=this.createFrame_(r.node,null,t),e.periodInfo=r,e.period.id||(a.log.info("No Period ID given for Period with start time "+r.start+",  Assigning a default"),e.period.id="__shaka_period_"+r.start),o.findChildren(r.node,"EventStream").forEach(this.parseEventStream_.bind(this,r.start,r.duration)),t=o.findChildren(r.node,"AdaptationSet").map(this.parseAdaptationSet_.bind(this,e)).filter(n.isNotNull),e.dynamic){for(e=[],o=(n=i.makeIterator(t)).next();!o.done;o=n.next())for(var l=(o=i.makeIterator(o.value.representationIds)).next();!l.done;l=o.next())e.push(l.value);if(n=new Set(e),e.length!=n.size)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.DASH_DUPLICATE_REPRESENTATION_ID)}var u=t.filter((function(e){return!e.trickModeFor}));if(t.filter((function(e){return e.trickModeFor})).forEach((function(e){var t=e.streams[0],r=e.trickModeFor;u.forEach((function(e){e.id==r&&e.streams.forEach((function(e){e.trickModeVideo=t}))}))})),e=this.getSetsOfType_(u,s.VIDEO),n=this.getSetsOfType_(u,s.AUDIO),!e.length&&!n.length)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.DASH_EMPTY_PERIOD);for(t=this.config_.disableAudio,n.length&&!t||(n=[null]),t=this.config_.disableVideo,e.length&&!t||(e=[null]),t=[],o=0;o<n.length;o++)for(l=0;l<e.length;l++)this.createVariants_(n[o],e[l],t);if(e=[],!this.config_.disableText)for(s=this.getSetsOfType_(u,s.TEXT),n=0;n<s.length;n++)e.push.apply(e,s[n].streams);return{startTime:r.start,textStreams:e,variants:t}},a.dash.DashParser.prototype.getSetsOfType_=function(e,t){return e.filter((function(e){return e.contentType==t}))},a.dash.DashParser.prototype.createVariants_=function(e,t,r){var n=a.util.ManifestParserUtils.ContentType;if(o.asserts.assert(!e||e.contentType==n.AUDIO,"Audio parameter mismatch!"),o.asserts.assert(!t||t.contentType==n.VIDEO,"Video parameter mismatch!"),e||t)if(e&&t){if((n=a.media.DrmEngine).areDrmCompatible(e.drmInfos,t.drmInfos))for(var i=n.getCommonDrmInfos(e.drmInfos,t.drmInfos),s=0;s<e.streams.length;s++)for(var l=0;l<t.streams.length;l++)n=(t.streams[l].bandwidth||0)+(e.streams[s].bandwidth||0),n={id:this.globalId_++,language:e.language,primary:e.main||t.main,audio:e.streams[s],video:t.streams[l],bandwidth:n,drmInfos:i,allowedByApplication:!0,allowedByKeySystem:!0},r.push(n)}else for(i=e||t,s=0;s<i.streams.length;s++)n=i.streams[s].bandwidth||0,n={id:this.globalId_++,language:i.language||"und",primary:i.main,audio:e?i.streams[s]:null,video:t?i.streams[s]:null,bandwidth:n,drmInfos:i.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0},r.push(n)},a.dash.DashParser.prototype.parseAdaptationSet_=function(e,t){var r=a.util.XmlUtils,n=a.util.Functional,o=a.util.ManifestParserUtils,s=o.ContentType;if(e.adaptationSet=this.createFrame_(t,e.period,null),e.adaptationSet.contentType==s.IMAGE)return a.log.warning("Skipping Image AdaptationSet",e.adaptationSet),null;var l=!1,u=r.findChildren(t,"Role"),c=u.map((function(e){return e.getAttribute("value")})).filter(n.isNotNull),d=void 0;(n=e.adaptationSet.contentType==o.ContentType.TEXT)&&(d=o.TextStreamKind.SUBTITLE);for(var p=0;p<u.length;p++){var f=u[p].getAttribute("schemeIdUri");if(null==f||"urn:mpeg:dash:role:2011"==f)switch(f=u[p].getAttribute("value"),f){case"main":l=!0;break;case"caption":case"subtitle":d=f}}var h=null,m=!1;r.findChildren(t,"EssentialProperty").forEach((function(e){"http://dashif.org/guidelines/trickmode"==e.getAttribute("schemeIdUri")?h=e.getAttribute("value"):m=!0})),p=r.findChildren(t,"Accessibility");var g=a.util.LanguageUtils,y=new Map;for(u={},f=(p=i.makeIterator(p)).next();!f.done;u={channelId:u.channelId},f=p.next()){var _=f.value;f=_.getAttribute("schemeIdUri"),_=_.getAttribute("value"),"urn:scte:dash:cc:cea-608:2015"==f||"urn:scte:dash:cc:cea-708:2015"==f?(u.channelId=1,null!=_?_.split(";").forEach(function(e){return function(t){if(t.includes("=")){var r=(t=t.split("="))[0].startsWith("CC")?t[0]:"CC"+t[0];t=t[1].split(",")[0].split(":").pop()}else r="CC"+e.channelId,e.channelId+=2;y.set(r,g.normalize(t))}}(u)):y.set("CC1","und")):"urn:mpeg:dash:role:2011"==f&&null!=_&&(c.push(_),"captions"==_&&(d=o.TextStreamKind.CLOSED_CAPTION))}if(m)return null;o=r.findChildren(t,"ContentProtection");var v=a.dash.ContentProtection.parseFromAdaptationSet(o,this.config_.dash.customScheme,this.config_.dash.ignoreDrmInfo);if(o=a.util.LanguageUtils.normalize(t.getAttribute("lang")||"und"),u=t.getAttribute("label"),(p=r.findChildren(t,"Label"))&&p.length&&((p=p[0]).textContent&&(u=p.textContent)),0==(c=(r=r.findChildren(t,"Representation")).map(this.parseRepresentation_.bind(this,e,v,d,o,u,l,c,y)).filter((function(e){return!!e}))).length){if(this.config_.dash.ignoreEmptyAdaptationSet||n)return null;throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.DASH_EMPTY_ADAPTATION_SET)}return e.adaptationSet.contentType&&e.adaptationSet.contentType!=s.APPLICATION||(e.adaptationSet.contentType=a.dash.DashParser.guessContentType_(c[0].mimeType,c[0].codecs),c.forEach((function(t){t.type=e.adaptationSet.contentType}))),c.forEach((function(e){v.drmInfos.forEach((function(t){e.keyId&&t.keyIds.push(e.keyId)}))})),s=r.map((function(e){return e.getAttribute("id")})).filter(a.util.Functional.isNotNull),{id:e.adaptationSet.id||"__fake__"+this.globalId_++,contentType:e.adaptationSet.contentType,language:o,main:l,streams:c,drmInfos:v.drmInfos,trickModeFor:h,representationIds:s}},a.dash.DashParser.prototype.parseRepresentation_=function(e,t,r,n,i,s,l,u,c){var d=a.util.XmlUtils,p=a.util.ManifestParserUtils.ContentType;if(e.representation=this.createFrame_(c,e.adaptationSet,null),!this.verifyRepresentation_(e.representation))return a.log.warning("Skipping Representation",e.representation),null;e.bandwidth=d.parseAttr(c,"bandwidth",d.parsePositiveInt)||0;var f=e.representation.contentType;p=f==p.TEXT||f==p.APPLICATION;try{var h=this.requestInitSegment_.bind(this);if(e.representation.segmentBase)var m=a.dash.SegmentBase.createStream(e,h);else if(e.representation.segmentList)m=a.dash.SegmentList.createStream(e,this.segmentIndexMap_);else if(e.representation.segmentTemplate)m=a.dash.SegmentTemplate.createStream(e,h,this.segmentIndexMap_,!!this.manifest_);else{o.asserts.assert(p,"Must have Segment* with non-text streams.");var g=e.representation.baseUris,y=e.periodInfo.duration||0;m={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(e){return 0<=e&&e<y?1:null},getSegmentReference:function(e){return 1!=e?null:new a.media.SegmentReference(1,0,y,(function(){return g}),0,null)},initSegmentReference:null,scaledPresentationTimeOffset:0}}}catch(e){if(p&&e.code==a.util.Error.Code.DASH_NO_SEGMENT_INFO)return null;throw e}return c=d.findChildren(c,"ContentProtection"),c=a.dash.ContentProtection.parseFromRepresentation(c,this.config_.dash.customScheme,t,this.config_.dash.ignoreDrmInfo),{id:this.globalId_++,originalId:e.representation.id,createSegmentIndex:m.createSegmentIndex,findSegmentPosition:m.findSegmentPosition,getSegmentReference:m.getSegmentReference,initSegmentReference:m.initSegmentReference,presentationTimeOffset:m.scaledPresentationTimeOffset,mimeType:e.representation.mimeType,codecs:e.representation.codecs,frameRate:e.representation.frameRate,pixelAspectRatio:e.representation.pixelAspectRatio,bandwidth:e.bandwidth,width:e.representation.width,height:e.representation.height,kind:r,encrypted:0<t.drmInfos.length,keyId:c,language:n,label:i,type:e.adaptationSet.contentType,primary:s,trickModeVideo:null,emsgSchemeIdUris:e.representation.emsgSchemeIdUris,roles:l,channelsCount:e.representation.numChannels,audioSamplingRate:e.representation.audioSamplingRate,closedCaptions:u}},a.dash.DashParser.prototype.onUpdate_=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var r,n;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return o.asserts.assert(0<=e.updatePeriod_,"There should be an update period"),a.log.info("Updating manifest..."),r=0,t.setCatchFinallyBlocks(2),t.yield(e.requestManifest_(),4);case 4:r=t.yieldResult,t.leaveTryBlock(3);break;case 2:n=t.enterCatchBlock(),o.asserts.assert(n instanceof a.util.Error,"Should only receive a Shaka error"),e.playerInterface_&&(n.severity=a.util.Error.Severity.RECOVERABLE,e.playerInterface_.onError(n));case 3:if(!e.playerInterface_)return t.return();e.setUpdateTimer_(r),t.jumpToEnd()}}))}))},a.dash.DashParser.prototype.setUpdateTimer_=function(e){0>this.updatePeriod_||(e=Math.max(a.dash.DashParser.MIN_UPDATE_PERIOD_,this.updatePeriod_-e,this.averageUpdateDuration_.getEstimate()),this.updateTimer_.tickAfter(e))},a.dash.DashParser.prototype.createFrame_=function(e,t,r){o.asserts.assert(t||r,"Must provide either parent or baseUris");var n=a.util.ManifestParserUtils,i=a.util.XmlUtils;t=t||{contentType:"",mimeType:"",codecs:"",emsgSchemeIdUris:[],frameRate:void 0,numChannels:null,audioSamplingRate:null},r=r||t.baseUris;var s=i.parseNonNegativeInt,l=i.evalDivision,u=i.findChildren(e,"BaseURL").map(i.getContents),c=e.getAttribute("contentType")||t.contentType,d=e.getAttribute("mimeType")||t.mimeType,p=e.getAttribute("codecs")||t.codecs;l=i.parseAttr(e,"frameRate",l)||t.frameRate;var f=e.getAttribute("sar")||t.pixelAspectRatio,h=this.emsgSchemeIdUris_(i.findChildren(e,"InbandEventStream"),t.emsgSchemeIdUris),m=i.findChildren(e,"AudioChannelConfiguration");m=this.parseAudioChannels_(m)||t.numChannels;var g=i.parseAttr(e,"audioSamplingRate",s)||t.audioSamplingRate;return c||(c=a.dash.DashParser.guessContentType_(d,p)),{baseUris:n.resolveUris(r,u),segmentBase:i.findChild(e,"SegmentBase")||t.segmentBase,segmentList:i.findChild(e,"SegmentList")||t.segmentList,segmentTemplate:i.findChild(e,"SegmentTemplate")||t.segmentTemplate,width:i.parseAttr(e,"width",s)||t.width,height:i.parseAttr(e,"height",s)||t.height,contentType:c,mimeType:d,codecs:p,frameRate:l,pixelAspectRatio:f,emsgSchemeIdUris:h,id:e.getAttribute("id"),numChannels:m,audioSamplingRate:g}},a.dash.DashParser.prototype.emsgSchemeIdUris_=function(e,t){for(var r=t.slice(),n=i.makeIterator(e),o=n.next();!o.done;o=n.next())o=o.value.getAttribute("schemeIdUri"),r.includes(o)||r.push(o);return r},a.dash.DashParser.prototype.parseAudioChannels_=function(e){for(var t=0;t<e.length;++t){var r=e[t],n=r.getAttribute("schemeIdUri");if(n&&(r=r.getAttribute("value")))switch(n){case"urn:mpeg:dash:outputChannelPositionList:2012":return r.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":var i=parseInt(r,10);if(!i){a.log.warning("Channel parsing failure! Ignoring scheme and value",n,r);continue}return i;case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":if(!(i=parseInt(r,16))){a.log.warning("Channel parsing failure! Ignoring scheme and value",n,r);continue}for(e=0;i;)1&i&&++e,i>>=1;return e;default:a.log.warning("Unrecognized audio channel scheme:",n,r)}}return null},a.dash.DashParser.prototype.verifyRepresentation_=function(e){var t=a.util.ManifestParserUtils.ContentType,r=e.segmentBase?1:0;return r+=e.segmentList?1:0,0==(r+=e.segmentTemplate?1:0)?e.contentType==t.TEXT||e.contentType==t.APPLICATION||(a.log.warning("Representation does not contain a segment information source:","the Representation must contain one of SegmentBase, SegmentList,",'SegmentTemplate, or explicitly indicate that it is "text".',e),!1):(1!=r&&(a.log.warning("Representation contains multiple segment information sources:","the Representation should only contain one of SegmentBase,","SegmentList, or SegmentTemplate.",e),e.segmentBase?(a.log.info("Using SegmentBase by default."),e.segmentList=null):(o.asserts.assert(e.segmentList,"There should be a SegmentList"),a.log.info("Using SegmentList by default.")),e.segmentTemplate=null),!0)},a.dash.DashParser.prototype.requestForTiming_=function(e,t,r){return e=a.util.ManifestParserUtils.resolveUris(e,[t]),(e=a.net.NetworkingEngine.makeRequest(e,this.config_.retryParameters)).method=r,e=this.playerInterface_.networkingEngine.request(a.net.NetworkingEngine.RequestType.TIMING,e),this.operationManager_.manage(e),e.promise.then((function(e){if("HEAD"==r){if(!e.headers||!e.headers.date)return a.log.warning("UTC timing response is missing","expected date header"),0;e=e.headers.date}else e=a.util.StringUtils.fromUTF8(e.data);return e=Date.parse(e),isNaN(e)?(a.log.warning("Unable to parse date from UTC timing response"),0):e-Date.now()}))},a.dash.DashParser.prototype.parseUtcTiming_=function(e,t){var r=t.map((function(e){return{scheme:e.getAttribute("schemeIdUri"),value:e.getAttribute("value")}})),n=this.config_.dash.clockSyncUri;return!r.length&&n&&r.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:n}),a.util.Functional.createFallbackPromiseChain(r,function(t){var r=t.scheme;switch(t=t.value,r){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return this.requestForTiming_(e,t,"HEAD");case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return this.requestForTiming_(e,t,"GET");case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return r=Date.parse(t),isNaN(r)?0:r-Date.now();case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":return a.log.alwaysWarn("NTP UTCTiming scheme is not supported"),Promise.reject();default:return a.log.alwaysWarn("Unrecognized scheme in UTCTiming element",r),Promise.reject()}}.bind(this)).catch((function(){return a.log.alwaysWarn("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"),0}))},a.dash.DashParser.prototype.parseEventStream_=function(e,t,r){var n=a.util.XmlUtils,i=n.parseNonNegativeInt,o=r.getAttribute("schemeIdUri")||"",s=r.getAttribute("value")||"",l=n.parseAttr(r,"timescale",i)||1;n.findChildren(r,"Event").forEach(function(r){var a=n.parseAttr(r,"presentationTime",i)||0,u=n.parseAttr(r,"duration",i)||0;u=(a=a/l+e)+u/l,null!=t&&(a=Math.min(a,e+t),u=Math.min(u,e+t)),r={schemeIdUri:o,value:s,startTime:a,endTime:u,id:r.getAttribute("id")||"",eventElement:r},this.playerInterface_.onTimelineRegionAdded(r)}.bind(this))},a.dash.DashParser.prototype.requestInitSegment_=function(e,t,r){var n=a.net.NetworkingEngine.RequestType.SEGMENT;return e=a.util.Networking.createSegmentRequest(e,t,r,this.config_.retryParameters),n=this.playerInterface_.networkingEngine.request(n,e),this.operationManager_.manage(n),n.promise.then((function(e){return e.data}))},a.dash.DashParser.guessContentType_=function(e,t){var r=a.util.MimeUtils.getFullType(e,t);return a.text.TextEngine.isTypeSupported(r)?a.util.ManifestParserUtils.ContentType.TEXT:e.split("/")[0]},a.media.ManifestParser.registerParserByExtension("mpd",a.dash.DashParser),a.media.ManifestParser.registerParserByMime("application/dash+xml",a.dash.DashParser),a.media.ManifestParser.registerParserByMime("video/vnd.mpeg.dash.mpd",a.dash.DashParser),a.hls={},a.hls.Playlist=function(e,t,r,n){this.absoluteUri=e,this.type=t,this.tags=r,this.segments=n||null},a.hls.PlaylistType={MASTER:0,MEDIA:1},a.hls.Tag=function(e,t,r,n){this.id=e,this.name=t,this.attributes=r,this.value=void 0===n?null:n},a.hls.Tag.prototype.toString=function(){var e=function(e){var t=isNaN(Number(e.value))?'"'+e.value+'"':e.value;return e.name+"="+t},t="#"+this.name;return e=this.attributes?this.attributes.map(e):[],this.value&&e.unshift(this.value),0<e.length&&(t+=":"+e.join(",")),t},a.hls.Attribute=function(e,t){this.name=e,this.value=t},a.hls.Tag.prototype.addAttribute=function(e){this.attributes.push(e)},a.hls.Tag.prototype.getAttribute=function(e){var t=this.attributes.filter((function(t){return t.name==e}));return o.asserts.assert(2>t.length,"A tag should not have multiple attributes with the same name!"),t.length?t[0]:null},a.hls.Tag.prototype.getAttributeValue=function(e,t){var r=this.getAttribute(e);return r?r.value:t||null},a.hls.Segment=function(e,t){this.tags=t,this.absoluteUri=e},a.hls.Utils={},a.hls.Utils.filterTagsByName=function(e,t){return e.filter((function(e){return e.name==t}))},a.hls.Utils.getFirstTagWithName=function(e,t){var r=a.hls.Utils.filterTagsByName(e,t);return r.length?r[0]:null},a.hls.Utils.findMediaTags=function(e,t,r){return e.filter((function(e){var n=e.getAttribute("TYPE");return e=e.getAttribute("GROUP-ID"),n.value==t&&e.value==r}))},a.hls.Utils.constructAbsoluteUri=function(e,t){return a.util.ManifestParserUtils.resolveUris([e],[t])[0]},a.hls.Utils.isComment=function(e){return/^#(?!EXT)/m.test(e)},a.util.TextParser=function(e){this.data_=e,this.position_=0},a.util.TextParser.prototype.atEnd=function(){return this.position_==this.data_.length},a.util.TextParser.prototype.readLine=function(){return this.readRegexReturnCapture_(/(.*?)(\n|$)/gm,1)},a.util.TextParser.prototype.readWord=function(){return this.readRegexReturnCapture_(/[^ \t\n]*/gm,0)},a.util.TextParser.prototype.skipWhitespace=function(){this.readRegex(/[ \t]+/gm)},a.util.TextParser.prototype.readRegex=function(e){return e=this.indexOf_(e),this.atEnd()||null==e||e.position!=this.position_?null:(this.position_+=e.length,e.results)},a.util.TextParser.prototype.readRegexReturnCapture_=function(e,t){if(this.atEnd())return null;var r=this.readRegex(e);return r?r[t]:null},a.util.TextParser.prototype.indexOf_=function(e){return o.asserts.assert(e.global,"global flag should be set"),e.lastIndex=this.position_,null==(e=e.exec(this.data_))?null:{position:e.index,length:e[0].length,results:e}},a.hls.ManifestTextParser=function(){this.globalId_=0},a.hls.ManifestTextParser.prototype.parsePlaylist=function(e,t){var r=a.hls.ManifestTextParser.MEDIA_PLAYLIST_TAGS,n=a.hls.ManifestTextParser.SEGMENT_TAGS,i=a.util.StringUtils.fromUTF8(e),o=(i=i.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n").trim()).split(/\n+/m);if(!/^#EXTM3U($|[ \t\n])/m.test(o[0]))throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_PLAYLIST_HEADER_MISSING);i=a.hls.PlaylistType.MASTER;for(var s=1;s<o.length;s++)if(!a.hls.Utils.isComment(o[s])){var l=this.parseTag_(o[s]);if(--this.globalId_,r.includes(l.name)){i=a.hls.PlaylistType.MEDIA;break}"EXT-X-STREAM-INF"==l.name&&(s+=1)}for(r=[],s=1;s<o.length;)if(a.hls.Utils.isComment(o[s]))s+=1;else{if(l=this.parseTag_(o[s]),n.includes(l.name)){if(i!=a.hls.PlaylistType.MEDIA)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_INVALID_PLAYLIST_HIERARCHY);return n=o.splice(s,o.length-s),n=this.parseSegments_(t,n,r),new a.hls.Playlist(t,i,r,n)}if(r.push(l),s+=1,"EXT-X-STREAM-INF"==l.name){var u=new a.hls.Attribute("URI",o[s]);l.addAttribute(u),s+=1}}return new a.hls.Playlist(t,i,r)},a.hls.ManifestTextParser.prototype.parseSegments_=function(e,t,r){var n=this,i=[],o=[];return t.forEach((function(t){if(/^(#EXT)/.test(t))t=n.parseTag_(t),a.hls.ManifestTextParser.MEDIA_PLAYLIST_TAGS.includes(t.name)?r.push(t):o.push(t);else{if(a.hls.Utils.isComment(t))return[];t=t.trim(),t=a.hls.Utils.constructAbsoluteUri(e,t),t=new a.hls.Segment(t,o),i.push(t),o=[]}})),i},a.hls.ManifestTextParser.prototype.parseTag_=function(e){return a.hls.ManifestTextParser.parseTag(this.globalId_++,e)},a.hls.ManifestTextParser.parseTag=function(e,t){var r=t.match(/^#(EXT[^:]*)(?::(.*))?$/);if(!r)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.INVALID_HLS_TAG,t);var n,i=r[1],o=r[2];if(r=[],o){var s,l=(o=new a.util.TextParser(o)).readRegex(/^([^,=]+)(?:,|$)/g);for(l&&(n=l[1]),l=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g;s=o.readRegex(l);)s=new a.hls.Attribute(s[1],s[2]||s[3]),r.push(s)}return new a.hls.Tag(e,i,r,n)},a.hls.ManifestTextParser.MEDIA_PLAYLIST_TAGS="EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-MAP EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST".split(" "),a.hls.ManifestTextParser.SEGMENT_TAGS="EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE".split(" "),a.net.DataUriPlugin=function(e,t,r,n){try{var i=a.net.DataUriPlugin.parse(e);return a.util.AbortableOperation.completed({uri:e,originalUri:e,data:i.data,headers:{"content-type":i.contentType}})}catch(e){return a.util.AbortableOperation.failed(e)}},o.exportSymbol("shaka.net.DataUriPlugin",a.net.DataUriPlugin),a.net.DataUriPlugin.parse=function(t){var r=t.split(":");if(2>r.length||"data"!=r[0])throw a.log.error("Bad data URI, failed to parse scheme"),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.NETWORK,a.util.Error.Code.MALFORMED_DATA_URI,t);if(2>(r=r.slice(1).join(":").split(",")).length)throw a.log.error("Bad data URI, failed to extract encoding and MIME type"),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.NETWORK,a.util.Error.Code.MALFORMED_DATA_URI,t);var n=r[0];r=e.decodeURIComponent(r.slice(1).join(","));var i=null;if(1<(n=n.split(";")).length&&(i=n[1]),"base64"==i)t=a.util.Uint8ArrayUtils.fromBase64(r).buffer;else{if(i)throw a.log.error("Bad data URI, unknown encoding"),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.NETWORK,a.util.Error.Code.UNKNOWN_DATA_URI_ENCODING,t);t=a.util.StringUtils.toUTF8(r)}return{data:t,contentType:n[0]}},a.net.NetworkingEngine.registerScheme("data",a.net.DataUriPlugin),a.hls.HlsParser=function(){var e=this;this.config_=this.playerInterface_=null,this.globalId_=1,this.mediaTagsToStreamInfosMap_=new Map,this.variantUriSet_=new Set,this.uriToStreamInfosMap_=new Map,this.presentationTimeline_=null,this.masterPlaylistUri_="",this.manifestTextParser_=new a.hls.ManifestTextParser,this.updatePlaylistDelay_=0,this.updatePlaylistTimer_=new a.util.Timer((function(){e.onUpdate_()})),this.presentationType_=a.hls.HlsParser.PresentationType_.VOD,this.manifest_=null,this.maxTargetDuration_=0,this.minTargetDuration_=1/0,this.operationManager_=new a.util.OperationManager,this.segmentsToNotifyByStream_=[],this.groupIdToClosedCaptionsMap_=new Map,this.aesEncrypted_=!1},o.exportSymbol("shaka.hls.HlsParser",a.hls.HlsParser),a.hls.HlsParser.prototype.configure=function(e){this.config_=e},a.hls.HlsParser.prototype.start=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var a,s;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return o.asserts.assert(r.config_,"Must call configure() before start()!"),r.playerInterface_=t,n.yield(r.requestManifest_(e),2);case 2:return a=n.yieldResult,r.masterPlaylistUri_=a.uri,o.asserts.assert(a.data,"Response data should be non-null!"),n.yield(r.parseManifest_(a.data),3);case 3:return 0<(s=r.updatePlaylistDelay_)&&r.updatePlaylistTimer_.tickAfter(s),o.asserts.assert(r.manifest_,"Manifest should be non-null"),n.return(r.manifest_)}}))}))},a.hls.HlsParser.prototype.stop=function(){this.updatePlaylistTimer_&&(this.updatePlaylistTimer_.stop(),this.updatePlaylistTimer_=null);var e=[];return this.operationManager_&&(e.push(this.operationManager_.destroy()),this.operationManager_=null),this.config_=this.playerInterface_=null,this.mediaTagsToStreamInfosMap_.clear(),this.variantUriSet_.clear(),this.uriToStreamInfosMap_.clear(),this.manifest_=null,Promise.all(e)},a.hls.HlsParser.prototype.update=function(){if(this.isLive_()){for(var e=[],t=i.makeIterator(this.uriToStreamInfosMap_.values()),r=t.next();!r.done;r=t.next())e.push(this.updateStream_(r.value));return Promise.all(e)}},a.hls.HlsParser.prototype.updateStream_=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){var n,s,l,u,c,d,p,f,h,m;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return n=a.hls.Utils,s=a.hls.HlsParser.PresentationType_,l=e.absoluteMediaPlaylistUri,r.yield(t.requestManifest_(l),2);case 2:if(u=r.yieldResult,(c=t.manifestTextParser_.parsePlaylist(u.data,u.uri)).type!=a.hls.PlaylistType.MEDIA)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_INVALID_PLAYLIST_HIERARCHY);return p=(d=n.getFirstTagWithName(c.tags,"EXT-X-MEDIA-SEQUENCE"))?Number(d.value):0,f=e.stream,r.yield(t.createSegments_(e.verbatimMediaPlaylistUri,c,p,f.mimeType,f.codecs),3);case 3:h=r.yieldResult,e.segmentIndex.replace(h),m=h[h.length-1],o.asserts.assert(m,"Should have segments!"),n.getFirstTagWithName(c.tags,"EXT-X-ENDLIST")&&(t.setPresentationType_(s.VOD),t.presentationTimeline_.setDuration(m.endTime)),r.jumpToEnd()}}))}))},a.hls.HlsParser.prototype.onExpirationUpdated=function(e,t){},a.hls.HlsParser.prototype.parseManifest_=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){var n,s,l,u,c,d,p,f,h,m,g,y,_;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:if(o.asserts.assert(t.masterPlaylistUri_,"Master playlist URI must be set before calling parseManifest_!"),(n=t.manifestTextParser_.parsePlaylist(e,t.masterPlaylistUri_)).type!=a.hls.PlaylistType.MASTER)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_MASTER_PLAYLIST_NOT_PROVIDED);return r.yield(t.createPeriod_(n),2);case 2:if(s=r.yieldResult,!t.playerInterface_)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.PLAYER,a.util.Error.Code.OPERATION_ABORTED);if(t.aesEncrypted_&&0==s.variants.length)throw a.log.info("No stream is created, because we don't support AES-128","encryption yet"),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_AES_128_ENCRYPTION_NOT_SUPPORTED);t.playerInterface_.filterAllPeriods([s]),l=1/0,c=u=0,d=1/0;for(var v=i.makeIterator(t.uriToStreamInfosMap_.values()),E=v.next();!E.done;E=v.next())p=E.value,l=Math.min(l,p.minTimestamp),u=Math.max(u,p.minTimestamp),c=Math.max(c,p.maxTimestamp),"text"!=p.stream.type&&(d=Math.min(d,p.duration));if(o.asserts.assert(null==t.presentationTimeline_,"Presentation timeline created early!"),t.createPresentationTimeline_(c),o.asserts.assert(t.presentationTimeline_,"Presentation timeline not created!"),t.isLive_()){for(t.updatePlaylistDelay_=t.minTargetDuration_,f=a.hls.HlsParser.PresentationType_,t.presentationType_==f.LIVE&&(h=t.presentationTimeline_.getDelay(),isNaN(t.config_.availabilityWindowOverride)||(h=t.config_.availabilityWindowOverride),t.presentationTimeline_.setSegmentAvailabilityDuration(h)),m=a.hls.HlsParser.TS_ROLLOVER_/a.hls.HlsParser.TS_TIMESCALE_,g=0;u>=m;)g+=m,u-=m;if(g)for(a.log.debug("Offsetting live streams by",g,"to compensate for rollover"),E=(v=i.makeIterator(t.uriToStreamInfosMap_.values())).next();!E.done;E=v.next())(y=E.value).minTimestamp<m?(a.log.v1("Offset applied to",y.stream.type),y.stream.presentationTimeOffset=-g,y.segmentIndex.offset(g)):a.log.v1("Offset NOT applied to",y.stream.type)}else for(t.presentationTimeline_.setDuration(d),t.presentationTimeline_.offset(-l),E=(v=i.makeIterator(t.uriToStreamInfosMap_.values())).next();!E.done;E=v.next())(_=E.value).stream.presentationTimeOffset=l,_.segmentIndex.offset(-l),_.segmentIndex.fit(d);t.manifest_={presentationTimeline:t.presentationTimeline_,periods:[s],offlineSessionIds:[],minBufferTime:0},r.jumpToEnd()}}))}))},a.hls.HlsParser.prototype.createPeriod_=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){var n,o,s,l,u,c,d,p,f,h,m,g;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return n=a.hls.Utils,o=a.util.Functional,s=e.tags,l=n.filterTagsByName(e.tags,"EXT-X-MEDIA"),u=l.filter(function(e){return"SUBTITLES"==a.hls.HlsParser.getRequiredAttributeValue_(e,"TYPE")}.bind(t)),c=u.map(function(t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var o;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return r.config_.disableText?n.return(null):(n.setCatchFinallyBlocks(2),n.yield(r.createTextStream_(t,e),4));case 4:return n.return(n.yieldResult);case 2:if(o=n.enterCatchBlock(),r.config_.hls.ignoreTextStreamFailures)return n.return(null);throw o}}))}))}.bind(t)),d=l.filter((function(e){return"CLOSED-CAPTIONS"==a.hls.HlsParser.getRequiredAttributeValue_(e,"TYPE")})),t.parseClosedCaptions_(d),r.yield(Promise.all(c),2);case 2:return p=r.yieldResult,f=n.filterTagsByName(s,"EXT-X-STREAM-INF"),h=f.map(function(t){return this.createVariantsForTag_(t,e)}.bind(t)),r.yield(Promise.all(h),3);case 3:return m=r.yieldResult,g=(g=m.reduce(o.collapseArrays,[])).filter((function(e){return null!=e})),r.return({startTime:0,variants:g,textStreams:p.filter((function(e){return null!=e}))})}}))}))},a.hls.HlsParser.prototype.createVariantsForTag_=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var s,l,u,c,d,p,f,h,m,g,y,_,v,E,S,b,T,w,M,x,P,I,C,A,N,D,k;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return o.asserts.assert("EXT-X-STREAM-INF"==e.name,"Should only be called on variant tags!"),s=a.util.ManifestParserUtils.ContentType,l=a.hls.Utils,u=e.getAttributeValue("CODECS","avc1.42E01E,mp4a.40.2"),c=a.hls.HlsParser.filterDuplicateCodecs_(u.split(/\s*,\s*/)),d=e.getAttribute("RESOLUTION"),f=p=null,h=e.getAttributeValue("FRAME-RATE"),m=Number(a.hls.HlsParser.getRequiredAttributeValue_(e,"BANDWIDTH")),d&&(g=d.value.split("x"),p=g[0],f=g[1]),y=(y=(y=l.filterTagsByName(t.tags,"EXT-X-MEDIA")).filter((function(e){return"CLOSED-CAPTIONS"!=a.hls.HlsParser.getRequiredAttributeValue_(e,"TYPE")}))).filter((function(e){var t=e.getAttributeValue("URI")||"";return"SUBTITLES"==(e.getAttributeValue("TYPE")||"")||""!=t})),_=e.getAttributeValue("AUDIO"),v=e.getAttributeValue("VIDEO"),o.asserts.assert(null==_||null==v,"Unexpected: both video and audio described by media tags!"),_?y=l.findMediaTags(y,"AUDIO",_):v&&(y=l.findMediaTags(y,"VIDEO",v)),(E=r.guessCodecsSafe_(s.TEXT,c))&&((S=e.getAttributeValue("SUBTITLES"))&&(b=l.findMediaTags(y,"SUBTITLES",S),o.asserts.assert(1==b.length,"Exactly one text tag expected!"),b.length&&(T=r.mediaTagsToStreamInfosMap_.get(b[0].id))&&(T.stream.codecs=E)),a.util.ArrayUtils.remove(c,E)),w=y.map(function(e){return this.createStreamInfoFromMediaTag_(e,c)}.bind(r)),M=[],x=[],n.yield(Promise.all(w),2);case 2:if(I=(I=n.yieldResult).filter((function(e){return null!=e})),_?M=I:v&&(x=I),a.log.debug("Guessing stream type for",e.toString()),A=!1,M.length||x.length?M.length?(D=a.hls.HlsParser.getRequiredAttributeValue_(e,"URI"),k=M[0].verbatimMediaPlaylistUri,D==k?(a.log.debug("Guessing audio-only."),C=s.AUDIO,A=!0):(a.log.debug("Guessing video."),C=s.VIDEO)):(o.asserts.assert(x.length,"No video streams!  This should have been handled already!"),a.log.debug("Guessing audio."),C=s.AUDIO):1==c.length?(N=r.guessCodecsSafe_(s.VIDEO,c),d||h||N?(a.log.debug("Guessing video-only."),C=s.VIDEO):(a.log.debug("Guessing audio-only."),C=s.AUDIO)):(a.log.debug("Guessing multiplexed audio+video."),C=s.VIDEO,c=[c.join(",")]),o.asserts.assert(C,"Type should have been set by now!"),A){n.jumpTo(3);break}return n.yield(r.createStreamInfoFromVariantTag_(e,c,C),4);case 4:P=n.yieldResult;case 3:if(P)P.stream.type==s.AUDIO?M=[P]:x=[P];else if(null===P)return a.log.debug("streamInfo is null"),n.return([]);return o.asserts.assert(x.length||M.length,"We should have created a stream!"),x&&r.filterLegacyCodecs_(x),M&&r.filterLegacyCodecs_(M),n.return(r.createVariants_(M,x,m,p,f,h))}}))}))},a.hls.HlsParser.prototype.filterLegacyCodecs_=function(e){e.forEach((function(e){if(e){var t=e.stream.codecs.split(",");t=t.filter((function(e){return"mp4a.40.34"!=e})),e.stream.codecs=t.join(",")}}))},a.hls.HlsParser.prototype.createVariants_=function(e,t,r,n,o,s){var l=a.media.DrmEngine;t.forEach(function(e){this.addVideoAttributes_(e.stream,n,o,s)}.bind(this));var u=!!this.config_&&this.config_.disableAudio;e.length&&!u||(e=[null]),u=!!this.config_&&this.config_.disableVideo,t.length&&!u||(t=[null]),u=[];for(var c=(e=i.makeIterator(e)).next();!c.done;c=e.next()){c=c.value;for(var d=i.makeIterator(t),p=d.next();!p.done;p=d.next()){var f=p.value;p=c?c.stream:null;var h=f?f.stream:null,m=c?c.drmInfos:null,g=f?f.drmInfos:null;f=(f?f.verbatimMediaPlaylistUri:"")+" - "+(c?c.verbatimMediaPlaylistUri:"");var y=void 0;if(p&&h){if(!l.areDrmCompatible(m,g)){a.log.warning("Incompatible DRM info in HLS variant.  Skipping.");continue}y=l.getCommonDrmInfos(m,g)}else p?y=m:h&&(y=g);this.variantUriSet_.has(f)?a.log.debug("Skipping variant which only differs in text streams."):(p=this.createVariant_(p,h,r,y),u.push(p),this.variantUriSet_.add(f))}}return u},a.hls.HlsParser.prototype.createVariant_=function(e,t,r,n){var i=a.util.ManifestParserUtils.ContentType;return o.asserts.assert(!e||e.type==i.AUDIO,"Audio parameter mismatch!"),o.asserts.assert(!t||t.type==i.VIDEO,"Video parameter mismatch!"),{id:this.globalId_++,language:e?e.language:"und",primary:!!e&&e.primary||!!t&&t.primary,audio:e,video:t,bandwidth:r,drmInfos:n,allowedByApplication:!0,allowedByKeySystem:!0}},a.hls.HlsParser.prototype.createTextStream_=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var n,s;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return o.asserts.assert("EXT-X-MEDIA"==e.name,"Should only be called on media tags!"),n=a.hls.HlsParser.getRequiredAttributeValue_(e,"TYPE"),o.asserts.assert("SUBTITLES"==n,'Should only be called on tags with TYPE="SUBTITLES"!'),t.yield(r.createStreamInfoFromMediaTag_(e,[]),2);case 2:return s=t.yieldResult,o.asserts.assert(s,"Should always have a streamInfo for text"),t.return(s.stream)}}))}))},a.hls.HlsParser.prototype.parseClosedCaptions_=function(e){for(var t=(e=i.makeIterator(e)).next();!t.done;t=e.next()){t=t.value,o.asserts.assert("EXT-X-MEDIA"==t.name,"Should only be called on media tags!");var r=a.hls.HlsParser.getRequiredAttributeValue_(t,"TYPE");o.asserts.assert("CLOSED-CAPTIONS"==r,'Should only be called on tags with TYPE="CLOSED-CAPTIONS"!'),r=a.util.LanguageUtils;var n=t.getAttributeValue("LANGUAGE")||"und";r=r.normalize(n),n=a.hls.HlsParser.getRequiredAttributeValue_(t,"GROUP-ID"),t=a.hls.HlsParser.getRequiredAttributeValue_(t,"INSTREAM-ID"),this.groupIdToClosedCaptionsMap_.get(n)||this.groupIdToClosedCaptionsMap_.set(n,new Map),this.groupIdToClosedCaptionsMap_.get(n).set(t,r)}},a.hls.HlsParser.prototype.createStreamInfoFromMediaTag_=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var s,l,u,c,d,p,f,h,m,g,y,_,v,E;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return o.asserts.assert("EXT-X-MEDIA"==e.name,"Should only be called on media tags!"),s=a.hls.HlsParser,l=s.getRequiredAttributeValue_(e,"URI"),r.uriToStreamInfosMap_.has(l)?n.return(r.uriToStreamInfosMap_.get(l)):(u=s.getRequiredAttributeValue_(e,"TYPE").toLowerCase(),c=a.util.ManifestParserUtils.ContentType,"subtitles"==u&&(u=c.TEXT),d=a.util.LanguageUtils,p=d.normalize(e.getAttributeValue("LANGUAGE","und")),f=e.getAttributeValue("NAME"),h=e.getAttribute("DEFAULT"),m=e.getAttribute("AUTOSELECT"),g=e.getAttributeValue("CHANNELS"),y="audio"==u?r.getChannelCount_(g):null,_=!!h||!!m,v=e.getAttributeValue("CHARACTERISTICS"),n.yield(r.createStreamInfo_(l,t,u,p,_,f,y,null,v),2));case 2:return E=n.yieldResult,r.uriToStreamInfosMap_.has(l)?n.return(r.uriToStreamInfosMap_.get(l)):null==E?n.return(null):(r.mediaTagsToStreamInfosMap_.set(e.id,E),r.uriToStreamInfosMap_.set(l,E),n.return(E))}}))}))},a.hls.HlsParser.prototype.getChannelCount_=function(e){return e?(e=e.split("/")[0],parseInt(e,10)):null},a.hls.HlsParser.prototype.createStreamInfoFromVariantTag_=function(e,t,r){var n=this;return i.asyncExecutePromiseGeneratorFunction((function s(){var l,u,c,d,p,f;return i.generator.createGenerator(s,(function(i){switch(i.nextAddress){case 1:return o.asserts.assert("EXT-X-STREAM-INF"==e.name,"Should only be called on media tags!"),l=a.util.ManifestParserUtils.ContentType,u=a.hls.HlsParser,c=u.getRequiredAttributeValue_(e,"URI"),n.uriToStreamInfosMap_.has(c)?i.return(n.uriToStreamInfosMap_.get(c)):(d=e.getAttributeValue("CLOSED-CAPTIONS"),p=null,r==l.VIDEO&&d&&"NONE"!=d&&(p=n.groupIdToClosedCaptionsMap_.get(d)),i.yield(n.createStreamInfo_(c,t,r,"und",!1,null,null,p,null),2));case 2:return null==(f=i.yieldResult)?i.return(null):n.uriToStreamInfosMap_.has(c)?i.return(n.uriToStreamInfosMap_.get(c)):(n.uriToStreamInfosMap_.set(c,f),i.return(f))}}))}))},a.hls.HlsParser.prototype.createStreamInfo_=function(e,t,r,n,s,l,u,c,d){var p=this;return i.asyncExecutePromiseGeneratorFunction((function f(){var h,m,g,y,_,v,E,S,b,T,w,M,x,P,I,C,A,N,D,k,L,R,O,U,j,F,B;return i.generator.createGenerator(f,(function(f){switch(f.nextAddress){case 1:return h=a.hls.Utils,m=h.constructAbsoluteUri(p.masterPlaylistUri_,e),f.yield(p.requestManifest_(m),2);case 2:if(g=f.yieldResult,m=g.uri,(y=p.manifestTextParser_.parsePlaylist(g.data,m)).type!=a.hls.PlaylistType.MEDIA)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_INVALID_PLAYLIST_HIERARCHY);_=[],y.segments.forEach((function(e){e=h.filterTagsByName(e.tags,"EXT-X-KEY"),_.push.apply(_,e)})),v=!1,E=[],S=null;for(var z=i.makeIterator(_),V=z.next();!V.done;V=z.next())if(b=V.value,"NONE"!=(T=a.hls.HlsParser.getRequiredAttributeValue_(b,"METHOD"))){if(v=!0,"AES-128"==T)return a.log.warning("Unsupported HLS Encryption",T),p.aesEncrypted_=!0,f.return(null);w=a.hls.HlsParser.getRequiredAttributeValue_(b,"KEYFORMAT"),(x=(M=a.hls.HlsParser.KEYFORMATS_TO_DRM_PARSERS_[w])?M(b):null)?(x.keyIds.length&&(S=x.keyIds[0]),E.push(x)):a.log.warning("Unsupported HLS KEYFORMAT",w)}if(v&&!E.length)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_KEYFORMATS_NOT_SUPPORTED);return o.asserts.assert(null!=y.segments,"Media playlist should have segments!"),p.determinePresentationType_(y),P=p.guessCodecs_(r,t),f.yield(p.guessMimeType_(r,P,y),3);case 3:return I=f.yieldResult,a.hls.HlsParser.RAW_FORMATS_.includes(I)&&(P=""),A=(C=h.getFirstTagWithName(y.tags,"EXT-X-MEDIA-SEQUENCE"))?Number(C.value):0,f.setCatchFinallyBlocks(4),f.yield(p.createSegments_(e,y,A,I,P),6);case 6:N=f.yieldResult,f.leaveTryBlock(5);break;case 4:if((D=f.enterCatchBlock()).code==a.util.Error.Code.HLS_INTERNAL_SKIP_STREAM)return a.log.alwaysWarn("Skipping unsupported HLS stream",I,e),f.return(null);throw D;case 5:return k=N[0].startTime,L=N[N.length-1].endTime,R=L-k,O=new a.media.SegmentIndex(N),U=p.createInitSegmentReference_(y),j=void 0,r==a.util.ManifestParserUtils.ContentType.TEXT&&(j=a.util.ManifestParserUtils.TextStreamKind.SUBTITLE),F=[],d&&F.push(d),B={id:p.globalId_++,originalId:l,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:O.find.bind(O),getSegmentReference:O.get.bind(O),initSegmentReference:U,presentationTimeOffset:0,mimeType:I,codecs:P,kind:j,encrypted:v,keyId:S,language:n,label:l,type:r,primary:s,trickModeVideo:null,emsgSchemeIdUris:null,frameRate:void 0,pixelAspectRatio:void 0,width:void 0,height:void 0,bandwidth:void 0,roles:F,channelsCount:u,audioSamplingRate:null,closedCaptions:c},f.return({stream:B,segmentIndex:O,drmInfos:E,verbatimMediaPlaylistUri:e,absoluteMediaPlaylistUri:m,minTimestamp:k,maxTimestamp:L,duration:R})}}))}))},a.hls.HlsParser.prototype.determinePresentationType_=function(e){var t=a.hls.Utils,r=a.hls.HlsParser.PresentationType_,n=t.getFirstTagWithName(e.tags,"EXT-X-PLAYLIST-TYPE");t=t.getFirstTagWithName(e.tags,"EXT-X-ENDLIST"),t=n&&"VOD"==n.value||t,n=n&&"EVENT"==n.value&&!t,n=!t&&!n,t?this.setPresentationType_(r.VOD):(n?this.setPresentationType_(r.LIVE):this.setPresentationType_(r.EVENT),e=this.getRequiredTag_(e.tags,"EXT-X-TARGETDURATION"),e=Number(e.value),this.maxTargetDuration_=Math.max(e,this.maxTargetDuration_),this.minTargetDuration_=Math.min(e,this.minTargetDuration_))},a.hls.HlsParser.prototype.createPresentationTimeline_=function(e){this.isLive_()?(this.presentationTimeline_=new a.media.PresentationTimeline(0,3*this.maxTargetDuration_),this.presentationTimeline_.setStatic(!1)):(this.presentationTimeline_=new a.media.PresentationTimeline(null,0),this.presentationTimeline_.setStatic(!0)),this.notifySegments_(),o.asserts.assert(!this.presentationTimeline_.usingPresentationStartTime(),"We should not be using the presentation start time in HLS!")},a.hls.HlsParser.prototype.createInitSegmentReference_=function(e){var t=a.hls.Utils,r=t.filterTagsByName(e.tags,"EXT-X-MAP");if(!r.length)return null;if(1<r.length)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND);r=r[0];var n=a.hls.HlsParser.getRequiredAttributeValue_(r,"URI"),i=t.constructAbsoluteUri(e.absoluteUri,n);return e=0,t=null,(r=r.getAttributeValue("BYTERANGE"))&&(e=r.split("@"),r=Number(e[0]),t=(e=Number(e[1]))+r-1),new a.media.InitSegmentReference((function(){return[i]}),e,t)},a.hls.HlsParser.prototype.createSegmentReference_=function(e,t,r,n,i){e=a.hls.Utils;var s=r.tags,l=r.absoluteUri;r=this.getRequiredTag_(s,"EXTINF").value.split(","),r=i+Number(r[0]);var u=0,c=null;return(e=e.getFirstTagWithName(s,"EXT-X-BYTERANGE"))&&(s=e.value.split("@"),e=Number(s[0]),s[1]?u=Number(s[1]):(o.asserts.assert(t,"Cannot refer back to previous HLS segment!"),u=t.endByte+1),c=u+e-1),new a.media.SegmentReference(n,i,r,(function(){return[l]}),u,c)},a.hls.HlsParser.prototype.notifySegments_=function(){var e=this;this.presentationTimeline_&&(this.segmentsToNotifyByStream_.forEach((function(t){e.presentationTimeline_.notifySegments(t,0)})),this.segmentsToNotifyByStream_=[])},a.hls.HlsParser.prototype.createSegments_=function(e,t,r,n,s){var l=this;return i.asyncExecutePromiseGeneratorFunction((function u(){var c,d,p,f,h,m,g,y,_,v,E;return i.generator.createGenerator(u,(function(i){switch(i.nextAddress){case 1:return c=t.segments,d=[],o.asserts.assert(c.length,"Playlist should have segments!"),p=c[0].absoluteUri,f=l.createSegmentReference_(t,null,c[0],r,0),h=l.createInitSegmentReference_(t),i.yield(l.getStartTime_(e,h,f,n,s),2);case 2:m=i.yieldResult,a.log.debug("First segment",p.split("/").pop(),"starts at",m);for(var u=0;u<c.length;++u)g=c[u],y=d[d.length-1],_=0==u?m:y.endTime,v=r+u,E=l.createSegmentReference_(t,y,g,v,_),d.push(E);return l.segmentsToNotifyByStream_.push(d),l.notifySegments_(),i.return(d)}}))}))},a.hls.HlsParser.prototype.fetchPartialSegment_=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){var n,o,s,l,u,c;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return n=a.net.NetworkingEngine.RequestType.SEGMENT,o=a.util.Networking.createSegmentRequest(e.getUris(),e.startByte,e.startByte+a.hls.HlsParser.PARTIAL_SEGMENT_SIZE_-1,t.config_.retryParameters),s=a.util.Networking.createSegmentRequest(e.getUris(),e.startByte,e.endByte,t.config_.retryParameters),t.config_.hls.useFullSegmentsForStartTime?r.return(t.makeNetworkRequest_(s,n)):(r.setCatchFinallyBlocks(2),r.yield(t.makeNetworkRequest_(o,n),4));case 4:return l=r.yieldResult,r.return(l);case 2:if((u=r.enterCatchBlock()).code==a.util.Error.Code.OPERATION_ABORTED)throw u;return a.log.alwaysWarn("Unable to fetch a partial HLS segment! Falling back to a full segment request, which is expensive!  Your server should support Range requests and CORS preflights.",o.uris[0]),r.yield(t.makeNetworkRequest_(s,n),5);case 5:return c=r.yieldResult,r.return(c)}}))}))},a.hls.HlsParser.prototype.getStartTime_=function(e,t,r,n,s){var l=this;return i.asyncExecutePromiseGeneratorFunction((function u(){var c,d,p,f,h,m,g,y,_;return i.generator.createGenerator(u,(function(i){switch(i.nextAddress){case 1:if(l.manifest_){if(c=l.uriToStreamInfosMap_.get(e),d=c.segmentIndex,p=d.get(r.position))return a.log.v1("Found segment start time in previous manifest"),i.return(p.startTime);a.log.debug("Unable to find segment start time in previous manifest!")}if(a.log.v1("Fetching segment to find start time"),n=n.toLowerCase(),a.hls.HlsParser.RAW_FORMATS_.includes(n))throw a.log.alwaysWarn("Raw formats are not yet supported.  Skipping "+n),new a.util.Error(a.util.Error.Severity.RECOVERABLE,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_INTERNAL_SKIP_STREAM);if("video/webm"==n)throw a.log.alwaysWarn("WebM in HLS is not yet supported.  Skipping."),new a.util.Error(a.util.Error.Severity.RECOVERABLE,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_INTERNAL_SKIP_STREAM);if("video/mp4"!=n&&"audio/mp4"!=n){i.jumpTo(2);break}return f=[l.fetchPartialSegment_(r)],t&&f.push(l.fetchPartialSegment_(t)),i.yield(Promise.all(f),3);case 3:return h=i.yieldResult,m=h[0],g=h[1]||h[0],i.return(l.getStartTimeFromMp4Segment_(e,m.uri,m.data,g.data));case 2:if("video/mp2t"!=n){i.jumpTo(4);break}return i.yield(l.fetchPartialSegment_(r),5);case 5:return y=i.yieldResult,o.asserts.assert(y.data,"Should have a response body!"),i.return(l.getStartTimeFromTsSegment_(e,y.uri,y.data));case 4:if("application/mp4"!=n&&!n.startsWith("text/")){i.jumpTo(6);break}return i.yield(l.fetchPartialSegment_(r),7);case 7:return _=i.yieldResult,o.asserts.assert(_.data,"Should have a response body!"),i.return(l.getStartTimeFromTextSegment_(n,s,_.data));case 6:throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME,e)}}))}))},a.hls.HlsParser.prototype.getStartTimeFromMp4Segment_=function(e,t,r,n){var i=a.util.Mp4Parser,s=0;if((new i).box("moov",i.children).box("trak",i.children).box("mdia",i.children).fullBox("mdhd",(function(e){o.asserts.assert(0==e.version||1==e.version,"MDHD version can only be 0 or 1"),e.reader.skip(0==e.version?8:16),s=e.reader.readUint32(),e.parser.stop()})).parse(n,!0),!s)throw a.log.error("Unable to find timescale in init segment!"),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME,e,t);var l=0,u=!1;if((new i).box("moof",i.children).box("traf",i.children).fullBox("tfdt",(function(e){o.asserts.assert(0==e.version||1==e.version,"TFDT version can only be 0 or 1"),l=(0==e.version?e.reader.readUint32():e.reader.readUint64())/s,u=!0,e.parser.stop()})).parse(r,!0),!u)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME,e,t);return l},a.hls.HlsParser.prototype.getStartTimeFromTsSegment_=function(e,t,r){var n=new a.util.DataViewReader(new DataView(r),a.util.DataViewReader.Endianness.BIG_ENDIAN),i=function(){throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME,e,t)},s=0,l=0;for(r=function(){n.seek(s+188),71!=(l=n.readUint8())&&(n.seek(s+192),l=n.readUint8()),71!=l&&(n.seek(s+204),l=n.readUint8()),71!=l&&i(),n.rewind(1)};;){s=n.getPosition(),71!=(l=n.readUint8())&&i();var u=n.readUint16();if(8191==(8191&u))r();else if(16384&u){if(0!=(u=(48&n.readUint8())>>4)&&2!=u||i(),3==u&&(u=n.readUint8(),n.skip(u)),1==n.readUint32()>>8)return n.skip(3),0!=(r=n.readUint8()>>6)&&1!=r||i(),0==(u=n.readUint8())&&i(),2==r?o.asserts.assert(5==u,"Bad PES header?"):3==r&&o.asserts.assert(10==u,"Bad PES header?"),(1073741824*((14&(r=n.readUint8()))>>1)+((65534&(u=n.readUint16()))<<14|(65534&n.readUint16())>>1))/a.hls.HlsParser.TS_TIMESCALE_;r()}else r()}},a.hls.HlsParser.prototype.getStartTimeFromTextSegment_=function(e,t,r){return e=a.util.MimeUtils.getFullType(e,t),a.text.TextEngine.isTypeSupported(e)?((t=new a.text.TextEngine(null)).initParser(e),t.getStartTime(r)):0},a.hls.HlsParser.filterDuplicateCodecs_=function(e){for(var t=new Set,r=[],n=(e=i.makeIterator(e)).next();!n.done;n=e.next()){n=n.value;var o=a.util.MimeUtils.getCodecBase(n);t.has(o)?a.log.debug("Ignoring duplicate codec"):(r.push(n),t.add(o))}return r},a.hls.HlsParser.prototype.guessCodecsSafe_=function(e,t){for(var r=a.util.ManifestParserUtils.ContentType,n=a.hls.HlsParser.CODEC_REGEXPS_BY_CONTENT_TYPE_[e],i=0;i<n.length;i++)for(var o=0;o<t.length;o++)if(n[i].test(t[o].trim()))return t[o].trim();return e==r.TEXT?"":null},a.hls.HlsParser.prototype.guessCodecs_=function(e,t){if(1==t.length)return t[0];var r=this.guessCodecsSafe_(e,t);if(null!=r)return r;throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_COULD_NOT_GUESS_CODECS,t)},a.hls.HlsParser.prototype.guessMimeType_=function(e,t,r){var n=this;return i.asyncExecutePromiseGeneratorFunction((function s(){var l,u,c,d,p,f,h,m,g,y,_;return i.generator.createGenerator(s,(function(i){switch(i.nextAddress){case 1:return l=a.util.ManifestParserUtils.ContentType,u=a.hls.HlsParser,c=a.net.NetworkingEngine.RequestType.SEGMENT,o.asserts.assert(r.segments.length,"Playlist should have segments!"),d=r.segments[0].absoluteUri,p=new o.Uri(d),f=p.getPath().split(".").pop(),h=u.EXTENSION_MAP_BY_CONTENT_TYPE_[e],(m=h[f])?i.return(m):e==l.TEXT?t&&"vtt"!=t?i.return("application/mp4"):i.return("text/vtt"):((g=a.net.NetworkingEngine.makeRequest([d],n.config_.retryParameters)).method="HEAD",i.yield(n.makeNetworkRequest_(g,c),2));case 2:if(y=i.yieldResult,!(_=y.headers["content-type"]))throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_COULD_NOT_GUESS_MIME_TYPE,f);return i.return(_.split(";")[0])}}))}))},a.hls.HlsParser.getRequiredAttributeValue_=function(e,t){var r=e.getAttribute(t);if(!r)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_REQUIRED_ATTRIBUTE_MISSING,t);return r.value},a.hls.HlsParser.prototype.getRequiredTag_=function(e,t){var r=a.hls.Utils.getFirstTagWithName(e,t);if(!r)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.HLS_REQUIRED_TAG_MISSING,t);return r},a.hls.HlsParser.prototype.addVideoAttributes_=function(e,t,r,n){e&&(e.width=Number(t)||void 0,e.height=Number(r)||void 0,e.frameRate=Number(n)||void 0)},a.hls.HlsParser.prototype.requestManifest_=function(e){var t=a.net.NetworkingEngine.RequestType.MANIFEST;return e=a.net.NetworkingEngine.makeRequest([e],this.config_.retryParameters),this.makeNetworkRequest_(e,t)},a.hls.HlsParser.VIDEO_CODEC_REGEXPS_=[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],a.hls.HlsParser.AUDIO_CODEC_REGEXPS_=[/^vorbis$/,/^opus$/,/^flac$/,/^mp4a/,/^[ae]c-3$/],a.hls.HlsParser.TEXT_CODEC_REGEXPS_=[/^vtt$/,/^wvtt/,/^stpp/],a.hls.HlsParser.CODEC_REGEXPS_BY_CONTENT_TYPE_={audio:a.hls.HlsParser.AUDIO_CODEC_REGEXPS_,video:a.hls.HlsParser.VIDEO_CODEC_REGEXPS_,text:a.hls.HlsParser.TEXT_CODEC_REGEXPS_},a.hls.HlsParser.AUDIO_EXTENSIONS_TO_MIME_TYPES_={mp4:"audio/mp4",m4s:"audio/mp4",m4i:"audio/mp4",m4a:"audio/mp4",cmfa:"audio/mp4",ts:"video/mp2t",aac:"audio/aac",ac3:"audio/ac3",ec3:"audio/ec3",mp3:"audio/mpeg"},a.hls.HlsParser.RAW_FORMATS_=["audio/aac","audio/ac3","audio/ec3","audio/mpeg"],a.hls.HlsParser.VIDEO_EXTENSIONS_TO_MIME_TYPES_={mp4:"video/mp4",m4s:"video/mp4",m4i:"video/mp4",m4v:"video/mp4",cmfv:"video/mp4",ts:"video/mp2t"},a.hls.HlsParser.TEXT_EXTENSIONS_TO_MIME_TYPES_={mp4:"application/mp4",m4s:"application/mp4",m4i:"application/mp4",cmft:"application/mp4",vtt:"text/vtt",ttml:"application/ttml+xml"},a.hls.HlsParser.EXTENSION_MAP_BY_CONTENT_TYPE_={audio:a.hls.HlsParser.AUDIO_EXTENSIONS_TO_MIME_TYPES_,video:a.hls.HlsParser.VIDEO_EXTENSIONS_TO_MIME_TYPES_,text:a.hls.HlsParser.TEXT_EXTENSIONS_TO_MIME_TYPES_},a.hls.HlsParser.widevineDrmParser_=function(e){var t=a.hls.HlsParser,r=t.getRequiredAttributeValue_(e,"METHOD");a.Deprecate.deprecateFeature(2,6,"HLS SAMPLE-AES-CENC","SAMPLE-AES-CENC will no longer be supported, see Issue #1227");var n=["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"];return n.includes(r)?(t=t.getRequiredAttributeValue_(e,"URI"),t=a.net.DataUriPlugin.parse(t),t=new Uint8Array(t.data),t=a.util.ManifestParserUtils.createDrmInfo("com.widevine.alpha",[{initDataType:"cenc",initData:t}]),(e=e.getAttributeValue("KEYID"))&&(o.asserts.assert(e.startsWith("0x"),"Incorrect KEYID format!"),t.keyIds=[e.substr(2).toLowerCase()]),t):(a.log.error("Widevine in HLS is only supported with [",n.join(", "),"], not",r),null)},a.hls.HlsParser.prototype.onUpdate_=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var r,n;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return a.log.info("Updating manifest..."),o.asserts.assert(0<e.updatePlaylistDelay_,"We should only call |onUpdate_| when we are suppose to be updating."),e.playerInterface_?(t.setCatchFinallyBlocks(2),t.yield(e.update(),4)):t.return();case 4:r=e.updatePlaylistDelay_,e.updatePlaylistTimer_.tickAfter(r),t.leaveTryBlock(0);break;case 2:if(n=t.enterCatchBlock(),!e.playerInterface_)return t.return();o.asserts.assert(n instanceof a.util.Error,"Should only receive a Shaka error"),n.severity=a.util.Error.Severity.RECOVERABLE,e.playerInterface_.onError(n),e.updatePlaylistTimer_.tickAfter(.1),t.jumpToEnd()}}))}))},a.hls.HlsParser.prototype.isLive_=function(){return this.presentationType_!=a.hls.HlsParser.PresentationType_.VOD},a.hls.HlsParser.prototype.setPresentationType_=function(e){this.presentationType_=e,this.presentationTimeline_&&this.presentationTimeline_.setStatic(!this.isLive_()),this.isLive_()||this.updatePlaylistTimer_.stop()},a.hls.HlsParser.prototype.makeNetworkRequest_=function(e,t){if(!this.operationManager_)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.PLAYER,a.util.Error.Code.OPERATION_ABORTED);var r=this.playerInterface_.networkingEngine.request(t,e);return this.operationManager_.manage(r),r.promise},a.hls.HlsParser.KEYFORMATS_TO_DRM_PARSERS_={"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":a.hls.HlsParser.widevineDrmParser_},a.hls.HlsParser.PresentationType_={VOD:"VOD",EVENT:"EVENT",LIVE:"LIVE"},a.hls.HlsParser.TS_TIMESCALE_=9e4,a.hls.HlsParser.TS_ROLLOVER_=8589934592,a.hls.HlsParser.PARTIAL_SEGMENT_SIZE_=2048,a.media.ManifestParser.registerParserByExtension("m3u8",a.hls.HlsParser),a.media.ManifestParser.registerParserByMime("application/x-mpegurl",a.hls.HlsParser),a.media.ManifestParser.registerParserByMime("application/vnd.apple.mpegurl",a.hls.HlsParser),a.media.ActiveStreamMap=function(){this.history_=new Map},a.media.ActiveStreamMap.prototype.clear=function(){this.history_.clear()},a.media.ActiveStreamMap.prototype.useVariant=function(e,t){this.getFrameFor_(e).variant=t},a.media.ActiveStreamMap.prototype.useText=function(e,t){this.getFrameFor_(e).text=t},a.media.ActiveStreamMap.prototype.getVariant=function(e){return this.getFrameFor_(e).variant},a.media.ActiveStreamMap.prototype.getText=function(e){return this.getFrameFor_(e).text},a.media.ActiveStreamMap.prototype.getFrameFor_=function(e){if(!this.history_.has(e)){var t=new a.media.ActiveStreamMap.Frame;this.history_.set(e,t)}return this.history_.get(e)},a.media.ActiveStreamMap.Frame=function(){this.text=this.variant=null},a.media.AdaptationSet=function(e,t){this.root_=e,this.variants_=new Set([e]),t=t||[];for(var r=i.makeIterator(t),n=r.next();!n.done;n=r.next())this.add(n.value)},a.media.AdaptationSet.prototype.add=function(e){return this.canInclude(e)?(this.variants_.add(e),!0):(a.log.warning("Rejecting variant - not compatible with root."),!1)},a.media.AdaptationSet.prototype.canInclude=function(e){return a.media.AdaptationSet.areAdaptable(this.root_,e)},a.media.AdaptationSet.areAdaptable=function(e,t){var r=a.media.AdaptationSet;return!!e.audio==!!t.audio&&!!e.video==!!t.video&&e.language==t.language&&(o.asserts.assert(!!e.audio==!!t.audio,"Both should either have audio or not have audio."),!(e.audio&&t.audio&&!r.areAudiosCompatible_(e.audio,t.audio))&&(o.asserts.assert(!!e.video==!!t.video,"Both should either have video or not have video."),!(e.video&&t.video&&!r.areVideosCompatible_(e.video,t.video))))},a.media.AdaptationSet.prototype.values=function(){return this.variants_.values()},a.media.AdaptationSet.areAudiosCompatible_=function(e,t){var r=a.media.AdaptationSet;return!(e.channelsCount!=t.channelsCount||!r.canTransitionBetween_(e,t)||!r.areRolesEqual_(e.roles,t.roles))},a.media.AdaptationSet.areVideosCompatible_=function(e,t){var r=a.media.AdaptationSet;return!(!r.canTransitionBetween_(e,t)||!r.areRolesEqual_(e.roles,t.roles))},a.media.AdaptationSet.canTransitionBetween_=function(e,t){if(e.mimeType!=t.mimeType)return!1;var r=a.util.MimeUtils.splitCodecs(e.codecs).map((function(e){return a.util.MimeUtils.getCodecBase(e)})),n=a.util.MimeUtils.splitCodecs(t.codecs).map((function(e){return a.util.MimeUtils.getCodecBase(e)}));if(r.length!=n.length)return!1;r.sort(),n.sort();for(var i=0;i<r.length;i++)if(r[i]!=n[i])return!1;return!0},a.media.AdaptationSet.areRolesEqual_=function(e,t){var r=new Set(e),n=new Set(t);if(r.delete("main"),n.delete("main"),r.size!=n.size)return!1;for(var o=(r=i.makeIterator(r)).next();!o.done;o=r.next())if(!n.has(o.value))return!1;return!0},a.media.AdaptationSetCriteria=function(){},a.media.AdaptationSetCriteria.prototype.create=function(e){},a.media.ExampleBasedCriteria=function(e){this.example_=e,this.fallback_=new a.media.PreferenceBasedCriteria(e.language,"",e.audio&&e.audio.channelsCount?e.audio.channelsCount:0,"")},a.media.ExampleBasedCriteria.prototype.create=function(e){var t=this,r=e.filter((function(e){return a.media.AdaptationSet.areAdaptable(t.example_,e)}));return r.length?new a.media.AdaptationSet(r[0],r):this.fallback_.create(e)},a.media.PreferenceBasedCriteria=function(e,t,r,n,i){this.language_=e,this.role_=t,this.channelCount_=r,this.label_=void 0===n?"":n,this.type_=void 0===i?"":i},a.media.PreferenceBasedCriteria.prototype.create=function(e){var t=a.media.PreferenceBasedCriteria,r=a.util.StreamUtils,n=[];n=t.filterByLanguage_(e,this.language_);var o=e.filter((function(e){return e.primary}));for(n=n.length?n:o.length?o:e,this.role_&&((e=t.filterVariantsByRole_(n,this.role_,this.type_)).length?n=e:a.log.warning("No exact match for variant role could be found.")),this.channelCount_&&((r=r.filterVariantsByAudioChannelCount(n,this.channelCount_)).length?n=r:a.log.warning("No exact match for the channel count could be found.")),this.label_&&((t=t.filterVariantsByLabel_(n,this.label_)).length?n=t:a.log.warning("No exact match for variant label could be found.")),t=new a.media.AdaptationSet(n[0]),r=(n=i.makeIterator(n)).next();!r.done;r=n.next())r=r.value,t.canInclude(r)&&t.add(r);return t},a.media.PreferenceBasedCriteria.filterByLanguage_=function(e,t){var r=a.util.LanguageUtils,n=r.normalize(t),i=r.findClosestLocale(n,e.map((function(e){return r.getLocaleForVariant(e)})));return i?e.filter((function(e){return i==r.getLocaleForVariant(e)})):[]},a.media.PreferenceBasedCriteria.filterVariantsByRole_=function(e,t,r){return e.filter((function(e){if(r){var n=e[r];return n&&n.roles.includes(t)}return n=e.audio,e=e.video,n&&0<=n.roles.indexOf(t)||e&&0<=e.roles.indexOf(t)}))},a.media.PreferenceBasedCriteria.filterVariantsByLabel_=function(e,t){return e.filter((function(e){return!!e.audio&&(e=e.audio.label.toLowerCase())==t.toLowerCase()}))},a.media.BufferingObserver=function(e,t){var r=a.media.BufferingObserver.State;this.previousState_=r.SATISFIED,this.thresholds_=(new Map).set(r.SATISFIED,t).set(r.STARVING,e)},a.media.BufferingObserver.prototype.setThresholds=function(e,t){var r=a.media.BufferingObserver.State;this.thresholds_.set(r.SATISFIED,t).set(r.STARVING,e)},a.media.BufferingObserver.prototype.update=function(e,t){var r=a.media.BufferingObserver.State,n=this.thresholds_.get(this.previousState_),i=this.previousState_;return this.previousState_=r=t||e>=n?r.SATISFIED:r.STARVING,i!=r},a.media.BufferingObserver.prototype.setState=function(e){this.previousState_=e},a.media.BufferingObserver.prototype.getState=function(){return this.previousState_},a.media.BufferingObserver.State={STARVING:0,SATISFIED:1},a.media.StallDetector=function(e,t){this.implementation_=e,this.wasMakingProgress_=e.shouldBeMakingProgress(),this.value_=e.getPresentationSeconds(),this.lastUpdateSeconds_=e.getWallSeconds(),this.didJump_=!1,this.stallThresholdSeconds_=t,this.onStall_=function(){}},a.media.StallDetector.prototype.release=function(){this.implementation_=null,this.onStall_=function(){}},a.media.StallDetector.prototype.onStall=function(e){this.onStall_=e},a.media.StallDetector.prototype.poll=function(){var e=this.implementation_,t=e.shouldBeMakingProgress(),r=e.getPresentationSeconds(),n=e.getWallSeconds();this.value_==r&&this.wasMakingProgress_==t||(this.lastUpdateSeconds_=n,this.value_=r,this.wasMakingProgress_=t,this.didJump_=!1),(r=n-this.lastUpdateSeconds_)>=this.stallThresholdSeconds_&&t&&!this.didJump_&&(this.onStall_(this.value_,r),this.didJump_=!0,this.value_=e.getPresentationSeconds())},a.media.StallDetector.Implementation=function(){},a.media.StallDetector.Implementation.prototype.shouldBeMakingProgress=function(){},a.media.StallDetector.Implementation.prototype.getPresentationSeconds=function(){},a.media.StallDetector.Implementation.prototype.getWallSeconds=function(){},a.media.StallDetector.MediaElementImplementation=function(e){this.mediaElement_=e},a.media.StallDetector.MediaElementImplementation.prototype.shouldBeMakingProgress=function(){return!this.mediaElement_.paused&&0!=this.mediaElement_.playbackRate&&0!=this.mediaElement_.buffered.length&&a.media.StallDetector.MediaElementImplementation.hasContentFor_(this.mediaElement_.buffered,this.mediaElement_.currentTime)},a.media.StallDetector.MediaElementImplementation.prototype.getPresentationSeconds=function(){return this.mediaElement_.currentTime},a.media.StallDetector.MediaElementImplementation.prototype.getWallSeconds=function(){return Date.now()/1e3},a.media.StallDetector.MediaElementImplementation.hasContentFor_=function(e,t){for(var r=0;r<e.length;r++){var n=e.start(r),i=e.end(r);if(!(t<n||t>i-.5))return!0}return!1},a.media.GapJumpingController=function(e,t,r,n,i){var o=this;this.video_=e,this.timeline_=t,this.config_=r,this.onEvent_=i,this.eventManager_=new a.util.EventManager,this.seekingEventReceived_=!1,this.prevReadyState_=e.readyState,this.didFireLargeGap_=!1,this.stallDetector_=n,this.hadSegmentAppended_=!1,this.eventManager_.listen(e,"waiting",(function(){return o.onPollGapJump_()})),this.gapJumpTimer_=new a.util.Timer((function(){o.onPollGapJump_()})).tickEvery(.25)},a.media.GapJumpingController.BROWSER_GAP_TOLERANCE=.001,a.media.GapJumpingController.prototype.release=function(){this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),null!=this.gapJumpTimer_&&(this.gapJumpTimer_.stop(),this.gapJumpTimer_=null),this.stallDetector_&&(this.stallDetector_.release(),this.stallDetector_=null),this.video_=this.timeline_=this.onEvent_=null},a.media.GapJumpingController.prototype.onSegmentAppended=function(){this.hadSegmentAppended_=!0,this.onPollGapJump_()},a.media.GapJumpingController.prototype.onSeeking=function(){this.seekingEventReceived_=!0,this.didFireLargeGap_=this.hadSegmentAppended_=!1},a.media.GapJumpingController.prototype.onPollGapJump_=function(){if(0!=this.video_.readyState){if(this.video_.seeking){if(!this.seekingEventReceived_)return}else this.seekingEventReceived_=!1;if(!this.video_.paused){this.video_.readyState!=this.prevReadyState_&&(this.didFireLargeGap_=!1,this.prevReadyState_=this.video_.readyState);var e=this.config_.smallGapLimit,t=this.video_.currentTime,r=this.video_.buffered,n=a.media.TimeRangesUtils.getGapIndex(r,t);if(null==n)this.stallDetector_&&this.stallDetector_.poll();else if(0!=n||this.hadSegmentAppended_){var i=r.start(n),o=this.timeline_.getSeekRangeEnd();if(!(i>=o)){e=(o=i-t)<=e;var s=!1;if(!(o<a.media.GapJumpingController.BROWSER_GAP_TOLERANCE)){if(!e&&!this.didFireLargeGap_){this.didFireLargeGap_=!0;var l=new a.util.FakeEvent("largegap",{currentTime:t,gapSize:o});l.cancelable=!0,this.onEvent_(l),this.config_.jumpLargeGaps&&!l.defaultPrevented?s=!0:a.log.info("Ignoring large gap at",t,"size",o)}(e||s)&&(0==n?a.log.info("Jumping forward",o,"seconds because of gap before start time of",i):a.log.info("Jumping forward",o,"seconds because of gap starting at",r.end(n-1),"and ending at",i),this.video_.currentTime=i)}}}}}},a.media.IPlayheadObserver=function(){},a.media.IPlayheadObserver.prototype.poll=function(e,t){},a.media.PlayheadObserverManager=function(e){var t=this;this.mediaElement_=e,this.observers_=new Set,this.pollingLoop_=new a.util.Timer((function(){t.pollAllObservers_(!1)})).tickEvery(.25)},a.media.PlayheadObserverManager.prototype.release=function(){this.pollingLoop_.stop();for(var e=i.makeIterator(this.observers_),t=e.next();!t.done;t=e.next())t.value.release();this.observers_.clear()},a.media.PlayheadObserverManager.prototype.manage=function(e){this.observers_.add(e)},a.media.PlayheadObserverManager.prototype.notifyOfSeek=function(){this.pollAllObservers_(!0)},a.media.PlayheadObserverManager.prototype.pollAllObservers_=function(e){for(var t=i.makeIterator(this.observers_),r=t.next();!r.done;r=t.next())r.value.poll(this.mediaElement_.currentTime,e)},a.util.Periods=function(){},a.util.Periods.getAllVariantsFrom=function(e){for(var t=[],r=(e=i.makeIterator(e)).next();!r.done;r=e.next())for(var n=(r=i.makeIterator(r.value.variants)).next();!n.done;n=r.next())t.push(n.value);return t},a.util.Periods.findPeriodForTime=function(e,t){for(var r=null,n=i.makeIterator(e),o=n.next();!o.done;o=n.next())t>=(o=o.value).startTime&&(r=o);return r},a.media.PeriodObserver=function(e){this.manifest_=e,this.currentPeriod_=null,this.onChangedPeriods_=function(e){}},a.media.PeriodObserver.prototype.release=function(){this.currentPeriod_=this.manifest_=null,this.onChangedPeriods_=function(e){}},a.media.PeriodObserver.prototype.poll=function(e,t){var r=this.currentPeriod_,n=this.findCurrentPeriod_(e);r!=n&&this.onChangedPeriods_(n),this.currentPeriod_=n},a.media.PeriodObserver.prototype.setListeners=function(e){this.onChangedPeriods_=e},a.media.PeriodObserver.prototype.findCurrentPeriod_=function(e){var t=this.manifest_.periods;return a.util.Periods.findPeriodForTime(t,e)||t[0]},a.media.PlayRateController=function(e){var t=this;this.harness_=e,this.isBuffering_=!1,this.rate_=this.harness_.getRate(),this.pollRate_=.25,this.timer_=new a.util.Timer((function(){t.harness_.movePlayhead(t.rate_*t.pollRate_)}))},a.media.PlayRateController.prototype.release=function(){this.timer_&&(this.timer_.stop(),this.timer_=null),this.harness_=null},a.media.PlayRateController.prototype.setBuffering=function(e){this.isBuffering_=e,this.apply_()},a.media.PlayRateController.prototype.set=function(e){o.asserts.assert(0!=e,"Should never set rate of 0 explicitly!"),this.rate_=e,this.apply_()},a.media.PlayRateController.prototype.getActiveRate=function(){return this.calculateCurrentRate_()},a.media.PlayRateController.prototype.apply_=function(){this.timer_.stop();var e=this.calculateCurrentRate_();if(0<=e)try{return void this.applyRate_(e)}catch(e){}this.timer_.tickEvery(this.pollRate_),this.applyRate_(0)},a.media.PlayRateController.prototype.calculateCurrentRate_=function(){return this.isBuffering_?0:this.rate_},a.media.PlayRateController.prototype.applyRate_=function(e){var t=this.harness_.getRate();return t!=e&&this.harness_.setRate(e),t!=e},a.util.MediaReadyState=function(){},a.util.MediaReadyState.waitForReadyState=function(e,t,r,n){t==HTMLMediaElement.HAVE_NOTHING||e.readyState>=t?n():(t=a.util.MediaReadyState.READY_STATES_TO_EVENT_NAMES_.get(t),r.listenOnce(e,t,n))},a.util.MediaReadyState.READY_STATES_TO_EVENT_NAMES_=new Map([[HTMLMediaElement.HAVE_METADATA,"loadedmetadata"],[HTMLMediaElement.HAVE_CURRENT_DATA,"loadeddata"],[HTMLMediaElement.HAVE_FUTURE_DATA,"canplay"],[HTMLMediaElement.HAVE_ENOUGH_DATA,"canplaythrough"]]),a.media.VideoWrapper=function(e,t,r){var n=this;this.video_=e,this.onSeek_=t,this.startTime_=r,this.started_=!1,this.eventManager_=new a.util.EventManager,this.mover_=new a.media.VideoWrapper.PlayheadMover(e,10),a.util.MediaReadyState.waitForReadyState(this.video_,HTMLMediaElement.HAVE_METADATA,this.eventManager_,(function(){n.setStartTime_(n.startTime_)}))},a.media.VideoWrapper.prototype.release=function(){this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),null!=this.mover_&&(this.mover_.release(),this.mover_=null),this.onSeek_=function(){},this.video_=null},a.media.VideoWrapper.prototype.getTime=function(){return this.started_?this.video_.currentTime:this.startTime_},a.media.VideoWrapper.prototype.setTime=function(e){var t=this;0<this.video_.readyState?this.mover_.moveTo(e):a.util.MediaReadyState.waitForReadyState(this.video_,HTMLMediaElement.HAVE_METADATA,this.eventManager_,(function(){t.setStartTime_(t.startTime_)}))},a.media.VideoWrapper.prototype.setStartTime_=function(e){var t=this;.001>Math.abs(this.video_.currentTime-e)?this.startListeningToSeeks_():(this.eventManager_.listenOnce(this.video_,"seeking",(function(){t.startListeningToSeeks_()})),this.mover_.moveTo(0==this.video_.currentTime?e:this.video_.currentTime))},a.media.VideoWrapper.prototype.startListeningToSeeks_=function(){var e=this;o.asserts.assert(0<this.video_.readyState,"The media element should be ready before we listen for seeking."),this.started_=!0,this.eventManager_.listen(this.video_,"seeking",(function(){return e.onSeek_()}))},a.media.VideoWrapper.PlayheadMover=function(e,t){var r=this;this.mediaElement_=e,this.maxAttempts_=t,this.targetTime_=this.originTime_=this.remainingAttempts_=0,this.timer_=new a.util.Timer((function(){return r.onTick_()}))},a.media.VideoWrapper.PlayheadMover.prototype.release=function(){this.timer_&&(this.timer_.stop(),this.timer_=null),this.mediaElement_=null},a.media.VideoWrapper.PlayheadMover.prototype.moveTo=function(e){this.originTime_=this.mediaElement_.currentTime,this.targetTime_=e,this.remainingAttempts_=this.maxAttempts_,this.mediaElement_.currentTime=e,this.timer_.tickEvery(.1)},a.media.VideoWrapper.PlayheadMover.prototype.onTick_=function(){0>=this.remainingAttempts_?(a.log.warning(["Failed to move playhead from",this.originTime_,"to",this.targetTime_].join(" ")),this.timer_.stop()):this.mediaElement_.currentTime!=this.originTime_?this.timer_.stop():(this.mediaElement_.currentTime=this.targetTime_,this.remainingAttempts_--)},a.media.Playhead=function(){},a.media.Playhead.prototype.setStartTime=function(e){},a.media.Playhead.prototype.getTime=function(){},a.media.Playhead.prototype.notifyOfBufferingChange=function(){},a.media.SrcEqualsPlayhead=function(e){var t=this;this.mediaElement_=e,this.started_=!1,this.startTime_=null,this.eventManager_=new a.util.EventManager;a.util.MediaReadyState.waitForReadyState(this.mediaElement_,HTMLMediaElement.HAVE_CURRENT_DATA,this.eventManager_,(function(){null==t.startTime_?t.started_=!0:(t.eventManager_.listenOnce(t.mediaElement_,"seeking",(function(){t.started_=!0})),t.mediaElement_.currentTime=Math.max(0,t.mediaElement_.currentTime+t.startTime_))}))},a.media.SrcEqualsPlayhead.prototype.release=function(){this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),this.mediaElement_=null},a.media.SrcEqualsPlayhead.prototype.setStartTime=function(e){this.startTime_=this.started_?this.startTime_:e},a.media.SrcEqualsPlayhead.prototype.getTime=function(){return(this.started_?this.mediaElement_.currentTime:this.startTime_)||0},a.media.SrcEqualsPlayhead.prototype.notifyOfBufferingChange=function(){},a.media.MediaSourcePlayhead=function(e,t,r,n,i,o){var s=this;this.minSeekRange_=3,this.mediaElement_=e,this.timeline_=t.presentationTimeline,this.minBufferTime_=t.minBufferTime||0,this.config_=r,this.onSeek_=i,this.lastCorrectiveSeek_=null,this.gapController_=new a.media.GapJumpingController(e,t.presentationTimeline,r,this.createStallDetector_(e,r),o),this.videoWrapper_=new a.media.VideoWrapper(e,(function(){return s.onSeeking_()}),this.getStartTime_(n)),this.checkWindowTimer_=new a.util.Timer((function(){s.onPollWindow_()})).tickEvery(.25)},a.media.MediaSourcePlayhead.prototype.release=function(){this.videoWrapper_&&(this.videoWrapper_.release(),this.videoWrapper_=null),this.gapController_&&(this.gapController_.release(),this.gapController_=null),this.checkWindowTimer_&&(this.checkWindowTimer_.stop(),this.checkWindowTimer_=null),this.mediaElement_=this.videoWrapper_=this.timeline_=this.config_=null,this.onSeek_=function(){}},a.media.MediaSourcePlayhead.prototype.setStartTime=function(e){this.videoWrapper_.setTime(e)},a.media.MediaSourcePlayhead.prototype.getTime=function(){var e=this.videoWrapper_.getTime();return 0<this.mediaElement_.readyState&&!this.mediaElement_.paused?this.clampTime_(e):e},a.media.MediaSourcePlayhead.prototype.getStartTime_=function(e){return null==e?e=1/0>this.timeline_.getDuration()?this.timeline_.getSeekRangeStart():this.timeline_.getSeekRangeEnd():0>e&&(e=this.timeline_.getSeekRangeEnd()+e),this.clampSeekToDuration_(this.clampTime_(e))},a.media.MediaSourcePlayhead.prototype.notifyOfBufferingChange=function(){this.gapController_.onSegmentAppended()},a.media.MediaSourcePlayhead.prototype.onPollWindow_=function(){if(0!=this.mediaElement_.readyState&&!this.mediaElement_.paused){var e=this.mediaElement_.currentTime,t=this.timeline_.getSeekRangeStart(),r=this.timeline_.getSeekRangeEnd();r-t<this.minSeekRange_&&(t=r-this.minSeekRange_),e<t&&(t=this.reposition_(e),a.log.info("Jumping forward "+(t-e)+" seconds to catch up with the seek range."),this.mediaElement_.currentTime=t)}},a.media.MediaSourcePlayhead.prototype.onSeeking_=function(){this.gapController_.onSeeking();var e=this.videoWrapper_.getTime(),t=this.reposition_(e);if(Math.abs(t-e)>a.media.GapJumpingController.BROWSER_GAP_TOLERANCE){var r=(new Date).getTime()/1e3;if(!this.lastCorrectiveSeek_||this.lastCorrectiveSeek_<r-1)return this.lastCorrectiveSeek_=r,void this.videoWrapper_.setTime(t)}a.log.v1("Seek to "+e),this.onSeek_()},a.media.MediaSourcePlayhead.prototype.clampSeekToDuration_=function(e){var t=this.timeline_.getDuration();return e>=t?(o.asserts.assert(0<=this.config_.durationBackoff,"Duration backoff must be non-negative!"),t-this.config_.durationBackoff):e},a.media.MediaSourcePlayhead.prototype.reposition_=function(e){o.asserts.assert(this.config_,"Cannot reposition playhead when it has beeen destroyed");var t=a.media.TimeRangesUtils.isBuffered.bind(null,this.mediaElement_.buffered),r=Math.max(this.minBufferTime_,this.config_.rebufferingGoal),n=this.config_.safeSeekOffset,i=this.timeline_.getSeekRangeStart(),s=this.timeline_.getSeekRangeEnd(),l=this.timeline_.getDuration();s-i<this.minSeekRange_&&(i=s-this.minSeekRange_);var u=this.timeline_.getSafeSeekRangeStart(r),c=this.timeline_.getSafeSeekRangeStart(n);return r=this.timeline_.getSafeSeekRangeStart(r+n),e>=l?(a.log.v1("Playhead past duration."),this.clampSeekToDuration_(e)):e>s?(a.log.v1("Playhead past end."),s):e<i?t(c)?(a.log.v1("Playhead before start & start is buffered"),c):(a.log.v1("Playhead before start & start is unbuffered"),r):e>=u||t(e)?(a.log.v1("Playhead in safe region or in buffered region."),e):(a.log.v1("Playhead outside safe region & in unbuffered region."),r)},a.media.MediaSourcePlayhead.prototype.clampTime_=function(e){var t=this.timeline_.getSeekRangeStart();return e<t||e>(t=this.timeline_.getSeekRangeEnd())?t:e},a.media.MediaSourcePlayhead.prototype.createStallDetector_=function(e,t){if(!t.stallEnabled)return null;var r=t.stallThreshold,n=t.stallSkip;return(r=new a.media.StallDetector(new a.media.StallDetector.MediaElementImplementation(e),r)).onStall((function(t,r){a.log.debug(["Stall detected at",t,"for",r,"seconds. Seeking forward",n,"seconds."].join(" ")),e.currentTime+=n})),r},a.media.RegionTimeline=function(){this.onAddRegion_=function(e){},this.regions_=new Set},a.media.RegionTimeline.prototype.release=function(){this.onAddRegion_=function(e){},this.regions_.clear()},a.media.RegionTimeline.prototype.setListeners=function(e){this.onAddRegion_=e},a.media.RegionTimeline.prototype.addRegion=function(e){null==this.findSimilarRegion_(e)&&(this.regions_.add(e),this.onAddRegion_(e))},a.media.RegionTimeline.prototype.findSimilarRegion_=function(e){for(var t=i.makeIterator(this.regions_),r=t.next();!r.done;r=t.next())if((r=r.value).schemeIdUri==e.schemeIdUri&&r.id==e.id&&r.startTime==e.startTime&&r.endTime==e.endTime)return r;return null},a.media.RegionTimeline.prototype.regions=function(){return this.regions_},a.media.RegionObserver=function(e){var t=this;this.timeline_=e,this.oldPosition_=new Map,this.onEnter_=function(e,t){},this.onExit_=function(e,t){},this.onSkip_=function(e,t){};var r=a.media.RegionObserver.RelativePosition_;e=r.BEFORE_THE_REGION;var n=r.IN_THE_REGION;r=r.AFTER_THE_REGION,this.rules_=[{weWere:null,weAre:n,invoke:function(e,r){return t.onEnter_(e,r)}},{weWere:e,weAre:n,invoke:function(e,r){return t.onEnter_(e,r)}},{weWere:r,weAre:n,invoke:function(e,r){return t.onEnter_(e,r)}},{weWere:n,weAre:e,invoke:function(e,r){return t.onExit_(e,r)}},{weWere:n,weAre:r,invoke:function(e,r){return t.onExit_(e,r)}},{weWere:e,weAre:r,invoke:function(e,r){return t.onSkip_(e,r)}},{weWere:r,weAre:e,invoke:function(e,r){return t.onSkip_(e,r)}}]},a.media.RegionObserver.prototype.release=function(){this.timeline_=null,this.oldPosition_.clear(),this.onEnter_=function(e,t){},this.onExit_=function(e,t){},this.onSkip_=function(e,t){}},a.media.RegionObserver.prototype.poll=function(e,t){for(var r=a.media.RegionObserver,n=i.makeIterator(this.timeline_.regions()),o=n.next();!o.done;o=n.next()){o=o.value;var s=this.oldPosition_.get(o),l=r.determinePositionRelativeTo_(o,e);this.oldPosition_.set(o,l);for(var u=i.makeIterator(this.rules_),c=u.next();!c.done;c=u.next())(c=c.value).weWere==s&&c.weAre==l&&c.invoke(o,t)}},a.media.RegionObserver.prototype.setListeners=function(e,t,r){this.onEnter_=e,this.onExit_=t,this.onSkip_=r},a.media.RegionObserver.determinePositionRelativeTo_=function(e,t){var r=a.media.RegionObserver.RelativePosition_;return t<e.startTime?r.BEFORE_THE_REGION:t>e.endTime?r.AFTER_THE_REGION:r.IN_THE_REGION},a.media.RegionObserver.RelativePosition_={BEFORE_THE_REGION:1,IN_THE_REGION:2,AFTER_THE_REGION:3},a.media.StreamingEngine=function(e,t){this.playerInterface_=t,this.manifest_=e,this.config_=null,this.bufferingGoalScale_=1,this.setupPeriodPromise_=Promise.resolve(),this.canSwitchPeriod_=[],this.canSwitchStream_=new Map,this.mediaStates_=new Map,this.startupComplete_=!1,this.failureCallbackBackoff_=null,this.unloadingTextStream_=this.destroyed_=this.fatalError_=!1,this.textStreamSequenceId_=0},a.media.StreamingEngine.APPEND_WINDOW_START_FUDGE_=.1,a.media.StreamingEngine.APPEND_WINDOW_END_FUDGE_=.01,a.media.StreamingEngine.MAX_RUN_AHEAD_SEGMENTS_=1,a.media.StreamingEngine.prototype.destroy=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var r,n;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:r=[];for(var o=i.makeIterator(e.mediaStates_.values()),a=o.next();!a.done;a=o.next())n=a.value,e.cancelUpdate_(n),r.push(e.abortOperations_(n));return t.yield(Promise.all(r),2);case 2:e.mediaStates_.clear(),e.canSwitchStream_.clear(),e.playerInterface_=null,e.manifest_=null,e.setupPeriodPromise_=null,e.canSwitchPeriod_=null,e.config_=null,e.destroyed_=!0,t.jumpToEnd()}}))}))},a.media.StreamingEngine.prototype.configure=function(e){this.config_=e,this.failureCallbackBackoff_=new a.net.Backoff({maxAttempts:Math.max(e.retryParameters.maxAttempts,2),baseDelay:e.retryParameters.baseDelay,backoffFactor:e.retryParameters.backoffFactor,fuzzFactor:e.retryParameters.fuzzFactor,timeout:0},!0)},a.media.StreamingEngine.prototype.start=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var r,n,s;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return o.asserts.assert(e.config_,"StreamingEngine configure() must be called before init()!"),r=e.playerInterface_.getPresentationTime(),n=e.findPeriodForTime_(r),(s=e.playerInterface_.onChooseStreams(e.manifest_.periods[n])).variant||s.text?t.yield(e.initStreams_(s.variant?s.variant.audio:null,s.variant?s.variant.video:null,s.text,r),2):(a.log.error("init: no Streams chosen"),t.return(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STREAMING,a.util.Error.Code.INVALID_STREAMS_CHOSEN)));case 2:if(e.destroyed_)return t.return();a.log.debug("init: completed initial Stream setup"),e.playerInterface_&&e.playerInterface_.onInitialStreamsSetup&&(a.log.v1("init: calling onInitialStreamsSetup()..."),e.playerInterface_.onInitialStreamsSetup()),t.jumpToEnd()}}))}))},a.media.StreamingEngine.prototype.getBufferingPeriod=function(){var e=a.util.ManifestParserUtils.ContentType,t=this.mediaStates_.get(e.VIDEO);return t?this.manifest_.periods[t.needPeriodIndex]:(e=this.mediaStates_.get(e.AUDIO))?this.manifest_.periods[e.needPeriodIndex]:null},a.media.StreamingEngine.prototype.getBufferingAudio=function(){return this.getStream_(a.util.ManifestParserUtils.ContentType.AUDIO)},a.media.StreamingEngine.prototype.getBufferingVideo=function(){return this.getStream_(a.util.ManifestParserUtils.ContentType.VIDEO)},a.media.StreamingEngine.prototype.getBufferingText=function(){return this.getStream_(a.util.ManifestParserUtils.ContentType.TEXT)},a.media.StreamingEngine.prototype.getStream_=function(e){return(e=this.mediaStates_.get(e))?e.restoreStreamAfterTrickPlay||e.stream:null},a.media.StreamingEngine.prototype.loadNewTextStream=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){var n,o,s,l,u,c,d,p,f;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return n=a.util.ManifestParserUtils.ContentType,r.yield(t.playerInterface_.mediaSourceEngine.clear(n.TEXT),2);case 2:return t.textStreamSequenceId_++,t.unloadingTextStream_=!1,o=t.textStreamSequenceId_,s=t.playerInterface_.mediaSourceEngine,l=new Map,u=new Set,l.set(n.TEXT,e),u.add(e),r.yield(s.init(l,!1),3);case 3:return t.destroyed_?r.return():r.yield(t.setupStreams_(u),4);case 4:if(t.destroyed_)return r.return();c=t.playerInterface_.mediaSourceEngine.getTextDisplayer().isTextVisible()||t.config_.alwaysStreamText,t.textStreamSequenceId_!=o||t.mediaStates_.has(n.TEXT)||t.unloadingTextStream_||!c||(d=t.playerInterface_.getPresentationTime(),p=t.findPeriodForTime_(d),f=t.createMediaState_(e,p,0),t.mediaStates_.set(n.TEXT,f),t.scheduleUpdate_(f,0)),r.jumpToEnd()}}))}))},a.media.StreamingEngine.prototype.unloadTextStream=function(){var e=a.util.ManifestParserUtils.ContentType;this.unloadingTextStream_=!0;var t=this.mediaStates_.get(e.TEXT);t&&(this.cancelUpdate_(t),this.abortOperations_(t).catch((function(){})),this.mediaStates_.delete(e.TEXT))},a.media.StreamingEngine.prototype.setTrickPlay=function(e){var t=this.mediaStates_.get(a.util.ManifestParserUtils.ContentType.VIDEO);if(t){var r=t.stream;r&&(a.log.debug("setTrickPlay",e),e?(e=r.trickModeVideo)&&!t.restoreStreamAfterTrickPlay&&(a.log.debug("Engaging trick mode stream",e),this.switchInternal_(e,!1,0,!1),t.restoreStreamAfterTrickPlay=r):(r=t.restoreStreamAfterTrickPlay)&&(a.log.debug("Restoring non-trick-mode stream",r),t.restoreStreamAfterTrickPlay=null,this.switchInternal_(r,!0,0,!1)))}},a.media.StreamingEngine.prototype.switchVariant=function(e,t,r){var n=!1;if(e.video){var i=this.switchInternal_(e.video,t,r,!1);n=n||i}return e.audio&&(e=this.switchInternal_(e.audio,t,r,!1),n=n||e),n},a.media.StreamingEngine.prototype.switchTextStream=function(e){var t=a.util.ManifestParserUtils.ContentType;return o.asserts.assert(e&&e.type==t.TEXT,"Wrong stream type passed to switchTextStream!"),this.switchInternal_(e,!0,0,!1)},a.media.StreamingEngine.prototype.reloadTextStream=function(){var e=this.mediaStates_.get(a.util.ManifestParserUtils.ContentType.TEXT);e&&this.switchInternal_(e.stream,!0,0,!0)},a.media.StreamingEngine.prototype.switchInternal_=function(e,t,r,n){var i=this,s=a.util.ManifestParserUtils.ContentType,l=this.mediaStates_.get(e.type);if(!l&&e.type==s.TEXT&&this.config_.ignoreTextStreamFailures)return this.loadNewTextStream(e),!0;if(o.asserts.assert(l,"switch: expected mediaState to exist"),!l)return!1;var u=this.findPeriodContainingStream_(e),c=Array.from(this.mediaStates_.values()).every((function(e){return e.needPeriodIndex==l.needPeriodIndex}));return t&&u!=l.needPeriodIndex&&c?(a.log.debug("switch: switching to stream in another Period; clearing buffer and changing Periods"),this.mediaStates_.forEach((function(e){i.forceClearBuffer_(e)})),!0):(l.restoreStreamAfterTrickPlay&&(a.log.debug("switch during trick play mode",e),e.trickModeVideo?(l.restoreStreamAfterTrickPlay=e,e=e.trickModeVideo,a.log.debug("switch found trick play stream",e)):(l.restoreStreamAfterTrickPlay=null,a.log.debug("switch found no special trick play stream"))),c=this.canSwitchPeriod_[u],o.asserts.assert(c&&c.resolved,"switch: expected Period "+u+" to be ready"),!(!c||!c.resolved)&&(c=this.canSwitchStream_.get(e.id),o.asserts.assert(c&&c.resolved,"switch: expected Stream "+e.id+" to be ready"),!(!c||!c.resolved)&&(l.stream!=e||n?(e.type==s.TEXT&&(n=a.util.MimeUtils.getFullType(e.mimeType,e.codecs),this.playerInterface_.mediaSourceEngine.reinitText(n)),l.stream=e,l.needInitSegment=!0,e=a.media.StreamingEngine.logPrefix_(l),a.log.debug("switch: switching to Stream "+e),this.shouldAbortCurrentRequest_(l,u)&&(a.log.info("Aborting current segment request to switch."),l.operation.abort()),t&&(l.clearingBuffer?l.waitingToFlushBuffer=!0:l.performingUpdate?(l.waitingToClearBuffer=!0,l.clearBufferSafeMargin=r,l.waitingToFlushBuffer=!0):(this.cancelUpdate_(l),this.clearBuffer_(l,!0,r).catch((function(e){i.playerInterface_&&i.playerInterface_.onError(e)})))),!0):(t=a.media.StreamingEngine.logPrefix_(l),a.log.debug("switch: Stream "+t+" already active"),!1))))},a.media.StreamingEngine.prototype.shouldAbortCurrentRequest_=function(e,t){if(!e.operation)return!1;var r=this.playerInterface_.getPresentationTime(),n=this.playerInterface_.mediaSourceEngine.bufferEnd(e.type),i=this.getSegmentReferenceNeeded_(e,r,n,t),o=i?i.getSize():null;return i&&!o&&(o=(i.getEndTime()-i.getStartTime())*e.stream.bandwidth/8),!isNaN(o)&&((i=e.stream.initSegmentReference)&&(o+=i.getSize()||0),8*o/(i=this.playerInterface_.getBandwidthEstimate())<n-r-Math.max(this.manifest_.minBufferTime||0,this.config_.rebufferingGoal)||e.operation.getBytesRemaining()>o)},a.media.StreamingEngine.prototype.seeked=function(){var e=this,t=a.util.Iterables,r=this.playerInterface_.getPresentationTime(),n=this.config_.smallGapLimit,o=function(t){return e.playerInterface_.mediaSourceEngine.isBuffered(t,r,n)},s=!1,l=this.findPeriodForTime_(r);if(t.every(this.mediaStates_.values(),(function(e){return e.needPeriodIndex==l})))for(var u=(t=i.makeIterator(this.mediaStates_.keys())).next();!u.done;u=t.next())o(u=u.value)||(this.forceClearBuffer_(this.mediaStates_.get(u)),s=!0);else t.every(this.mediaStates_.keys(),o)||(a.log.debug("(all): seeked: unbuffered seek: clearing all buffers"),this.mediaStates_.forEach((function(t){e.forceClearBuffer_(t)})),s=!0);s||a.log.debug("(all): seeked: buffered seek: presentationTime="+r)},a.media.StreamingEngine.prototype.forceClearBuffer_=function(e){var t=this,r=a.media.StreamingEngine.logPrefix_(e);e.clearingBuffer?a.log.debug(r,"clear: already clearing the buffer"):e.waitingToClearBuffer?a.log.debug(r,"clear: already waiting"):e.performingUpdate?(a.log.debug(r,"clear: currently updating"),e.waitingToClearBuffer=!0,e.clearBufferSafeMargin=0):null==this.playerInterface_.mediaSourceEngine.bufferStart(e.type)?(a.log.debug(r,"clear: nothing buffered"),null==e.updateTimer&&this.scheduleUpdate_(e,0)):(a.log.debug(r,"clear: handling right now"),this.cancelUpdate_(e),this.clearBuffer_(e,!1,0).catch((function(e){t.playerInterface_&&t.playerInterface_.onError(e)})))},a.media.StreamingEngine.prototype.initStreams_=function(e,t,r,n){var s=this;return i.asyncExecutePromiseGeneratorFunction((function l(){var u,c,d,p,f,h,m;return i.generator.createGenerator(l,(function(i){switch(i.nextAddress){case 1:return o.asserts.assert(s.config_,"StreamingEngine configure() must be called before init()!"),u=s.playerInterface_.getPresentationTime(),c=s.findPeriodForTime_(u),d=a.util.ManifestParserUtils.ContentType,p=new Map,f=new Set,e&&(p.set(d.AUDIO,e),f.add(e)),t&&(p.set(d.VIDEO,t),f.add(t)),r&&(p.set(d.TEXT,r),f.add(r)),h=s.playerInterface_.mediaSourceEngine,m=s.config_.forceTransmuxTS,i.yield(h.init(p,m),2);case 2:return s.destroyed_?i.return():(s.setDuration_(),i.yield(s.setupStreams_(f),3));case 3:if(s.destroyed_)return i.return();p.forEach((function(e,t){if(!s.mediaStates_.has(t)){var r=s.createMediaState_(e,c,n);s.mediaStates_.set(t,r),s.scheduleUpdate_(r,0)}})),i.jumpToEnd()}}))}))},a.media.StreamingEngine.prototype.createMediaState_=function(e,t,r){return{stream:e,type:e.type,lastStream:null,lastSegmentReference:null,restoreStreamAfterTrickPlay:null,needInitSegment:!0,needPeriodIndex:t,endOfStream:!1,performingUpdate:!1,updateTimer:null,waitingToClearBuffer:!1,clearBufferSafeMargin:0,waitingToFlushBuffer:!1,clearingBuffer:!1,recovering:!1,hasError:!1,resumeAt:r||0,operation:null}},a.media.StreamingEngine.prototype.setupPeriod_=function(e){var t=this.canSwitchPeriod_[e];if(t)return a.log.debug("(all) Period "+e+" is being or has been set up"),o.asserts.assert(t.promise,"promise must not be null"),t.promise;a.log.debug("(all) setting up Period "+e),t={promise:new a.util.PublicPromise,resolved:!1},this.canSwitchPeriod_[e]=t;for(var r=new Set,n=i.makeIterator(this.manifest_.periods[e].variants),s=n.next();!s.done;s=n.next())(s=s.value).video&&r.add(s.video),s.video&&s.video.trickModeVideo&&r.add(s.video.trickModeVideo),s.audio&&r.add(s.audio);for(s=(n=i.makeIterator(this.manifest_.periods[e].textStreams)).next();!s.done;s=n.next())r.add(s.value);return this.setupPeriodPromise_=this.setupPeriodPromise_.then(function(){if(!this.destroyed_)return this.setupStreams_(r)}.bind(this)).then(function(){this.destroyed_||(this.canSwitchPeriod_[e].promise.resolve(),this.canSwitchPeriod_[e].resolved=!0,a.log.v1("(all) setup Period "+e))}.bind(this)).catch(function(t){this.destroyed_||(this.canSwitchPeriod_[e].promise.catch((function(){})),this.canSwitchPeriod_[e].promise.reject(),delete this.canSwitchPeriod_[e],a.log.warning("(all) failed to setup Period "+e),this.playerInterface_.onError(t))}.bind(this)),t.promise},a.media.StreamingEngine.prototype.setupStreams_=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){var n,o,s,l,u,c,d;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:n=[];for(var p=i.makeIterator(e),f=p.next();!f.done;f=p.next())o=f.value,(s=t.canSwitchStream_.get(o.id))?(a.log.debug("(all) Stream "+o.id+" is being or has been set up"),n.push(s.promise)):(a.log.v1("(all) setting up Stream "+o.id),t.canSwitchStream_.set(o.id,{promise:new a.util.PublicPromise,resolved:!1}),n.push(o.createSegmentIndex()));return r.setCatchFinallyBlocks(2),r.yield(Promise.all(n),4);case 4:if(t.destroyed_)return r.return();r.leaveTryBlock(3);break;case 2:if(l=r.enterCatchBlock(),t.destroyed_)return r.return();for(f=(r=i.makeIterator(e)).next();!f.done;f=r.next())u=f.value,t.canSwitchStream_.get(u.id).promise.catch((function(){})),t.canSwitchStream_.get(u.id).promise.reject(),t.canSwitchStream_.delete(u.id);throw l;case 3:for(f=(p=i.makeIterator(e)).next();!f.done;f=p.next())c=f.value,(d=t.canSwitchStream_.get(c.id)).resolved||(d.promise.resolve(),d.resolved=!0,a.log.v1("(all) setup Stream "+c.id));r.jumpToEnd()}}))}))},a.media.StreamingEngine.prototype.setDuration_=function(){var e=this.manifest_.presentationTimeline.getDuration();1/0>e?this.playerInterface_.mediaSourceEngine.setDuration(e):this.playerInterface_.mediaSourceEngine.setDuration(Math.pow(2,32))},a.media.StreamingEngine.prototype.onUpdate_=function(e){if(!this.destroyed_){var t=a.media.StreamingEngine.logPrefix_(e);if(o.asserts.assert(!e.performingUpdate&&null!=e.updateTimer,t+" unexpected call to onUpdate_()"),!e.performingUpdate&&null!=e.updateTimer&&(o.asserts.assert(!e.clearingBuffer,t+" onUpdate_() should not be called when clearing the buffer"),!e.clearingBuffer))if(e.updateTimer=null,e.waitingToClearBuffer)a.log.debug(t,"skipping update and clearing the buffer"),this.clearBuffer_(e,e.waitingToFlushBuffer,e.clearBufferSafeMargin);else{try{var r=this.update_(e);null!=r&&(this.scheduleUpdate_(e,r),e.hasError=!1)}catch(e){return void this.handleStreamingError_(e)}r=Array.from(this.mediaStates_.values()),this.handlePeriodTransition_(e),this.startupComplete_&&r.every((function(e){return e.endOfStream}))&&(a.log.v1(t,"calling endOfStream()..."),this.playerInterface_.mediaSourceEngine.endOfStream().then(function(){if(!this.destroyed_){var e=this.playerInterface_.mediaSourceEngine.getDuration();0!=e&&e<this.manifest_.presentationTimeline.getDuration()&&this.manifest_.presentationTimeline.setDuration(e)}}.bind(this)))}}},a.media.StreamingEngine.prototype.update_=function(e){var t=this;o.asserts.assert(this.manifest_,"manifest_ should not be null"),o.asserts.assert(this.config_,"config_ should not be null");var r=a.util.ManifestParserUtils.ContentType;if(a.media.StreamingEngine.isEmbeddedText_(e))return this.playerInterface_.mediaSourceEngine.setSelectedClosedCaptionId(e.stream.originalId||""),null;var n=a.media.StreamingEngine.logPrefix_(e),i=this.playerInterface_.getPresentationTime(),s=this.getTimeNeeded_(e,i);a.log.v2(n,"timeNeeded="+s);var l=this.findPeriodContainingStream_(e.stream),u=this.findPeriodForTime_(s),c=this.playerInterface_.mediaSourceEngine.bufferedAheadOf(e.type,i);a.log.v2(n,"update_:","presentationTime="+i,"bufferedAhead="+c);var d=Math.max(this.manifest_.minBufferTime||0,this.config_.rebufferingGoal,this.config_.bufferingGoal)*this.bufferingGoalScale_;if(s>=this.manifest_.presentationTimeline.getDuration())return a.log.debug(n,"buffered to end of presentation"),e.endOfStream=!0,e.type==r.VIDEO&&(e=this.mediaStates_.get(r.TEXT))&&e.stream.mimeType==a.util.MimeUtils.CLOSED_CAPTION_MIMETYPE&&(e.endOfStream=!0),null;if(e.endOfStream=!1,e.needPeriodIndex=u,u!=l)return a.log.debug(n,"need Period "+u,"presentationTime="+i,"timeNeeded="+s,"currentPeriodIndex="+l),null;if(c>=d)return a.log.v2(n,"buffering goal met"),.5;if(r=this.playerInterface_.mediaSourceEngine.bufferEnd(e.type),!(r=this.getSegmentReferenceNeeded_(e,i,r,l)))return 1;var p=1/0;return Array.from(this.mediaStates_.values()).forEach((function(e){a.media.StreamingEngine.isEmbeddedText_(e)||(e=t.getTimeNeeded_(e,i),p=Math.min(p,e))})),n=this.manifest_.presentationTimeline.getMaxSegmentDuration()*a.media.StreamingEngine.MAX_RUN_AHEAD_SEGMENTS_,s>=p+n?1:(e.resumeAt=0,this.fetchAndAppend_(e,i,l,r),null)},a.media.StreamingEngine.prototype.getTimeNeeded_=function(e,t){if(!e.lastStream||!e.lastSegmentReference)return Math.max(t,e.resumeAt);var r=this.findPeriodContainingStream_(e.lastStream);return this.manifest_.periods[r].startTime+e.lastSegmentReference.endTime},a.media.StreamingEngine.prototype.getSegmentReferenceNeeded_=function(e,t,r,n){var i=a.media.StreamingEngine.logPrefix_(e);return e.lastSegmentReference&&e.stream==e.lastStream?(r=e.lastSegmentReference.position+1,a.log.v2(i,"next position known:","position="+r),this.getSegmentReferenceIfAvailable_(e,n,r)):(e.lastSegmentReference?(o.asserts.assert(e.lastStream,"lastStream should not be null"),a.log.v1(i,"next position unknown: another Stream buffered"),i=this.findPeriodContainingStream_(e.lastStream),i=this.lookupSegmentPosition_(e,this.manifest_.periods[i].startTime+e.lastSegmentReference.endTime,n)):(o.asserts.assert(!e.lastStream,"lastStream should be null"),a.log.v1(i,"next position unknown: nothing buffered"),i=this.lookupSegmentPosition_(e,r||t,n)),null==i?null:(t=null,null==r&&(t=this.getSegmentReferenceIfAvailable_(e,n,Math.max(0,i-1))),t||this.getSegmentReferenceIfAvailable_(e,n,i)))},a.media.StreamingEngine.prototype.lookupSegmentPosition_=function(e,t,r){var n=a.media.StreamingEngine.logPrefix_(e);return r=this.manifest_.periods[r],a.log.debug(n,"looking up segment:","presentationTime="+t,"currentPeriod.startTime="+r.startTime),t=Math.max(0,t-r.startTime),null==(e=e.stream.findSegmentPosition(t))&&a.log.warning(n,"cannot find segment:","currentPeriod.startTime="+r.startTime,"lookupTime="+t),e},a.media.StreamingEngine.prototype.getSegmentReferenceIfAvailable_=function(e,t,r){var n=a.media.StreamingEngine.logPrefix_(e);if(t=this.manifest_.periods[t],!(e=e.stream.getSegmentReference(r)))return a.log.v1(n,"segment does not exist:","currentPeriod.startTime="+t.startTime,"position="+r),null;var i=this.manifest_.presentationTimeline;return r=i.getSegmentAvailabilityStart(),i=i.getSegmentAvailabilityEnd(),t.startTime+e.endTime<r||t.startTime+e.startTime>i?(a.log.v2(n,"segment is not available:","currentPeriod.startTime="+t.startTime,"reference.startTime="+e.startTime,"reference.endTime="+e.endTime,"availabilityStart="+r,"availabilityEnd="+i),null):e},a.media.StreamingEngine.prototype.fetchAndAppend_=function(e,t,r,n){var i=a.util.ManifestParserUtils.ContentType,s=a.media.StreamingEngine,l=s.logPrefix_(e),u=this.manifest_.periods[r];a.log.v1(l,"fetchAndAppend_:","presentationTime="+t,"currentPeriod.startTime="+u.startTime,"reference.position="+n.position,"reference.startTime="+n.startTime,"reference.endTime="+n.endTime);var c=e.stream,d=this.manifest_.presentationTimeline.getDuration(),p=this.manifest_.periods[r+1],f=Math.max(0,u.startTime-s.APPEND_WINDOW_START_FUDGE_);s=p?p.startTime+s.APPEND_WINDOW_END_FUDGE_:d,o.asserts.assert(n.startTime<=s,l+" segment should start before append window end"),r=this.initSourceBuffer_(e,r,f,s),e.performingUpdate=!0,e.needInitSegment=!1,a.log.v2(l,"fetching segment"),f=this.fetch_(e,n),Promise.all([r,f]).then(function(r){if(!this.destroyed_&&!this.fatalError_)return this.append_(e,t,u,c,n,r[1])}.bind(this)).then(function(){this.destroyed_||this.fatalError_||(e.performingUpdate=!1,e.recovering=!1,e.waitingToClearBuffer||this.playerInterface_.onSegmentAppended(),this.scheduleUpdate_(e,0),this.handleStartup_(e,c),a.log.v1(l,"finished fetch and append"))}.bind(this)).catch(function(t){this.destroyed_||this.fatalError_||(o.asserts.assert(t instanceof a.util.Error,"Should only receive a Shaka error"),e.performingUpdate=!1,e.type==i.TEXT&&this.config_.ignoreTextStreamFailures?(t.code==a.util.Error.Code.BAD_HTTP_STATUS?a.log.warning(l,"Text stream failed to download. Proceeding without it."):a.log.warning(l,"Text stream failed to parse. Proceeding without it."),this.mediaStates_.delete(i.TEXT)):t.code==a.util.Error.Code.OPERATION_ABORTED?(e.performingUpdate=!1,e.updateTimer=null,this.scheduleUpdate_(e,0)):t.code==a.util.Error.Code.QUOTA_EXCEEDED_ERROR?this.handleQuotaExceeded_(e,t):(a.log.error(l,"failed fetch and append: code="+t.code),e.hasError=!0,t.severity=a.util.Error.Severity.CRITICAL,this.handleStreamingError_(t)))}.bind(this))},a.media.StreamingEngine.prototype.retry=function(){if(this.destroyed_)return a.log.error("Unable to retry after StreamingEngine is destroyed!"),!1;if(this.fatalError_)return a.log.error("Unable to retry after StreamingEngine encountered a fatal error!"),!1;for(var e=i.makeIterator(this.mediaStates_.values()),t=e.next();!t.done;t=e.next()){t=t.value;var r=a.media.StreamingEngine.logPrefix_(t);t.hasError&&(a.log.info(r,"Retrying after failure..."),t.hasError=!1,this.scheduleUpdate_(t,.1))}return!0},a.media.StreamingEngine.prototype.handleQuotaExceeded_=function(e,t){var r=a.media.StreamingEngine.logPrefix_(e);if(Array.from(this.mediaStates_.values()).some((function(t){return t!=e&&t.recovering})))a.log.debug(r,"MediaSource threw QuotaExceededError:","waiting for another stream to recover...");else{var n=Math.round(100*this.bufferingGoalScale_);if(20<n)this.bufferingGoalScale_-=.2;else{if(!(4<n))return a.log.error(r,"MediaSource threw QuotaExceededError too many times"),this.fatalError_=e.hasError=!0,void this.playerInterface_.onError(t);this.bufferingGoalScale_-=.04}a.log.warning(r,"MediaSource threw QuotaExceededError:","reducing buffering goals by "+(100-Math.round(100*this.bufferingGoalScale_))+"%"),e.recovering=!0}this.scheduleUpdate_(e,4)},a.media.StreamingEngine.prototype.initSourceBuffer_=function(e,t,r,n){if(!e.needInitSegment)return Promise.resolve();var i=a.media.StreamingEngine.logPrefix_(e);return t=this.manifest_.periods[t].startTime-e.stream.presentationTimeOffset,a.log.v1(i,"setting timestamp offset to "+t),a.log.v1(i,"setting append window start to "+r),a.log.v1(i,"setting append window end to "+n),r=this.playerInterface_.mediaSourceEngine.setStreamProperties(e.type,t,r,n),e.stream.initSegmentReference?(a.log.v1(i,"fetching init segment"),n=this.fetch_(e,e.stream.initSegmentReference).then(function(t){if(!this.destroyed_)return a.log.v1(i,"appending init segment"),this.playerInterface_.mediaSourceEngine.appendBuffer(e.type,t,null,null,e.stream.closedCaptions&&0<e.stream.closedCaptions.size)}.bind(this)).catch((function(t){return e.needInitSegment=!0,Promise.reject(t)})),Promise.all([r,n])):r},a.media.StreamingEngine.prototype.append_=function(e,t,r,n,i,o){var s=a.media.StreamingEngine.logPrefix_(e),l=n.closedCaptions&&0<n.closedCaptions.size;return null!=n.emsgSchemeIdUris&&0<n.emsgSchemeIdUris.length&&(new a.util.Mp4Parser).fullBox("emsg",this.parseEMSG_.bind(this,r,i,n.emsgSchemeIdUris)).parse(o),this.evict_(e,t).then(function(){if(!this.destroyed_)return a.log.v1(s,"appending media segment"),this.playerInterface_.mediaSourceEngine.appendBuffer(e.type,o,i.startTime+r.startTime,i.endTime+r.startTime,l)}.bind(this)).then(function(){if(!this.destroyed_)return a.log.v2(s,"appended media segment"),e.lastStream=n,e.lastSegmentReference=i,Promise.resolve()}.bind(this))},a.media.StreamingEngine.prototype.parseEMSG_=function(e,t,r,n){var i=n.reader.readTerminatedString(),o=n.reader.readTerminatedString(),s=n.reader.readUint32(),l=n.reader.readUint32(),u=n.reader.readUint32(),c=n.reader.readUint32();n=n.reader.readBytes(n.reader.getLength()-n.reader.getPosition()),e=e.startTime+t.startTime+l/s,r.includes(i)&&("urn:mpeg:dash:event:2012"==i?this.playerInterface_.onManifestUpdate():(r=new a.util.FakeEvent("emsg",{detail:{startTime:e,endTime:e+u/s,schemeIdUri:i,value:o,timescale:s,presentationTimeDelta:l,eventDuration:u,id:c,messageData:n}}),this.playerInterface_.onEvent(r)))},a.media.StreamingEngine.prototype.evict_=function(e,t){var r=a.media.StreamingEngine.logPrefix_(e);a.log.v2(r,"checking buffer length");var n=Math.max(this.config_.bufferBehind,this.manifest_.presentationTimeline.getMaxSegmentDuration()),i=this.playerInterface_.mediaSourceEngine.bufferStart(e.type);if(null==i)return a.log.v2(r,"buffer behind okay because nothing buffered:","presentationTime="+t,"bufferBehind="+n),Promise.resolve();var o=t-i,s=o-n;return 0>=s?(a.log.v2(r,"buffer behind okay:","presentationTime="+t,"bufferedBehind="+o,"bufferBehind="+n,"underflow="+-s),Promise.resolve()):(a.log.v1(r,"buffer behind too large:","presentationTime="+t,"bufferedBehind="+o,"bufferBehind="+n,"overflow="+s),this.playerInterface_.mediaSourceEngine.remove(e.type,i,i+s).then(function(){this.destroyed_||a.log.v1(r,"evicted "+s+" seconds")}.bind(this)))},a.media.StreamingEngine.prototype.handleStartup_=function(e,t){var r=a.util.Functional,n=a.util.ManifestParserUtils.ContentType;if(!this.startupComplete_){var i=a.media.StreamingEngine.logPrefix_(e),s=Array.from(this.mediaStates_.values());if(1==s.length&&s[0].type==n.TEXT||(this.startupComplete_=s.every((function(e){return e.type==n.TEXT||!e.waitingToClearBuffer&&!e.clearingBuffer&&e.lastSegmentReference}))),this.startupComplete_){a.log.debug(i,"startup complete");var l=this.findPeriodContainingStream_(t);for(o.asserts.assert(s.every((function(e){return e.needPeriodIndex==l||e.needPeriodIndex==l+1})),i+" expected all MediaStates to need same Period"),this.canSwitchPeriod_[l]||this.setupPeriod_(l).then(function(){this.destroyed_||(a.log.v1(i,"calling onCanSwitch()..."),this.playerInterface_.onCanSwitch())}.bind(this)).catch(r.noop),s=0;s<this.manifest_.periods.length;++s)this.setupPeriod_(s).catch(r.noop);this.playerInterface_.onStartupComplete&&(a.log.v1(i,"calling onStartupComplete()..."),this.playerInterface_.onStartupComplete())}}},a.media.StreamingEngine.prototype.handlePeriodTransition_=function(e){var t=a.util.Functional,r=a.media.StreamingEngine.logPrefix_(e),n=a.util.ManifestParserUtils.ContentType,s=this.findPeriodContainingStream_(e.stream);if(e.needPeriodIndex!=s){var l=e.needPeriodIndex,u=Array.from(this.mediaStates_.values());o.asserts.assert(u.every((function(e){return e.needPeriodIndex==l||e.hasError||!a.media.StreamingEngine.isIdle_(e)||a.media.StreamingEngine.isEmbeddedText_(e)})),"All MediaStates should need the same Period or be performing updates."),u.every((function(e){return e.needPeriodIndex==l||a.media.StreamingEngine.isEmbeddedText_(e)}))?u.every(a.media.StreamingEngine.isIdle_)?(a.log.debug(r,"all need Period "+l),this.setupPeriod_(l).then(function(){if(!this.destroyed_)if(u.every(function(e){var t=a.media.StreamingEngine.isIdle_(e),r=this.findPeriodContainingStream_(e.stream);return!!a.media.StreamingEngine.isEmbeddedText_(e)||t&&e.needPeriodIndex==l&&r!=l}.bind(this))){var e=this.manifest_.periods[l];a.log.v1(r,"calling onChooseStreams()...");var t=this.playerInterface_.onChooseStreams(e),s=new Map;t.variant&&t.variant.video&&s.set(n.VIDEO,t.variant.video),t.variant&&t.variant.audio&&s.set(n.AUDIO,t.variant.audio),t.text&&s.set(n.TEXT,t.text);for(var c=(t=i.makeIterator(this.mediaStates_.keys())).next();!c.done;c=t.next())if(c=c.value,!s.has(c)&&c!=n.TEXT)return a.log.error(r,"invalid Streams chosen: missing "+c+" Stream"),void this.playerInterface_.onError(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STREAMING,a.util.Error.Code.INVALID_STREAMS_CHOSEN));for(c=(t=i.makeIterator(Array.from(s.keys()))).next();!c.done;c=t.next())if(c=c.value,!this.mediaStates_.has(c)){if(c!=n.TEXT)return a.log.error(r,"invalid Streams chosen: unusable "+c+" Stream"),void this.playerInterface_.onError(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STREAMING,a.util.Error.Code.INVALID_STREAMS_CHOSEN));this.initStreams_(null,null,s.get(n.TEXT),e.startTime),s.delete(c)}for(c=(t=i.makeIterator(Array.from(this.mediaStates_.keys()))).next();!c.done;c=t.next()){c=c.value;var d=this.mediaStates_.get(c),p=s.get(c);if(p){var f=a.media.StreamingEngine.isEmbeddedText_(d);f&&(d.needPeriodIndex=l,d.resumeAt=e.startTime),this.switchInternal_(p,!1,0,!1),f&&a.media.StreamingEngine.isEmbeddedText_(d)||this.scheduleUpdate_(this.mediaStates_.get(c),0)}else o.asserts.assert(c==n.TEXT,"Invalid streams chosen"),this.mediaStates_.delete(c)}a.log.v1(r,"calling onCanSwitch()..."),this.playerInterface_.onCanSwitch()}else a.log.debug(r,"ignoring transition to Period",l,"since another is happening")}.bind(this)).catch(t.noop)):a.log.debug(r,"all MediaStates need Period "+l+", but not all MediaStates are idle"):a.log.debug(r,"not all MediaStates need Period "+l)}},a.media.StreamingEngine.isEmbeddedText_=function(e){var t=a.util.MimeUtils;return e&&e.type==a.util.ManifestParserUtils.ContentType.TEXT&&e.stream.mimeType==t.CLOSED_CAPTION_MIMETYPE},a.media.StreamingEngine.isIdle_=function(e){return!e.performingUpdate&&null==e.updateTimer&&!e.waitingToClearBuffer&&!e.clearingBuffer},a.media.StreamingEngine.prototype.findPeriodForTime_=function(e){return(e=a.util.Periods.findPeriodForTime(this.manifest_.periods,e+a.util.ManifestParserUtils.GAP_OVERLAP_TOLERANCE_SECONDS))?this.manifest_.periods.indexOf(e):0},a.media.StreamingEngine.prototype.findPeriodContainingStream_=function(e){o.asserts.assert(this.manifest_,"Must have a manifest to find a stream.");for(var t=this.manifest_.periods,r=0;r<t.length;r++){for(var n=t[r],a=new Set,s=i.makeIterator(n.variants),l=s.next();!l.done;l=s.next())(l=l.value).audio&&a.add(l.audio),l.video&&a.add(l.video),l.video&&l.video.trickModeVideo&&a.add(l.video.trickModeVideo);for(s=(n=i.makeIterator(n.textStreams)).next();!s.done;s=n.next())a.add(s.value);if(a.has(e))return r}return-1},a.media.StreamingEngine.prototype.fetch_=function(e,t){var r=a.net.NetworkingEngine.RequestType.SEGMENT,n=a.util.Networking.createSegmentRequest(t.getUris(),t.startByte,t.endByte,this.config_.retryParameters);return a.log.v2("fetching: reference=",t),r=this.playerInterface_.netEngine.request(r,n),e.operation=r,r.promise.then((function(t){return e.operation=null,t.data}))},a.media.StreamingEngine.prototype.clearBuffer_=function(e,t,r){var n=this;return i.asyncExecutePromiseGeneratorFunction((function s(){var l,u,c,d;return i.generator.createGenerator(s,(function(i){switch(i.nextAddress){case 1:return l=a.media.StreamingEngine.logPrefix_(e),o.asserts.assert(!e.performingUpdate&&null==e.updateTimer,l+" unexpected call to clearBuffer_()"),e.waitingToClearBuffer=!1,e.waitingToFlushBuffer=!1,e.clearBufferSafeMargin=0,e.clearingBuffer=!0,a.log.debug(l,"clearing buffer"),r?(c=n.playerInterface_.getPresentationTime(),d=n.playerInterface_.mediaSourceEngine.getDuration(),u=n.playerInterface_.mediaSourceEngine.remove(e.type,c+r,d)):u=n.playerInterface_.mediaSourceEngine.clear(e.type).then(function(){if(!this.destroyed_&&t)return this.playerInterface_.mediaSourceEngine.flush(e.type)}.bind(n)),i.yield(u,2);case 2:if(n.destroyed_)return i.return();a.log.debug(l,"cleared buffer"),e.lastStream=null,e.lastSegmentReference=null,e.clearingBuffer=!1,e.endOfStream=!1,n.scheduleUpdate_(e,0),i.jumpToEnd()}}))}))},a.media.StreamingEngine.prototype.scheduleUpdate_=function(e,t){var r=this,n=a.media.StreamingEngine.logPrefix_(e);a.log.v2(n,"updating in "+t+" seconds"),o.asserts.assert(null==e.updateTimer,n+" did not expect update to be scheduled"),e.updateTimer=new a.util.DelayedTick((function(){return i.asyncExecutePromiseGeneratorFunction((function t(){var n;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return t.setCatchFinallyBlocks(2),t.yield(r.onUpdate_(e),4);case 4:t.leaveTryBlock(0);break;case 2:n=t.enterCatchBlock(),r.playerInterface_&&r.playerInterface_.onError(n),t.jumpToEnd()}}))}))})).tickAfter(t)},a.media.StreamingEngine.prototype.cancelUpdate_=function(e){null!=e.updateTimer&&(e.updateTimer.stop(),e.updateTimer=null)},a.media.StreamingEngine.prototype.abortOperations_=function(e){return i.asyncExecutePromiseGeneratorFunction((function t(){return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:if(e.operation)return t.yield(e.operation.abort(),0);t.jumpTo(0)}}))}))},a.media.StreamingEngine.prototype.handleStreamingError_=function(e){this.failureCallbackBackoff_.attempt().then(function(){this.destroyed_||(this.playerInterface_.onError(e),e.handled||this.config_.failureCallback(e))}.bind(this))},a.media.StreamingEngine.logPrefix_=function(e){return"("+e.type+":"+e.stream.id+")"},a.net.HttpPluginUtils={},a.net.HttpPluginUtils.makeResponse=function(e,t,r,n,i,o){if(200<=r&&299>=r&&202!=r)return{uri:i||n,originalUri:n,data:t,headers:e,fromCache:!!e["x-shaka-from-cache"]};i=null;try{i=a.util.StringUtils.fromBytesAutoDetect(t)}catch(e){}throw a.log.debug("HTTP error text:",i),new a.util.Error(401==r||403==r?a.util.Error.Severity.CRITICAL:a.util.Error.Severity.RECOVERABLE,a.util.Error.Category.NETWORK,a.util.Error.Code.BAD_HTTP_STATUS,n,r,i,e,o)},a.net.HttpFetchPlugin=function(e,t,r,n){var i=new a.net.HttpFetchPlugin.Headers_;a.util.MapUtils.asMap(t.headers).forEach((function(e,t){i.append(t,e)}));var o=new a.net.HttpFetchPlugin.AbortController_,s={canceled:!1,timedOut:!1};if(e=a.net.HttpFetchPlugin.request_(e,r,{body:t.body||void 0,headers:i,method:t.method,signal:o.signal,credentials:t.allowCrossSiteCredentials?"include":void 0},s,n),e=new a.util.AbortableOperation(e,(function(){return s.canceled=!0,o.abort(),Promise.resolve()})),t=t.retryParameters.timeout){var l=new a.util.Timer((function(){s.timedOut=!0,o.abort()}));l.tickAfter(t/1e3),e.finally((function(){l.stop()}))}return e},o.exportSymbol("shaka.net.HttpFetchPlugin",a.net.HttpFetchPlugin),a.net.HttpFetchPlugin.request_=function(e,t,r,n,s){return i.asyncExecutePromiseGeneratorFunction((function l(){var u,c,d,p,f,h,m,g,y,_,v,E;return i.generator.createGenerator(l,(function(l){switch(l.nextAddress){case 1:return u=a.net.HttpFetchPlugin.fetch_,c=a.net.HttpFetchPlugin.ReadableStream_,h=f=0,m=Date.now(),l.setCatchFinallyBlocks(2),l.yield(u(e,r),4);case 4:return d=l.yieldResult,g=d.clone().body.getReader(),_=(y=d.headers.get("Content-Length"))?parseInt(y,10):0,new c({start:function(e){var t=function(){return i.asyncExecutePromiseGeneratorFunction((function r(){var n,l,u;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return r.setCatchFinallyBlocks(2),r.yield(g.read(),4);case 4:n=r.yieldResult,r.leaveTryBlock(3);break;case 2:return l=r.enterCatchBlock(),a.log.v1("error reading from stream",l.message),r.return();case 3:n.done||(f+=n.value.byteLength),(100<(u=Date.now())-m||n.done)&&(s(u-m,f-h,_-f),h=f,m=u),n.done?(o.asserts.assert(!n.value,'readObj should be unset when "done" is true.'),e.close()):(e.enqueue(n.value),t()),r.jumpToEnd()}}))}))};t()}}),l.yield(d.arrayBuffer(),5);case 5:p=l.yieldResult,l.leaveTryBlock(3);break;case 2:if(v=l.enterCatchBlock(),n.canceled)throw new a.util.Error(a.util.Error.Severity.RECOVERABLE,a.util.Error.Category.NETWORK,a.util.Error.Code.OPERATION_ABORTED,e,t);if(n.timedOut)throw new a.util.Error(a.util.Error.Severity.RECOVERABLE,a.util.Error.Category.NETWORK,a.util.Error.Code.TIMEOUT,e,t);throw new a.util.Error(a.util.Error.Severity.RECOVERABLE,a.util.Error.Category.NETWORK,a.util.Error.Code.HTTP_ERROR,e,v,t);case 3:return E={},d.headers.forEach((function(e,t){E[t.trim()]=e})),l.return(a.net.HttpPluginUtils.makeResponse(E,p,d.status,e,d.url,t))}}))}))},a.net.HttpFetchPlugin.isSupported=function(){if(!e.ReadableStream)return!1;try{new ReadableStream({})}catch(e){return!1}return!(!e.fetch||!e.AbortController)},o.exportProperty(a.net.HttpFetchPlugin,"isSupported",a.net.HttpFetchPlugin.isSupported),a.net.HttpFetchPlugin.fetch_=e.fetch,a.net.HttpFetchPlugin.AbortController_=e.AbortController,a.net.HttpFetchPlugin.ReadableStream_=e.ReadableStream,a.net.HttpFetchPlugin.Headers_=e.Headers,a.net.HttpFetchPlugin.isSupported()&&(a.net.NetworkingEngine.registerScheme("http",a.net.HttpFetchPlugin,a.net.NetworkingEngine.PluginPriority.PREFERRED),a.net.NetworkingEngine.registerScheme("https",a.net.HttpFetchPlugin,a.net.NetworkingEngine.PluginPriority.PREFERRED)),a.net.HttpXHRPlugin=function(e,t,r,n){var s=new a.net.HttpXHRPlugin.Xhr_,l=Date.now(),u=0,c=new Promise((function(c,d){for(var p in s.open(t.method,e,!0),s.responseType="arraybuffer",s.timeout=t.retryParameters.timeout,s.withCredentials=t.allowCrossSiteCredentials,s.onabort=function(){d(new a.util.Error(a.util.Error.Severity.RECOVERABLE,a.util.Error.Category.NETWORK,a.util.Error.Code.OPERATION_ABORTED,e,r))},s.onload=function(t){t=t.target,o.asserts.assert(t,"XHR onload has no target!");for(var n=t.getAllResponseHeaders().trim().split("\r\n"),s={},l=(n=i.makeIterator(n)).next();!l.done;l=n.next())s[(l=l.value.split(": "))[0].toLowerCase()]=l.slice(1).join(": ");try{var u=a.net.HttpPluginUtils.makeResponse(s,t.response,t.status,e,t.responseURL,r);c(u)}catch(e){o.asserts.assert(e instanceof a.util.Error,"Wrong error type!"),d(e)}},s.onerror=function(t){d(new a.util.Error(a.util.Error.Severity.RECOVERABLE,a.util.Error.Category.NETWORK,a.util.Error.Code.HTTP_ERROR,e,t,r))},s.ontimeout=function(t){d(new a.util.Error(a.util.Error.Severity.RECOVERABLE,a.util.Error.Category.NETWORK,a.util.Error.Code.TIMEOUT,e,r))},s.onprogress=function(e){var t=Date.now();(100<t-l||e.lengthComputable&&e.loaded==e.total)&&(n(t-l,e.loaded-u,e.total-e.loaded),u=e.loaded,l=t)},t.headers){var f=p.toLowerCase();s.setRequestHeader(f,t.headers[p])}s.send(t.body)}));return new a.util.AbortableOperation(c,(function(){return s.abort(),Promise.resolve()}))},o.exportSymbol("shaka.net.HttpXHRPlugin",a.net.HttpXHRPlugin),a.net.HttpXHRPlugin.Xhr_=e.XMLHttpRequest,a.net.NetworkingEngine.registerScheme("http",a.net.HttpXHRPlugin,a.net.NetworkingEngine.PluginPriority.FALLBACK),a.net.NetworkingEngine.registerScheme("https",a.net.HttpXHRPlugin,a.net.NetworkingEngine.PluginPriority.FALLBACK),a.offline={},a.offline.DownloadProgressEstimator=function(){this.actualDownloaded_=this.estimatedDownloaded_=this.estimatedTotal_=0,this.pending_=new Map,this.nextId_=0},a.offline.DownloadProgressEstimator.prototype.open=function(e){this.estimatedTotal_+=e;var t=this.nextId_;return this.nextId_++,this.pending_.set(t,e),t},a.offline.DownloadProgressEstimator.prototype.close=function(e,t){if(this.pending_.has(e)){var r=this.pending_.get(e);this.pending_.delete(e),this.estimatedDownloaded_+=r,this.actualDownloaded_+=t}},a.offline.DownloadProgressEstimator.prototype.getEstimatedProgress=function(){return 0==this.estimatedTotal_?0:this.estimatedDownloaded_/this.estimatedTotal_},a.offline.DownloadProgressEstimator.prototype.getTotalDownloaded=function(){return this.actualDownloaded_},a.offline.DownloadManager=function(e,t,r){this.networkingEngine_=e,this.groups_=new Map,this.destroyed_=!1,this.onProgress_=t,this.onInitData_=r,this.estimator_=new a.offline.DownloadProgressEstimator},a.offline.DownloadManager.prototype.destroy=function(){return this.destroyed_=!0,Promise.all(this.groups_.values()).then((function(){}),(function(){}))},a.offline.DownloadManager.prototype.queue=function(e,t,r,n,s){var l=this;o.asserts.assert(!this.destroyed_,"Do not call |queue| after |destroy|");var u=this.estimator_.open(r);r=this.groups_.get(e)||Promise.resolve(),this.groups_.set(e,r.then((function(){return i.asyncExecutePromiseGeneratorFunction((function e(){var r,o,c,d,p,f;return i.generator.createGenerator(e,(function(e){switch(e.nextAddress){case 1:return e.yield(l.fetchSegment_(t),2);case 2:if(r=e.yieldResult,l.destroyed_)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.OPERATION_ABORTED);if(n)for(var i in o=new Uint8Array(r),(c=new a.util.Pssh(o)).data)d=Number(i),p=c.data[d],f=c.systemIds[d],l.onInitData_(p,f);return l.estimator_.close(u,r.byteLength),l.onProgress_(l.estimator_.getEstimatedProgress(),l.estimator_.getTotalDownloaded()),e.return(s(r))}}))}))})))},a.offline.DownloadManager.prototype.waitToFinish=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return t.yield(Promise.all(e.groups_.values()),2);case 2:return t.return(e.estimator_.getTotalDownloaded())}}))}))},a.offline.DownloadManager.prototype.fetchSegment_=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){var n,s,l;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return n=a.net.NetworkingEngine.RequestType.SEGMENT,s=t.networkingEngine_.request(n,e),r.yield(s.promise,2);case 2:return l=r.yieldResult,o.asserts.assert(l.data,"Response data should be non-null!"),r.return(l.data)}}))}))},a.offline.indexeddb={},a.offline.indexeddb.DBOperation=function(e,t){var r=this;this.transaction_=e,this.store_=e.objectStore(t),this.promise_=new a.util.PublicPromise,e.onabort=function(e){e.preventDefault(),r.promise_.reject()},e.onerror=function(e){e.preventDefault(),r.promise_.reject()},e.oncomplete=function(e){r.promise_.resolve()}},a.offline.indexeddb.DBOperation.prototype.abort=function(){try{this.transaction_.abort()}catch(e){}return this.promise_.catch((function(){}))},a.offline.indexeddb.DBOperation.prototype.forEachEntry=function(e){var t=this;return new Promise((function(r,n){var i=t.store_.openCursor();i.onerror=n,i.onsuccess=function(t){if(!(t=t.target.result))return r();e(t.key,t.value,t),t.continue()}}))},a.offline.indexeddb.DBOperation.prototype.store=function(){return this.store_},a.offline.indexeddb.DBOperation.prototype.promise=function(){return this.promise_},a.offline.indexeddb.DBConnection=function(e){this.connection_=e,this.pending_=[]},a.offline.indexeddb.DBConnection.prototype.destroy=function(){return Promise.all(this.pending_.map((function(e){return e.abort()})))},a.offline.indexeddb.DBConnection.prototype.startReadOnlyOperation=function(e){return this.startOperation_(e,"readonly")},a.offline.indexeddb.DBConnection.prototype.startReadWriteOperation=function(e){return this.startOperation_(e,"readwrite")},a.offline.indexeddb.DBConnection.prototype.startOperation_=function(e,t){var r=this,n=this.connection_.transaction([e],t),i=new a.offline.indexeddb.DBOperation(n,e);return this.pending_.push(i),i.promise().then((function(){return r.stopTracking_(i)}),(function(){return r.stopTracking_(i)})),i},a.offline.indexeddb.DBConnection.prototype.stopTracking_=function(e){a.util.ArrayUtils.remove(this.pending_,e)},a.offline.indexeddb.BaseStorageCell=function(e,t,r){this.connection_=new a.offline.indexeddb.DBConnection(e),this.segmentStore_=t,this.manifestStore_=r},a.offline.indexeddb.BaseStorageCell.prototype.destroy=function(){return this.connection_.destroy()},a.offline.indexeddb.BaseStorageCell.prototype.hasFixedKeySpace=function(){return!0},a.offline.indexeddb.BaseStorageCell.prototype.addSegments=function(e){return this.rejectAdd(this.segmentStore_)},a.offline.indexeddb.BaseStorageCell.prototype.removeSegments=function(e,t){return this.remove_(this.segmentStore_,e,t)},a.offline.indexeddb.BaseStorageCell.prototype.getSegments=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){var n;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return r.yield(t.get_(t.segmentStore_,e),2);case 2:return n=r.yieldResult,r.return(n.map((function(e){return t.convertSegmentData(e)})))}}))}))},a.offline.indexeddb.BaseStorageCell.prototype.addManifests=function(e){return this.rejectAdd(this.manifestStore_)},a.offline.indexeddb.BaseStorageCell.prototype.updateManifestExpiration=function(e,t){var r=this.connection_.startReadWriteOperation(this.manifestStore_),n=r.store();return n.get(e).onsuccess=function(r){(r=r.target.result)&&(r.expiration=t,n.put(r,e))},r.promise()},a.offline.indexeddb.BaseStorageCell.prototype.removeManifests=function(e,t){return this.remove_(this.manifestStore_,e,t)},a.offline.indexeddb.BaseStorageCell.prototype.getManifests=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){var n;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return r.yield(t.get_(t.manifestStore_,e),2);case 2:return n=r.yieldResult,r.return(n.map((function(e){return t.convertManifest(e)})))}}))}))},a.offline.indexeddb.BaseStorageCell.prototype.getAllManifests=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var r,n;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return r=e.connection_.startReadOnlyOperation(e.manifestStore_),n=new Map,t.yield(r.forEachEntry((function(t,r){n.set(t,e.convertManifest(r))})),2);case 2:return t.yield(r.promise(),3);case 3:return t.return(n)}}))}))},a.offline.indexeddb.BaseStorageCell.prototype.convertSegmentData=function(e){return e},a.offline.indexeddb.BaseStorageCell.prototype.convertManifest=function(e){return e},a.offline.indexeddb.BaseStorageCell.prototype.rejectAdd=function(e){return Promise.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.NEW_KEY_OPERATION_NOT_SUPPORTED,"Cannot add new value to "+e))},a.offline.indexeddb.BaseStorageCell.prototype.add=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var o,a,s,l;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:o=r.connection_.startReadWriteOperation(e),a=o.store(),s=[];for(var u=i.makeIterator(t),c=u.next();!c.done;c=u.next())l=c.value,a.add(l).onsuccess=function(e){s.push(e.target.result)};return n.yield(o.promise(),2);case 2:return n.return(s)}}))}))},a.offline.indexeddb.BaseStorageCell.prototype.remove_=function(e,t,r){for(var n=(e=this.connection_.startReadWriteOperation(e)).store(),o={},a=(t=i.makeIterator(t)).next();!a.done;o={key:o.key},a=t.next())o.key=a.value,n.delete(o.key).onsuccess=function(e){return function(){return r(e.key)}}(o);return e.promise()},a.offline.indexeddb.BaseStorageCell.prototype.get_=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var o,s,l,u,c,d,p;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:for(o=r.connection_.startReadOnlyOperation(e),s=o.store(),l={},u=[],c={},d=i.makeIterator(t),p=d.next();!p.done;c={request:c.request,key:c.key},p=d.next())c.key=p.value,c.request=s.get(c.key),c.request.onsuccess=function(e){return function(){null==e.request.result&&u.push(e.key),l[e.key]=e.request.result}}(c);return n.yield(o.promise(),2);case 2:if(u.length)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.KEY_NOT_FOUND,"Could not find values for "+u);return n.return(t.map((function(e){return l[e]})))}}))}))},a.offline.indexeddb.EmeSessionStorageCell=function(e,t){this.connection_=new a.offline.indexeddb.DBConnection(e),this.store_=t},a.offline.indexeddb.EmeSessionStorageCell.prototype.destroy=function(){return this.connection_.destroy()},a.offline.indexeddb.EmeSessionStorageCell.prototype.getAll=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var r,n;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return r=e.connection_.startReadOnlyOperation(e.store_),n=[],t.yield(r.forEachEntry((function(e,t){n.push(t)})),2);case 2:return t.yield(r.promise(),3);case 3:return t.return(n)}}))}))},a.offline.indexeddb.EmeSessionStorageCell.prototype.add=function(e){for(var t=this.connection_.startReadWriteOperation(this.store_),r=t.store(),n=(e=i.makeIterator(e)).next();!n.done;n=e.next())r.add(n.value);return t.promise()},a.offline.indexeddb.EmeSessionStorageCell.prototype.remove=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){var n;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return n=t.connection_.startReadWriteOperation(t.store_),r.yield(n.forEachEntry((function(t,r,n){0<=e.indexOf(r.sessionId)&&n.delete()})),2);case 2:return r.yield(n.promise(),0)}}))}))},a.offline.StorageMuxer=function(){this.mechanisms_=new Map},a.offline.StorageMuxer.prototype.destroy=function(){for(var e=[],t=i.makeIterator(this.mechanisms_.values()),r=t.next();!r.done;r=t.next())e.push(r.value.destroy());return this.mechanisms_.clear(),Promise.all(e)},a.offline.StorageMuxer.prototype.init=function(){var e=this;a.offline.StorageMuxer.getRegistry_().forEach((function(t,r){var n=t();n?e.mechanisms_.set(r,n):a.log.info("Skipping "+r+" as it is not supported on this platform")}));for(var t=[],r=i.makeIterator(this.mechanisms_.values()),n=r.next();!n.done;n=r.next())t.push(n.value.init());return Promise.all(t)},a.offline.StorageMuxer.prototype.getActive=function(){var e=null;if(this.mechanisms_.forEach((function(t,r){t.getCells().forEach((function(t,n){t.hasFixedKeySpace()||e||(e={path:{mechanism:r,cell:n},cell:t})}))})),e)return e;throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.MISSING_STORAGE_CELL,"Could not find a cell that supports add-operations")},a.offline.StorageMuxer.prototype.forEachCell=function(e){this.mechanisms_.forEach((function(t,r){t.getCells().forEach((function(t,n){e({mechanism:r,cell:n},t)}))}))},a.offline.StorageMuxer.prototype.getCell=function(e,t){var r=this.mechanisms_.get(e);if(!r)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.MISSING_STORAGE_CELL,"Could not find mechanism with name "+e);if(!(r=r.getCells().get(t)))throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.MISSING_STORAGE_CELL,"Could not find cell with name "+t);return r},a.offline.StorageMuxer.prototype.forEachEmeSessionCell=function(e){this.mechanisms_.forEach((function(t){e(t.getEmeSessionCell())}))},a.offline.StorageMuxer.prototype.getEmeSessionCell=function(){var e=Array.from(this.mechanisms_.keys());if(!e.length)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.STORAGE_NOT_SUPPORTED,"No supported storage mechanisms found");return this.mechanisms_.get(e[0]).getEmeSessionCell()},a.offline.StorageMuxer.prototype.resolvePath=function(e){var t=this.mechanisms_.get(e.mechanism);return t?t.getCells().get(e.cell):null},a.offline.StorageMuxer.prototype.erase=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var r,n;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return r=Array.from(e.mechanisms_.values()),(n=0<r.length)||a.offline.StorageMuxer.getRegistry_().forEach((function(e,t){var n=e();n&&r.push(n)})),t.yield(Promise.all(r.map((function(e){return e.erase()}))),2);case 2:if(!n)return t.yield(Promise.all(r.map((function(e){return e.destroy()}))),0);t.jumpTo(0)}}))}))},a.offline.StorageMuxer.register=function(e,t){a.offline.StorageMuxer.registry_.set(e,t)},o.exportSymbol("shaka.offline.StorageMuxer.register",a.offline.StorageMuxer.register),a.offline.StorageMuxer.unregister=function(e){a.offline.StorageMuxer.registry_.delete(e)},o.exportSymbol("shaka.offline.StorageMuxer.unregister",a.offline.StorageMuxer.unregister),a.offline.StorageMuxer.support=function(){for(var e=a.offline.StorageMuxer.getRegistry_(),t=(e=i.makeIterator(e.values())).next();!t.done;t=e.next())if(t=(t=t.value)())return t.destroy(),!0;return!1},a.offline.StorageMuxer.overrideSupport=function(e){a.offline.StorageMuxer.override_=e},a.offline.StorageMuxer.clearOverride=function(){a.offline.StorageMuxer.override_=null},a.offline.StorageMuxer.getRegistry_=function(){a.offline.StorageMuxer.override_;var e=a.offline.StorageMuxer.registry_;return e},a.offline.StorageMuxer.override_=null,a.offline.StorageMuxer.registry_=new Map,a.offline.indexeddb.V1StorageCell=function(e){a.offline.indexeddb.BaseStorageCell.apply(this,arguments)},i.inherits(a.offline.indexeddb.V1StorageCell,a.offline.indexeddb.BaseStorageCell),a.offline.indexeddb.V1StorageCell.prototype.updateManifestExpiration=function(e,t){var r=this.connection_.startReadWriteOperation(this.manifestStore_),n=r.store(),i=new a.util.PublicPromise;return n.get(e).onsuccess=function(r){(r=r.target.result)?(o.asserts.assert(r.key==e,"With in-line keys, the keys should match"),r.expiration=t,n.put(r),i.resolve()):i.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.KEY_NOT_FOUND,"Could not find values for "+e))},r.promise().then((function(){return i}))},a.offline.indexeddb.V1StorageCell.prototype.convertManifest=function(e){return{originalManifestUri:e.originalManifestUri,duration:e.duration,size:e.size,expiration:null==e.expiration?1/0:e.expiration,periods:e.periods.map(a.offline.indexeddb.V1StorageCell.convertPeriod_),sessionIds:e.sessionIds,drmInfo:e.drmInfo,appMetadata:e.appMetadata}},a.offline.indexeddb.V1StorageCell.convertPeriod_=function(e){var t=a.offline.indexeddb.V1StorageCell;return t.fillMissingVariants_(e),e.streams.forEach((function(e){o.asserts.assert(e.variantIds,"After filling in missing variants, each stream should have variant ids")})),{startTime:e.startTime,streams:e.streams.map(t.convertStream_)}},a.offline.indexeddb.V1StorageCell.convertStream_=function(e){var t=a.offline.indexeddb.V1StorageCell,r=e.initSegmentUri?t.getKeyFromSegmentUri_(e.initSegmentUri):null;return{id:e.id,originalId:null,primary:e.primary,presentationTimeOffset:e.presentationTimeOffset,contentType:e.contentType,mimeType:e.mimeType,codecs:e.codecs,frameRate:e.frameRate,pixelAspectRatio:void 0,kind:e.kind,language:e.language,label:e.label,width:e.width,height:e.height,initSegmentKey:r,encrypted:e.encrypted,keyId:e.keyId,segments:e.segments.map(t.convertSegment_),variantIds:e.variantIds}},a.offline.indexeddb.V1StorageCell.convertSegment_=function(e){var t=a.offline.indexeddb.V1StorageCell.getKeyFromSegmentUri_(e.uri);return{startTime:e.startTime,endTime:e.endTime,dataKey:t}},a.offline.indexeddb.V1StorageCell.prototype.convertSegmentData=function(e){return{data:e.data}},a.offline.indexeddb.V1StorageCell.getKeyFromSegmentUri_=function(e){var t;if((t=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(e))||(t=/^offline:segment\/([0-9]+)$/.exec(e)))return Number(t[1]);throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.MALFORMED_OFFLINE_URI,"Could not parse uri "+e)},a.offline.indexeddb.V1StorageCell.fillMissingVariants_=function(e){var t=a.util.ManifestParserUtils.ContentType.AUDIO,r=a.util.ManifestParserUtils.ContentType.VIDEO,n=e.streams.filter((function(e){return e.contentType==t})),i=e.streams.filter((function(e){return e.contentType==r}));if(!n.every((function(e){return e.variantIds}))||!i.every((function(e){return e.variantIds}))){o.asserts.assert(n.every((function(e){return!e.variantIds})),"Some audio streams have variant ids and some do not."),o.asserts.assert(i.every((function(e){return!e.variantIds})),"Some video streams have variant ids and some do not."),n.forEach((function(e){e.variantIds=[]})),i.forEach((function(e){e.variantIds=[]}));var s=0;if(i.length&&!n.length){a.log.debug("Found video-only content. Creating variants for video.");var l=s++;i.forEach((function(e){e.variantIds.push(l)}))}if(!i.length&&n.length){a.log.debug("Found audio-only content. Creating variants for audio.");var u=s++;n.forEach((function(e){e.variantIds.push(u)}))}i.length&&n.length&&(a.log.debug("Found audio-video content. Creating variants."),n.forEach((function(e){i.forEach((function(t){var r=s++;e.variantIds.push(r),t.variantIds.push(r)}))})))}},a.offline.indexeddb.V2StorageCell=function(e,t,r,n){a.offline.indexeddb.BaseStorageCell.call(this,e,t,r),this.isFixedKey_=n},i.inherits(a.offline.indexeddb.V2StorageCell,a.offline.indexeddb.BaseStorageCell),a.offline.indexeddb.V2StorageCell.prototype.hasFixedKeySpace=function(){return this.isFixedKey_},a.offline.indexeddb.V2StorageCell.prototype.addSegments=function(e){return this.isFixedKey_?this.rejectAdd(this.segmentStore_):this.add(this.segmentStore_,e)},a.offline.indexeddb.V2StorageCell.prototype.addManifests=function(e){return this.isFixedKey_?this.rejectAdd(this.manifestStore_):this.add(this.manifestStore_,e)},a.offline.indexeddb.V2StorageCell.prototype.convertManifest=function(e){return null==e.expiration&&(e.expiration=1/0),e},a.offline.indexeddb.StorageMechanism=function(){this.sessions_=this.v3_=this.v2_=this.v1_=this.db_=null},a.offline.indexeddb.StorageMechanism.prototype.init=function(){var t=this,r=a.offline.indexeddb.StorageMechanism.DB_NAME,n=a.offline.indexeddb.StorageMechanism.VERSION,i=new a.util.PublicPromise,o=e.indexedDB.open(r,n);return o.onsuccess=function(e){e=e.target.result,t.db_=e,t.v1_=a.offline.indexeddb.StorageMechanism.createV1_(e),t.v2_=a.offline.indexeddb.StorageMechanism.createV2_(e),t.v3_=a.offline.indexeddb.StorageMechanism.createV3_(e),t.sessions_=a.offline.indexeddb.StorageMechanism.createEmeSession_(e),i.resolve()},o.onupgradeneeded=function(e){t.createStores_(e.target.result)},o.onerror=function(e){i.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.INDEXED_DB_ERROR,o.error)),e.preventDefault()},i},a.offline.indexeddb.StorageMechanism.prototype.destroy=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:if(!e.v1_){t.jumpTo(2);break}return t.yield(e.v1_.destroy(),2);case 2:if(!e.v2_){t.jumpTo(4);break}return t.yield(e.v2_.destroy(),4);case 4:if(!e.v3_){t.jumpTo(6);break}return t.yield(e.v3_.destroy(),6);case 6:if(!e.sessions_){t.jumpTo(8);break}return t.yield(e.sessions_.destroy(),8);case 8:e.db_&&e.db_.close(),t.jumpToEnd()}}))}))},a.offline.indexeddb.StorageMechanism.prototype.getCells=function(){var e=new Map;return this.v1_&&e.set("v1",this.v1_),this.v2_&&e.set("v2",this.v2_),this.v3_&&e.set("v3",this.v3_),e},a.offline.indexeddb.StorageMechanism.prototype.getEmeSessionCell=function(){return o.asserts.assert(this.sessions_,"Cannot be destroyed."),this.sessions_},a.offline.indexeddb.StorageMechanism.prototype.erase=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:if(!e.v1_){t.jumpTo(2);break}return t.yield(e.v1_.destroy(),2);case 2:if(!e.v2_){t.jumpTo(4);break}return t.yield(e.v2_.destroy(),4);case 4:if(!e.v3_){t.jumpTo(6);break}return t.yield(e.v3_.destroy(),6);case 6:return e.db_&&e.db_.close(),t.yield(a.offline.indexeddb.StorageMechanism.deleteAll_(),8);case 8:return e.db_=null,e.v1_=null,e.v2_=null,e.v3_=null,t.yield(e.init(),0)}}))}))},a.offline.indexeddb.StorageMechanism.createV1_=function(e){var t=a.offline.indexeddb.StorageMechanism,r=t.V1_SEGMENT_STORE;t=t.V1_MANIFEST_STORE;var n=e.objectStoreNames;return n.contains(t)&&n.contains(r)?(a.log.debug("Mounting v1 idb storage cell"),new a.offline.indexeddb.V1StorageCell(e,r,t)):null},a.offline.indexeddb.StorageMechanism.createV2_=function(e){var t=a.offline.indexeddb.StorageMechanism,r=t.V2_SEGMENT_STORE;t=t.V2_MANIFEST_STORE;var n=e.objectStoreNames;return n.contains(t)&&n.contains(r)?(a.log.debug("Mounting v2 idb storage cell"),new a.offline.indexeddb.V2StorageCell(e,r,t,!0)):null},a.offline.indexeddb.StorageMechanism.createV3_=function(e){var t=a.offline.indexeddb.StorageMechanism,r=t.V3_SEGMENT_STORE;t=t.V3_MANIFEST_STORE;var n=e.objectStoreNames;return n.contains(t)&&n.contains(r)?(a.log.debug("Mounting v3 idb storage cell"),new a.offline.indexeddb.V2StorageCell(e,r,t,!1)):null},a.offline.indexeddb.StorageMechanism.createEmeSession_=function(e){var t=a.offline.indexeddb.StorageMechanism.SESSION_ID_STORE;return e.objectStoreNames.contains(t)?(a.log.debug("Mounting session ID idb storage cell"),new a.offline.indexeddb.EmeSessionStorageCell(e,t)):null},a.offline.indexeddb.StorageMechanism.prototype.createStores_=function(e){for(var t=i.makeIterator([a.offline.indexeddb.StorageMechanism.V3_SEGMENT_STORE,a.offline.indexeddb.StorageMechanism.V3_MANIFEST_STORE,a.offline.indexeddb.StorageMechanism.SESSION_ID_STORE]),r=t.next();!r.done;r=t.next())r=r.value,e.objectStoreNames.contains(r)||e.createObjectStore(r,{autoIncrement:!0})},a.offline.indexeddb.StorageMechanism.deleteAll_=function(){var t=a.offline.indexeddb.StorageMechanism.DB_NAME,r=new a.util.PublicPromise,n=e.indexedDB.deleteDatabase(t);return n.onblocked=function(e){a.log.warning("Deleting",t,"is being blocked")},n.onsuccess=function(e){r.resolve()},n.onerror=function(e){r.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.INDEXED_DB_ERROR,n.error)),e.preventDefault()},r},a.offline.indexeddb.StorageMechanism.DB_NAME="shaka_offline_db",a.offline.indexeddb.StorageMechanism.VERSION=4,a.offline.indexeddb.StorageMechanism.V1_SEGMENT_STORE="segment",a.offline.indexeddb.StorageMechanism.V2_SEGMENT_STORE="segment-v2",a.offline.indexeddb.StorageMechanism.V3_SEGMENT_STORE="segment-v3",a.offline.indexeddb.StorageMechanism.V1_MANIFEST_STORE="manifest",a.offline.indexeddb.StorageMechanism.V2_MANIFEST_STORE="manifest-v2",a.offline.indexeddb.StorageMechanism.V3_MANIFEST_STORE="manifest-v3",a.offline.indexeddb.StorageMechanism.SESSION_ID_STORE="session-ids",a.offline.StorageMuxer.register("idb",(function(){return e.indexedDB?new a.offline.indexeddb.StorageMechanism:null})),a.offline.OfflineUri=function(e,t,r,n){this.type_=e,this.mechanism_=t,this.cell_=r,this.key_=n,this.asString_=["offline:",e,"/",t,"/",r,"/",n].join("")},a.offline.OfflineUri.prototype.isManifest=function(){return"manifest"==this.type_},a.offline.OfflineUri.prototype.isSegment=function(){return"segment"==this.type_},a.offline.OfflineUri.prototype.mechanism=function(){return this.mechanism_},a.offline.OfflineUri.prototype.cell=function(){return this.cell_},a.offline.OfflineUri.prototype.key=function(){return this.key_},a.offline.OfflineUri.prototype.toString=function(){return this.asString_},a.offline.OfflineUri.parse=function(e){if(null==(e=/^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(e)))return null;var t=e[1];if("manifest"!=t&&"segment"!=t)return null;var r=e[2];if(!r)return null;var n=e[3];return n&&null!=t?new a.offline.OfflineUri(t,r,n,Number(e[4])):null},a.offline.OfflineUri.manifest=function(e,t,r){return new a.offline.OfflineUri("manifest",e,t,r)},a.offline.OfflineUri.segment=function(e,t,r){return new a.offline.OfflineUri("segment",e,t,r)},a.offline.ManifestConverter=function(e,t){this.mechanism_=e,this.cell_=t},a.offline.ManifestConverter.prototype.fromManifestDB=function(e){var t=this,r=new a.media.PresentationTimeline(null,0);r.setDuration(e.duration);var n=e.periods.map((function(e){return t.fromPeriodDB(e,r)})),i=e.drmInfo?[e.drmInfo]:[];return e.drmInfo&&n.forEach((function(e){e.variants.forEach((function(e){e.drmInfos=i}))})),{presentationTimeline:r,minBufferTime:2,offlineSessionIds:e.sessionIds,periods:n}},a.offline.ManifestConverter.prototype.fromPeriodDB=function(e,t){var r=this,n=e.streams.filter((function(e){return r.isAudio_(e)})),i=e.streams.filter((function(e){return r.isVideo_(e)}));return n=this.createVariants(n,i),i=e.streams.filter((function(e){return r.isText_(e)})).map((function(e){return r.fromStreamDB_(e)})),e.streams.forEach((function(n,i){var o=n.segments.map((function(e,t){return r.fromSegmentDB_(t,e)}));t.notifySegments(o,e.startTime)})),{startTime:e.startTime,variants:Array.from(n.values()),textStreams:i}},a.offline.ManifestConverter.prototype.createVariants=function(e,t){for(var r=new Set,n=i.makeIterator(e),a=n.next();!a.done;a=n.next()){var s=i.makeIterator(a.value.variantIds);for(a=s.next();!a.done;a=s.next())r.add(a.value)}for(a=(n=i.makeIterator(t)).next();!a.done;a=n.next())for(a=(s=i.makeIterator(a.value.variantIds)).next();!a.done;a=s.next())r.add(a.value);for(n=new Map,a=(r=i.makeIterator(r)).next();!a.done;a=r.next())a=a.value,n.set(a,this.createEmptyVariant_(a));for(a=(r=i.makeIterator(e)).next();!a.done;a=r.next()){a=a.value,s=this.fromStreamDB_(a);var l=i.makeIterator(a.variantIds);for(a=l.next();!a.done;a=l.next())a=n.get(a.value),o.asserts.assert(!a.audio,"A variant should only have one audio stream"),a.language=s.language,a.primary=a.primary||s.primary,a.audio=s}for(a=(r=i.makeIterator(t)).next();!a.done;a=r.next())for(a=a.value,s=this.fromStreamDB_(a),a=(l=i.makeIterator(a.variantIds)).next();!a.done;a=l.next())a=n.get(a.value),o.asserts.assert(!a.video,"A variant should only have one video stream"),a.primary=a.primary||s.primary,a.video=s;return n},a.offline.ManifestConverter.prototype.fromStreamDB_=function(e){var t=this,r=e.segments.map((function(e,r){return t.fromSegmentDB_(r,e)})),n=new a.media.SegmentIndex(r);return r={id:e.id,originalId:e.originalId,createSegmentIndex:function(){return Promise.resolve()},findSegmentPosition:function(e){return n.find(e)},getSegmentReference:function(e){return n.get(e)},initSegmentReference:null,presentationTimeOffset:e.presentationTimeOffset,mimeType:e.mimeType,codecs:e.codecs,width:e.width||void 0,height:e.height||void 0,frameRate:e.frameRate||void 0,pixelAspectRatio:e.pixelAspectRatio||void 0,kind:e.kind,encrypted:e.encrypted,keyId:e.keyId,language:e.language,label:e.label||null,type:e.contentType,primary:e.primary,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null},null!=e.initSegmentKey&&(r.initSegmentReference=this.fromInitSegmentDB_(e.initSegmentKey)),r},a.offline.ManifestConverter.prototype.fromSegmentDB_=function(e,t){var r=a.offline.OfflineUri.segment(this.mechanism_,this.cell_,t.dataKey);return new a.media.SegmentReference(e,t.startTime,t.endTime,(function(){return[r.toString()]}),0,null)},a.offline.ManifestConverter.prototype.fromInitSegmentDB_=function(e){var t=a.offline.OfflineUri.segment(this.mechanism_,this.cell_,e);return new a.media.InitSegmentReference((function(){return[t.toString()]}),0,null)},a.offline.ManifestConverter.prototype.isAudio_=function(e){return e.contentType==a.util.ManifestParserUtils.ContentType.AUDIO},a.offline.ManifestConverter.prototype.isVideo_=function(e){return e.contentType==a.util.ManifestParserUtils.ContentType.VIDEO},a.offline.ManifestConverter.prototype.isText_=function(e){return e.contentType==a.util.ManifestParserUtils.ContentType.TEXT},a.offline.ManifestConverter.prototype.createEmptyVariant_=function(e){return{id:e,language:"",primary:!1,audio:null,video:null,bandwidth:0,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0}},a.offline.OfflineManifestParser=function(){this.uri_=null},a.offline.OfflineManifestParser.prototype.configure=function(e){},a.offline.OfflineManifestParser.prototype.start=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var n,o,s,l,u,c;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return n=a.offline.OfflineUri.parse(e),r.uri_=n,null!=n&&n.isManifest()?(o=new a.offline.StorageMuxer,t.setFinallyBlock(2),t.yield(o.init(),4)):t.return(Promise.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.NETWORK,a.util.Error.Code.MALFORMED_OFFLINE_URI,n)));case 4:return t.yield(o.getCell(n.mechanism(),n.cell()),5);case 5:return s=t.yieldResult,t.yield(s.getManifests([n.key()]),6);case 6:return l=t.yieldResult,u=l[0],c=new a.offline.ManifestConverter(n.mechanism(),n.cell()),t.return(c.fromManifestDB(u));case 2:return t.enterFinallyBlock(),t.yield(o.destroy(),7);case 7:t.leaveFinallyBlock(0)}}))}))},a.offline.OfflineManifestParser.prototype.stop=function(){return Promise.resolve()},a.offline.OfflineManifestParser.prototype.update=function(){},a.offline.OfflineManifestParser.prototype.onExpirationUpdated=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var s,l,u,c,d,p,f,h;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return o.asserts.assert(r.uri_,"Should not get update event before start has been called"),s=r.uri_,l=new a.offline.StorageMuxer,n.setCatchFinallyBlocks(2,3),n.yield(l.init(),5);case 5:return n.yield(l.getCell(s.mechanism(),s.cell()),6);case 6:return u=n.yieldResult,n.yield(u.getManifests([s.key()]),7);case 7:if(c=n.yieldResult,d=c[0],p=d.sessionIds.includes(e),f=null==d.expiration||d.expiration>t,!p||!f){n.jumpTo(3);break}return a.log.debug("Updating expiration for stored content"),n.yield(u.updateManifestExpiration(s.key(),t),3);case 3:return n.enterFinallyBlock(),n.yield(l.destroy(),10);case 10:n.leaveFinallyBlock(0);break;case 2:h=n.enterCatchBlock(),a.log.error("There was an error updating",s,h),n.jumpTo(3)}}))}))},a.media.ManifestParser.registerParserByMime("application/x-offline-manifest",a.offline.OfflineManifestParser),a.offline.OfflineScheme=function(e,t,r,n){return(t=a.offline.OfflineUri.parse(e))&&t.isManifest()?a.offline.OfflineScheme.getManifest_(e):t&&t.isSegment()?a.offline.OfflineScheme.getSegment_(t.key(),t):a.util.AbortableOperation.failed(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.NETWORK,a.util.Error.Code.MALFORMED_OFFLINE_URI,e))},o.exportSymbol("shaka.offline.OfflineScheme",a.offline.OfflineScheme),a.offline.OfflineScheme.getManifest_=function(e){return e={uri:e,originalUri:e,data:new ArrayBuffer(0),headers:{"content-type":"application/x-offline-manifest"}},a.util.AbortableOperation.completed(e)},a.offline.OfflineScheme.getSegment_=function(e,t){o.asserts.assert(t.isSegment(),"Only segment uri's should be given to getSegment");var r=new a.offline.StorageMuxer;return a.util.AbortableOperation.completed(void 0).chain((function(){return r.init()})).chain((function(){return r.getCell(t.mechanism(),t.cell())})).chain((function(e){return e.getSegments([t.key()])})).chain((function(e){return{uri:t,originalUri:t,data:e[0].data,headers:{}}})).finally((function(){return r.destroy()}))},a.net.NetworkingEngine.registerScheme("offline",a.offline.OfflineScheme),a.offline.SessionDeleter=function(){},a.offline.SessionDeleter.prototype.delete=function(e,t,r){var n=this;return i.asyncExecutePromiseGeneratorFunction((function o(){var s,l,u,c,d,p,f;return i.generator.createGenerator(o,(function(o){switch(o.nextAddress){case 1:s=a.offline.SessionDeleter,l=[],u=i.makeIterator(s.createBuckets_(r)),c=u.next();case 2:if(c.done){o.jumpTo(4);break}return d=c.value,p=n.doDelete_(e,t,d),o.yield(p,5);case 5:f=o.yieldResult,l=l.concat(f),c=u.next(),o.jumpTo(2);break;case 4:return o.return(l)}}))}))},a.offline.SessionDeleter.prototype.doDelete_=function(e,t,r){return i.asyncExecutePromiseGeneratorFunction((function n(){var o,s,l,u;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return o=new a.media.DrmEngine({netEngine:t,onError:function(){},onKeyStatus:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),n.setCatchFinallyBlocks(2),o.configure(e),n.yield(o.initForRemoval(r.info.keySystem,r.info.licenseUri,r.info.serverCertificate,r.info.audioCapabilities,r.info.videoCapabilities),4);case 4:n.leaveTryBlock(3);break;case 2:return s=n.enterCatchBlock(),a.log.warning("Error initializing EME",s),n.yield(o.destroy(),5);case 5:return n.return([]);case 3:return n.setCatchFinallyBlocks(6),n.yield(o.setServerCertificate(),8);case 8:n.leaveTryBlock(7);break;case 6:return l=n.enterCatchBlock(),a.log.warning("Error setting server certificate",l),n.yield(o.destroy(),9);case 9:return n.return([]);case 7:return u=[],n.yield(Promise.all(r.sessionIds.map((function(e){return i.asyncExecutePromiseGeneratorFunction((function t(){var r;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return t.setCatchFinallyBlocks(2),t.yield(o.removeSession(e),4);case 4:u.push(e),t.leaveTryBlock(0);break;case 2:r=t.enterCatchBlock(),a.log.warning("Error deleting offline session",r),t.jumpToEnd()}}))}))}))),10);case 10:return n.yield(o.destroy(),11);case 11:return n.return(u)}}))}))},a.offline.SessionDeleter.createBuckets_=function(e){for(var t=a.offline.SessionDeleter,r=[],n=(e=i.makeIterator(e)).next();!n.done;n=e.next()){n=n.value;for(var o=!1,s=i.makeIterator(r),l=s.next();!l.done;l=s.next())if(l=l.value,t.isCompatible_(l.info,n)){l.sessionIds.push(n.sessionId),o=!0;break}o||r.push({info:n,sessionIds:[n.sessionId]})}return r},a.offline.SessionDeleter.isCompatible_=function(e,t){var r=a.util.ArrayUtils,n=function(e,t){return e.robustness==t.robustness&&e.contentType==t.contentType};return e.keySystem==t.keySystem&&e.licenseUri==t.licenseUri&&r.hasSameElements(e.audioCapabilities,t.audioCapabilities,n)&&r.hasSameElements(e.videoCapabilities,t.videoCapabilities,n)},a.routing={},a.routing.Walker=function(e,t,r){var n=this;this.implementation_=r,this.currentlyAt_=e,this.currentlyWith_=t,this.waitForWork_=null,this.requests_=[],this.currentStep_=this.currentRoute_=null,this.isAlive_=!0,this.mainLoopPromise_=Promise.resolve().then((function(){return n.mainLoop_()}))},a.routing.Walker.prototype.getCurrentPayload=function(){return this.currentlyWith_},a.routing.Walker.prototype.destroy=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return e.isAlive_=!1,e.currentStep_&&e.currentStep_.abort(),e.unblockMainLoop_(),t.yield(e.mainLoopPromise_,2);case 2:e.currentRoute_&&e.currentRoute_.listeners.onCancel();for(var r=i.makeIterator(e.requests_),n=r.next();!n.done;n=r.next())n.value.listeners.onCancel();e.currentRoute_=null,e.requests_=[],e.implementation_=null,t.jumpToEnd()}}))}))},a.routing.Walker.prototype.startNewRoute=function(e){var t={onStart:function(){},onEnd:function(){},onCancel:function(){},onError:function(e){},onSkip:function(){},onEnter:function(){}};return this.requests_.push({create:e,listeners:t}),this.currentStep_&&this.currentStep_.abort(),this.unblockMainLoop_(),t},a.routing.Walker.prototype.mainLoop_=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:if(e.isAlive_)return t.yield(e.doOneThing_(),1);t.jumpTo(0)}}))}))},a.routing.Walker.prototype.doOneThing_=function(){return this.tryNewRoute_()?Promise.resolve():this.currentRoute_?this.takeNextStep_():(o.asserts.assert(null==this.waitForWork_,"We should not have a promise yet."),this.implementation_.onIdle(this.currentlyAt_),this.waitForWork_=new a.util.PublicPromise)},a.routing.Walker.prototype.tryNewRoute_=function(){if(o.asserts.assert(null==this.currentStep_,"We should never have a current step between taking steps."),0==this.requests_.length||this.currentRoute_&&!this.currentRoute_.interruptible)return!1;this.currentRoute_&&(this.currentRoute_.listeners.onCancel(),this.currentRoute_=null);var e=this.requests_.shift(),t=e.create(this.currentlyWith_);return t?(e.listeners.onStart(),this.currentRoute_={node:t.node,payload:t.payload,interruptible:t.interruptible,listeners:e.listeners}):e.listeners.onSkip(),!0},a.routing.Walker.prototype.takeNextStep_=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var r,n;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return o.asserts.assert(e.currentRoute_,"We need a current route to take the next step."),e.currentlyAt_=e.implementation_.getNext(e.currentlyAt_,e.currentlyWith_,e.currentRoute_.node,e.currentRoute_.payload),e.currentRoute_.listeners.onEnter(e.currentlyAt_),t.setCatchFinallyBlocks(2),e.currentStep_=e.implementation_.enterNode(e.currentlyAt_,e.currentlyWith_,e.currentRoute_.payload),t.yield(e.currentStep_.promise,4);case 4:e.currentStep_=null,e.currentlyAt_==e.currentRoute_.node&&(e.currentRoute_.listeners.onEnd(),e.currentRoute_=null),t.leaveTryBlock(0);break;case 2:return(r=t.enterCatchBlock()).code==a.util.Error.Code.OPERATION_ABORTED?(o.asserts.assert(e.currentRoute_.interruptible,"Do not put abortable steps in non-interruptible routes!"),e.currentRoute_.listeners.onCancel()):e.currentRoute_.listeners.onError(r),e.currentRoute_=null,e.currentStep_=null,n=e,t.yield(e.implementation_.handleError(e.currentlyWith_,r),5);case 5:n.currentlyAt_=t.yieldResult,t.jumpToEnd()}}))}))},a.routing.Walker.prototype.unblockMainLoop_=function(){this.waitForWork_&&(this.waitForWork_.resolve(),this.waitForWork_=null)},a.text.SimpleTextDisplayer=function(e){this.textTrack_=null;for(var t=0;t<e.textTracks.length;++t){var r=e.textTracks[t];r.mode="disabled",r.label==a.Player.TextTrackLabel&&(this.textTrack_=r)}this.textTrack_||(this.textTrack_=e.addTextTrack("subtitles",a.Player.TextTrackLabel)),this.textTrack_.mode="hidden"},o.exportSymbol("shaka.text.SimpleTextDisplayer",a.text.SimpleTextDisplayer),a.text.SimpleTextDisplayer.prototype.remove=function(e,t){return!!this.textTrack_&&(a.text.SimpleTextDisplayer.removeWhere_(this.textTrack_,(function(r){return r.startTime<t&&r.endTime>e})),!0)},o.exportProperty(a.text.SimpleTextDisplayer.prototype,"remove",a.text.SimpleTextDisplayer.prototype.remove),a.text.SimpleTextDisplayer.prototype.append=function(e){for(var t=a.text.SimpleTextDisplayer.convertToTextTrackCue_,r=[],n=(e=i.makeIterator(e)).next();!n.done;n=e.next())(n=n.value).nestedCues.length?r=r.concat(n.nestedCues):r.push(n);var o=[];e=this.textTrack_.cues?Array.from(this.textTrack_.cues):[],n={};for(var s=(r=i.makeIterator(r)).next();!s.done;n={inCue:n.inCue},s=r.next())n.inCue=s.value,e.some(function(e){return function(t){return t.startTime==e.inCue.startTime&&t.endTime==e.inCue.endTime&&t.text==e.inCue.payload}}(n))||(s=t(n.inCue))&&o.push(s);o.slice().sort((function(e,t){return e.startTime!=t.startTime?e.startTime-t.startTime:e.endTime!=t.endTime?e.endTime-t.startTime:o.indexOf(t)-o.indexOf(e)})).forEach(function(e){this.textTrack_.addCue(e)}.bind(this))},o.exportProperty(a.text.SimpleTextDisplayer.prototype,"append",a.text.SimpleTextDisplayer.prototype.append),a.text.SimpleTextDisplayer.prototype.destroy=function(){return this.textTrack_&&a.text.SimpleTextDisplayer.removeWhere_(this.textTrack_,(function(e){return!0})),this.textTrack_=null,Promise.resolve()},o.exportProperty(a.text.SimpleTextDisplayer.prototype,"destroy",a.text.SimpleTextDisplayer.prototype.destroy),a.text.SimpleTextDisplayer.prototype.isTextVisible=function(){return"showing"==this.textTrack_.mode},o.exportProperty(a.text.SimpleTextDisplayer.prototype,"isTextVisible",a.text.SimpleTextDisplayer.prototype.isTextVisible),a.text.SimpleTextDisplayer.prototype.setTextVisibility=function(e){this.textTrack_.mode=e?"showing":"hidden"},o.exportProperty(a.text.SimpleTextDisplayer.prototype,"setTextVisibility",a.text.SimpleTextDisplayer.prototype.setTextVisibility),a.text.SimpleTextDisplayer.convertToTextTrackCue_=function(e){if(e.startTime>=e.endTime)return a.log.warning("Invalid cue times: "+e.startTime+" - "+e.endTime),null;var t=a.text.Cue,r=new VTTCue(e.startTime,e.endTime,e.payload);r.lineAlign=e.lineAlign,r.positionAlign=e.positionAlign,e.size&&(r.size=e.size);try{r.align=e.textAlign}catch(e){}return"center"==e.textAlign&&"center"!=r.align&&(r.align="middle"),e.writingMode==t.writingMode.VERTICAL_LEFT_TO_RIGHT?r.vertical="lr":e.writingMode==t.writingMode.VERTICAL_RIGHT_TO_LEFT&&(r.vertical="rl"),e.lineInterpretation==t.lineInterpretation.PERCENTAGE&&(r.snapToLines=!1),null!=e.line&&(r.line=e.line),null!=e.position&&(r.position=e.position),r},a.text.SimpleTextDisplayer.removeWhere_=function(e,t){var r=e.mode,n="showing"==r?"showing":"hidden";e.mode=n,o.asserts.assert(e.cues,'Cues should be accessible when mode is set to "'+n+'".');for(var i=(n=e.cues).length-1;0<=i;i--){var a=n[i];a&&t(a)&&e.removeCue(a)}e.mode=r},a.util.ConfigUtils={},a.util.ConfigUtils.mergeConfigObjects=function(e,t,r,n,i){o.asserts.assert(e,"Destination config must not be null!");var s,l=i in n,u=!0;for(s in t){var c=i+"."+s,d=l?n[i]:r[s];l||s in r?void 0===t[s]?void 0===d||l?delete e[s]:e[s]=a.util.ObjectUtils.cloneObject(d):d.constructor==Object&&t[s]&&t[s].constructor==Object?(e[s]||(e[s]=a.util.ObjectUtils.cloneObject(d)),c=a.util.ConfigUtils.mergeConfigObjects(e[s],t[s],d,n,c),u=u&&c):typeof t[s]!=typeof d||null==t[s]||"function"!=typeof t[s]&&t[s].constructor!=d.constructor?(a.log.alwaysError("Invalid config, wrong type for "+c),u=!1):("function"==typeof r[s]&&r[s].length!=t[s].length&&a.log.alwaysWarn("Unexpected number of arguments for "+c),e[s]=t[s]):(a.log.alwaysError("Invalid config, unrecognized key "+c),u=!1)}return u},o.exportSymbol("shaka.util.ConfigUtils.mergeConfigObjects",a.util.ConfigUtils.mergeConfigObjects),a.util.ConfigUtils.convertToConfigObject=function(e,t){for(var r={},n=r,i=0,o=0;!(0>(i=e.indexOf(".",i)));)0!=i&&"\\"==e[i-1]||(n[o=e.substring(o,i).replace(/\\\./g,".")]={},n=n[o],o=i+1),i+=1;return n[e.substring(o).replace(/\\\./g,".")]=t,r},o.exportSymbol("shaka.util.ConfigUtils.convertToConfigObject",a.util.ConfigUtils.convertToConfigObject),a.util.PlayerConfiguration=function(){},o.exportSymbol("shaka.util.PlayerConfiguration",a.util.PlayerConfiguration),a.util.PlayerConfiguration.createDefault=function(){var e=5e5,t=1/0;navigator.connection&&(e=1e6*navigator.connection.downlink,navigator.connection.saveData&&(t=360));var r={retryParameters:a.net.NetworkingEngine.defaultRetryParameters(),servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1,initDataTransform:a.media.DrmEngine.defaultInitDataTransform,fairPlayTransform:!0,updateExpirationTime:1},n={retryParameters:a.net.NetworkingEngine.defaultRetryParameters(),availabilityWindowOverride:NaN,disableAudio:!1,disableVideo:!1,disableText:!1,dash:{customScheme:function(e){if(e)return null},clockSyncUri:"",ignoreDrmInfo:!1,xlinkFailGracefully:!1,defaultPresentationDelay:10,ignoreMinBufferTime:!1,autoCorrectDrift:!0,ignoreSuggestedPresentationDelay:!1,ignoreEmptyAdaptationSet:!1},hls:{ignoreTextStreamFailures:!1,useFullSegmentsForStartTime:!1}},o={retryParameters:a.net.NetworkingEngine.defaultRetryParameters(),failureCallback:function(e){return a.log.error("Unhandled streaming error",e),[e]},rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,smallGapLimit:.5,jumpLargeGaps:!1,durationBackoff:1,forceTransmuxTS:!1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1,useNativeHlsOnSafari:!0};a.util.Platform.isWebOS()&&(o.stallEnabled=!1);var s={trackSelectionCallback:function(e){return i.asyncExecutePromiseGeneratorFunction((function t(){return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return t.return(e)}}))}))},progressCallback:function(e,t){return[e,t]},usePersistentLicense:!0},l={drm:r,manifest:n,streaming:o,offline:s,abrFactory:a.abr.SimpleAbrManager,abr:{enabled:!0,defaultBandwidthEstimate:e,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:t,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0}},preferredAudioLanguage:"",preferredTextLanguage:"",preferredVariantRole:"",preferredTextRole:"",preferredAudioChannelCount:2,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0},playRangeStart:0,playRangeEnd:1/0,textDisplayFactory:function(){return null}};return s.trackSelectionCallback=function(e){return i.asyncExecutePromiseGeneratorFunction((function t(){return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return t.return(a.util.PlayerConfiguration.defaultTrackSelect(e,l.preferredAudioLanguage))}}))}))},l},a.util.PlayerConfiguration.mergeConfigObjects=function(e,t,r){var n={".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",serverCertificate:new Uint8Array(0),individualizationServer:""}};return a.util.ConfigUtils.mergeConfigObjects(e,t,r||a.util.PlayerConfiguration.createDefault(),n,"")},o.exportProperty(a.util.PlayerConfiguration,"mergeConfigObjects",a.util.PlayerConfiguration.mergeConfigObjects),a.util.PlayerConfiguration.defaultTrackSelect=function(e,t){var r=a.util.ManifestParserUtils.ContentType,n=a.util.LanguageUtils,o=e.filter((function(e){return"variant"==e.type})),s=[],l=n.findClosestLocale(t,o.map((function(e){return e.language})));l&&(s=o.filter((function(e){return n.normalize(e.language)==l}))),0==s.length&&(s=o.filter((function(e){return e.primary}))),0==s.length&&(1<new Set(o.map((function(e){return e.language}))).size&&a.log.warning("Could not choose a good audio track based on language preferences or primary tracks.  An arbitrary language will be stored!"),s=o);var u=s.filter((function(e){return e.height&&480>=e.height}));if(u.length&&(u.sort((function(e,t){return t.height-e.height})),s=u.filter((function(e){return e.height==u[0].height}))),o=[],s.length){var c=Math.floor(s.length/2);s.sort((function(e,t){return e.bandwidth-t.bandwidth})),o.push(s[c])}for(c=(s=i.makeIterator(e)).next();!c.done;c=s.next())(c=c.value).type==r.TEXT&&o.push(c);return o},a.util.StateHistory=function(){this.open_=null,this.closed_=[]},a.util.StateHistory.prototype.update=function(e){null==this.open_?this.start_(e):this.update_(e)},a.util.StateHistory.prototype.getTimeSpentIn=function(e){var t=0;this.open_&&this.open_.state==e&&(t+=this.open_.duration);for(var r=i.makeIterator(this.closed_),n=r.next();!n.done;n=r.next())t+=(n=n.value).state==e?n.duration:0;return t},a.util.StateHistory.prototype.getCopy=function(){for(var e=function(e){return{timestamp:e.timestamp,state:e.state,duration:e.duration}},t=[],r=i.makeIterator(this.closed_),n=r.next();!n.done;n=r.next())t.push(e(n.value));return this.open_&&t.push(e(this.open_)),t},a.util.StateHistory.prototype.start_=function(e){o.asserts.assert(null==this.open_,"There must be no open entry in order when we start"),this.open_={timestamp:this.getNowInSeconds_(),state:e,duration:0}},a.util.StateHistory.prototype.update_=function(e){o.asserts.assert(this.open_,"There must be an open entry in order to update it");var t=this.getNowInSeconds_();this.open_.duration=t-this.open_.timestamp,this.open_.state!=e&&(this.closed_.push(this.open_),this.open_={timestamp:t,state:e,duration:0})},a.util.StateHistory.prototype.getNowInSeconds_=function(){return Date.now()/1e3},a.util.SwitchHistory=function(){this.currentText_=this.currentVariant_=null,this.history_=[]},a.util.SwitchHistory.prototype.updateCurrentVariant=function(e,t){this.currentVariant_!=e&&(this.currentVariant_=e,this.history_.push({timestamp:this.getNowInSeconds_(),id:e.id,type:"variant",fromAdaptation:t,bandwidth:e.bandwidth}))},a.util.SwitchHistory.prototype.updateCurrentText=function(e,t){this.currentText_!=e&&(this.currentText_=e,this.history_.push({timestamp:this.getNowInSeconds_(),id:e.id,type:"text",fromAdaptation:t,bandwidth:null}))},a.util.SwitchHistory.prototype.getCopy=function(){for(var e=[],t=i.makeIterator(this.history_),r=t.next();!r.done;r=t.next())e.push(this.clone_(r.value));return e},a.util.SwitchHistory.prototype.getNowInSeconds_=function(){return Date.now()/1e3},a.util.SwitchHistory.prototype.clone_=function(e){return{timestamp:e.timestamp,id:e.id,type:e.type,fromAdaptation:e.fromAdaptation,bandwidth:e.bandwidth}},a.util.Stats=function(){this.bandwidthEstimate_=this.variantBandwidth_=this.licenseTimeSeconds_=this.loadLatencySeconds_=this.totalCorruptedFrames_=this.totalDecodedFrames_=this.totalDroppedFrames_=this.height_=this.width_=NaN,this.stateHistory_=new a.util.StateHistory,this.switchHistory_=new a.util.SwitchHistory},a.util.Stats.prototype.setDroppedFrames=function(e,t){this.totalDroppedFrames_=e,this.totalDecodedFrames_=t},a.util.Stats.prototype.setCorruptedFrames=function(e){this.totalCorruptedFrames_=e},a.util.Stats.prototype.setResolution=function(e,t){this.width_=e,this.height_=t},a.util.Stats.prototype.setLoadLatency=function(e){this.loadLatencySeconds_=e},a.util.Stats.prototype.setLicenseTime=function(e){this.licenseTimeSeconds_=e},a.util.Stats.prototype.setVariantBandwidth=function(e){this.variantBandwidth_=e},a.util.Stats.prototype.setBandwidthEstimate=function(e){this.bandwidthEstimate_=e},a.util.Stats.prototype.getStateHistory=function(){return this.stateHistory_},a.util.Stats.prototype.getSwitchHistory=function(){return this.switchHistory_},a.util.Stats.prototype.getBlob=function(){return{width:this.width_,height:this.height_,streamBandwidth:this.variantBandwidth_,decodedFrames:this.totalDecodedFrames_,droppedFrames:this.totalDroppedFrames_,corruptedFrames:this.totalCorruptedFrames_,estimatedBandwidth:this.bandwidthEstimate_,loadLatency:this.loadLatencySeconds_,playTime:this.stateHistory_.getTimeSpentIn("playing"),pauseTime:this.stateHistory_.getTimeSpentIn("paused"),bufferingTime:this.stateHistory_.getTimeSpentIn("buffering"),licenseTime:this.licenseTimeSeconds_,stateHistory:this.stateHistory_.getCopy(),switchHistory:this.switchHistory_.getCopy()}},a.util.Stats.getEmptyBlob=function(){return{width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,corruptedFrames:NaN,estimatedBandwidth:NaN,loadLatency:NaN,playTime:NaN,pauseTime:NaN,bufferingTime:NaN,licenseTime:NaN,switchHistory:[],stateHistory:[]}},a.Player=function(t,r){var n=this;a.util.FakeEventTarget.call(this),this.loadMode_=a.Player.LoadMode.NOT_LOADED,this.video_=null,this.isTextVisible_=!1,this.eventManager_=new a.util.EventManager,this.abrManagerFactory_=this.abrManager_=this.assetUri_=this.manifest_=this.parser_=this.streamingEngine_=this.regionTimeline_=this.bufferObserver_=this.bufferPoller_=this.playRateController_=this.playheadObservers_=this.playhead_=this.mediaSourceEngine_=this.drmEngine_=this.networkingEngine_=null,this.nextExternalStreamId_=1e9,this.loadingTextStreams_=new Set,this.switchingPeriods_=!0,this.deferredVariant_=null,this.deferredVariantClearBuffer_=!1,this.deferredVariantClearBufferSafeMargin_=0,this.deferredTextStream_=null,this.activeStreams_=new a.media.ActiveStreamMap,this.config_=this.defaultConfig_(),this.maxHwRes_={width:1/0,height:1/0},this.stats_=null,this.currentAdaptationSetCriteria_=new a.media.PreferenceBasedCriteria(this.config_.preferredAudioLanguage,this.config_.preferredVariantRole,this.config_.preferredAudioChannelCount),this.currentTextLanguage_=this.config_.preferredTextLanguage,this.currentTextRole_=this.config_.preferredTextRole,this.cleanupOnUnload_=[],r&&r(this),this.networkingEngine_=this.createNetworkingEngine(),this.eventManager_.listen(e,"online",(function(){n.retryStreaming()})),this.detachNode_={name:"detach"},this.attachNode_={name:"attach"},this.unloadNode_={name:"unload"},this.parserNode_={name:"manifest-parser"},this.manifestNode_={name:"manifest"},this.mediaSourceNode_={name:"media-source"},this.drmNode_={name:"drm-engine"},this.loadNode_={name:"load"},this.srcEqualsDrmNode_={name:"src-equals-drm-engine"},this.srcEqualsNode_={name:"src-equals"};var o=a.util.AbortableOperation,s=new Map;s.set(this.attachNode_,(function(e,t){return o.notAbortable(n.onAttach_(e,t))})),s.set(this.detachNode_,(function(e,t){return o.notAbortable(n.onDetach_(e,t))})),s.set(this.unloadNode_,(function(e,t){return o.notAbortable(n.onUnload_(e,t))})),s.set(this.mediaSourceNode_,(function(e,t){var r=n.onInitializeMediaSourceEngine_(e,t);return o.notAbortable(r)})),s.set(this.parserNode_,(function(e,t){var r=n.onInitializeParser_(e,t);return o.notAbortable(r)})),s.set(this.manifestNode_,(function(e,t){return n.onParseManifest_(e,t)})),s.set(this.drmNode_,(function(e,t){var r=n.onInitializeDrm_(e,t);return o.notAbortable(r)})),s.set(this.loadNode_,(function(e,t){return o.notAbortable(n.onLoad_(e,t))})),s.set(this.srcEqualsDrmNode_,(function(e,t){var r=n.onInitializeSrcEqualsDrm_(e,t);return o.notAbortable(r)})),s.set(this.srcEqualsNode_,(function(e,t){return n.onSrcEquals_(e,t)})),this.walker_=new a.routing.Walker(this.detachNode_,this.createEmptyPayload_(),{getNext:function(e,t,r,i){return n.getNextStep_(e,t,r,i)},enterNode:function(e,t,r){return n.dispatchEvent(new a.util.FakeEvent("onstatechange",{state:e.name})),s.get(e)(t,r)},handleError:function(e,t){return i.asyncExecutePromiseGeneratorFunction((function r(){return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return a.log.warning("The walker saw an error:"),t instanceof a.util.Error?a.log.warning("Error Code:",t.code):(a.log.warning("Error Message:",t.message),a.log.warning("Error Stack:",t.stack)),r.yield(n.onUnload_(e,n.createEmptyPayload_()),2);case 2:return r.return(e.mediaElement?n.attachNode_:n.detachNode_)}}))}))},onIdle:function(e){n.dispatchEvent(new a.util.FakeEvent("onstateidle",{state:e.name}))}}),t&&this.attach(t,!0)},o.inherits(a.Player,a.util.FakeEventTarget),o.exportSymbol("shaka.Player",a.Player),a.Player.prototype.destroy=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var r;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return e.loadMode_==a.Player.LoadMode.DESTROYED?t.return():(e.loadMode_=a.Player.LoadMode.DESTROYED,r=e.walker_.startNewRoute((function(t){return{node:e.detachNode_,payload:e.createEmptyPayload_(),interruptible:!1}})),t.yield(new Promise((function(t){r.onStart=function(){a.log.info("Preparing to destroy walker...")},r.onEnd=function(){t(),e.dispatchEvent(new a.util.FakeEvent("loaded"))},r.onCancel=function(){o.asserts.assert(!1,"Our final detach call should never be cancelled."),t()},r.onError=function(){o.asserts.assert(!1,"Our final detach call should never see an error"),t()},r.onSkip=function(){o.asserts.assert(!1,"Our final detach call should never be skipped"),t()}})),2));case 2:return t.yield(e.walker_.destroy(),3);case 3:if(e.eventManager_&&(e.eventManager_.release(),e.eventManager_=null),e.abrManagerFactory_=null,e.abrManager_=null,e.config_=null,!e.networkingEngine_){t.jumpTo(0);break}return t.yield(e.networkingEngine_.destroy(),5);case 5:e.networkingEngine_=null,t.jumpToEnd()}}))}))},o.exportProperty(a.Player.prototype,"destroy",a.Player.prototype.destroy),a.Player.version="v2.5.13-debug",o.exportProperty(a.Player,"version",a.Player.version),a.Deprecate.init(a.Player.version),a.Player.restrictedStatuses_=["output-restricted","internal-error"],a.Player.supportPlugins_={},a.Player.registerSupportPlugin=function(e,t){a.Player.supportPlugins_[e]=t},o.exportProperty(a.Player,"registerSupportPlugin",a.Player.registerSupportPlugin),a.Player.isBrowserSupported=function(){if(!(e.Promise&&e.Uint8Array&&Array.prototype.forEach))return!1;var t=a.util.Platform.safariVersion();return!(t&&12>t||!a.media.DrmEngine.isBrowserSupported())&&(!!a.util.Platform.supportsMediaSource()||a.util.Platform.supportsMediaType("application/x-mpegurl"))},o.exportProperty(a.Player,"isBrowserSupported",a.Player.isBrowserSupported),a.Player.probeSupport=function(){return o.asserts.assert(a.Player.isBrowserSupported(),"Must have basic support"),a.media.DrmEngine.probeSupport().then((function(e){var t=a.media.ManifestParser.probeSupport(),r=a.media.MediaSourceEngine.probeSupport();for(var n in e={manifest:t,media:r,drm:e},t=a.Player.supportPlugins_)e[n]=t[n]();return e}))},o.exportProperty(a.Player,"probeSupport",a.Player.probeSupport),a.Player.prototype.attach=function(e,t){if(t=void 0===t||t,this.loadMode_==a.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());var r=this.createEmptyPayload_();r.mediaElement=e,a.util.Platform.supportsMediaSource()||(t=!1);var n=t?this.mediaSourceNode_:this.attachNode_,i=this.walker_.startNewRoute((function(e){return{node:n,payload:r,interruptible:!1}}));return i.onStart=function(){return a.log.info("Starting attach...")},this.wrapWalkerListenersWithPromise_(i)},o.exportProperty(a.Player.prototype,"attach",a.Player.prototype.attach),a.Player.prototype.detach=function(){var e=this;if(this.loadMode_==a.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());var t=this.walker_.startNewRoute((function(t){return{node:e.detachNode_,payload:e.createEmptyPayload_(),interruptible:!1}}));return t.onStart=function(){return a.log.info("Starting detach...")},this.wrapWalkerListenersWithPromise_(t)},o.exportProperty(a.Player.prototype,"detach",a.Player.prototype.detach),a.Player.prototype.unload=function(e){var t=this;if(e=void 0===e||e,this.loadMode_==a.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());a.util.Platform.supportsMediaSource()||(e=!1);var r=this.createEmptyPayload_(),n=this.walker_.startNewRoute((function(n){var i=n.mediaElement&&e?t.mediaSourceNode_:n.mediaElement?t.attachNode_:t.detachNode_;return o.asserts.assert(i,"We should have picked a destination."),r.mediaElement=n.mediaElement,{node:i,payload:r,interruptible:!1}}));return n.onStart=function(){return a.log.info("Starting unload...")},this.wrapWalkerListenersWithPromise_(n)},o.exportProperty(a.Player.prototype,"unload",a.Player.prototype.unload),a.Player.prototype.load=function(e,t,r){var n=this;if(this.loadMode_==a.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());this.dispatchEvent(new a.util.FakeEvent("loading"));var i=this.createEmptyPayload_();i.uri=e,i.startTimeOfLoad=Date.now()/1e3,r&&"string"!=typeof r&&(a.Deprecate.deprecateFeature(2,6,"Loading with a manifest parser factory","Please register a manifest parser and for the mime-type."),i.factory=function(){return new r}),r&&"string"==typeof r&&(i.mimeType=r),void 0!==t&&(i.startTime=t);var o=this.shouldUseSrcEquals_(i)?this.srcEqualsNode_:this.loadNode_,s=this.walker_.startNewRoute((function(e){return null==e.mediaElement?null:(i.mediaElement=e.mediaElement,{node:o,payload:i,interruptible:!0})}));return s.onStart=function(){return a.log.info("Starting load of "+e+"...")},new Promise((function(e,t){s.onSkip=function(){return t(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.PLAYER,a.util.Error.Code.NO_VIDEO_ELEMENT))},s.onEnd=function(){return e()},s.onCancel=function(){return t(n.createAbortLoadError_())},s.onError=function(e){return t(e)}}))},o.exportProperty(a.Player.prototype,"load",a.Player.prototype.load),a.Player.prototype.shouldUseSrcEquals_=function(e){var t=a.util.Platform;if(e.factory)return!1;if(!t.supportsMediaSource())return!0;var r=e.mimeType,n=e.uri||"";return r||(r={mp4:"video/mp4",m4v:"video/mp4",m4a:"audio/mp4",webm:"video/webm",weba:"audio/webm",mkv:"video/webm",ts:"video/mp2t",ogv:"video/ogg",ogg:"audio/ogg",mpg:"video/mpeg",mpeg:"video/mpeg",m3u8:"application/x-mpegurl",mp3:"audio/mpeg",aac:"audio/aac",flac:"audio/flac",wav:"audio/wav"}[a.media.ManifestParser.getExtension(n)]),!!r&&((e=""!=(e.mediaElement||t.anyMediaElement()).canPlayType(r))&&(!(r=a.media.ManifestParser.isSupported(n,r))||(o.asserts.assert(e&&r,"Both native and MSE playback should be possible!"),t.isApple()&&this.config_.streaming.useNativeHlsOnSafari)))},a.Player.prototype.onAttach_=function(e,t){var r=this;return o.asserts.assert(null==e.mediaElement||e.mediaElement==t.mediaElement,"The routing logic failed. MediaElement requirement failed."),null==e.mediaElement&&(e.mediaElement=t.mediaElement,this.eventManager_.listen(e.mediaElement,"error",(function(e){return r.onVideoError_(e)}))),this.video_=e.mediaElement,Promise.resolve()},a.Player.prototype.onDetach_=function(e,t){return e.mediaElement&&(this.eventManager_.unlisten(e.mediaElement,"error"),e.mediaElement=null),this.video_=null,Promise.resolve()},a.Player.prototype.onUnload_=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var n;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return r.loadMode_!=a.Player.LoadMode.DESTROYED&&(r.loadMode_=a.Player.LoadMode.NOT_LOADED),n=r.cleanupOnUnload_.map((function(e){return e()})),r.cleanupOnUnload_=[],t.yield(Promise.all(n),2);case 2:if(r.dispatchEvent(new a.util.FakeEvent("unloading")),e.factory=null,e.mimeType=null,e.startTime=null,e.uri=null,e.mediaElement&&(r.eventManager_.unlisten(e.mediaElement,"loadedmetadata"),r.eventManager_.unlisten(e.mediaElement,"playing"),r.eventManager_.unlisten(e.mediaElement,"pause"),r.eventManager_.unlisten(e.mediaElement,"ended"),r.eventManager_.unlisten(e.mediaElement,"ratechange")),r.playheadObservers_&&(r.playheadObservers_.release(),r.playheadObservers_=null),r.bufferPoller_&&(r.bufferPoller_.stop(),r.bufferPoller_=null),!r.parser_){t.jumpTo(3);break}return t.yield(r.parser_.stop(),4);case 4:r.parser_=null;case 3:if(!r.abrManager_){t.jumpTo(5);break}return t.yield(r.abrManager_.stop(),5);case 5:if(!r.streamingEngine_){t.jumpTo(7);break}return t.yield(r.streamingEngine_.destroy(),8);case 8:r.streamingEngine_=null;case 7:if(r.playRateController_&&(r.playRateController_.release(),r.playRateController_=null),r.playhead_&&(r.playhead_.release(),r.playhead_=null),!r.mediaSourceEngine_){t.jumpTo(9);break}return t.yield(r.mediaSourceEngine_.destroy(),10);case 10:r.mediaSourceEngine_=null;case 9:if(!e.mediaElement||!e.mediaElement.src){t.jumpTo(11);break}return t.yield(new Promise((function(e){return new a.util.Timer(e).tickAfter(.1)})),12);case 12:e.mediaElement.removeAttribute("src"),e.mediaElement.load();case 11:if(!r.drmEngine_){t.jumpTo(13);break}return t.yield(r.drmEngine_.destroy(),14);case 14:r.drmEngine_=null;case 13:r.activeStreams_.clear(),r.assetUri_=null,r.bufferObserver_=null,r.loadingTextStreams_.clear(),r.manifest_=null,r.stats_=null,r.lastTextFactory_=null,r.switchingPeriods_=!0,r.updateBufferState_(),t.jumpToEnd()}}))}))},a.Player.prototype.onInitializeMediaSourceEngine_=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var s,l,u,c;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return o.asserts.assert(a.util.Platform.supportsMediaSource(),"We should not be initializing media source on a platform that does not support media source."),o.asserts.assert(e.mediaElement,"We should have a media element when initializing media source."),o.asserts.assert(e.mediaElement==t.mediaElement,"|has| and |wants| should have the same media element when initializing media source."),o.asserts.assert(null==r.mediaSourceEngine_,"We should not have a media source engine yet."),s=a.media.MuxJSClosedCaptionParser.isSupported()?new a.media.MuxJSClosedCaptionParser:new a.media.NoopCaptionParser,l=r.config_.textDisplayFactory,u=new l,r.lastTextFactory_=l,c=r.createMediaSourceEngine(e.mediaElement,s,u),n.yield(c.open(),2);case 2:r.mediaSourceEngine_=c,n.jumpToEnd()}}))}))},a.Player.prototype.onInitializeParser_=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var s,l,u,c;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:if(o.asserts.assert(e.mediaElement,"We should have a media element when initializing the parser."),o.asserts.assert(e.mediaElement==t.mediaElement,"|has| and |wants| should have the same media element when initializing the parser."),o.asserts.assert(r.networkingEngine_,"Need networking engine when initializing the parser."),o.asserts.assert(r.config_,"Need player config when initializing the parser."),e.factory=t.factory,e.mimeType=t.mimeType,e.uri=t.uri,o.asserts.assert(e.uri,"We should have an asset uri when initializing the parsing."),s=e.uri,l=r.networkingEngine_,r.assetUri_=s,e.factory){r.parser_=e.factory(),n.jumpTo(2);break}return u=r,n.yield(a.media.ManifestParser.create(s,l,r.config_.manifest.retryParameters,e.mimeType),3);case 3:u.parser_=n.yieldResult;case 2:c=a.util.ObjectUtils.cloneObject(r.config_.manifest),t.mediaElement&&"AUDIO"===t.mediaElement.nodeName&&(c.disableVideo=!0),r.parser_.configure(c),n.jumpToEnd()}}))}))},a.Player.prototype.onParseManifest_=function(e,t){var r=this;o.asserts.assert(e.factory==t.factory,"|has| and |wants| should have the same factory when parsing."),o.asserts.assert(e.mimeType==t.mimeType,"|has| and |wants| should have the same mime type when parsing."),o.asserts.assert(e.uri==t.uri,"|has| and |wants| should have the same uri when parsing."),o.asserts.assert(e.uri,"|has| should have a valid uri when parsing."),o.asserts.assert(e.uri==this.assetUri_,"|has.uri| should match the cached asset uri."),o.asserts.assert(this.networkingEngine_,"Need networking engine to parse manifest."),o.asserts.assert(this.config_,"Need player config to parse manifest."),o.asserts.assert(this.parser_,"|this.parser_| should have been set in an earlier step.");var n=e.uri,s=this.networkingEngine_;this.regionTimeline_=new a.media.RegionTimeline,this.regionTimeline_.setListeners((function(e){r.onRegionEvent_("timelineregionadded",e)}));var l={networkingEngine:s,filterNewPeriod:function(e){return r.filterNewPeriod_(e)},filterAllPeriods:function(e){return r.filterAllPeriods_(e)},onTimelineRegionAdded:function(e){return r.regionTimeline_.addRegion(e)},onEvent:function(e){return r.dispatchEvent(e)},onError:function(e){return r.onError_(e)}};return new a.util.AbortableOperation(Promise.resolve().then((function(){return i.asyncExecutePromiseGeneratorFunction((function e(){var t;return i.generator.createGenerator(e,(function(e){switch(e.nextAddress){case 1:return t=r,e.yield(r.parser_.start(n,l),2);case 2:if(t.manifest_=e.yieldResult,r.dispatchEvent(new a.util.FakeEvent("manifestparsed")),0==r.manifest_.periods.length)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.NO_PERIODS);a.Player.filterForAVVariants_(r.manifest_.periods),e.jumpToEnd()}}))}))})),(function(){return a.log.info("Aborting parser step..."),r.parser_.stop()}))},a.Player.prototype.onInitializeDrm_=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return o.asserts.assert(e.factory==t.factory,"The load graph should have ensured the factories matched."),o.asserts.assert(e.mimeType==t.mimeType,"The load graph should have ensured the mime types matched."),o.asserts.assert(e.uri==t.uri,"The load graph should have ensured the uris matched"),o.asserts.assert(r.networkingEngine_,"|onInitializeDrm_| should never be called after |destroy|"),o.asserts.assert(r.config_,"|onInitializeDrm_| should never be called after |destroy|"),o.asserts.assert(r.manifest_,"|this.manifest_| should have been set in an earlier step."),r.drmEngine_=r.createDrmEngine({netEngine:r.networkingEngine_,onError:function(e){r.onError_(e)},onKeyStatus:function(e){r.onKeyStatus_(e)},onExpirationUpdated:function(e,t){r.onExpirationUpdated_(e,t)},onEvent:function(e){r.dispatchEvent(e)}}),r.drmEngine_.configure(r.config_.drm),n.yield(r.drmEngine_.initForPlayback(a.util.Periods.getAllVariantsFrom(r.manifest_.periods),r.manifest_.offlineSessionIds),2);case 2:r.filterAllPeriods_(r.manifest_.periods),n.jumpToEnd()}}))}))},a.Player.prototype.onLoad_=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var s,l,u,c,d,p,f,h,m,g;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return o.asserts.assert(e.factory==t.factory,"|has| and |wants| should have the same factory when loading."),o.asserts.assert(e.mimeType==t.mimeType,"|has| and |wants| should have the same mime type when loading."),o.asserts.assert(e.uri==t.uri,"|has| and |wants| should have the same uri when loading."),o.asserts.assert(e.mediaElement,"We should have a media element when loading."),o.asserts.assert(t.startTimeOfLoad,"|wants| should tell us when the load was originally requested"),e.startTime=t.startTime,s=e.mediaElement,l=e.uri,r.assetUri_=l,r.playRateController_=new a.media.PlayRateController({getRate:function(){return e.mediaElement.playbackRate},setRate:function(t){e.mediaElement.playbackRate=t},movePlayhead:function(t){e.mediaElement.currentTime+=t}}),r.stats_=new a.util.Stats,u=function(){return r.updateStateHistory_()},c=function(){return r.onRateChange_()},r.eventManager_.listen(s,"playing",u),r.eventManager_.listen(s,"pause",u),r.eventManager_.listen(s,"ended",u),r.eventManager_.listen(s,"ratechange",c),d=r.config_.abrFactory,r.abrManager_&&r.abrManagerFactory_==d||(r.abrManagerFactory_=d,r.abrManager_=new d,r.abrManager_.configure(r.config_.abr)),r.createTextStreamsForClosedCaptions_(r.manifest_.periods),r.currentAdaptationSetCriteria_=new a.media.PreferenceBasedCriteria(r.config_.preferredAudioLanguage,r.config_.preferredVariantRole,r.config_.preferredAudioChannelCount),r.currentTextLanguage_=r.config_.preferredTextLanguage,a.Player.applyPlayRange_(r.manifest_.presentationTimeline,r.config_.playRangeStart,r.config_.playRangeEnd),n.yield(r.drmEngine_.attach(s),2);case 2:return r.abrManager_.init((function(e,t,n){return r.switch_(e,t,n)})),r.playhead_=r.createPlayhead(e.startTime),r.playheadObservers_=r.createPlayheadObserversForMSE_(),p=Math.max(r.manifest_.minBufferTime,r.config_.streaming.rebufferingGoal),r.startBufferManagement_(p),r.streamingEngine_=r.createStreamingEngine(),r.streamingEngine_.configure(r.config_.streaming),a.util.StreamUtils.chooseCodecsAndFilterManifest(r.manifest_,r.config_.preferredAudioChannelCount),r.loadMode_=a.Player.LoadMode.MEDIA_SOURCE,r.dispatchEvent(new a.util.FakeEvent("streaming")),n.yield(r.streamingEngine_.start(),3);case 3:r.config_.streaming.startAtSegmentBoundary&&(f=r.playhead_.getTime(),h=r.adjustStartTime_(f),r.playhead_.setStartTime(h)),r.manifest_.periods.forEach(r.filterNewPeriod_.bind(r)),r.onTracksChanged_(),r.onAdaptation_(),m=r.getPresentationPeriod_()||r.manifest_.periods[0],g=m.variants.some((function(e){return e.primary})),r.config_.preferredAudioLanguage||g||a.log.warning("No preferred audio language set.  We will choose an arbitrary language initially"),r.chooseVariant_(m.variants),r.eventManager_.listenOnce(s,"loadedmetadata",(function(){var e=Date.now()/1e3-t.startTimeOfLoad;r.stats_.setLoadLatency(e)})),n.jumpToEnd()}}))}))},a.Player.prototype.onInitializeSrcEqualsDrm_=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var n,s;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return n=a.util.ManifestParserUtils.ContentType,o.asserts.assert(r.networkingEngine_,"|onInitializeSrcEqualsDrm_| should never be called after |destroy|"),o.asserts.assert(r.config_,"|onInitializeSrcEqualsDrm_| should never be called after |destroy|"),r.drmEngine_=r.createDrmEngine({netEngine:r.networkingEngine_,onError:function(e){r.onError_(e)},onKeyStatus:function(e){r.onKeyStatus_(e)},onExpirationUpdated:function(e,t){r.onExpirationUpdated_(e,t)},onEvent:function(e){r.dispatchEvent(e)}}),r.drmEngine_.configure(r.config_.drm),s={id:0,language:"und",primary:!1,audio:null,video:{id:0,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(e){return null},getSegmentReference:function(e){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:"video/mp4",codecs:"",encrypted:!0,keyId:null,language:"und",label:null,type:n.VIDEO,primary:!1,frameRate:void 0,pixelAspectRatio:void 0,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null},bandwidth:100,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0},t.yield(r.drmEngine_.initForPlayback([s],[]),2);case 2:return t.yield(r.drmEngine_.attach(e.mediaElement),0)}}))}))},a.Player.prototype.onSrcEquals_=function(e,t){var r=this;o.asserts.assert(e.mediaElement,"We should have a media element when loading."),o.asserts.assert(t.uri,"|has| should have a valid uri when loading."),o.asserts.assert(t.startTimeOfLoad,"|wants| should tell us when the load was originally requested"),o.asserts.assert(this.video_==e.mediaElement,"The video element should match our media element"),e.uri=t.uri,e.startTime=t.startTime,this.assetUri_=e.uri,this.stats_=new a.util.Stats,this.playhead_=new a.media.SrcEqualsPlayhead(e.mediaElement),null!=e.startTime&&this.playhead_.setStartTime(e.startTime),this.playRateController_=new a.media.PlayRateController({getRate:function(){return e.mediaElement.playbackRate},setRate:function(t){e.mediaElement.playbackRate=t},movePlayhead:function(t){e.mediaElement.currentTime+=t}}),this.startBufferManagement_(this.config_.streaming.rebufferingGoal);var n=function(){return r.updateStateHistory_()};this.eventManager_.listen(e.mediaElement,"playing",n),this.eventManager_.listen(e.mediaElement,"pause",n),this.eventManager_.listen(e.mediaElement,"ended",n),this.eventManager_.listen(e.mediaElement,"ratechange",(function(){return r.onRateChange_()})),"none"!=this.video_.preload&&this.eventManager_.listenOnce(e.mediaElement,"loadedmetadata",(function(){var e=Date.now()/1e3-t.startTimeOfLoad;r.stats_.setLoadLatency(e)})),this.video_.audioTracks&&(this.eventManager_.listen(this.video_.audioTracks,"addtrack",(function(){return r.onTracksChanged_()})),this.eventManager_.listen(this.video_.audioTracks,"removetrack",(function(){return r.onTracksChanged_()})),this.eventManager_.listen(this.video_.audioTracks,"change",(function(){return r.onTracksChanged_()}))),this.video_.textTracks&&(n=this.video_.textTracks,this.eventManager_.listen(n,"addtrack",(function(){return r.onTracksChanged_()})),this.eventManager_.listen(n,"removetrack",(function(){return r.onTracksChanged_()})),this.eventManager_.listen(n,"change",(function(){return r.onTracksChanged_()}))),e.mediaElement.src=e.uri,this.loadMode_=a.Player.LoadMode.SRC_EQUALS,this.dispatchEvent(new a.util.FakeEvent("streaming"));var s=new a.util.PublicPromise;a.util.MediaReadyState.waitForReadyState(this.video_,HTMLMediaElement.HAVE_METADATA,this.eventManager_,(function(){s.resolve()}));var l=!1;return this.cleanupOnUnload_.push((function(){l=!0})),a.util.MediaReadyState.waitForReadyState(this.video_,HTMLMediaElement.HAVE_CURRENT_DATA,this.eventManager_,(function(){return i.asyncExecutePromiseGeneratorFunction((function e(){return i.generator.createGenerator(e,(function(e){switch(e.nextAddress){case 1:if(l)return e.return();if(r.setupPreferredAudioOnSrc_(),r.filterTextTracks_().find((function(e){return"disabled"!=e.mode}))){e.jumpTo(2);break}return e.yield(new Promise((function(e){r.eventManager_.listenOnce(r.video_.textTracks,"change",e),new a.util.Timer(e).tickAfter(1)})),2);case 2:if(l)return e.return();r.setupPreferredTextOnSrc_(),e.jumpToEnd()}}))}))})),this.video_.error?s.reject(this.videoErrorToShakaError_()):"none"==this.video_.preload&&(a.log.alwaysWarn('With <video preload="none">, the browser will not load anything until play() is called. We are unable to measure load latency in a meaningful way, and we cannot provide track info yet. Please do not use preload="none" with Shaka Player.'),s.resolve()),this.eventManager_.listenOnce(this.video_,"error",(function(){s.reject(r.videoErrorToShakaError_())})),new a.util.AbortableOperation(s,(function(){var e=new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.PLAYER,a.util.Error.Code.OPERATION_ABORTED);return s.reject(e),Promise.resolve()}))},a.Player.prototype.setupPreferredAudioOnSrc_=function(){var e=this.config_.preferredAudioLanguage;if(""!=e){this.selectAudioLanguage(e);var t=this.config_.preferredVariantRole;""!=t&&this.selectAudioLanguage(e,t)}},a.Player.prototype.setupPreferredTextOnSrc_=function(){var e=this.config_.preferredTextLanguage;if(""!=e){this.selectTextLanguage(e);var t=this.config_.preferredTextRole;""!=t&&this.selectTextLanguage(e,t)}},a.Player.filterForAVVariants_=function(e){var t=function(e){return e.video&&e.audio||e.video&&e.video.codecs.includes(",")};e.some((function(e){return e.variants.some(t)}))&&(a.log.debug("Found variant with audio and video content, so filtering out audio-only content in all periods."),e.forEach((function(e){e.variants=e.variants.filter(t)})))},a.Player.prototype.createDrmEngine=function(e){return new a.media.DrmEngine(e,this.config_.drm.updateExpirationTime)},a.Player.prototype.createNetworkingEngine=function(){var e=this;return new a.net.NetworkingEngine((function(t,r){e.abrManager_&&e.abrManager_.segmentDownloaded(t,r)}))},a.Player.prototype.createPlayhead=function(e){var t=this;return o.asserts.assert(this.manifest_,"Must have manifest"),o.asserts.assert(this.video_,"Must have video"),new a.media.MediaSourcePlayhead(this.video_,this.manifest_,this.config_.streaming,e,(function(){return t.onSeek_()}),(function(e){return t.dispatchEvent(e)}))},a.Player.prototype.createPlayheadObserversForMSE_=function(){var e=this;o.asserts.assert(this.manifest_,"Must have manifest"),o.asserts.assert(this.regionTimeline_,"Must have region timeline"),o.asserts.assert(this.video_,"Must have video element");var t=new a.media.PeriodObserver(this.manifest_);t.setListeners((function(t){return e.onChangePeriod_()}));var r=new a.media.RegionObserver(this.regionTimeline_);r.setListeners((function(t,r){e.onRegionEvent_("timelineregionenter",t)}),(function(t,r){e.onRegionEvent_("timelineregionexit",t)}),(function(t,r){r||(e.onRegionEvent_("timelineregionenter",t),e.onRegionEvent_("timelineregionexit",t))}));var n=new a.media.PlayheadObserverManager(this.video_);return n.manage(t),n.manage(r),n},a.Player.prototype.startBufferManagement_=function(e){var t=this;o.asserts.assert(!this.bufferObserver_,"No buffering observer should exist before initialization."),o.asserts.assert(!this.bufferPoller_,"No buffer timer should exist before initialization."),this.bufferObserver_=new a.media.BufferingObserver(1,2),this.bufferObserver_.setState(a.media.BufferingObserver.State.STARVING),this.updateBufferingSettings_(e),this.updateBufferState_(),this.bufferPoller_=new a.util.Timer((function(){t.pollBufferState_()})).tickEvery(.25)},a.Player.prototype.updateBufferingSettings_=function(e){this.bufferObserver_.setThresholds(e,Math.min(a.Player.TYPICAL_BUFFERING_THRESHOLD_,e/2))},a.Player.prototype.pollBufferState_=function(){switch(o.asserts.assert(this.video_,"Need a media element to update the buffering observer"),o.asserts.assert(this.bufferObserver_,"Need a buffering observer to update"),this.loadMode_){case a.Player.LoadMode.SRC_EQUALS:var e=this.isBufferedToEndSrc_();break;case a.Player.LoadMode.MEDIA_SOURCE:e=this.isBufferedToEndMS_();break;default:e=!1}var t=a.media.TimeRangesUtils.bufferedAheadOf(this.video_.buffered,this.video_.currentTime);this.bufferObserver_.update(t,e)&&this.updateBufferState_()},a.Player.prototype.createMediaSourceEngine=function(e,t,r){return new a.media.MediaSourceEngine(e,t,r)},a.Player.prototype.createStreamingEngine=function(){var e=this;o.asserts.assert(this.playhead_&&this.abrManager_&&this.mediaSourceEngine_&&this.manifest_,"Must not be destroyed");var t={getPresentationTime:function(){return e.playhead_.getTime()},getBandwidthEstimate:function(){return e.abrManager_.getBandwidthEstimate()},mediaSourceEngine:this.mediaSourceEngine_,netEngine:this.networkingEngine_,onChooseStreams:this.onChooseStreams_.bind(this),onCanSwitch:this.canSwitch_.bind(this),onError:this.onError_.bind(this),onEvent:function(t){return e.dispatchEvent(t)},onManifestUpdate:this.onManifestUpdate_.bind(this),onSegmentAppended:this.onSegmentAppended_.bind(this)};return new a.media.StreamingEngine(this.manifest_,t)},a.Player.prototype.configure=function(e,t){o.asserts.assert(this.config_,"Config must not be null!"),o.asserts.assert("object"==typeof e||2==arguments.length,"String configs should have values!"),2==arguments.length&&"string"==typeof e&&(e=a.util.ConfigUtils.convertToConfigObject(e,t)),o.asserts.assert("object"==typeof e,"Should be an object!");var r=a.util.PlayerConfiguration.mergeConfigObjects(this.config_,e,this.defaultConfig_());return this.applyConfig_(),r},o.exportProperty(a.Player.prototype,"configure",a.Player.prototype.configure),a.Player.prototype.applyConfig_=function(){if(this.parser_){var e=a.util.ObjectUtils.cloneObject(this.config_.manifest);this.video_&&"AUDIO"===this.video_.nodeName&&(e.disableVideo=!0),this.parser_.configure(e)}if(this.drmEngine_&&this.drmEngine_.configure(this.config_.drm),this.streamingEngine_){this.streamingEngine_.configure(this.config_.streaming);try{this.manifest_.periods.forEach(this.filterNewPeriod_.bind(this))}catch(e){this.onError_(e)}var t=this.streamingEngine_.getBufferingAudio(),r=this.streamingEngine_.getBufferingVideo();e=this.getPresentationPeriod_(),t=a.util.StreamUtils.getVariantByStreams(t,r,e.variants),this.abrManager_&&t&&t.allowedByApplication&&t.allowedByKeySystem?this.chooseVariant_(e.variants):(a.log.debug("Choosing new streams after changing configuration"),this.chooseStreamsAndSwitch_(e))}this.mediaSourceEngine_&&(e=this.config_.textDisplayFactory,this.lastTextFactory_!=e&&(t=new e,this.mediaSourceEngine_.setTextDisplayer(t),this.lastTextFactory_=e,this.streamingEngine_&&this.streamingEngine_.reloadTextStream())),this.abrManager_&&(this.abrManager_.configure(this.config_.abr),this.config_.abr.enabled&&!this.switchingPeriods_?this.abrManager_.enable():this.abrManager_.disable(),this.onAbrStatusChanged_()),this.bufferObserver_&&(e=this.config_.streaming.rebufferingGoal,this.manifest_&&(e=Math.max(e,this.manifest_.minBufferTime)),this.updateBufferingSettings_(e))},a.Player.prototype.getConfiguration=function(){o.asserts.assert(this.config_,"Config must not be null!");var e=this.defaultConfig_();return a.util.PlayerConfiguration.mergeConfigObjects(e,this.config_,this.defaultConfig_()),e},o.exportProperty(a.Player.prototype,"getConfiguration",a.Player.prototype.getConfiguration),a.Player.prototype.getSharedConfiguration=function(){return o.asserts.assert(this.config_,"Cannot call getSharedConfiguration after call destroy!"),this.config_},a.Player.prototype.resetConfiguration=function(){for(var e in o.asserts.assert(this.config_,"Cannot be destroyed"),this.config_)delete this.config_[e];a.util.PlayerConfiguration.mergeConfigObjects(this.config_,this.defaultConfig_(),this.defaultConfig_()),this.applyConfig_()},o.exportProperty(a.Player.prototype,"resetConfiguration",a.Player.prototype.resetConfiguration),a.Player.prototype.getLoadMode=function(){return this.loadMode_},o.exportProperty(a.Player.prototype,"getLoadMode",a.Player.prototype.getLoadMode),a.Player.prototype.getMediaElement=function(){return this.video_},o.exportProperty(a.Player.prototype,"getMediaElement",a.Player.prototype.getMediaElement),a.Player.prototype.getNetworkingEngine=function(){return this.networkingEngine_},o.exportProperty(a.Player.prototype,"getNetworkingEngine",a.Player.prototype.getNetworkingEngine),a.Player.prototype.getAssetUri=function(){return this.assetUri_},o.exportProperty(a.Player.prototype,"getAssetUri",a.Player.prototype.getAssetUri),a.Player.prototype.getManifestUri=function(){return a.Deprecate.deprecateFeature(2,6,"getManifestUri",'Please use "getAssetUri" instead.'),this.getAssetUri()},o.exportProperty(a.Player.prototype,"getManifestUri",a.Player.prototype.getManifestUri),a.Player.prototype.isLive=function(){return this.manifest_?this.manifest_.presentationTimeline.isLive():!(!this.video_||!this.video_.src)&&1/0==this.video_.duration},o.exportProperty(a.Player.prototype,"isLive",a.Player.prototype.isLive),a.Player.prototype.isInProgress=function(){return!!this.manifest_&&this.manifest_.presentationTimeline.isInProgress()},o.exportProperty(a.Player.prototype,"isInProgress",a.Player.prototype.isInProgress),a.Player.prototype.isAudioOnly=function(){if(this.manifest_){if(!this.manifest_.periods.length)return!1;var e=this.manifest_.periods[0].variants;return!!e.length&&!e[0].video}return!(!this.video_||!this.video_.src)&&(this.video_.videoTracks?0==this.video_.videoTracks.length:0==this.video_.videoHeight)},o.exportProperty(a.Player.prototype,"isAudioOnly",a.Player.prototype.isAudioOnly),a.Player.prototype.seekRange=function(){if(this.manifest_){var e=this.manifest_.presentationTimeline;return{start:e.getSeekRangeStart(),end:e.getSeekRangeEnd()}}return this.video_&&this.video_.src&&(e=this.video_.seekable).length?{start:e.start(0),end:e.end(e.length-1)}:{start:0,end:0}},o.exportProperty(a.Player.prototype,"seekRange",a.Player.prototype.seekRange),a.Player.prototype.keySystem=function(){return a.media.DrmEngine.keySystem(this.drmInfo())},o.exportProperty(a.Player.prototype,"keySystem",a.Player.prototype.keySystem),a.Player.prototype.drmInfo=function(){return this.drmEngine_?this.drmEngine_.getDrmInfo():null},o.exportProperty(a.Player.prototype,"drmInfo",a.Player.prototype.drmInfo),a.Player.prototype.getExpiration=function(){return this.drmEngine_?this.drmEngine_.getExpiration():1/0},o.exportProperty(a.Player.prototype,"getExpiration",a.Player.prototype.getExpiration),a.Player.prototype.isBuffering=function(){var e=a.media.BufferingObserver.State;return!!this.bufferObserver_&&this.bufferObserver_.getState()==e.STARVING},o.exportProperty(a.Player.prototype,"isBuffering",a.Player.prototype.isBuffering),a.Player.prototype.getPlaybackRate=function(){return this.playRateController_?this.playRateController_.getActiveRate():0},o.exportProperty(a.Player.prototype,"getPlaybackRate",a.Player.prototype.getPlaybackRate),a.Player.prototype.trickPlay=function(e){o.asserts.assert(0!=e,"Should never set a trick play rate of 0!"),0==e?a.log.alwaysWarn("A trick play rate of 0 is unsupported!"):(this.video_.paused&&this.video_.play(),this.playRateController_&&this.playRateController_.set(e),this.loadMode_==a.Player.LoadMode.MEDIA_SOURCE&&this.streamingEngine_.setTrickPlay(1<Math.abs(e)))},o.exportProperty(a.Player.prototype,"trickPlay",a.Player.prototype.trickPlay),a.Player.prototype.cancelTrickPlay=function(){this.loadMode_==a.Player.LoadMode.SRC_EQUALS&&this.playRateController_.set(1),this.loadMode_==a.Player.LoadMode.MEDIA_SOURCE&&(this.playRateController_.set(1),this.streamingEngine_.setTrickPlay(!1))},o.exportProperty(a.Player.prototype,"cancelTrickPlay",a.Player.prototype.cancelTrickPlay),a.Player.prototype.getVariantTracks=function(){if(this.manifest_&&this.playhead_){for(var e=this.getPresentationVariant_(),t=[],r=i.makeIterator(this.getSelectableVariants_()),n=r.next();!n.done;n=r.next()){n=n.value;var o=a.util.StreamUtils.variantToTrack(n);o.active=n==e,t.push(o)}return t}return this.video_&&this.video_.audioTracks?Array.from(this.video_.audioTracks).map((function(e){return a.util.StreamUtils.html5AudioTrackToTrack(e)})):[]},o.exportProperty(a.Player.prototype,"getVariantTracks",a.Player.prototype.getVariantTracks),a.Player.prototype.getTextTracks=function(){if(this.manifest_&&this.playhead_){for(var e=this.getPresentationText_(),t=[],r=i.makeIterator(this.getSelectableText_()),n=r.next();!n.done;n=r.next()){n=n.value;var o=a.util.StreamUtils.textStreamToTrack(n);o.active=n==e,t.push(o)}return t}if(this.video_&&this.video_.src&&this.video_.textTracks){e=this.filterTextTracks_();var s=a.util.StreamUtils;return e.map((function(e){return s.html5TextTrackToTrack(e)}))}return[]},o.exportProperty(a.Player.prototype,"getTextTracks",a.Player.prototype.getTextTracks),a.Player.prototype.selectTextTrack=function(e){if(this.manifest_&&this.streamingEngine_){var t=this.getPresentationPeriod_(),r=t.textStreams.find((function(t){return t.id==e.id}));r?(this.addTextStreamToSwitchHistory_(t,r,!1),this.switchTextStream_(r),this.currentTextLanguage_=r.language):a.log.error("No stream with id",e.id)}else if(this.video_&&this.video_.src&&this.video_.textTracks){for(t=this.filterTextTracks_(),r=(t=i.makeIterator(t)).next();!r.done;r=t.next())r=r.value,a.util.StreamUtils.html5TrackId(r)==e.id?r.mode=this.isTextVisible_?"showing":"hidden":r.mode="disabled";this.onTextChanged_()}},o.exportProperty(a.Player.prototype,"selectTextTrack",a.Player.prototype.selectTextTrack),a.Player.prototype.selectEmbeddedTextTrack=function(){a.Deprecate.deprecateFeature(2,6,"selectEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. Please use SelectTextTrack.");var e=this.getTextTracks().filter((function(e){return e.mimeType==a.util.MimeUtils.CLOSED_CAPTION_MIMETYPE}));0<e.length?this.selectTextTrack(e[0]):a.log.warning("Unable to find the text track embedded in the video.")},o.exportProperty(a.Player.prototype,"selectEmbeddedTextTrack",a.Player.prototype.selectEmbeddedTextTrack),a.Player.prototype.usingEmbeddedTextTrack=function(){a.Deprecate.deprecateFeature(2,6,"usingEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. There should be no reason to know if the player is playing embedded text.");var e=this.getTextTracks().filter((function(e){return e.active}))[0];return!!e&&e.mimeType==a.util.MimeUtils.CLOSED_CAPTION_MIMETYPE},o.exportProperty(a.Player.prototype,"usingEmbeddedTextTrack",a.Player.prototype.usingEmbeddedTextTrack),a.Player.prototype.selectVariantTrack=function(e,t,r){if(r=void 0===r?0:r,this.manifest_&&this.streamingEngine_){var n=this.getPresentationPeriod_();this.config_.abr.enabled&&a.log.alwaysWarn("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack().");var o=n.variants.find((function(t){return t.id==e.id}));o?a.util.StreamUtils.isPlayable(o)?(this.addVariantToSwitchHistory_(n,o,!1),this.switchVariant_(o,t,r),this.currentAdaptationSetCriteria_=new a.media.ExampleBasedCriteria(o),this.chooseVariant_(n.variants)):a.log.error("Unable to switch to restricted track",e.id):a.log.error("No variant with id",e.id)}else if(this.video_&&this.video_.audioTracks){for(t=Array.from(this.video_.audioTracks),r=(t=i.makeIterator(t)).next();!r.done;r=t.next())r=r.value,a.util.StreamUtils.html5TrackId(r)==e.id&&(r.enabled=!0);this.onVariantChanged_()}},o.exportProperty(a.Player.prototype,"selectVariantTrack",a.Player.prototype.selectVariantTrack),a.Player.prototype.getAudioLanguagesAndRoles=function(){return a.Player.getLanguageAndRolesFrom_(this.getVariantTracks())},o.exportProperty(a.Player.prototype,"getAudioLanguagesAndRoles",a.Player.prototype.getAudioLanguagesAndRoles),a.Player.prototype.getTextLanguagesAndRoles=function(){return a.Player.getLanguageAndRolesFrom_(this.getTextTracks())},o.exportProperty(a.Player.prototype,"getTextLanguagesAndRoles",a.Player.prototype.getTextLanguagesAndRoles),a.Player.prototype.getAudioLanguages=function(){return Array.from(a.Player.getLanguagesFrom_(this.getVariantTracks()))},o.exportProperty(a.Player.prototype,"getAudioLanguages",a.Player.prototype.getAudioLanguages),a.Player.prototype.getTextLanguages=function(){return Array.from(a.Player.getLanguagesFrom_(this.getTextTracks()))},o.exportProperty(a.Player.prototype,"getTextLanguages",a.Player.prototype.getTextLanguages),a.Player.prototype.selectAudioLanguage=function(e,t){var r=a.util.LanguageUtils;if(this.manifest_&&this.playhead_)r=this.getPresentationPeriod_(),this.currentAdaptationSetCriteria_=new a.media.PreferenceBasedCriteria(e,t||"",0,"","audio"),this.chooseVariantAndSwitch_(r);else if(this.video_&&this.video_.audioTracks){for(var n=Array.from(this.video_.audioTracks),o=r.normalize(e),s=(n=i.makeIterator(n)).next();!s.done;s=n.next()){s=s.value;var l=a.util.StreamUtils.html5AudioTrackToTrack(s);r.normalize(l.language)!=o||t&&!l.roles.includes(t)||(s.enabled=!0)}this.onVariantChanged_()}},o.exportProperty(a.Player.prototype,"selectAudioLanguage",a.Player.prototype.selectAudioLanguage),a.Player.prototype.selectTextLanguage=function(e,t){var r=a.util.LanguageUtils;if(this.manifest_&&this.playhead_){var n=this.getPresentationPeriod_();this.currentTextLanguage_=e,this.currentTextRole_=t||"";var i=this.chooseTextStream_(n.textStreams);i&&(this.addTextStreamToSwitchHistory_(n,i,!1),this.shouldStreamText_()&&this.switchTextStream_(i))}else{var o=r.normalize(e);(n=this.getTextTracks().filter((function(e){return r.normalize(e.language)==o&&(!t||e.roles.includes(t))}))[0])&&this.selectTextTrack(n)}},o.exportProperty(a.Player.prototype,"selectTextLanguage",a.Player.prototype.selectTextLanguage),a.Player.prototype.selectVariantsByLabel=function(e){if(this.manifest_&&this.playhead_){for(var t=this.getPresentationPeriod_(),r=null,n=i.makeIterator(this.getSelectableVariants_()),o=n.next();!o.done;o=n.next())if((o=o.value).audio.label==e){r=o;break}null==r?a.log.warning("No variants were found with label: "+e+". Ignoring the request to switch."):(this.currentAdaptationSetCriteria_=new a.media.PreferenceBasedCriteria(r.language,"",0,e),this.chooseVariantAndSwitch_(t))}},o.exportProperty(a.Player.prototype,"selectVariantsByLabel",a.Player.prototype.selectVariantsByLabel),a.Player.prototype.isTextTrackVisible=function(){var e=this.isTextVisible_;if(this.mediaSourceEngine_){var t=this.mediaSourceEngine_.getTextDisplayer().isTextVisible();return o.asserts.assert(t==e,"text visibility has fallen out of sync"),t}return this.video_&&this.video_.src&&this.video_.textTracks?this.filterTextTracks_().some((function(e){return"showing"==e.mode})):e},o.exportProperty(a.Player.prototype,"isTextTrackVisible",a.Player.prototype.isTextTrackVisible),a.Player.prototype.filterTextTracks_=function(){return o.asserts.assert(this.video_.textTracks,"TextTracks should be valid."),Array.from(this.video_.textTracks).filter((function(e){return"metadata"!=e.kind&&e.label!=a.Player.TextTrackLabel}))},a.Player.prototype.setTextTrackVisibility=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){var n,o,s,l,u;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:if(t.isTextVisible_==(n=!!e))return r.return();if(t.isTextVisible_=n,t.loadMode_!=a.Player.LoadMode.MEDIA_SOURCE){if(t.video_&&t.video_.src&&t.video_.textTracks){o=t.filterTextTracks_();for(var c=i.makeIterator(o),d=c.next();!d.done;d=c.next())"disabled"!=(s=d.value).mode&&(s.mode=n?"showing":"hidden")}r.jumpTo(2);break}if(t.mediaSourceEngine_.getTextDisplayer().setTextVisibility(n),t.config_.streaming.alwaysStreamText){r.jumpTo(2);break}if(!n){t.streamingEngine_.unloadTextStream(),r.jumpTo(2);break}if(t.streamingEngine_.getBufferingText()){r.jumpTo(2);break}if(l=t.getPresentationPeriod_(),!(0<(u=a.util.StreamUtils.filterStreamsByLanguageAndRole(l.textStreams,t.currentTextLanguage_,t.currentTextRole_)).length)){r.jumpTo(2);break}return r.yield(t.streamingEngine_.loadNewTextStream(u[0]),2);case 2:t.onTextTrackVisibility_(),r.jumpToEnd()}}))}))},o.exportProperty(a.Player.prototype,"setTextTrackVisibility",a.Player.prototype.setTextTrackVisibility),a.Player.prototype.getPlayheadTimeAsDate=function(){if(!this.isLive())return a.log.warning("getPlayheadTimeAsDate is for live streams!"),null;var e=this.walker_.getCurrentPayload(),t=0;if(this.playhead_)t=this.playhead_.getTime();else if(e){if(null==e.startTime)return new Date;t=e.startTime}return this.manifest_?(t=this.manifest_.presentationTimeline.getPresentationStartTime(),new Date(1e3*(t+this.video_.currentTime))):this.video_&&this.video_.getStartDate?(e=this.video_.getStartDate(),isNaN(e.getTime())?(a.log.warning("EXT-X-PROGRAM-DATETIME required to get playhead time as Date!"),null):new Date(e.getTime()+1e3*t)):(a.log.warning("No way to get playhead time as Date!"),null)},o.exportProperty(a.Player.prototype,"getPlayheadTimeAsDate",a.Player.prototype.getPlayheadTimeAsDate),a.Player.prototype.getPresentationStartTimeAsDate=function(){if(!this.isLive())return a.log.warning("getPresentationStartTimeAsDate is for live streams!"),null;if(this.manifest_){var e=this.manifest_.presentationTimeline.getPresentationStartTime();return new Date(1e3*e)}return this.video_&&this.video_.getStartDate?(e=this.video_.getStartDate(),isNaN(e.getTime())?(a.log.warning("EXT-X-PROGRAM-DATETIME required to get presentation start time as Date!"),null):e):(a.log.warning("No way to get presentation start time as Date!"),null)},o.exportProperty(a.Player.prototype,"getPresentationStartTimeAsDate",a.Player.prototype.getPresentationStartTimeAsDate),a.Player.prototype.getBufferedInfo=function(){var e={total:[],audio:[],video:[],text:[]};return this.loadMode_==a.Player.LoadMode.SRC_EQUALS&&(e.total=a.media.TimeRangesUtils.getBufferedInfo(this.video_.buffered)),this.loadMode_==a.Player.LoadMode.MEDIA_SOURCE&&this.mediaSourceEngine_.getBufferedInfo(e),e},o.exportProperty(a.Player.prototype,"getBufferedInfo",a.Player.prototype.getBufferedInfo),a.Player.prototype.getStats=function(){if(this.loadMode_!=a.Player.LoadMode.MEDIA_SOURCE&&this.loadMode_!=a.Player.LoadMode.SRC_EQUALS)return a.util.Stats.getEmptyBlob();this.updateStateHistory_(),o.asserts.assert(this.video_,"If we have stats, we should have video_");var e=this.video_;return e.getVideoPlaybackQuality&&(e=e.getVideoPlaybackQuality(),this.stats_.setDroppedFrames(Number(e.droppedVideoFrames),Number(e.totalVideoFrames)),this.stats_.setCorruptedFrames(Number(e.corruptedVideoFrames))),e=this.drmEngine_?this.drmEngine_.getLicenseTime():NaN,this.stats_.setLicenseTime(e),this.loadMode_==a.Player.LoadMode.MEDIA_SOURCE&&((e=this.getPresentationVariant_())&&this.stats_.setVariantBandwidth(e.bandwidth),e&&e.video&&this.stats_.setResolution(e.video.width||NaN,e.video.height||NaN),e=this.abrManager_.getBandwidthEstimate(),this.stats_.setBandwidthEstimate(e)),this.stats_.getBlob()},o.exportProperty(a.Player.prototype,"getStats",a.Player.prototype.getStats),a.Player.prototype.addTextTrack=function(e,t,r,n,s,l){var u=this;return i.asyncExecutePromiseGeneratorFunction((function c(){var d,p,f,h,m,g,y,_,v;return i.generator.createGenerator(c,(function(i){switch(i.nextAddress){case 1:if(u.loadMode_==a.Player.LoadMode.SRC_EQUALS)throw a.log.error("Cannot add text when loaded with src="),Error("State error!");if(u.loadMode_!=a.Player.LoadMode.MEDIA_SOURCE)throw a.log.error("Must call load() and wait for it to resolve before adding text tracks."),Error("State error!");if(d=u.getPresentationPeriod_(),p=a.util.ManifestParserUtils.ContentType,f=u.manifest_.periods.indexOf(d),m=(h=f+1)>=u.manifest_.periods.length?u.manifest_.presentationTimeline.getDuration():u.manifest_.periods[h].startTime,1/0==(g=m-d.startTime))throw new a.util.Error(a.util.Error.Severity.RECOVERABLE,a.util.Error.Category.MANIFEST,a.util.Error.Code.CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM);return y=new a.media.SegmentReference(1,0,g,(function(){return[e]}),0,null),_={id:u.nextExternalStreamId_++,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(e){return 1},getSegmentReference:function(e){return 1==e?y:null},initSegmentReference:null,presentationTimeOffset:0,mimeType:n,codecs:s||"",kind:r,encrypted:!1,keyId:null,language:t,label:l||null,type:p.TEXT,primary:!1,frameRate:void 0,pixelAspectRatio:void 0,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null},u.loadingTextStreams_.add(_),d.textStreams.push(_),i.yield(u.streamingEngine_.loadNewTextStream(_),2);case 2:return o.asserts.assert(d,"The period should still be non-null here."),(v=u.streamingEngine_.getBufferingText())&&u.activeStreams_.useText(d,v),u.loadingTextStreams_.delete(_),a.log.debug("Choosing new streams after adding a text stream"),u.chooseStreamsAndSwitch_(d),u.onTracksChanged_(),i.return(a.util.StreamUtils.textStreamToTrack(_))}}))}))},o.exportProperty(a.Player.prototype,"addTextTrack",a.Player.prototype.addTextTrack),a.Player.prototype.setMaxHardwareResolution=function(e,t){this.maxHwRes_.width=e,this.maxHwRes_.height=t},o.exportProperty(a.Player.prototype,"setMaxHardwareResolution",a.Player.prototype.setMaxHardwareResolution),a.Player.prototype.retryStreaming=function(){return this.loadMode_==a.Player.LoadMode.MEDIA_SOURCE&&this.streamingEngine_.retry()},o.exportProperty(a.Player.prototype,"retryStreaming",a.Player.prototype.retryStreaming),a.Player.prototype.getManifest=function(){return this.manifest_},o.exportProperty(a.Player.prototype,"getManifest",a.Player.prototype.getManifest),a.Player.prototype.getManifestParserFactory=function(){return this.parser_?this.parser_.constructor:null},o.exportProperty(a.Player.prototype,"getManifestParserFactory",a.Player.prototype.getManifestParserFactory),a.Player.prototype.addVariantToSwitchHistory_=function(e,t,r){this.activeStreams_.useVariant(e,t),this.stats_.getSwitchHistory().updateCurrentVariant(t,r)},a.Player.prototype.addTextStreamToSwitchHistory_=function(e,t,r){this.activeStreams_.useText(e,t),this.stats_.getSwitchHistory().updateCurrentText(t,r)},a.Player.prototype.defaultConfig_=function(){var e=this,t=a.util.PlayerConfiguration.createDefault();t.streaming.failureCallback=function(t){e.defaultStreamingFailureCallback_(t)};var r=this;return t.textDisplayFactory=function(){return new a.text.SimpleTextDisplayer(r.video_)},t},a.Player.prototype.defaultStreamingFailureCallback_=function(e){var t=[a.util.Error.Code.BAD_HTTP_STATUS,a.util.Error.Code.HTTP_ERROR,a.util.Error.Code.TIMEOUT];this.isLive()&&t.includes(e.code)&&(e.severity=a.util.Error.Severity.RECOVERABLE,a.log.warning("Live streaming error.  Retrying automatically..."),this.retryStreaming())},a.Player.prototype.createTextStreamsForClosedCaptions_=function(e){for(var t=a.util.ManifestParserUtils.ContentType,r=0;r<e.length;r++){for(var n=e[r],o=new Map,s=i.makeIterator(n.variants),l=s.next();!l.done;l=s.next())if((l=l.value).video&&l.video.closedCaptions){l=l.video;for(var u=i.makeIterator(l.closedCaptions.keys()),c=u.next();!c.done;c=u.next())if(c=c.value,!o.has(c)){var d={id:this.nextExternalStreamId_++,originalId:c,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(e){return null},getSegmentReference:function(e){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:a.util.MimeUtils.CLOSED_CAPTION_MIMETYPE,codecs:"",kind:a.util.ManifestParserUtils.TextStreamKind.CLOSED_CAPTION,encrypted:!1,keyId:null,language:l.closedCaptions.get(c),label:null,type:t.TEXT,primary:!1,frameRate:void 0,pixelAspectRatio:void 0,trickModeVideo:null,emsgSchemeIdUris:null,roles:l.roles,channelsCount:null,audioSamplingRate:null,closedCaptions:null};o.set(c,d)}}for(s=(o=i.makeIterator(o.values())).next();!s.done;s=o.next())n.textStreams.push(s.value)}},a.Player.prototype.filterAllPeriods_=function(e){o.asserts.assert(this.video_,"Must not be destroyed");var t=a.util.ArrayUtils,r=a.util.StreamUtils,n=this.streamingEngine_?this.streamingEngine_.getBufferingAudio():null,i=this.streamingEngine_?this.streamingEngine_.getBufferingVideo():null;if(n=r.filterNewPeriod.bind(null,this.drmEngine_,n,i),e.forEach(n),0==(t=t.count(e,(function(e){return e.variants.some(r.isPlayable)}))))throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.CONTENT_UNSUPPORTED_BY_BROWSER);if(t<e.length)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.UNPLAYABLE_PERIOD);e.forEach(function(e){a.util.StreamUtils.applyRestrictions(e.variants,this.config_.restrictions,this.maxHwRes_)&&this.streamingEngine_&&this.getPresentationPeriod_()==e&&this.onTracksChanged_(),this.checkRestrictedVariants_(e.variants)}.bind(this))},a.Player.prototype.filterNewPeriod_=function(e){o.asserts.assert(this.video_,"Must not be destroyed");var t=a.util.StreamUtils,r=this.streamingEngine_?this.streamingEngine_.getBufferingAudio():null,n=this.streamingEngine_?this.streamingEngine_.getBufferingVideo():null;if(t.filterNewPeriod(this.drmEngine_,r,n,e),!(r=e.variants).some(t.isPlayable))throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.UNPLAYABLE_PERIOD);if(this.checkRestrictedVariants_(e.variants),a.util.StreamUtils.applyRestrictions(r,this.config_.restrictions,this.maxHwRes_)&&this.streamingEngine_&&this.getPresentationPeriod_()==e&&this.onTracksChanged_(),e=this.drmEngine_?this.drmEngine_.getDrmInfo():null)for(r=(t=i.makeIterator(r)).next();!r.done;r=t.next())for(n=(r=i.makeIterator(r.value.drmInfos)).next();!n.done;n=r.next())if((n=n.value).keySystem==e.keySystem)for(var s=(n=i.makeIterator(n.initData||[])).next();!s.done;s=n.next())s=s.value,this.drmEngine_.newInitData(s.initDataType,s.initData)},a.Player.prototype.switchVariant_=function(e,t,r){return t=void 0!==t&&t,r=void 0===r?0:r,this.switchingPeriods_?(this.deferredVariant_=e,this.deferredVariantClearBuffer_=t,this.deferredVariantClearBufferSafeMargin_=r,!0):((e=this.streamingEngine_.switchVariant(e,t,r))&&this.onVariantChanged_(),e)};a.Player.prototype.switchTextStream_=function(e){return this.switchingPeriods_?(this.deferredTextStream_=e,!0):((e=this.streamingEngine_.switchTextStream(e))&&this.onTextChanged_(),e)},a.Player.prototype.assertCorrectActiveStreams_=function(){if(this.streamingEngine_&&this.manifest_&&o.DEBUG){var e=this.streamingEngine_.getBufferingPeriod(),t=this.getPresentationPeriod_();if(null!=e&&e==t){e=this.streamingEngine_.getBufferingAudio();var r=this.streamingEngine_.getBufferingVideo(),n=this.streamingEngine_.getBufferingText();e=this.deferredVariant_?this.deferredVariant_.audio:e,r=this.deferredVariant_?this.deferredVariant_.video:r,n=this.deferredTextStream_||n;var i=this.activeStreams_.getVariant(t);t=this.activeStreams_.getText(t),o.asserts.assert(i.audio==e,"Inconsistent active audio stream"),o.asserts.assert(i.video==r,"Inconsistent active video stream"),o.asserts.assert(null==n||t==n,"Inconsistent active text stream")}}},a.Player.prototype.adjustStartTime_=function(e){function t(e,t){if(!e)return null;var r=e.findSegmentPosition(t-i.startTime);return null==r?null:(r=e.getSegmentReference(r))?(r=r.startTime+i.startTime,o.asserts.assert(r<=t,"Segment should start before time"),r):null}var r=this.streamingEngine_.getBufferingAudio(),n=this.streamingEngine_.getBufferingVideo(),i=this.getPresentationPeriod_();return r=t(r,e),null!=(n=t(n,e))&&null!=r?Math.max(n,r):null!=n?n:null!=r?r:e},a.Player.prototype.updateBufferState_=function(){var e=this.isBuffering();this.stats_&&this.bufferObserver_&&this.playhead_&&(this.playRateController_.setBuffering(e),this.updateStateHistory_()),e=new a.util.FakeEvent("buffering",{buffering:e}),this.dispatchEvent(e)},a.Player.prototype.onChangePeriod_=function(){this.onTracksChanged_()},a.Player.prototype.onRateChange_=function(){var e=this.video_.playbackRate;0!=e&&this.playRateController_.set(e)},a.Player.prototype.updateStateHistory_=function(){if(this.stats_&&this.bufferObserver_){var e=a.media.BufferingObserver.State,t=this.stats_.getStateHistory();this.bufferObserver_.getState()==e.STARVING?t.update("buffering"):this.video_.paused?t.update("paused"):this.video_.ended?t.update("ended"):t.update("playing")}},a.Player.prototype.onSeek_=function(){this.playheadObservers_&&this.playheadObservers_.notifyOfSeek(),this.streamingEngine_&&this.streamingEngine_.seeked(),this.bufferObserver_&&this.pollBufferState_()},a.Player.prototype.chooseVariant_=function(e){o.asserts.assert(this.config_,"Must not be destroyed");try{this.checkRestrictedVariants_(e)}catch(e){return this.onError_(e),null}return o.asserts.assert(e.length,"Should have thrown for no Variants."),e=e.filter((function(e){return a.util.StreamUtils.isPlayable(e)})),e=this.currentAdaptationSetCriteria_.create(e),this.abrManager_.setVariants(Array.from(e.values())),this.abrManager_.chooseVariant()},a.Player.prototype.chooseTextStream_=function(e){return a.util.StreamUtils.filterStreamsByLanguageAndRole(e,this.currentTextLanguage_,this.currentTextRole_)[0]||null},a.Player.prototype.chooseStreamsAndSwitch_=function(e){var t=this.chooseVariantAndSwitch_(e,!1);e=this.chooseTextAndSwitch_(e),(t||e)&&this.onAdaptation_()},a.Player.prototype.chooseVariantAndSwitch_=function(e,t){t=void 0===t||t,o.asserts.assert(this.config_,"Must not be destroyed");var r=this.chooseVariant_(e.variants),n=!1;return r&&(this.addVariantToSwitchHistory_(e,r,!0),n=this.switchVariant_(r,!0)),t&&n&&this.onAdaptation_(),n},a.Player.prototype.chooseTextAndSwitch_=function(e){o.asserts.assert(this.config_,"Must not be destroyed");var t=this.chooseTextStream_(e.textStreams),r=!1;return t&&this.shouldStreamText_()&&(this.addTextStreamToSwitchHistory_(e,t,!0),r=this.switchTextStream_(t)),r},a.Player.prototype.onChooseStreams_=function(e){a.log.debug("onChooseStreams_",e),o.asserts.assert(this.config_,"Must not be destroyed");try{a.log.v2("onChooseStreams_, choosing variant from ",e.variants),a.log.v2("onChooseStreams_, choosing text from ",e.textStreams);var t=this.chooseStreams_(e);return a.log.v2("onChooseStreams_, chose variant ",t.variant),a.log.v2("onChooseStreams_, chose text ",t.text),t}catch(e){return this.onError_(e),{variant:null,text:null}}},a.Player.prototype.chooseStreams_=function(e){this.switchingPeriods_=!0,this.abrManager_.disable(),this.onAbrStatusChanged_(),a.log.debug("Choosing new streams after period changed");var t=this.chooseVariant_(e.variants),r=this.chooseTextStream_(e.textStreams);this.deferredVariant_&&(e.variants.includes(this.deferredVariant_)&&(t=this.deferredVariant_),this.deferredVariant_=null),this.deferredTextStream_&&(e.textStreams.includes(this.deferredTextStream_)&&(r=this.deferredTextStream_),this.deferredTextStream_=null),t&&this.addVariantToSwitchHistory_(e,t,!0),r&&this.addTextStreamToSwitchHistory_(e,r,!0),e=!this.streamingEngine_.getBufferingPeriod();var n=t?t.audio:null;return e&&r&&(n&&this.shouldShowText_(n,r)&&(this.isTextVisible_=!0),this.isTextVisible_&&(this.mediaSourceEngine_.getTextDisplayer().setTextVisibility(!0),o.asserts.assert(this.shouldStreamText_(),"Should be streaming text")),this.onTextTrackVisibility_()),this.shouldStreamText_()?{variant:t,text:r}:{variant:t,text:null}},a.Player.prototype.shouldShowText_=function(e,t){var r=a.util.LanguageUtils,n=r.normalize(this.config_.preferredTextLanguage),i=r.normalize(e.language),o=r.normalize(t.language);return r.areLanguageCompatible(o,n)&&!r.areLanguageCompatible(i,o)},a.Player.prototype.canSwitch_=function(){a.log.debug("canSwitch_"),o.asserts.assert(this.config_,"Must not be destroyed"),this.switchingPeriods_=!1,this.config_.abr.enabled&&(this.abrManager_.enable(),this.onAbrStatusChanged_()),this.deferredVariant_&&(this.streamingEngine_.switchVariant(this.deferredVariant_,this.deferredVariantClearBuffer_,this.deferredVariantClearBufferSafeMargin_),this.onVariantChanged_(),this.deferredVariant_=null),this.deferredTextStream_&&(this.streamingEngine_.switchTextStream(this.deferredTextStream_),this.onTextChanged_(),this.deferredTextStream_=null)},a.Player.prototype.onManifestUpdate_=function(){this.parser_&&this.parser_.update&&this.parser_.update()},a.Player.prototype.onSegmentAppended_=function(){this.playhead_&&this.playhead_.notifyOfBufferingChange()},a.Player.prototype.switch_=function(e,t,r){t=void 0!==t&&t,r=void 0===r?0:r,a.log.debug("switch_"),o.asserts.assert(this.config_.abr.enabled,"AbrManager should not call switch while disabled!"),o.asserts.assert(!this.switchingPeriods_,"AbrManager should not call switch while transitioning between Periods!"),o.asserts.assert(this.manifest_,"We need a manifest to switch variants.");var n=this.findPeriodWithVariant_(e);o.asserts.assert(n,"A period should contain the variant."),this.addVariantToSwitchHistory_(n,e,!0),this.streamingEngine_&&this.streamingEngine_.switchVariant(e,t,r)&&this.onAdaptation_()},a.Player.prototype.onAdaptation_=function(){this.delayDispatchEvent_(new a.util.FakeEvent("adaptation"))},a.Player.prototype.onTracksChanged_=function(){this.delayDispatchEvent_(new a.util.FakeEvent("trackschanged"))},a.Player.prototype.onVariantChanged_=function(){this.delayDispatchEvent_(new a.util.FakeEvent("variantchanged"))},a.Player.prototype.onTextChanged_=function(){this.delayDispatchEvent_(new a.util.FakeEvent("textchanged"))},a.Player.prototype.onTextTrackVisibility_=function(){this.delayDispatchEvent_(new a.util.FakeEvent("texttrackvisibility"))},a.Player.prototype.onAbrStatusChanged_=function(){this.delayDispatchEvent_(new a.util.FakeEvent("abrstatuschanged",{newStatus:this.config_.abr.enabled}))},a.Player.prototype.onError_=function(e){if(o.asserts.assert(e instanceof a.util.Error,"Wrong error type!"),this.loadMode_!=a.Player.LoadMode.DESTROYED){var t=new a.util.FakeEvent("error",{detail:e});this.dispatchEvent(t),t.defaultPrevented&&(e.handled=!0)}},a.Player.prototype.onRegionEvent_=function(e,t){this.dispatchEvent(new a.util.FakeEvent(e,{detail:{schemeIdUri:t.schemeIdUri,value:t.value,startTime:t.startTime,endTime:t.endTime,id:t.id,eventElement:t.eventElement}}))},a.Player.prototype.videoErrorToShakaError_=function(){if(o.asserts.assert(this.video_.error,"Video error expected, but missing!"),!this.video_.error)return null;var e=this.video_.error.code;if(1==e)return null;var t=this.video_.error.msExtendedCode;return t&&(0>t&&(t+=Math.pow(2,32)),t=t.toString(16)),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MEDIA,a.util.Error.Code.VIDEO_ERROR,e,t,this.video_.error.message)},a.Player.prototype.onVideoError_=function(e){(e=this.videoErrorToShakaError_())&&this.onError_(e)},a.Player.prototype.onKeyStatus_=function(e){if(this.streamingEngine_){var t=a.Player.restrictedStatuses_,r=this.getPresentationPeriod_(),n=!1,i=Object.keys(e);0==i.length&&a.log.warning("Got a key status event without any key statuses, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");var o=1==i.length&&"00"==i[0];o&&a.log.warning("Got a synthetic key status event, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks."),i.length&&this.manifest_.periods.forEach((function(r){r.variants.forEach((function(r){a.util.StreamUtils.getVariantStreams(r).forEach((function(i){var a=r.allowedByKeySystem;i.keyId&&(i=e[o?"00":i.keyId],r.allowedByKeySystem=!!i&&!t.includes(i)),a!=r.allowedByKeySystem&&(n=!0)}))}))})),i=this.streamingEngine_.getBufferingAudio();var s=this.streamingEngine_.getBufferingVideo();(i=a.util.StreamUtils.getVariantByStreams(i,s,r.variants))&&!i.allowedByKeySystem&&(a.log.debug("Choosing new variants after key status changed"),this.chooseVariantAndSwitch_(r)),n&&(this.onTracksChanged_(),this.chooseVariant_(r.variants))}},a.Player.prototype.onExpirationUpdated_=function(e,t){this.parser_&&this.parser_.onExpirationUpdated&&this.parser_.onExpirationUpdated(e,t);var r=new a.util.FakeEvent("expirationupdated");this.dispatchEvent(r)},a.Player.prototype.shouldStreamText_=function(){return this.config_.streaming.alwaysStreamText||this.isTextTrackVisible()},a.Player.applyPlayRange_=function(e,t,r){0<t&&(e.isLive()?a.log.warning("|playRangeStart| has been configured for live content. Ignoring the setting."):e.setUserSeekStart(t)),r<(t=e.getDuration())&&(e.isLive()?a.log.warning("|playRangeEnd| has been configured for live content. Ignoring the setting."):e.setDuration(r))},a.Player.prototype.checkRestrictedVariants_=function(e){var t=a.Player.restrictedStatuses_,r=this.drmEngine_?this.drmEngine_.getKeyStatuses():{},n=Object.keys(r);n=n.length&&"00"==n[0];for(var o=!1,s=!1,l=[],u=[],c=(e=i.makeIterator(e)).next();!c.done;c=e.next()){var d=[];(c=c.value).audio&&d.push(c.audio),c.video&&d.push(c.video);for(var p=(d=i.makeIterator(d)).next();!p.done;p=d.next())if((p=p.value).keyId){var f=r[n?"00":p.keyId];f?t.includes(f)&&(u.includes(f)||u.push(f)):l.includes(p.keyId)||l.push(p.keyId)}c.allowedByApplication?c.allowedByKeySystem&&(o=!0):s=!0}if(!o)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.RESTRICTIONS_CANNOT_BE_MET,{hasAppRestrictions:s,missingKeys:l,restrictedKeyStatuses:u})},a.Player.prototype.delayDispatchEvent_=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return r.yield(Promise.resolve(),2);case 2:t.loadMode_!=a.Player.LoadMode.DESTROYED&&t.dispatchEvent(e),r.jumpToEnd()}}))}))},a.Player.getLanguagesFrom_=function(e){for(var t=new Set,r=(e=i.makeIterator(e)).next();!r.done;r=e.next())(r=r.value).language?t.add(a.util.LanguageUtils.normalize(r.language)):t.add("und");return t},a.Player.getLanguageAndRolesFrom_=function(e){for(var t=new Map,r=(e=i.makeIterator(e)).next();!r.done;r=e.next()){var n=r.value;r="und";var o=[];for(n.language&&(r=a.util.LanguageUtils.normalize(n.language)),(o="variant"==n.type?n.audioRoles:n.roles)&&o.length||(o=[""]),t.has(r)||t.set(r,new Set),o=(n=i.makeIterator(o)).next();!o.done;o=n.next())o=o.value,t.get(r).add(o)}var s=[];return t.forEach((function(e,t){for(var r=i.makeIterator(e),n=r.next();!n.done;n=r.next())s.push({language:t,role:n.value})})),s},a.Player.prototype.getSelectableVariants_=function(){var e=this.getPresentationPeriod_();return null==e?[]:(this.assertCorrectActiveStreams_(),e.variants.filter((function(e){return a.util.StreamUtils.isPlayable(e)})))},a.Player.prototype.getSelectableText_=function(){var e=this,t=this.getPresentationPeriod_();return null==t?[]:(this.assertCorrectActiveStreams_(),t.textStreams.filter((function(t){return!e.loadingTextStreams_.has(t)})))},a.Player.prototype.getPresentationPeriod_=function(){o.asserts.assert(this.manifest_&&this.playhead_,"Only ask for the presentation period when loaded with media source.");for(var e=this.playhead_.getTime(),t=null,r=i.makeIterator(this.manifest_.periods),n=r.next();!n.done;n=r.next())(n=n.value).startTime<=e&&(t=n);return o.asserts.assert(t,"Should have found a period."),t},a.Player.prototype.getPresentationVariant_=function(){var e=this.getPresentationPeriod_();return this.activeStreams_.getVariant(e)},a.Player.prototype.getPresentationText_=function(){var e=this.getPresentationPeriod_();if(null==e)return null;if(!this.activeStreams_.getText(e)){var t=a.util.StreamUtils.filterStreamsByLanguageAndRole(e.textStreams,this.currentTextLanguage_,this.currentTextRole_);t.length&&this.activeStreams_.useText(e,t[0])}return this.activeStreams_.getText(e)},a.Player.prototype.isBufferedToEndMS_=function(){if(o.asserts.assert(this.video_,"We need a video element to get buffering information"),o.asserts.assert(this.mediaSourceEngine_,"We need a media source engine to get buffering information"),o.asserts.assert(this.manifest_,"We need a manifest to get buffering information"),this.video_.ended||this.mediaSourceEngine_.ended())return!0;if(this.manifest_.presentationTimeline.isLive()){var e=this.manifest_.presentationTimeline.getSegmentAvailabilityEnd();if(a.media.TimeRangesUtils.bufferEnd(this.video_.buffered)>=e)return!0}return!1},a.Player.prototype.isBufferedToEndSrc_=function(){return o.asserts.assert(this.video_,"We need a video element to get buffering information"),!!this.video_.ended||a.media.TimeRangesUtils.bufferEnd(this.video_.buffered)>=this.video_.duration-1},a.Player.prototype.findPeriodWithVariant_=function(e){for(var t=i.makeIterator(this.manifest_.periods),r=t.next();!r.done;r=t.next())if((r=r.value).variants.includes(e))return r;return null},a.Player.prototype.createAbortLoadError_=function(){return new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.PLAYER,a.util.Error.Code.LOAD_INTERRUPTED)},a.Player.prototype.getNextStep_=function(e,t,r,n){var i=null;return e==this.detachNode_&&(i=r==this.detachNode_?this.detachNode_:this.attachNode_),e==this.attachNode_&&(i=this.getNextAfterAttach_(r,t,n)),e==this.mediaSourceNode_&&(i=this.getNextAfterMediaSource_(r,t,n)),e==this.parserNode_&&(i=this.getNextMatchingAllDependencies_(this.loadNode_,this.manifestNode_,this.unloadNode_,r,t,n)),e==this.manifestNode_&&(i=this.getNextMatchingAllDependencies_(this.loadNode_,this.drmNode_,this.unloadNode_,r,t,n)),e==this.drmNode_&&(i=this.getNextMatchingAllDependencies_(this.loadNode_,this.loadNode_,this.unloadNode_,r,t,n)),e==this.srcEqualsDrmNode_&&(i=r==this.srcEqualsNode_&&t.mediaElement==n.mediaElement?this.srcEqualsNode_:this.unloadNode_),e!=this.loadNode_&&e!=this.srcEqualsNode_||(i=this.unloadNode_),e==this.unloadNode_&&(i=this.getNextAfterUnload_(r,t,n)),o.asserts.assert(i,"Missing next step!"),i},a.Player.prototype.getNextAfterAttach_=function(e,t,r){return e==this.detachNode_||t.mediaElement!=r.mediaElement?this.detachNode_:e==this.attachNode_?this.attachNode_:e==this.mediaSourceNode_||e==this.loadNode_?this.mediaSourceNode_:e==this.srcEqualsNode_?this.srcEqualsDrmNode_:null},a.Player.prototype.getNextAfterMediaSource_=function(e,t,r){return e==this.loadNode_&&t.mediaElement==r.mediaElement?this.parserNode_:this.unloadNode_},a.Player.prototype.getNextAfterUnload_=function(e,t,r){return r.mediaElement&&t.mediaElement==r.mediaElement?this.attachNode_:this.detachNode_},a.Player.prototype.getNextMatchingAllDependencies_=function(e,t,r,n,i,o){return n==e&&i.mediaElement==o.mediaElement&&i.uri==o.uri&&i.mimeType==o.mimeType&&i.factory==o.factory?t:r},a.Player.prototype.createEmptyPayload_=function(){return{factory:null,mediaElement:null,mimeType:null,startTime:null,startTimeOfLoad:null,uri:null}},a.Player.prototype.wrapWalkerListenersWithPromise_=function(e){var t=this;return new Promise((function(r,n){e.onCancel=function(){return n(t.createAbortLoadError_())},e.onEnd=function(){return r()},e.onError=function(e){return n(e)},e.onSkip=function(){return n(t.createAbortLoadError_())}}))},a.Player.LoadMode={DESTROYED:0,NOT_LOADED:1,MEDIA_SOURCE:2,SRC_EQUALS:3},o.exportProperty(a.Player,"LoadMode",a.Player.LoadMode),a.Player.TYPICAL_BUFFERING_THRESHOLD_=.5,a.Player.TextTrackLabel="Shaka Player TextTrack",a.offline.StoredContentUtils=function(){},a.offline.StoredContentUtils.fromManifest=function(e,t,r,n){o.asserts.assert(t.periods.length,"Cannot create stored content from manifest with no periods.");var i=null==t.expiration?1/0:t.expiration;return{offlineUri:null,originalManifestUri:e,duration:t.presentationTimeline.getDuration(),size:r,expiration:i,tracks:t=a.offline.StoredContentUtils.getTracks_(t.periods[0]),appMetadata:n}},a.offline.StoredContentUtils.fromManifestDB=function(e,t){o.asserts.assert(t.periods.length,"Cannot create stored content from manifestDB with no periods.");var r=new a.offline.ManifestConverter(e.mechanism(),e.cell()),n=t.periods[0],i=new a.media.PresentationTimeline(null,0);return n=r.fromPeriodDB(n,i),r=t.appMetadata||{},n=a.offline.StoredContentUtils.getTracks_(n),{offlineUri:e.toString(),originalManifestUri:t.originalManifestUri,duration:t.duration,size:t.size,expiration:t.expiration,tracks:n,appMetadata:r}},a.offline.StoredContentUtils.getTracks_=function(e){for(var t=a.util.StreamUtils,r=[],n=t.getPlayableVariants(e.variants),o=(n=i.makeIterator(n)).next();!o.done;o=n.next())r.push(t.variantToTrack(o.value));for(n=(e=i.makeIterator(e.textStreams)).next();!n.done;n=e.next())r.push(t.textStreamToTrack(n.value));return r},a.offline.StreamBandwidthEstimator=function(){this.estimateByStreamId_={}},a.offline.StreamBandwidthEstimator.prototype.addVariant=function(e){var t=e.audio,r=e.video;if(t&&!r&&this.setBitrate_(t.id,t.bandwidth||e.bandwidth),!t&&r&&this.setBitrate_(r.id,r.bandwidth||e.bandwidth),t&&r){var n=t.bandwidth||a.offline.StreamBandwidthEstimator.DEFAULT_AUDIO_BITRATE_,i=r.bandwidth||e.bandwidth-n;0>=i&&(a.log.warning("Audio bit rate consumes variants bandwidth. Setting video bandwidth to match variant's bandwidth."),i=e.bandwidth),this.setBitrate_(t.id,n),this.setBitrate_(r.id,i)}},a.offline.StreamBandwidthEstimator.prototype.setBitrate_=function(e,t){this.estimateByStreamId_[e]=t},a.offline.StreamBandwidthEstimator.prototype.addText=function(e){this.estimateByStreamId_[e.id]=a.offline.StreamBandwidthEstimator.DEFAULT_TEXT_BITRATE_},a.offline.StreamBandwidthEstimator.prototype.getSegmentEstimate=function(e,t){var r=t.endTime-t.startTime;return this.getEstimate_(e)*r},a.offline.StreamBandwidthEstimator.prototype.getInitSegmentEstimate=function(e){return.5*this.getEstimate_(e)},a.offline.StreamBandwidthEstimator.prototype.getEstimate_=function(e){return null==(e=this.estimateByStreamId_[e])&&(e=0,a.log.error("Asking for bitrate of stream not given to the estimator")),0==e&&a.log.warning("Using bitrate of 0, this stream won't affect progress"),e},a.offline.StreamBandwidthEstimator.DEFAULT_AUDIO_BITRATE_=393216,a.offline.StreamBandwidthEstimator.DEFAULT_TEXT_BITRATE_=52,a.util.Destroyer=function(e){this.destroyed_=!1,this.waitOnDestroy_=new a.util.PublicPromise,this.onDestroy_=e},a.util.Destroyer.prototype.destroyed=function(){return this.destroyed_},a.util.Destroyer.prototype.destroy=function(){var e=this;return this.destroyed_?this.waitOnDestroy_:(this.destroyed_=!0,this.onDestroy_().then((function(){e.waitOnDestroy_.resolve()}),(function(){e.waitOnDestroy_.resolve()})))},a.util.ManifestFilter=function(){},a.util.ManifestFilter.filterByRestrictions=function(e,t,r){for(var n=(e=i.makeIterator(e.periods)).next();!n.done;n=e.next())(n=n.value).variants=n.variants.filter((function(e){return a.util.StreamUtils.meetsRestrictions(e,t,r)}))},a.util.ManifestFilter.filterByMediaSourceSupport=function(e){for(var t=a.media.MediaSourceEngine,r=(e=i.makeIterator(e.periods)).next();!r.done;r=e.next())(r=r.value).variants=r.variants.filter((function(e){var r=!0;return e.audio&&(r=r&&t.isStreamSupported(e.audio)),e.video&&(r=r&&t.isStreamSupported(e.video)),r}))},a.util.ManifestFilter.filterByDrmSupport=function(e,t){for(var r=i.makeIterator(e.periods),n=r.next();!n.done;n=r.next())(n=n.value).variants=n.variants.filter((function(e){return t.supportsVariant(e)}))},a.util.ManifestFilter.filterByCommonCodecs=function(e){o.asserts.assert(0<e.periods.length,"There should be at least be one period");var t=a.util.ManifestFilter,r=new a.util.ManifestFilter.VariantCodecSummarySet;e.periods.forEach((function(e,n){var i=t.VariantCodecSummarySet.fromVariants(e.variants);0==n?r.includeAll(i):r.onlyKeep(i)}));for(var n=(e=i.makeIterator(e.periods)).next();!n.done;n=e.next())(n=n.value).variants=n.variants.filter((function(e){return e=new t.VariantCodecSummary(e),r.contains(e)}))},a.util.ManifestFilter.rollingFilter=function(e,t){return i.asyncExecutePromiseGeneratorFunction((function r(){var n,o,s,l;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:n=null,o=i.makeIterator(e.periods),s=o.next();case 2:if(s.done){r.jumpTo(0);break}return l=s.value,n&&(l.variants=l.variants.filter((function(e){return e=new a.util.ManifestFilter.VariantCodecSummary(e),n.contains(e)}))),r.yield(t(l),5);case 5:n=a.util.ManifestFilter.VariantCodecSummarySet.fromVariants(l.variants),s=o.next(),r.jumpTo(2)}}))}))},a.util.ManifestFilter.VariantCodecSummary=function(e){var t=e.audio;e=e.video,this.audioMime_=t?t.mimeType:null,this.audioCodec_=t?t.codecs.split(".")[0]:null,this.videoMime_=e?e.mimeType:null,this.videoCodec_=e?e.codecs.split(".")[0]:null},a.util.ManifestFilter.VariantCodecSummary.prototype.equals=function(e){return this.audioMime_==e.audioMime_&&this.audioCodec_==e.audioCodec_&&this.videoMime_==e.videoMime_&&this.videoCodec_==e.videoCodec_},a.util.ManifestFilter.VariantCodecSummarySet=function(){this.all_=[]},a.util.ManifestFilter.VariantCodecSummarySet.prototype.add=function(e){this.contains(e)||this.all_.push(e)},a.util.ManifestFilter.VariantCodecSummarySet.prototype.includeAll=function(e){for(var t=(e=i.makeIterator(e.all_)).next();!t.done;t=e.next())this.add(t.value)},a.util.ManifestFilter.VariantCodecSummarySet.prototype.onlyKeep=function(e){this.all_=this.all_.filter((function(t){return e.contains(t)}))},a.util.ManifestFilter.VariantCodecSummarySet.prototype.contains=function(e){return this.all_.some((function(t){return e.equals(t)}))},a.util.ManifestFilter.VariantCodecSummarySet.fromVariants=function(e){for(var t=new a.util.ManifestFilter.VariantCodecSummarySet,r=(e=i.makeIterator(e)).next();!r.done;r=e.next())t.add(new a.util.ManifestFilter.VariantCodecSummary(r.value));return t},a.offline.Storage=function(e){var t=this;if(e&&e.constructor!=a.Player)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.LOCAL_PLAYER_INSTANCE_REQUIRED);this.networkingEngine_=this.config_=null,e?(this.config_=e.getSharedConfiguration(),this.networkingEngine_=e.getNetworkingEngine(),o.asserts.assert(this.networkingEngine_,"Storage should not be initialized with a player that had |destroy| called on it.")):(this.config_=a.util.PlayerConfiguration.createDefault(),this.networkingEngine_=new a.net.NetworkingEngine),this.storeInProgress_=!1,this.segmentsFromStore_=[],this.openOperations_=[];var r=!e;this.destroyer_=new a.util.Destroyer((function(){return i.asyncExecutePromiseGeneratorFunction((function e(){var n;return i.generator.createGenerator(e,(function(e){switch(e.nextAddress){case 1:return n=function(){},e.yield(Promise.all(t.openOperations_.map((function(e){return e.then(n,n)}))),2);case 2:if(!r){e.jumpTo(3);break}return e.yield(t.networkingEngine_.destroy(),3);case 3:t.config_=null,t.networkingEngine_=null,e.jumpToEnd()}}))}))}))},o.exportSymbol("shaka.offline.Storage",a.offline.Storage),a.offline.Storage.support=function(){return!!a.util.Platform.supportsMediaSource()&&a.offline.StorageMuxer.support()},o.exportProperty(a.offline.Storage,"support",a.offline.Storage.support),a.offline.Storage.prototype.destroy=function(){return this.destroyer_.destroy()},o.exportProperty(a.offline.Storage.prototype,"destroy",a.offline.Storage.prototype.destroy),a.offline.Storage.prototype.configure=function(e,t){return o.asserts.assert("object"==typeof e||2==arguments.length,"String configs should have values!"),2==arguments.length&&"string"==typeof e&&(e=a.util.ConfigUtils.convertToConfigObject(e,t)),o.asserts.assert("object"==typeof e,"Should be an object!"),a.offline.Storage.verifyConfig_(e),o.asserts.assert(this.config_,"Cannot reconfigure stroage after calling destroy."),a.util.PlayerConfiguration.mergeConfigObjects(this.config_,e)},o.exportProperty(a.offline.Storage.prototype,"configure",a.offline.Storage.prototype.configure),a.offline.Storage.prototype.getConfiguration=function(){o.asserts.assert(this.config_,"Config must not be null!");var e=a.util.PlayerConfiguration.createDefault();return a.util.PlayerConfiguration.mergeConfigObjects(e,this.config_,a.util.PlayerConfiguration.createDefault()),e},o.exportProperty(a.offline.Storage.prototype,"getConfiguration",a.offline.Storage.prototype.getConfiguration),a.offline.Storage.prototype.getNetworkingEngine=function(){return this.networkingEngine_},o.exportProperty(a.offline.Storage.prototype,"getNetworkingEngine",a.offline.Storage.prototype.getNetworkingEngine),a.offline.Storage.prototype.store=function(e,t,r){var n=this;return this.startOperation_(this.store_(e,t||{},(function(){return i.asyncExecutePromiseGeneratorFunction((function t(){var s,l;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return r&&"string"!=typeof r?(a.Deprecate.deprecateFeature(2,6,"Storing with a manifest parser factory","Please register a manifest parser and for the mime-type."),s=r,t.return(new s)):(o.asserts.assert(n.networkingEngine_,"Should not call |store| after |destroy|"),t.yield(a.media.ManifestParser.create(e,n.networkingEngine_,n.config_.manifest.retryParameters,r),2));case 2:return l=t.yieldResult,t.return(l)}}))}))})))},o.exportProperty(a.offline.Storage.prototype,"store",a.offline.Storage.prototype.store),a.offline.Storage.prototype.getStoreInProgress=function(){return this.storeInProgress_},o.exportProperty(a.offline.Storage.prototype,"getStoreInProgress",a.offline.Storage.prototype.getStoreInProgress),a.offline.Storage.prototype.store_=function(e,t,r){var n=this;return i.asyncExecutePromiseGeneratorFunction((function s(){var l,u,c,d,p,f,h,m,g;return i.generator.createGenerator(s,(function(i){switch(i.nextAddress){case 1:return n.requireSupport_(),n.storeInProgress_?i.return(Promise.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.STORE_ALREADY_IN_PROGRESS))):(n.storeInProgress_=!0,i.yield(n.parseManifest(e,r),2));case 2:if(l=i.yieldResult,n.checkDestroyed_(),!(!l.presentationTimeline.isLive()&&!l.presentationTimeline.isInProgress()))throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.CANNOT_STORE_LIVE_OFFLINE,e);return u=null,c=new a.offline.StorageMuxer,p=d=null,i.setCatchFinallyBlocks(3,4),i.yield(n.createDrmEngine(l,(function(e){p=p||e})),6);case 6:if(u=i.yieldResult,n.checkDestroyed_(),p)throw p;return i.yield(n.filterManifest_(l,u),7);case 7:return i.yield(c.init(),8);case 8:return n.checkDestroyed_(),i.yield(c.getActive(),9);case 9:return d=i.yieldResult,n.checkDestroyed_(),o.asserts.assert(u,"drmEngine should be non-null here."),i.yield(n.downloadManifest_(d.cell,u,l,e,t),10);case 10:if(f=i.yieldResult,n.checkDestroyed_(),p)throw p;return i.yield(d.cell.addManifests([f]),11);case 11:return h=i.yieldResult,n.checkDestroyed_(),m=a.offline.OfflineUri.manifest(d.path.mechanism,d.path.cell,h[0]),i.return(a.offline.StoredContentUtils.fromManifestDB(m,f));case 4:return i.enterFinallyBlock(),n.storeInProgress_=!1,n.segmentsFromStore_=[],i.yield(c.destroy(),12);case 12:if(!u){i.jumpTo(13);break}return i.yield(u.destroy(),13);case 13:i.leaveFinallyBlock(0);break;case 3:if(g=i.enterCatchBlock(),!d){i.jumpTo(15);break}return i.yield(d.cell.removeSegments(n.segmentsFromStore_,(function(){})),15);case 15:throw p||g}}))}))},a.offline.Storage.prototype.filterManifest_=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var s,l;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return s={width:1/0,height:1/0},a.util.ManifestFilter.filterByRestrictions(e,r.config_.restrictions,s),a.util.ManifestFilter.filterByMediaSourceSupport(e),a.util.ManifestFilter.filterByDrmSupport(e,t),a.util.ManifestFilter.filterByCommonCodecs(e),l=r.config_.preferredAudioChannelCount,a.util.StreamUtils.chooseCodecsAndFilterManifest(e,l),n.yield(a.util.ManifestFilter.rollingFilter(e,(function(e){return i.asyncExecutePromiseGeneratorFunction((function t(){var n,s,l,u,c,d,p,f;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:n=a.util.StreamUtils,s=[];for(var h=i.makeIterator(e.variants),m=h.next();!m.done;m=h.next())l=m.value,o.asserts.assert(n.isPlayable(l),'We should have already filtered by "is playable"'),s.push(n.variantToTrack(l));for(m=(h=i.makeIterator(e.textStreams)).next();!m.done;m=h.next())u=m.value,s.push(n.textStreamToTrack(u));return t.yield(r.config_.offline.trackSelectionCallback(s),2);case 2:for(c=t.yieldResult,d=new Set,p=new Set,m=(h=i.makeIterator(c)).next();!m.done;m=h.next())"variant"==(f=m.value).type&&d.add(f.id),"text"==f.type&&p.add(f.id);e.variants=e.variants.filter((function(e){return d.has(e.id)})),e.textStreams=e.textStreams.filter((function(e){return p.has(e.id)})),t.jumpToEnd()}}))}))})),2);case 2:a.offline.Storage.validateManifest_(e),n.jumpToEnd()}}))}))},a.offline.Storage.prototype.downloadManifest_=function(e,t,r,n,s){var l=this;return i.asyncExecutePromiseGeneratorFunction((function u(){var c,d,p,f,h,m,g,y,_,v;return i.generator.createGenerator(u,(function(i){switch(i.nextAddress){case 1:return o.asserts.assert(l.networkingEngine_,"Cannot call |downloadManifest_| after calling |destroy|."),c=a.offline.StoredContentUtils.fromManifest(n,r,0,s),d=r.periods.some((function(e){return e.variants.some((function(e){return e.drmInfos&&e.drmInfos.length}))})),p=r.periods.some((function(e){return e.variants.some((function(e){return e.drmInfos.some((function(e){return e.initData&&e.initData.length}))}))})),h=null,(f=d&&!p)&&(m=t.getDrmInfo(),h=a.offline.Storage.defaultSystemIds_.get(m.keySystem)),g=new a.offline.DownloadManager(l.networkingEngine_,(function(e,t){c.size=t,l.config_.offline.progressCallback(c,e)}),(function(e,r){f&&l.config_.offline.usePersistentLicense&&h==r&&t.newInitData("cenc",e)})),i.setFinallyBlock(2),_=y=l.createOfflineManifest_(g,e,t,r,n,s),i.yield(g.waitToFinish(),4);case 4:if(_.size=i.yieldResult,y.expiration=t.getExpiration(),v=t.getSessionIds(),y.sessionIds=l.config_.offline.usePersistentLicense?v:[],d&&l.config_.offline.usePersistentLicense&&!v.length)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.NO_INIT_DATA_FOR_OFFLINE);return i.return(y);case 2:return i.enterFinallyBlock(),i.yield(g.destroy(),5);case 5:i.leaveFinallyBlock(0)}}))}))},a.offline.Storage.prototype.remove=function(e){return this.startOperation_(this.remove_(e))},o.exportProperty(a.offline.Storage.prototype,"remove",a.offline.Storage.prototype.remove),a.offline.Storage.prototype.remove_=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){var n,o,s,l,u,c;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return t.requireSupport_(),null!=(n=a.offline.OfflineUri.parse(e))&&n.isManifest()?(o=n,s=new a.offline.StorageMuxer,r.setFinallyBlock(2),r.yield(s.init(),4)):r.return(Promise.reject(new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.MALFORMED_OFFLINE_URI,e)));case 4:return r.yield(s.getCell(o.mechanism(),o.cell()),5);case 5:return l=r.yieldResult,r.yield(l.getManifests([o.key()]),6);case 6:return u=r.yieldResult,c=u[0],r.yield(Promise.all([t.removeFromDRM_(o,c,s),t.removeFromStorage_(l,o,c)]),2);case 2:return r.enterFinallyBlock(),r.yield(s.destroy(),8);case 8:r.leaveFinallyBlock(0)}}))}))},a.offline.Storage.getCapabilities_=function(e,t){for(var r=a.util.MimeUtils,n=[],o=i.makeIterator(e.periods),s=o.next();!s.done;s=o.next())for(var l=(s=i.makeIterator(s.value.streams)).next();!l.done;l=s.next())l=l.value,t&&"video"==l.contentType?n.push({contentType:r.getFullType(l.mimeType,l.codecs),robustness:e.drmInfo.videoRobustness}):t||"audio"!=l.contentType||n.push({contentType:r.getFullType(l.mimeType,l.codecs),robustness:e.drmInfo.audioRobustness});return n},a.offline.Storage.prototype.removeFromDRM_=function(e,t,r){var n=this;return i.asyncExecutePromiseGeneratorFunction((function e(){return i.generator.createGenerator(e,(function(e){switch(e.nextAddress){case 1:return o.asserts.assert(n.networkingEngine_,"Cannot be destroyed"),e.yield(a.offline.Storage.deleteLicenseFor_(n.networkingEngine_,n.config_.drm,r,t),0)}}))}))},a.offline.Storage.prototype.removeFromStorage_=function(e,t,r){var n=this,i=a.offline.Storage.getAllSegmentIds_(r),o=i.length+1,s=0,l=a.offline.StoredContentUtils.fromManifestDB(t,r);return r=function(e){s+=1,n.config_.offline.progressCallback(l,s/o)},Promise.all([e.removeSegments(i,r),e.removeManifests([t.key()],r)])},a.offline.Storage.prototype.removeEmeSessions=function(){return this.startOperation_(this.removeEmeSessions_())},o.exportProperty(a.offline.Storage.prototype,"removeEmeSessions",a.offline.Storage.prototype.removeEmeSessions),a.offline.Storage.prototype.removeEmeSessions_=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var r,n,s,l,u,c,d,p,f,h;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return e.requireSupport_(),o.asserts.assert(e.networkingEngine_,"Cannot be destroyed"),r=e.networkingEngine_,n=e.config_.drm,s=new a.offline.StorageMuxer,l=new a.offline.SessionDeleter,u=!1,t.setFinallyBlock(2),t.yield(s.init(),4);case 4:for(c=[],s.forEachEmeSessionCell((function(e){return c.push(e)})),d=Promise.resolve(),p={},f=i.makeIterator(c),h=f.next();!h.done;p={sessionIdCell:p.sessionIdCell},h=f.next())p.sessionIdCell=h.value,d=d.then(function(e){return function(){return i.asyncExecutePromiseGeneratorFunction((function t(){var o,a;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return t.yield(e.sessionIdCell.getAll(),2);case 2:return o=t.yieldResult,t.yield(l.delete(n,r,o),3);case 3:return a=t.yieldResult,t.yield(e.sessionIdCell.remove(a),4);case 4:a.length!=o.length&&(u=!0),t.jumpToEnd()}}))}))}}(p));return t.yield(d,2);case 2:return t.enterFinallyBlock(),t.yield(s.destroy(),6);case 6:t.leaveFinallyBlock(3);break;case 3:return t.return(!u)}}))}))},a.offline.Storage.prototype.list=function(){return this.startOperation_(this.list_())},o.exportProperty(a.offline.Storage.prototype,"list",a.offline.Storage.prototype.list),a.offline.Storage.prototype.list_=function(){var e=this;return i.asyncExecutePromiseGeneratorFunction((function t(){var r,n,o;return i.generator.createGenerator(t,(function(t){switch(t.nextAddress){case 1:return e.requireSupport_(),r=[],n=new a.offline.StorageMuxer,t.setFinallyBlock(2),t.yield(n.init(),4);case 4:return o=Promise.resolve(),n.forEachCell((function(e,t){o=o.then((function(){return i.asyncExecutePromiseGeneratorFunction((function n(){return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return n.yield(t.getAllManifests(),2);case 2:n.yieldResult.forEach((function(t,n){var i=a.offline.OfflineUri.manifest(e.mechanism,e.cell,n);i=a.offline.StoredContentUtils.fromManifestDB(i,t),r.push(i)})),n.jumpToEnd()}}))}))}))})),t.yield(o,2);case 2:return t.enterFinallyBlock(),t.yield(n.destroy(),6);case 6:t.leaveFinallyBlock(3);break;case 3:return t.return(r)}}))}))},a.offline.Storage.prototype.parseManifest=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var s,l,u,c,d,p;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return s=null,l=r.networkingEngine_,o.asserts.assert(l,"Should be initialized!"),u={networkingEngine:l,filterAllPeriods:function(){},filterNewPeriod:function(){},onTimelineRegionAdded:function(){},onEvent:function(){},onError:function(e){s=e}},n.yield(t(),2);case 2:return(c=n.yieldResult).configure(r.config_.manifest),r.checkDestroyed_(),n.setFinallyBlock(3),n.yield(c.start(e,u),5);case 5:return d=n.yieldResult,r.checkDestroyed_(),p=a.offline.Storage.getAllStreamsFromManifest_(d),n.yield(Promise.all(a.util.Iterables.map(p,(function(e){return e.createSegmentIndex()}))),6);case 6:if(r.checkDestroyed_(),s)throw s;return n.return(d);case 3:return n.enterFinallyBlock(),n.yield(c.stop(),7);case 7:n.leaveFinallyBlock(0)}}))}))},a.offline.Storage.prototype.createDrmEngine=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var s,l,u;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return o.asserts.assert(r.networkingEngine_,"Cannot call |createDrmEngine| after |destroy|"),s=new a.media.DrmEngine({netEngine:r.networkingEngine_,onError:t,onKeyStatus:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),l=a.util.Periods.getAllVariantsFrom(e.periods),u=r.config_,s.configure(u.drm),n.yield(s.initForStorage(l,u.offline.usePersistentLicense),2);case 2:return n.yield(s.setServerCertificate(),3);case 3:return n.yield(s.createOrLoad(),4);case 4:return n.return(s)}}))}))},a.offline.Storage.prototype.createOfflineManifest_=function(e,t,r,n,i,o){var s=this,l=new a.offline.StreamBandwidthEstimator,u=n.periods.map((function(i){return s.createPeriod_(e,t,l,r,n,i)})),c=r.getDrmInfo(),d=this.config_.offline.usePersistentLicense;return c&&d&&(c.initData=[]),{originalManifestUri:i,duration:n.presentationTimeline.getDuration(),size:0,expiration:r.getExpiration(),periods:u,sessionIds:d?r.getSessionIds():[],drmInfo:c,appMetadata:o}},a.offline.Storage.prototype.createPeriod_=function(e,t,r,n,o,s){for(var l=(n=i.makeIterator(s.variants)).next();!l.done;l=n.next())r.addVariant(l.value);for(l=(n=i.makeIterator(s.textStreams)).next();!l.done;l=n.next())r.addText(l.value);n=a.offline.Storage.getAllStreamsFromPeriod_(s);var u=new Map;for(l=(n=i.makeIterator(n)).next();!l.done;l=n.next()){l=l.value;var c=this.createStream_(e,t,r,o,s,l);u.set(l.id,c)}return s.variants.forEach((function(e){e.audio&&u.get(e.audio.id).variantIds.push(e.id),e.video&&u.get(e.video.id).variantIds.push(e.id)})),{startTime:s.startTime,streams:Array.from(u.values())}},a.offline.Storage.prototype.createStream_=function(e,t,r,n,o,s){var l=this,u={id:s.id,originalId:s.originalId,primary:s.primary,presentationTimeOffset:s.presentationTimeOffset||0,contentType:s.type,mimeType:s.mimeType,codecs:s.codecs,frameRate:s.frameRate,pixelAspectRatio:s.pixelAspectRatio,kind:s.kind,language:s.language,label:s.label,width:s.width||null,height:s.height||null,initSegmentKey:null,encrypted:s.encrypted,keyId:s.keyId,segments:[],variantIds:[]};n=n.presentationTimeline.getSegmentAvailabilityStart();var c=s.id;return(o=s.initSegmentReference)&&(o=a.util.Networking.createSegmentRequest(o.getUris(),o.startByte,o.endByte,this.config_.streaming.retryParameters),e.queue(c,o,r.getInitSegmentEstimate(s.id),!0,(function(e){return i.asyncExecutePromiseGeneratorFunction((function r(){var n;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return r.yield(t.addSegments([{data:e}]),2);case 2:n=r.yieldResult,l.segmentsFromStore_.push(n[0]),u.initSegmentKey=n[0],r.jumpToEnd()}}))}))}))),a.offline.Storage.forEachSegment_(s,n,(function(n){var o=a.util.Networking.createSegmentRequest(n.getUris(),n.startByte,n.endByte,l.config_.streaming.retryParameters);e.queue(c,o,r.getSegmentEstimate(s.id,n),!1,(function(e){return i.asyncExecutePromiseGeneratorFunction((function r(){var o;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return r.yield(t.addSegments([{data:e}]),2);case 2:o=r.yieldResult,l.segmentsFromStore_.push(o[0]),u.segments.push({startTime:n.startTime,endTime:n.endTime,dataKey:o[0]}),r.jumpToEnd()}}))}))}))})),u},a.offline.Storage.forEachSegment_=function(e,t,r){for(var n=null==(t=e.findSegmentPosition(t))?null:e.getSegmentReference(t);n;)r(n),n=e.getSegmentReference(++t)},a.offline.Storage.prototype.checkDestroyed_=function(){if(this.destroyer_.destroyed())throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.OPERATION_ABORTED)},a.offline.Storage.prototype.requireSupport_=function(){if(!a.offline.Storage.support())throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.STORAGE,a.util.Error.Code.STORAGE_NOT_SUPPORTED)},a.offline.Storage.prototype.startOperation_=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return t.openOperations_.push(e),r.setFinallyBlock(2),r.yield(e,4);case 4:return r.return(r.yieldResult);case 2:r.enterFinallyBlock(),a.util.ArrayUtils.remove(t.openOperations_,e),r.leaveFinallyBlock(0)}}))}))},a.offline.Storage.getAllSegmentIds_=function(e){var t=[];return e.periods.forEach((function(e){e.streams.forEach((function(e){null!=e.initSegmentKey&&t.push(e.initSegmentKey),e.segments.forEach((function(e){t.push(e.dataKey)}))}))})),t},a.offline.Storage.deleteAll=function(){return i.asyncExecutePromiseGeneratorFunction((function e(){var t;return i.generator.createGenerator(e,(function(e){switch(e.nextAddress){case 1:return t=new a.offline.StorageMuxer,e.setFinallyBlock(2),e.yield(t.erase(),2);case 2:return e.enterFinallyBlock(),e.yield(t.destroy(),5);case 5:e.leaveFinallyBlock(0)}}))}))},o.exportProperty(a.offline.Storage,"deleteAll",a.offline.Storage.deleteAll),a.offline.Storage.deleteLicenseFor_=function(e,t,r,n){return i.asyncExecutePromiseGeneratorFunction((function o(){var s,l,u,c;return i.generator.createGenerator(o,(function(i){switch(i.nextAddress){case 1:return n.drmInfo?(s=r.getEmeSessionCell(),l=n.sessionIds.map((function(e){return{sessionId:e,keySystem:n.drmInfo.keySystem,licenseUri:n.drmInfo.licenseServerUri,serverCertificate:n.drmInfo.serverCertificate,audioCapabilities:a.offline.Storage.getCapabilities_(n,!1),videoCapabilities:a.offline.Storage.getCapabilities_(n,!0)}})),u=new a.offline.SessionDeleter,i.yield(u.delete(t,e,l),2)):i.return();case 2:return c=i.yieldResult,i.yield(s.remove(c),3);case 3:return i.yield(s.add(l.filter((function(e){return-1==c.indexOf(e.sessionId)}))),0)}}))}))},a.offline.Storage.getAllStreamsFromManifest_=function(e){for(var t=new Set,r=(e=i.makeIterator(e.periods)).next();!r.done;r=e.next()){r=r.value;for(var n=i.makeIterator(r.textStreams),o=n.next();!o.done;o=n.next())t.add(o.value);for(n=(r=i.makeIterator(r.variants)).next();!n.done;n=r.next())(n=n.value).audio&&t.add(n.audio),n.video&&t.add(n.video)}return t},a.offline.Storage.getAllStreamsFromPeriod_=function(e){for(var t=new Set,r=i.makeIterator(e.textStreams),n=r.next();!n.done;n=r.next())t.add(n.value);for(r=(e=i.makeIterator(e.variants)).next();!r.done;r=e.next())(r=r.value).audio&&t.add(r.audio),r.video&&t.add(r.video);return t},a.offline.Storage.verifyConfig_=function(e){var t=!1;null!=e.trackSelectionCallback&&(t=!0,e.offline=e.offline||{},e.offline.trackSelectionCallback=e.trackSelectionCallback,delete e.trackSelectionCallback),null!=e.progressCallback&&(t=!0,e.offline=e.offline||{},e.offline.progressCallback=e.progressCallback,delete e.progressCallback),null!=e.usePersistentLicense&&(t=!0,e.offline=e.offline||{},e.offline.usePersistentLicense=e.usePersistentLicense,delete e.usePersistentLicense),t&&a.Deprecate.deprecateFeature(2,6,"Storage.configure with OfflineConfig","Please configure storage with a player configuration.")},a.offline.Storage.validateManifest_=function(e){if(0==e.periods.length)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.MANIFEST,a.util.Error.Code.NO_PERIODS);for(var t=(e=i.makeIterator(e.periods)).next();!t.done;t=e.next())a.offline.Storage.validatePeriod_(t.value)},a.offline.Storage.validatePeriod_=function(e){var t=new Set(e.variants.map((function(e){return e.video}))),r=new Set(e.variants.map((function(e){return e.audio})));e=e.textStreams,1<t.size&&a.log.warning("Multiple video tracks selected to be stored");for(var n=(t=i.makeIterator(r)).next();!n.done;n=t.next()){n=n.value;for(var o=i.makeIterator(r),s=o.next();!s.done;s=o.next())n!=(s=s.value)&&n.language==s.language&&a.log.warning("Similar audio tracks were selected to be stored",n.id,s.id)}for(t=(r=i.makeIterator(e)).next();!t.done;t=r.next())for(t=t.value,o=(n=i.makeIterator(e)).next();!o.done;o=n.next())t!=(o=o.value)&&t.language==o.language&&a.log.warning("Similar text tracks were selected to be stored",t.id,o.id)},a.offline.Storage.defaultSystemIds_=(new Map).set("org.w3.clearkey","1077efecc0b24d02ace33c1e52e2fb4b").set("com.widevine.alpha","edef8ba979d64acea3c827dcd51d21ed").set("com.microsoft.playready","9a04f07998404286ab92e65be0885f95").set("com.adobe.primetime","f239e769efa348509c16a903c6932efb"),a.Player.registerSupportPlugin("offline",a.offline.Storage.support),a.polyfill={},a.polyfill.installAll=function(){for(var e=0;e<a.polyfill.polyfills_.length;++e)try{a.polyfill.polyfills_[e].callback()}catch(e){a.log.alwaysWarn("Error installing polyfill!",e)}},o.exportSymbol("shaka.polyfill.installAll",a.polyfill.installAll),a.polyfill.polyfills_=[],a.polyfill.register=function(e,t){for(var r={priority:t=t||0,callback:e},n=0;n<a.polyfill.polyfills_.length;n++)if(a.polyfill.polyfills_[n].priority<t)return void a.polyfill.polyfills_.splice(n,0,r);a.polyfill.polyfills_.push(r)},o.exportSymbol("shaka.polyfill.register",a.polyfill.register),a.polyfill.EncryptionScheme=function(){},a.polyfill.EncryptionScheme.install=function(){p.install()},a.polyfill.register(a.polyfill.EncryptionScheme.install,-1),a.polyfill.Fullscreen={},a.polyfill.Fullscreen.install=function(){if(e.Document){var t=Element.prototype;t.requestFullscreen=t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullscreen,(t=Document.prototype).exitFullscreen=t.exitFullscreen||t.mozCancelFullScreen||t.msExitFullscreen||t.webkitCancelFullScreen,"fullscreenElement"in document||(Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement||document.webkitFullscreenElement}}),Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled}})),t=a.polyfill.Fullscreen.proxyEvent_,document.addEventListener("webkitfullscreenchange",t),document.addEventListener("webkitfullscreenerror",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("mozfullscreenerror",t),document.addEventListener("MSFullscreenChange",t),document.addEventListener("MSFullscreenError",t)}},a.polyfill.Fullscreen.proxyEvent_=function(e){var t=e.type.replace(/^(webkit|moz|MS)/,"").toLowerCase();if("function"==typeof Event)var r=new Event(t,e);else(r=document.createEvent("Event")).initEvent(t,e.bubbles,e.cancelable);e.target.dispatchEvent(r)},a.polyfill.register(a.polyfill.Fullscreen.install),a.polyfill.IndexedDB={},a.polyfill.IndexedDB.install=function(){a.log.debug("IndexedDB.install");var t=!1;if(a.util.Platform.isChromecast())a.log.debug("Removing IndexedDB from ChromeCast"),t=!0;else try{e.indexedDB&&(t=!1)}catch(e){a.log.debug("Removing IndexedDB due to an exception when accessing it"),t=!0}t&&(delete e.indexedDB,o.asserts.assert(!e.indexedDB,"Failed to override window.indexedDB"))},a.polyfill.register(a.polyfill.IndexedDB.install),a.polyfill.InputEvent={},a.polyfill.InputEvent.install=function(){a.log.debug("InputEvent.install"),a.util.Platform.isIE()&&!HTMLInputElement.prototype.originalAddEventListener&&(a.log.info("Patching input event support on IE."),HTMLInputElement.prototype.originalAddEventListener=HTMLInputElement.prototype.addEventListener,HTMLInputElement.prototype.addEventListener=a.polyfill.InputEvent.addEventListener_)},a.polyfill.InputEvent.addEventListener_=function(e,t,r){if("input"==e)switch(this.type){case"range":e="change"}HTMLInputElement.prototype.originalAddEventListener.call(this,e,t,r)},a.polyfill.register(a.polyfill.InputEvent.install),a.polyfill.Languages={},a.polyfill.Languages.install=function(){navigator.languages||Object.defineProperty(navigator,"languages",{get:function(){return navigator.language?[navigator.language]:["en"]}})},a.polyfill.register(a.polyfill.Languages.install),a.polyfill.MathRound={},a.polyfill.MathRound.MAX_ACCURATE_INPUT_=4503599627370496,a.polyfill.MathRound.install=function(){a.log.debug("mathRound.install");var e=a.polyfill.MathRound.MAX_ACCURATE_INPUT_+1;if(Math.round(e)!=e){a.log.debug("polyfill Math.round");var t=Math.round;Math.round=function(e){var r=e;return e<=a.polyfill.MathRound.MAX_ACCURATE_INPUT_&&(r=t(e)),r}}},a.polyfill.register(a.polyfill.MathRound.install),a.polyfill.MediaSource={},a.polyfill.MediaSource.install=function(){a.log.debug("MediaSource.install");var t=a.util.Platform.safariVersion();e.MediaSource?e.cast&&cast.__platform__&&cast.__platform__.canDisplayType?(a.log.info("Patching Chromecast MSE bugs."),a.polyfill.MediaSource.patchCastIsTypeSupported_()):t?(a.polyfill.MediaSource.rejectTsContent_(),12>=t?(a.log.info("Patching Safari 11 & 12 MSE bugs."),a.polyfill.MediaSource.stubAbort_(),a.polyfill.MediaSource.patchRemovalRange_()):(a.log.info("Patching Safari 13 MSE bugs."),a.polyfill.MediaSource.stubAbort_())):a.util.Platform.isTizen2()||a.util.Platform.isTizen3()||a.util.Platform.isTizen4()?a.polyfill.MediaSource.rejectCodec_("opus"):a.log.info("Using native MSE as-is."):a.log.info("No MSE implementation available.")},a.polyfill.MediaSource.blacklist_=function(){e.MediaSource=null},a.polyfill.MediaSource.stubAbort_=function(){var e=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(t){for(var r=[],n=0;n<arguments.length;++n)r[n-0]=arguments[n];return(r=e.apply(this,r)).abort=function(){},r}},a.polyfill.MediaSource.patchRemovalRange_=function(){var e=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(t,r){return e.call(this,t,r-.001)}},a.polyfill.MediaSource.rejectTsContent_=function(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(t){return"mp2t"!=t.split(/ *; */)[0].split("/")[1].toLowerCase()&&e(t)}},a.polyfill.MediaSource.rejectCodec_=function(e){var t=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(r){return a.util.MimeUtils.getCodecBase(r)!=e&&t(r)}},a.polyfill.MediaSource.patchCastIsTypeSupported_=function(){var e=MediaSource.isTypeSupported,t=/^dv(?:h[e1]|a[v1])\./;MediaSource.isTypeSupported=function(r){for(var n=r.split(/ *; */),i=n[0],o={},a=1;a<n.length;++a){var s=n[a].split("="),l=s[0];s=s[1].replace(/"(.*)"/,"$1"),o[l]=s}if(!(n=o.codecs))return e(r);var u=!1,c=!1;for(var d in r=n.split(",").filter((function(e){return t.test(e)&&(c=!0),/^(hev|hvc)1\.2/.test(e)&&(u=!0),!0})),c&&(u=!1),o.codecs=r.join(","),u&&(o.eotf="smpte2084"),o)i+="; "+d+'="'+o[d]+'"';return cast.__platform__.canDisplayType(i)}},a.polyfill.register(a.polyfill.MediaSource.install),a.polyfill.PatchedMediaKeysApple={},a.polyfill.PatchedMediaKeysApple.install=function(){if(e.HTMLVideoElement&&e.WebKitMediaKeys){a.log.info("Using Apple-prefixed EME");var t=a.polyfill.PatchedMediaKeysApple;t.MediaKeyStatusMap.KEY_ID_=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=t.setMediaKeys,e.MediaKeys=t.MediaKeys,e.MediaKeySystemAccess=t.MediaKeySystemAccess,navigator.requestMediaKeySystemAccess=t.requestMediaKeySystemAccess}},a.polyfill.PatchedMediaKeysApple.requestMediaKeySystemAccess=function(e,t){a.log.debug("PatchedMediaKeysApple.requestMediaKeySystemAccess"),o.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess');var r=a.polyfill.PatchedMediaKeysApple;try{var n=new r.MediaKeySystemAccess(e,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}},a.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess=function(e,t){if(a.log.debug("PatchedMediaKeysApple.MediaKeySystemAccess"),this.keySystem=e,e.startsWith("com.apple.fps"))for(var r=i.makeIterator(t),n=r.next();!n.done;n=r.next())if(n=this.checkConfig_(n.value))return void(this.configuration_=n);throw(r=Error("Unsupported keySystem")).name="NotSupportedError",r.code=DOMException.NOT_SUPPORTED_ERR,r},a.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess.prototype.checkConfig_=function(e){if("required"==e.persistentState)return null;var t={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:e.initDataTypes,sessionTypes:["temporary"],label:e.label},r=!1,n=!1;if(e.audioCapabilities)for(var o=i.makeIterator(e.audioCapabilities),a=o.next();!a.done;a=o.next())if((a=a.value).contentType){r=!0;var s=a.contentType.split(";")[0];WebKitMediaKeys.isTypeSupported(this.keySystem,s)&&(t.audioCapabilities.push(a),n=!0)}if(e.videoCapabilities)for(a=(e=i.makeIterator(e.videoCapabilities)).next();!a.done;a=e.next())(o=a.value).contentType&&(r=!0,a=o.contentType.split(";")[0],WebKitMediaKeys.isTypeSupported(this.keySystem,a)&&(t.videoCapabilities.push(o),n=!0));return r||(n=WebKitMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),n?t:null},a.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess.prototype.createMediaKeys=function(){a.log.debug("PatchedMediaKeysApple.MediaKeySystemAccess.createMediaKeys");var e=new a.polyfill.PatchedMediaKeysApple.MediaKeys(this.keySystem);return Promise.resolve(e)},a.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess.prototype.getConfiguration=function(){return a.log.debug("PatchedMediaKeysApple.MediaKeySystemAccess.getConfiguration"),this.configuration_},a.polyfill.PatchedMediaKeysApple.setMediaKeys=function(e){a.log.debug("PatchedMediaKeysApple.setMediaKeys"),o.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys');var t=a.polyfill.PatchedMediaKeysApple,r=this.mediaKeys;return r&&r!=e&&(o.asserts.assert(r instanceof t.MediaKeys,"non-polyfill instance of oldMediaKeys"),r.setMedia(null)),delete this.mediaKeys,(this.mediaKeys=e)?(o.asserts.assert(e instanceof t.MediaKeys,"non-polyfill instance of newMediaKeys"),e.setMedia(this)):Promise.resolve()},a.polyfill.PatchedMediaKeysApple.MediaKeys=function(e){a.log.debug("PatchedMediaKeysApple.MediaKeys"),this.nativeMediaKeys_=new WebKitMediaKeys(e),this.eventManager_=new a.util.EventManager,this.certificate=null},a.polyfill.PatchedMediaKeysApple.MediaKeys.prototype.createSession=function(e){if(a.log.debug("PatchedMediaKeysApple.MediaKeys.createSession"),"temporary"!=(e=e||"temporary"))throw new TypeError("Session type "+e+" is unsupported on this platform.");return new a.polyfill.PatchedMediaKeysApple.MediaKeySession(this.nativeMediaKeys_,e)},a.polyfill.PatchedMediaKeysApple.MediaKeys.prototype.setServerCertificate=function(e){return a.log.debug("PatchedMediaKeysApple.MediaKeys.setServerCertificate"),this.certificate=e?new Uint8Array(e):null,Promise.resolve(!0)},a.polyfill.PatchedMediaKeysApple.MediaKeys.prototype.setMedia=function(e){var t=this,r=a.polyfill.PatchedMediaKeysApple;if(this.eventManager_.removeAll(),!e)return Promise.resolve();this.eventManager_.listen(e,"webkitneedkey",r.onWebkitNeedKey_);try{return a.util.MediaReadyState.waitForReadyState(e,HTMLMediaElement.HAVE_METADATA,this.eventManager_,(function(){e.webkitSetMediaKeys(t.nativeMediaKeys_)})),Promise.resolve()}catch(e){return Promise.reject(e)}},a.polyfill.PatchedMediaKeysApple.MediaKeySession=function(e,t){a.log.debug("PatchedMediaKeysApple.MediaKeySession"),a.util.FakeEventTarget.call(this),this.nativeMediaKeySession_=null,this.nativeMediaKeys_=e,this.updatePromise_=this.generateRequestPromise_=null,this.eventManager_=new a.util.EventManager,this.sessionId="",this.expiration=NaN,this.closed=new a.util.PublicPromise,this.keyStatuses=new a.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap},o.inherits(a.polyfill.PatchedMediaKeysApple.MediaKeySession,a.util.FakeEventTarget),a.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.generateRequest=function(e,t){a.log.debug("PatchedMediaKeysApple.MediaKeySession.generateRequest"),this.generateRequestPromise_=new a.util.PublicPromise;try{this.nativeMediaKeySession_=this.nativeMediaKeys_.createSession("video/mp4",new Uint8Array(t)),this.sessionId=this.nativeMediaKeySession_.sessionId||"",this.eventManager_.listen(this.nativeMediaKeySession_,"webkitkeymessage",this.onWebkitKeyMessage_.bind(this)),this.eventManager_.listen(this.nativeMediaKeySession_,"webkitkeyadded",this.onWebkitKeyAdded_.bind(this)),this.eventManager_.listen(this.nativeMediaKeySession_,"webkitkeyerror",this.onWebkitKeyError_.bind(this)),this.updateKeyStatus_("status-pending")}catch(e){this.generateRequestPromise_.reject(e)}return this.generateRequestPromise_},a.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.load=function(){return a.log.debug("PatchedMediaKeysApple.MediaKeySession.load"),Promise.reject(Error("MediaKeySession.load not yet supported"))},a.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.update=function(e){a.log.debug("PatchedMediaKeysApple.MediaKeySession.update"),this.updatePromise_=new a.util.PublicPromise;try{this.nativeMediaKeySession_.update(new Uint8Array(e))}catch(e){this.updatePromise_.reject(e)}return this.updatePromise_},a.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.close=function(){a.log.debug("PatchedMediaKeysApple.MediaKeySession.close");try{this.nativeMediaKeySession_.close(),this.closed.resolve(),this.eventManager_.removeAll()}catch(e){this.closed.reject(e)}return this.closed},a.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.remove=function(){return a.log.debug("PatchedMediaKeysApple.MediaKeySession.remove"),Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},a.polyfill.PatchedMediaKeysApple.onWebkitNeedKey_=function(e){if(a.log.debug("PatchedMediaKeysApple.onWebkitNeedKey_",e),o.asserts.assert(this.mediaKeys instanceof a.polyfill.PatchedMediaKeysApple.MediaKeys,"non-polyfill instance of newMediaKeys"),o.asserts.assert(null!=e.initData,"missing init data!"),e=new Uint8Array(e.initData),new DataView(e.buffer,e.byteOffset,e.byteLength).getUint32(0,!0)+4!=e.byteLength)throw new RangeError("Malformed FairPlay init data");e=a.util.StringUtils.fromUTF16(e.subarray(4),!0),e=a.util.StringUtils.toUTF8(e);var t=new Event("encrypted");t.initDataType="skd",t.initData=e,this.dispatchEvent(t)},a.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.onWebkitKeyMessage_=function(e){a.log.debug("PatchedMediaKeysApple.onWebkitKeyMessage_",e),o.asserts.assert(this.generateRequestPromise_,"generateRequestPromise_ should be set before now!"),this.generateRequestPromise_&&(this.generateRequestPromise_.resolve(),this.generateRequestPromise_=null);var t=null==this.keyStatuses.getStatus();e=new a.util.FakeEvent("message",{messageType:t?"license-request":"license-renewal",message:e.message.buffer}),this.dispatchEvent(e)},a.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.onWebkitKeyAdded_=function(e){a.log.debug("PatchedMediaKeysApple.onWebkitKeyAdded_",e),o.asserts.assert(!this.generateRequestPromise_,"Key added during generate!"),o.asserts.assert(this.updatePromise_,"updatePromise_ should be set before now!"),this.updatePromise_&&(this.updateKeyStatus_("usable"),this.updatePromise_.resolve(),this.updatePromise_=null)},a.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.onWebkitKeyError_=function(e){if(a.log.debug("PatchedMediaKeysApple.onWebkitKeyError_",e),(e=Error("EME PatchedMediaKeysApple key error")).errorCode=this.nativeMediaKeySession_.error,null!=this.generateRequestPromise_)this.generateRequestPromise_.reject(e),this.generateRequestPromise_=null;else if(null!=this.updatePromise_)this.updatePromise_.reject(e),this.updatePromise_=null;else switch(this.nativeMediaKeySession_.error.code){case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:this.updateKeyStatus_("output-not-allowed");break;default:this.updateKeyStatus_("internal-error")}},a.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.updateKeyStatus_=function(e){this.keyStatuses.setStatus(e),e=new a.util.FakeEvent("keystatuseschange"),this.dispatchEvent(e)},a.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap=function(){this.size=0,this.status_=void 0},a.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.setStatus=function(e){this.size=null==e?0:1,this.status_=e},a.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.getStatus=function(){return this.status_},a.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.forEach=function(e){this.status_&&e(this.status_,a.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.KEY_ID_)},a.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.get=function(e){if(this.has(e))return this.status_},a.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.has=function(e){var t=a.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.KEY_ID_;return!(!this.status_||!a.util.Uint8ArrayUtils.equal(new Uint8Array(e),new Uint8Array(t)))},a.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.entries=function(){o.asserts.assert(!1,"Not used!  Provided only for the compiler.")},a.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.keys=function(){o.asserts.assert(!1,"Not used!  Provided only for the compiler.")},a.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.values=function(){o.asserts.assert(!1,"Not used!  Provided only for the compiler.")},a.polyfill.register(a.polyfill.PatchedMediaKeysApple.install),a.polyfill.PatchedMediaKeysMs={},a.polyfill.PatchedMediaKeysMs.install=function(){if(e.HTMLVideoElement&&e.MSMediaKeys&&(!navigator.requestMediaKeySystemAccess||!MediaKeySystemAccess.prototype.getConfiguration)){a.log.info("Using ms-prefixed EME v20140218");var t=a.polyfill.PatchedMediaKeysMs;t.MediaKeyStatusMap.KEY_ID_=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=t.setMediaKeys,e.MediaKeys=t.MediaKeys,e.MediaKeySystemAccess=t.MediaKeySystemAccess,navigator.requestMediaKeySystemAccess=t.requestMediaKeySystemAccess}},a.polyfill.PatchedMediaKeysMs.requestMediaKeySystemAccess=function(e,t){a.log.debug("PatchedMediaKeysMs.requestMediaKeySystemAccess"),o.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess');var r=a.polyfill.PatchedMediaKeysMs;try{var n=new r.MediaKeySystemAccess(e,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}},a.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess=function(e,t){a.log.debug("PatchedMediaKeysMs.MediaKeySystemAccess"),this.keySystem=e;for(var r=!1,n=0;n<t.length;++n){var i=t[n],o={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:i.initDataTypes,sessionTypes:["temporary"],label:i.label},s=!1;if(i.audioCapabilities)for(var l=0;l<i.audioCapabilities.length;++l){var u=i.audioCapabilities[l];if(u.contentType){s=!0;var c=u.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,c)&&(o.audioCapabilities.push(u),r=!0)}}if(i.videoCapabilities)for(l=0;l<i.videoCapabilities.length;++l)(u=i.videoCapabilities[l]).contentType&&(s=!0,c=u.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,c)&&(o.videoCapabilities.push(u),r=!0));if(s||(r=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),"required"==i.persistentState&&(r=!1),r)return void(this.configuration_=o)}throw(r=Error("Unsupported keySystem")).name="NotSupportedError",r.code=DOMException.NOT_SUPPORTED_ERR,r},a.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess.prototype.createMediaKeys=function(){a.log.debug("PatchedMediaKeysMs.MediaKeySystemAccess.createMediaKeys");var e=new a.polyfill.PatchedMediaKeysMs.MediaKeys(this.keySystem);return Promise.resolve(e)},a.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess.prototype.getConfiguration=function(){return a.log.debug("PatchedMediaKeysMs.MediaKeySystemAccess.getConfiguration"),this.configuration_},a.polyfill.PatchedMediaKeysMs.setMediaKeys=function(e){a.log.debug("PatchedMediaKeysMs.setMediaKeys"),o.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys');var t=a.polyfill.PatchedMediaKeysMs,r=this.mediaKeys;return r&&r!=e&&(o.asserts.assert(r instanceof t.MediaKeys,"non-polyfill instance of oldMediaKeys"),r.setMedia(null)),delete this.mediaKeys,(this.mediaKeys=e)?(o.asserts.assert(e instanceof t.MediaKeys,"non-polyfill instance of newMediaKeys"),e.setMedia(this)):Promise.resolve()},a.polyfill.PatchedMediaKeysMs.MediaKeys=function(e){a.log.debug("PatchedMediaKeysMs.MediaKeys"),this.nativeMediaKeys_=new MSMediaKeys(e),this.eventManager_=new a.util.EventManager},a.polyfill.PatchedMediaKeysMs.MediaKeys.prototype.createSession=function(e){if(a.log.debug("PatchedMediaKeysMs.MediaKeys.createSession"),"temporary"!=(e=e||"temporary"))throw new TypeError("Session type "+e+" is unsupported on this platform.");return new a.polyfill.PatchedMediaKeysMs.MediaKeySession(this.nativeMediaKeys_,e)},a.polyfill.PatchedMediaKeysMs.MediaKeys.prototype.setServerCertificate=function(e){return a.log.debug("PatchedMediaKeysMs.MediaKeys.setServerCertificate"),Promise.resolve(!1)},a.polyfill.PatchedMediaKeysMs.MediaKeys.prototype.setMedia=function(e){var t=this,r=a.polyfill.PatchedMediaKeysMs;if(this.eventManager_.removeAll(),!e)return Promise.resolve();this.eventManager_.listen(e,"msneedkey",r.onMsNeedKey_);try{return a.util.MediaReadyState.waitForReadyState(e,HTMLMediaElement.HAVE_METADATA,this.eventManager_,(function(){e.msSetMediaKeys(t.nativeMediaKeys_)})),Promise.resolve()}catch(e){return Promise.reject(e)}},a.polyfill.PatchedMediaKeysMs.MediaKeySession=function(e,t){a.log.debug("PatchedMediaKeysMs.MediaKeySession"),a.util.FakeEventTarget.call(this),this.nativeMediaKeySession_=null,this.nativeMediaKeys_=e,this.updatePromise_=this.generateRequestPromise_=null,this.eventManager_=new a.util.EventManager,this.sessionId="",this.expiration=NaN,this.closed=new a.util.PublicPromise,this.keyStatuses=new a.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap},o.inherits(a.polyfill.PatchedMediaKeysMs.MediaKeySession,a.util.FakeEventTarget),a.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.generateRequest=function(e,t){a.log.debug("PatchedMediaKeysMs.MediaKeySession.generateRequest"),this.generateRequestPromise_=new a.util.PublicPromise;try{this.nativeMediaKeySession_=this.nativeMediaKeys_.createSession("video/mp4",new Uint8Array(t),null),this.eventManager_.listen(this.nativeMediaKeySession_,"mskeymessage",this.onMsKeyMessage_.bind(this)),this.eventManager_.listen(this.nativeMediaKeySession_,"mskeyadded",this.onMsKeyAdded_.bind(this)),this.eventManager_.listen(this.nativeMediaKeySession_,"mskeyerror",this.onMsKeyError_.bind(this)),this.updateKeyStatus_("status-pending")}catch(e){this.generateRequestPromise_.reject(e)}return this.generateRequestPromise_},a.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.load=function(){return a.log.debug("PatchedMediaKeysMs.MediaKeySession.load"),Promise.reject(Error("MediaKeySession.load not yet supported"))},a.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.update=function(e){a.log.debug("PatchedMediaKeysMs.MediaKeySession.update"),this.updatePromise_=new a.util.PublicPromise;try{this.nativeMediaKeySession_.update(new Uint8Array(e))}catch(e){this.updatePromise_.reject(e)}return this.updatePromise_},a.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.close=function(){a.log.debug("PatchedMediaKeysMs.MediaKeySession.close");try{this.nativeMediaKeySession_.close(),this.closed.resolve(),this.eventManager_.removeAll()}catch(e){this.closed.reject(e)}return this.closed},a.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.remove=function(){return a.log.debug("PatchedMediaKeysMs.MediaKeySession.remove"),Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},a.polyfill.PatchedMediaKeysMs.onMsNeedKey_=function(e){if(a.log.debug("PatchedMediaKeysMs.onMsNeedKey_",e),e.initData){var t=document.createEvent("CustomEvent");t.initCustomEvent("encrypted",!1,!1,null),t.initDataType="cenc",t.initData=a.util.Pssh.normaliseInitData(e.initData).buffer,this.dispatchEvent(t)}},a.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.onMsKeyMessage_=function(e){a.log.debug("PatchedMediaKeysMs.onMsKeyMessage_",e),o.asserts.assert(this.generateRequestPromise_,"generateRequestPromise_ not set in onMsKeyMessage_"),this.generateRequestPromise_&&(this.generateRequestPromise_.resolve(),this.generateRequestPromise_=null);var t=null==this.keyStatuses.getStatus();e=new a.util.FakeEvent("message",{messageType:t?"license-request":"license-renewal",message:e.message.buffer}),this.dispatchEvent(e)},a.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.onMsKeyAdded_=function(e){a.log.debug("PatchedMediaKeysMs.onMsKeyAdded_",e),this.generateRequestPromise_?(a.log.debug("Simulating completion for a PR persistent license."),o.asserts.assert(!this.updatePromise_,"updatePromise_ and generateRequestPromise_ set in onMsKeyAdded_"),this.updateKeyStatus_("usable"),this.generateRequestPromise_.resolve(),this.generateRequestPromise_=null):(o.asserts.assert(this.updatePromise_,"updatePromise_ not set in onMsKeyAdded_"),this.updatePromise_&&(this.updateKeyStatus_("usable"),this.updatePromise_.resolve(),this.updatePromise_=null))},a.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.onMsKeyError_=function(e){if(a.log.debug("PatchedMediaKeysMs.onMsKeyError_",e),(e=Error("EME PatchedMediaKeysMs key error")).errorCode=this.nativeMediaKeySession_.error,null!=this.generateRequestPromise_)this.generateRequestPromise_.reject(e),this.generateRequestPromise_=null;else if(null!=this.updatePromise_)this.updatePromise_.reject(e),this.updatePromise_=null;else switch(this.nativeMediaKeySession_.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:this.updateKeyStatus_("output-not-allowed");break;default:this.updateKeyStatus_("internal-error")}},a.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.updateKeyStatus_=function(e){this.keyStatuses.setStatus(e),e=new a.util.FakeEvent("keystatuseschange"),this.dispatchEvent(e)},a.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap=function(){this.size=0,this.status_=void 0},a.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.setStatus=function(e){this.size=null==e?0:1,this.status_=e},a.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.getStatus=function(){return this.status_},a.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.forEach=function(e){this.status_&&e(this.status_,a.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.KEY_ID_)},a.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.get=function(e){if(this.has(e))return this.status_},a.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.has=function(e){var t=a.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.KEY_ID_;return!(!this.status_||!a.util.Uint8ArrayUtils.equal(new Uint8Array(e),new Uint8Array(t)))},a.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.entries=function(){o.asserts.assert(!1,"Not used!  Provided only for the compiler.")},a.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.keys=function(){o.asserts.assert(!1,"Not used!  Provided only for the compiler.")},a.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.values=function(){o.asserts.assert(!1,"Not used!  Provided only for the compiler.")},a.polyfill.register(a.polyfill.PatchedMediaKeysMs.install),a.polyfill.PatchedMediaKeysNop={},a.polyfill.PatchedMediaKeysNop.install=function(){if(!(!e.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){a.log.info("EME not available.");var t=a.polyfill.PatchedMediaKeysNop;navigator.requestMediaKeySystemAccess=t.requestMediaKeySystemAccess,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=t.setMediaKeys,e.MediaKeys=t.MediaKeys,e.MediaKeySystemAccess=t.MediaKeySystemAccess}},a.polyfill.PatchedMediaKeysNop.requestMediaKeySystemAccess=function(e,t){return a.log.debug("PatchedMediaKeysNop.requestMediaKeySystemAccess"),o.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess'),Promise.reject(Error("The key system specified is not supported."))},a.polyfill.PatchedMediaKeysNop.setMediaKeys=function(e){return a.log.debug("PatchedMediaKeysNop.setMediaKeys"),o.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys'),null==e?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))},a.polyfill.PatchedMediaKeysNop.MediaKeys=function(){throw new TypeError("Illegal constructor.")},a.polyfill.PatchedMediaKeysNop.MediaKeys.prototype.createSession=function(){},a.polyfill.PatchedMediaKeysNop.MediaKeys.prototype.setServerCertificate=function(){},a.polyfill.PatchedMediaKeysNop.MediaKeySystemAccess=function(){throw new TypeError("Illegal constructor.")},a.polyfill.PatchedMediaKeysNop.MediaKeySystemAccess.prototype.getConfiguration=function(){},a.polyfill.PatchedMediaKeysNop.MediaKeySystemAccess.prototype.createMediaKeys=function(){},a.polyfill.register(a.polyfill.PatchedMediaKeysNop.install,-10),a.polyfill.PatchedMediaKeysWebkit={},a.polyfill.PatchedMediaKeysWebkit.prefix_="",a.polyfill.PatchedMediaKeysWebkit.install=function(){var t=a.polyfill.PatchedMediaKeysWebkit,r=t.prefixApi_;if(!(!e.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)a.log.info("Using webkit-prefixed EME v0.1b"),t.prefix_="webkit";else{if(!HTMLMediaElement.prototype.generateKeyRequest)return;a.log.info("Using nonprefixed EME v0.1b")}o.asserts.assert(HTMLMediaElement.prototype[r("generateKeyRequest")],"PatchedMediaKeysWebkit APIs not available!"),t.MediaKeyStatusMap.KEY_ID_=new Uint8Array([0]).buffer,navigator.requestMediaKeySystemAccess=t.requestMediaKeySystemAccess,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=t.setMediaKeys,e.MediaKeys=t.MediaKeys,e.MediaKeySystemAccess=t.MediaKeySystemAccess}},a.polyfill.PatchedMediaKeysWebkit.prefixApi_=function(e){var t=a.polyfill.PatchedMediaKeysWebkit.prefix_;return t?t+e.charAt(0).toUpperCase()+e.slice(1):e},a.polyfill.PatchedMediaKeysWebkit.requestMediaKeySystemAccess=function(e,t){a.log.debug("PatchedMediaKeysWebkit.requestMediaKeySystemAccess"),o.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess');var r=a.polyfill.PatchedMediaKeysWebkit;try{var n=new r.MediaKeySystemAccess(e,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}},a.polyfill.PatchedMediaKeysWebkit.setMediaKeys=function(e){a.log.debug("PatchedMediaKeysWebkit.setMediaKeys"),o.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys');var t=a.polyfill.PatchedMediaKeysWebkit,r=this.mediaKeys;return r&&r!=e&&(o.asserts.assert(r instanceof t.MediaKeys,"non-polyfill instance of oldMediaKeys"),r.setMedia(null)),delete this.mediaKeys,(this.mediaKeys=e)&&(o.asserts.assert(e instanceof t.MediaKeys,"non-polyfill instance of newMediaKeys"),e.setMedia(this)),Promise.resolve()},a.polyfill.PatchedMediaKeysWebkit.getVideoElement_=function(){var e=document.getElementsByTagName("video");return e.length?e[0]:document.createElement("video")},a.polyfill.PatchedMediaKeysWebkit.MediaKeySystemAccess=function(e,t){a.log.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess"),this.internalKeySystem_=this.keySystem=e;var r=!1;"org.w3.clearkey"==e&&(this.internalKeySystem_="webkit-org.w3.clearkey",r=!1);for(var n=!1,i=a.polyfill.PatchedMediaKeysWebkit.getVideoElement_(),o=0;o<t.length;++o){var s=t[o],l={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:s.initDataTypes,sessionTypes:["temporary"],label:s.label},u=!1;if(s.audioCapabilities)for(var c=0;c<s.audioCapabilities.length;++c){var d=s.audioCapabilities[c];if(d.contentType){u=!0;var p=d.contentType.split(";")[0];i.canPlayType(p,this.internalKeySystem_)&&(l.audioCapabilities.push(d),n=!0)}}if(s.videoCapabilities)for(c=0;c<s.videoCapabilities.length;++c)(d=s.videoCapabilities[c]).contentType&&(u=!0,i.canPlayType(d.contentType,this.internalKeySystem_)&&(l.videoCapabilities.push(d),n=!0));if(u||(n=i.canPlayType("video/mp4",this.internalKeySystem_)||i.canPlayType("video/webm",this.internalKeySystem_)),"required"==s.persistentState&&(r?(l.persistentState="required",l.sessionTypes=["persistent-license"]):n=!1),n)return void(this.configuration_=l)}throw r="Unsupported keySystem","org.w3.clearkey"!=e&&"com.widevine.alpha"!=e||(r="None of the requested configurations were supported."),(r=Error(r)).name="NotSupportedError",r.code=DOMException.NOT_SUPPORTED_ERR,r},a.polyfill.PatchedMediaKeysWebkit.MediaKeySystemAccess.prototype.createMediaKeys=function(){a.log.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess.createMediaKeys");var e=new a.polyfill.PatchedMediaKeysWebkit.MediaKeys(this.internalKeySystem_);return Promise.resolve(e)},a.polyfill.PatchedMediaKeysWebkit.MediaKeySystemAccess.prototype.getConfiguration=function(){return a.log.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess.getConfiguration"),this.configuration_},a.polyfill.PatchedMediaKeysWebkit.MediaKeys=function(e){a.log.debug("PatchedMediaKeysWebkit.MediaKeys"),this.keySystem_=e,this.media_=null,this.eventManager_=new a.util.EventManager,this.newSessions_=[],this.sessionMap_={}},a.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.setMedia=function(e){this.media_=e,this.eventManager_.removeAll();var t=a.polyfill.PatchedMediaKeysWebkit.prefix_;e&&(this.eventManager_.listen(e,t+"needkey",this.onWebkitNeedKey_.bind(this)),this.eventManager_.listen(e,t+"keymessage",this.onWebkitKeyMessage_.bind(this)),this.eventManager_.listen(e,t+"keyadded",this.onWebkitKeyAdded_.bind(this)),this.eventManager_.listen(e,t+"keyerror",this.onWebkitKeyError_.bind(this)))},a.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.createSession=function(e){if(a.log.debug("PatchedMediaKeysWebkit.MediaKeys.createSession"),"temporary"!=(e=e||"temporary")&&"persistent-license"!=e)throw new TypeError("Session type "+e+" is unsupported on this platform.");var t=a.polyfill.PatchedMediaKeysWebkit,r=this.media_||document.createElement("video");return r.src||(r.src="about:blank"),e=new t.MediaKeySession(r,this.keySystem_,e),this.newSessions_.push(e),e},a.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.setServerCertificate=function(e){return a.log.debug("PatchedMediaKeysWebkit.MediaKeys.setServerCertificate"),Promise.resolve(!1)},a.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitNeedKey_=function(e){a.log.debug("PatchedMediaKeysWebkit.onWebkitNeedKey_",e),o.asserts.assert(this.media_,"media_ not set in onWebkitNeedKey_");var t=document.createEvent("CustomEvent");t.initCustomEvent("encrypted",!1,!1,null),t.initDataType="cenc",t.initData=e.initData instanceof ArrayBuffer?e.initData:e.initData.buffer,this.media_.dispatchEvent(t)},a.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitKeyMessage_=function(e){a.log.debug("PatchedMediaKeysWebkit.onWebkitKeyMessage_",e);var t=this.findSession_(e.sessionId);if(t){var r=null==t.keyStatuses.getStatus();e=new a.util.FakeEvent("message",{messageType:r?"licenserequest":"licenserenewal",message:e.message}),t.generated(),t.dispatchEvent(e)}else a.log.error("Session not found",e.sessionId)},a.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitKeyAdded_=function(e){a.log.debug("PatchedMediaKeysWebkit.onWebkitKeyAdded_",e),e=this.findSession_(e.sessionId),o.asserts.assert(e,"unable to find session in onWebkitKeyAdded_"),e&&e.ready()},a.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitKeyError_=function(e){a.log.debug("PatchedMediaKeysWebkit.onWebkitKeyError_",e);var t=this.findSession_(e.sessionId);o.asserts.assert(t,"unable to find session in onWebkitKeyError_"),t&&t.handleError(e)},a.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.findSession_=function(e){var t=this.sessionMap_[e];return t?(a.log.debug("PatchedMediaKeysWebkit.MediaKeys.findSession_",t),t):(t=this.newSessions_.shift())?(t.sessionId=e,this.sessionMap_[e]=t,a.log.debug("PatchedMediaKeysWebkit.MediaKeys.findSession_",t),t):null},a.polyfill.PatchedMediaKeysWebkit.MediaKeySession=function(e,t,r){a.log.debug("PatchedMediaKeysWebkit.MediaKeySession"),a.util.FakeEventTarget.call(this),this.media_=e,this.initialized_=!1,this.updatePromise_=this.generatePromise_=null,this.keySystem_=t,this.type_=r,this.sessionId="",this.expiration=NaN,this.closed=new a.util.PublicPromise,this.keyStatuses=new a.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap},o.inherits(a.polyfill.PatchedMediaKeysWebkit.MediaKeySession,a.util.FakeEventTarget),a.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.generated=function(){a.log.debug("PatchedMediaKeysWebkit.MediaKeySession.generated"),this.generatePromise_&&(this.generatePromise_.resolve(),this.generatePromise_=null)},a.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.ready=function(){a.log.debug("PatchedMediaKeysWebkit.MediaKeySession.ready"),this.updateKeyStatus_("usable"),this.updatePromise_&&this.updatePromise_.resolve(),this.updatePromise_=null},a.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.handleError=function(e){a.log.debug("PatchedMediaKeysWebkit.MediaKeySession.handleError",e);var t=Error("EME v0.1b key error"),r=e.errorCode;r.systemCode=e.systemCode,t.errorCode=r,!e.sessionId&&this.generatePromise_?(45==e.systemCode&&(t.message="Unsupported session type."),this.generatePromise_.reject(t),this.generatePromise_=null):e.sessionId&&this.updatePromise_?(this.updatePromise_.reject(t),this.updatePromise_=null):(t=e.systemCode,e.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?this.updateKeyStatus_("output-restricted"):1==t?this.updateKeyStatus_("expired"):this.updateKeyStatus_("internal-error"))},a.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.generate_=function(e,t){var r=this;if(this.initialized_)return Promise.reject(Error("The session is already initialized."));this.initialized_=!0;try{if("persistent-license"==this.type_){var n=a.util.StringUtils;if(t)var i=new Uint8Array(n.toUTF8("LOAD_SESSION|"+t));else{var s=n.toUTF8("PERSISTENT|"),l=new Uint8Array(s.byteLength+e.byteLength);l.set(new Uint8Array(s),0),l.set(new Uint8Array(e),s.byteLength),i=l}}else o.asserts.assert("temporary"==this.type_,"expected temporary session"),o.asserts.assert(!t,"unexpected offline session ID"),i=new Uint8Array(e);o.asserts.assert(i,"init data not set!")}catch(e){return Promise.reject(e)}o.asserts.assert(null==this.generatePromise_,"generatePromise_ should be null"),this.generatePromise_=new a.util.PublicPromise;var u=(n=a.polyfill.PatchedMediaKeysWebkit.prefixApi_)("generateKeyRequest");try{this.media_[u](this.keySystem_,i)}catch(e){if("InvalidStateError"!=e.name)return this.generatePromise_=null,Promise.reject(e);new a.util.Timer((function(){try{r.media_[u](r.keySystem_,i)}catch(e){r.generatePromise_.reject(e),r.generatePromise_=null}})).tickAfter(.01)}return this.generatePromise_},a.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.update_=function(e,t){if(this.updatePromise_)this.updatePromise_.then(this.update_.bind(this,e,t)).catch(this.update_.bind(this,e,t));else{if(this.updatePromise_=e,"webkit-org.w3.clearkey"==this.keySystem_){var r=a.util.Uint8ArrayUtils,n=a.util.StringUtils.fromUTF8(t),i=JSON.parse(n);"oct"!=i.keys[0].kty&&(this.updatePromise_.reject(Error("Response is not a valid JSON Web Key Set.")),this.updatePromise_=null),n=r.fromBase64(i.keys[0].k),r=r.fromBase64(i.keys[0].kid)}else n=new Uint8Array(t),r=null;i=(i=a.polyfill.PatchedMediaKeysWebkit.prefixApi_)("addKey");try{this.media_[i](this.keySystem_,n,r,this.sessionId)}catch(e){this.updatePromise_.reject(e),this.updatePromise_=null}}},a.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.updateKeyStatus_=function(e){this.keyStatuses.setStatus(e),e=new a.util.FakeEvent("keystatuseschange"),this.dispatchEvent(e)},a.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.generateRequest=function(e,t){return a.log.debug("PatchedMediaKeysWebkit.MediaKeySession.generateRequest"),this.generate_(t,null)},a.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.load=function(e){return a.log.debug("PatchedMediaKeysWebkit.MediaKeySession.load"),"persistent-license"==this.type_?this.generate_(null,e):Promise.reject(Error("Not a persistent session."))},a.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.update=function(e){a.log.debug("PatchedMediaKeysWebkit.MediaKeySession.update",e),o.asserts.assert(this.sessionId,"update without session ID");var t=new a.util.PublicPromise;return this.update_(t,e),t},a.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.close=function(){if(a.log.debug("PatchedMediaKeysWebkit.MediaKeySession.close"),"persistent-license"!=this.type_){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;var e=a.polyfill.PatchedMediaKeysWebkit.prefixApi_;e=e("cancelKeyRequest");try{this.media_[e](this.keySystem_,this.sessionId)}catch(e){}}return this.closed.resolve(),this.closed},a.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.remove=function(){return a.log.debug("PatchedMediaKeysWebkit.MediaKeySession.remove"),"persistent-license"!=this.type_?Promise.reject(Error("Not a persistent session.")):this.close()},a.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap=function(){this.size=0,this.status_=void 0},a.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.setStatus=function(e){this.size=null==e?0:1,this.status_=e},a.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.getStatus=function(){return this.status_},a.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.forEach=function(e){this.status_&&e(this.status_,a.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.KEY_ID_)},a.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.get=function(e){if(this.has(e))return this.status_},a.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.has=function(e){var t=a.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.KEY_ID_;return!(!this.status_||!a.util.Uint8ArrayUtils.equal(new Uint8Array(e),new Uint8Array(t)))},a.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.entries=function(){o.asserts.assert(!1,"Not used!  Provided only for compiler.")},a.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.keys=function(){o.asserts.assert(!1,"Not used!  Provided only for compiler.")},a.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.values=function(){o.asserts.assert(!1,"Not used!  Provided only for compiler.")},a.polyfill.register(a.polyfill.PatchedMediaKeysWebkit.install),a.polyfill.PiPWebkit={},a.polyfill.PiPWebkit.install=function(){if(e.HTMLVideoElement){var t=HTMLVideoElement.prototype;if((!t.requestPictureInPicture||!document.exitPictureInPicture)&&t.webkitSupportsPresentationMode){var r=a.polyfill.PiPWebkit;a.log.debug("PiPWebkit.install"),document.pictureInPictureEnabled=!0,document.pictureInPictureElement=null,t.requestPictureInPicture=r.requestPictureInPicture_,Object.defineProperty(t,"disablePictureInPicture",{get:r.getDisablePictureInPicture_,set:r.setDisablePictureInPicture_,enumerable:!0,configurable:!0}),document.exitPictureInPicture=r.exitPictureInPicture_,document.addEventListener("webkitpresentationmodechanged",r.proxyEvent_,!0)}}},a.polyfill.PiPWebkit.proxyEvent_=function(e){if((e=e.target).webkitPresentationMode==a.polyfill.PiPWebkit.PIP_MODE_){document.pictureInPictureElement=e;var t=new Event("enterpictureinpicture");e.dispatchEvent(t)}else document.pictureInPictureElement==e&&(document.pictureInPictureElement=null),t=new Event("leavepictureinpicture"),e.dispatchEvent(t)},a.polyfill.PiPWebkit.requestPictureInPicture_=function(){var e=a.polyfill.PiPWebkit;return this.webkitSupportsPresentationMode(e.PIP_MODE_)?(this.webkitSetPresentationMode(e.PIP_MODE_),document.pictureInPictureElement=this,Promise.resolve()):Promise.reject(Error("PiP not allowed by video element"))},a.polyfill.PiPWebkit.exitPictureInPicture_=function(){var e=a.polyfill.PiPWebkit,t=document.pictureInPictureElement;return t?(t.webkitSetPresentationMode(e.INLINE_MODE_),document.pictureInPictureElement=null,Promise.resolve()):Promise.reject(Error("No picture in picture element found"))},a.polyfill.PiPWebkit.getDisablePictureInPicture_=function(){return!!this.hasAttribute("disablePictureInPicture")||!this.webkitSupportsPresentationMode(a.polyfill.PiPWebkit.PIP_MODE_)},a.polyfill.PiPWebkit.setDisablePictureInPicture_=function(e){e?this.setAttribute("disablePictureInPicture",""):this.removeAttribute("disablePictureInPicture")},a.polyfill.PiPWebkit.PIP_MODE_="picture-in-picture",a.polyfill.PiPWebkit.INLINE_MODE_="inline",a.polyfill.register(a.polyfill.PiPWebkit.install),a.polyfill.VideoPlayPromise={},a.polyfill.VideoPlayPromise.install=function(){if(a.log.debug("VideoPlayPromise.install"),e.HTMLMediaElement){var t=HTMLMediaElement.prototype.play;HTMLMediaElement.prototype.play=function(){var e=t.apply(this);return e&&e.catch((function(){})),e}}},a.polyfill.register(a.polyfill.VideoPlayPromise.install),a.polyfill.VideoPlaybackQuality={},a.polyfill.VideoPlaybackQuality.install=function(){if(e.HTMLVideoElement){var t=HTMLVideoElement.prototype;!t.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in t&&(t.getVideoPlaybackQuality=a.polyfill.VideoPlaybackQuality.webkit_)}},a.polyfill.VideoPlaybackQuality.webkit_=function(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}},a.polyfill.register(a.polyfill.VideoPlaybackQuality.install),a.polyfill.VTTCue={},a.polyfill.VTTCue.install=function(){if(e.VTTCue)a.log.info("Using native VTTCue.");else if(e.TextTrackCue){var t=TextTrackCue.length;3==t?(a.log.info("Using VTTCue polyfill from 3 argument TextTrackCue."),e.VTTCue=a.polyfill.VTTCue.from3ArgsTextTrackCue_):6==t?(a.log.info("Using VTTCue polyfill from 6 argument TextTrackCue."),e.VTTCue=a.polyfill.VTTCue.from6ArgsTextTrackCue_):a.polyfill.VTTCue.canUse3ArgsTextTrackCue_()&&(a.log.info("Using VTTCue polyfill from 3 argument TextTrackCue."),e.VTTCue=a.polyfill.VTTCue.from3ArgsTextTrackCue_)}else a.log.error("VTTCue not available.")},a.polyfill.VTTCue.from3ArgsTextTrackCue_=function(t,r,n){return new e.TextTrackCue(t,r,n)},a.polyfill.VTTCue.from6ArgsTextTrackCue_=function(t,r,n){return new e.TextTrackCue(t+"-"+r+"-"+n,t,r,n)},a.polyfill.VTTCue.canUse3ArgsTextTrackCue_=function(){try{return!!a.polyfill.VTTCue.from3ArgsTextTrackCue_(1,2,"")}catch(e){return!1}},a.polyfill.register(a.polyfill.VTTCue.install),a.text.TtmlTextParser=function(){},o.exportSymbol("shaka.text.TtmlTextParser",a.text.TtmlTextParser),a.text.TtmlTextParser.parameterNs_="http://www.w3.org/ns/ttml#parameter",a.text.TtmlTextParser.styleNs_="http://www.w3.org/ns/ttml#styling",a.text.TtmlTextParser.prototype.parseInit=function(e){o.asserts.assert(!1,"TTML does not have init segments")},o.exportProperty(a.text.TtmlTextParser.prototype,"parseInit",a.text.TtmlTextParser.prototype.parseInit),a.text.TtmlTextParser.prototype.parseMedia=function(e,t){var r=a.text.TtmlTextParser,n=a.util.XmlUtils,o=r.parameterNs_,s=a.util.StringUtils.fromUTF8(e),l=[],u=new DOMParser,c=null;if(""==s)return l;try{c=u.parseFromString(s,"text/xml")}catch(e){throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.INVALID_XML,"Failed to parse TTML.")}if(c){if(s=c.getElementsByTagName("parsererror")[0])throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.INVALID_XML,s.textContent);if(!(c=c.getElementsByTagName("tt")[0]))throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.INVALID_XML,"TTML does not contain <tt> tag.");s=n.getAttributeNS(c,o,"frameRate"),u=n.getAttributeNS(c,o,"subFrameRate");var d=n.getAttributeNS(c,o,"frameRateMultiplier"),p=n.getAttributeNS(c,o,"tickRate");if(n=c.getAttribute("xml:space")||"default",o=c.getAttribute("tts:extent"),"default"!=n&&"preserve"!=n)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.INVALID_XML,"Invalid xml:space value: "+n);n="default"==n,s=new r.RateInfo_(s,u,d,p),u=r.getLeafNodes_(c.getElementsByTagName("metadata")[0]),d=r.getLeafNodes_(c.getElementsByTagName("styling")[0]),p=r.getLeafNodes_(c.getElementsByTagName("layout")[0]);for(var f=[],h=0;h<p.length;h++){var m=r.parseCueRegion_(p[h],d,o);m&&f.push(m)}for(c=r.getLeafCues_(c.getElementsByTagName("body")[0]),o=(c=i.makeIterator(c)).next();!o.done;o=c.next())(o=r.parseCue_(o.value,t.periodStart,s,u,d,p,f,n,!1))&&l.push(o)}return l},o.exportProperty(a.text.TtmlTextParser.prototype,"parseMedia",a.text.TtmlTextParser.prototype.parseMedia),a.text.TtmlTextParser.percentValues_=/^(\d{1,2}(?:\.\d+)?|100(?:\.0+)?)% (\d{1,2}(?:\.\d+)?|100(?:\.0+)?)%$/,a.text.TtmlTextParser.unitValues_=/^(\d+px|\d+em)$/,a.text.TtmlTextParser.pixelValues_=/^(\d+)px (\d+)px$/,a.text.TtmlTextParser.timeColonFormatFrames_=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,a.text.TtmlTextParser.timeColonFormat_=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,a.text.TtmlTextParser.timeColonFormatMilliseconds_=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,a.text.TtmlTextParser.timeFramesFormat_=/^(\d*(?:\.\d*)?)f$/,a.text.TtmlTextParser.timeTickFormat_=/^(\d*(?:\.\d*)?)t$/,a.text.TtmlTextParser.timeHMSFormat_=/^(?:(\d*(?:\.\d*)?)h)?(?:(\d*(?:\.\d*)?)m)?(?:(\d*(?:\.\d*)?)s)?(?:(\d*(?:\.\d*)?)ms)?$/,a.text.TtmlTextParser.textAlignToLineAlign_={left:a.text.Cue.lineAlign.START,center:a.text.Cue.lineAlign.CENTER,right:a.text.Cue.lineAlign.END,start:a.text.Cue.lineAlign.START,end:a.text.Cue.lineAlign.END},a.text.TtmlTextParser.textAlignToPositionAlign_={left:a.text.Cue.positionAlign.LEFT,center:a.text.Cue.positionAlign.CENTER,right:a.text.Cue.positionAlign.RIGHT},a.text.TtmlTextParser.getLeafNodes_=function(e){var t=[];if(!e)return t;for(var r=i.makeIterator(e.childNodes),n=r.next();!n.done;n=r.next())(n=n.value).nodeType==Node.ELEMENT_NODE&&"br"!==n.nodeName&&(o.asserts.assert(n instanceof Element,"Node should be Element!"),n=a.text.TtmlTextParser.getLeafNodes_(n),o.asserts.assert(0<n.length,"Only a null Element should return no leaves!"),t=t.concat(n));return t.length||t.push(e),t},a.text.TtmlTextParser.getLeafCues_=function(e){if(!e)return[];for(var t=[],r=(e=i.makeIterator(e.childNodes)).next();!r.done;r=e.next())(r=r.value)instanceof Element&&(r.hasAttribute("begin")?t.push(r):t=t.concat(a.text.TtmlTextParser.getLeafCues_(r)));return t},a.text.TtmlTextParser.sanitizeTextContent=function(e,t){for(var r="",n=i.makeIterator(e.childNodes),o=n.next();!o.done;o=n.next())"br"==(o=o.value).nodeName&&e.childNodes[0]!==o?r+="\n":o.childNodes&&0<o.childNodes.length?r+=a.text.TtmlTextParser.sanitizeTextContent(o,t):t?r+=o=(o=o.textContent.trim()).replace(/\s+/g," "):r+=o.textContent;return r},a.text.TtmlTextParser.parseCue_=function(e,t,r,n,o,s,l,u,c){if(c&&"br"==e.nodeName)return(e=new a.text.Cue(0,0,"")).spacer=!0,e;var d=/^[\s\n]*$/.test(e.textContent),p=e.nodeType==Node.ELEMENT_NODE&&!e.hasAttribute("begin")&&!e.hasAttribute("end");if(e.nodeType!=Node.ELEMENT_NODE||p&&d||p&&!c)return null;d=a.text.TtmlTextParser.parseTime_(e.getAttribute("begin"),r),p=a.text.TtmlTextParser.parseTime_(e.getAttribute("end"),r);var f=a.text.TtmlTextParser.parseTime_(e.getAttribute("dur"),r);if(null==p&&null!=f&&(p=d+f),!c&&(null==d||null==p))throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.INVALID_TEXT_CUE);if(d=c&&null==d?0:d+t,p=c&&null==p?0:p+t,f="",c=[],Array.from(e.childNodes).find((function(e){return e.nodeType===Node.TEXT_NODE&&/\S+/.test(e.textContent)})))f=a.text.TtmlTextParser.sanitizeTextContent(e,u);else for(var h=i.makeIterator(e.childNodes),m=h.next();!m.done;m=h.next())(m=a.text.TtmlTextParser.parseCue_(m.value,t,r,n,o,s,l,u,!0))&&(m.startTime=m.startTime||d,m.endTime=m.endTime||p,c.push(m));if((t=new a.text.Cue(d,p,f)).nestedCues=c,(s=a.text.TtmlTextParser.getElementsFromCollection_(e,"region",s,"")[0])&&s.getAttribute("xml:id")){var g=s.getAttribute("xml:id");t.region=l.filter((function(e){return e.id==g}))[0]}return n=a.text.TtmlTextParser.getElementsFromCollection_(e,"smpte:backgroundImage",n,"#")[0],a.text.TtmlTextParser.addStyle_(t,e,s,n,o),t},a.text.TtmlTextParser.parseCueRegion_=function(e,t,r){var n,i,o=a.text.TtmlTextParser,s=new a.text.CueRegion,l=e.getAttribute("xml:id");return l?(s.id=l,l=null,r&&(l=o.percentValues_.exec(r)||o.pixelValues_.exec(r)),r=l?Number(l[1]):null,l=l?Number(l[2]):null,(n=o.getStyleAttributeFromRegion_(e,t,"extent"))&&(null!=(n=(i=o.percentValues_.exec(n))||o.pixelValues_.exec(n))&&(s.width=null!=r?100*Number(n[1])/r:Number(n[1]),s.height=null!=l?100*Number(n[2])/l:Number(n[2]),s.widthUnits=i||null!=r?a.text.CueRegion.units.PERCENTAGE:a.text.CueRegion.units.PX,s.heightUnits=i||null!=l?a.text.CueRegion.units.PERCENTAGE:a.text.CueRegion.units.PX)),(e=o.getStyleAttributeFromRegion_(e,t,"origin"))&&(null!=(n=(i=o.percentValues_.exec(e))||o.pixelValues_.exec(e))&&(s.viewportAnchorX=null!=l?100*Number(n[1])/l:Number(n[1]),s.viewportAnchorY=null!=r?100*Number(n[2])/r:Number(n[2]),s.viewportAnchorUnits=i||null!=r?a.text.CueRegion.units.PERCENTAGE:a.text.CueRegion.units.PX)),s):(a.log.warning("TtmlTextParser parser encountered a region with no id. Region will be ignored."),null)},a.text.TtmlTextParser.addStyle_=function(e,t,r,n,i){var s=a.text.TtmlTextParser,l=a.text.Cue;"rtl"==s.getStyleAttribute_(t,r,i,"direction")&&(e.direction=l.direction.HORIZONTAL_RIGHT_TO_LEFT);var u=s.getStyleAttribute_(t,r,i,"writingMode");"tb"==u||"tblr"==u?e.writingMode=l.writingMode.VERTICAL_LEFT_TO_RIGHT:"tbrl"==u?e.writingMode=l.writingMode.VERTICAL_RIGHT_TO_LEFT:"rltb"==u||"rl"==u?e.direction=l.direction.HORIZONTAL_RIGHT_TO_LEFT:u&&(e.direction=l.direction.HORIZONTAL_LEFT_TO_RIGHT),(u=s.getStyleAttribute_(t,r,i,"textAlign"))?(e.positionAlign=s.textAlignToPositionAlign_[u],e.lineAlign=s.textAlignToLineAlign_[u],o.asserts.assert(u.toUpperCase()in l.textAlign,u.toUpperCase()+" Should be in Cue.textAlign values!"),e.textAlign=l.textAlign[u.toUpperCase()]):e.textAlign=l.textAlign.START,(u=s.getStyleAttribute_(t,r,i,"displayAlign"))&&(o.asserts.assert(u.toUpperCase()in l.displayAlign,u.toUpperCase()+" Should be in Cue.displayAlign values!"),e.displayAlign=l.displayAlign[u.toUpperCase()]),(u=s.getStyleAttribute_(t,r,i,"color"))&&(e.color=u),(u=s.getStyleAttribute_(t,r,i,"backgroundColor"))&&(e.backgroundColor=u),(u=s.getStyleAttribute_(t,r,i,"fontFamily"))&&(e.fontFamily=u),(u=s.getStyleAttribute_(t,r,i,"fontWeight"))&&"bold"==u&&(e.fontWeight=l.fontWeight.BOLD),(u=s.getStyleAttribute_(t,r,i,"wrapOption"))&&"noWrap"==u&&(e.wrapLine=!1),(u=s.getStyleAttribute_(t,r,i,"lineHeight"))&&u.match(s.unitValues_)&&(e.lineHeight=u),(u=s.getStyleAttribute_(t,r,i,"fontSize"))&&u.match(s.unitValues_)&&(e.fontSize=u),(u=s.getStyleAttribute_(t,r,i,"fontStyle"))&&(o.asserts.assert(u.toUpperCase()in l.fontStyle,u.toUpperCase()+" Should be in Cue.fontStyle values!"),e.fontStyle=l.fontStyle[u.toUpperCase()]),n&&(l=n.getAttribute("imagetype"),u=n.getAttribute("encoding"),n=n.textContent.trim(),"PNG"==l&&"Base64"==u&&n&&(e.backgroundImage="data:image/png;base64,"+n)),(r=s.getStyleAttributeFromRegion_(r,i,"textDecoration"))&&s.addTextDecoration_(e,r),(t=s.getStyleAttributeFromElement_(t,i,"textDecoration"))&&s.addTextDecoration_(e,t)},a.text.TtmlTextParser.addTextDecoration_=function(e,t){for(var r=a.text.Cue,n=t.split(" "),i=0;i<n.length;i++)switch(n[i]){case"underline":e.textDecoration.includes(r.textDecoration.UNDERLINE)||e.textDecoration.push(r.textDecoration.UNDERLINE);break;case"noUnderline":e.textDecoration.includes(r.textDecoration.UNDERLINE)&&a.util.ArrayUtils.remove(e.textDecoration,r.textDecoration.UNDERLINE);break;case"lineThrough":e.textDecoration.includes(r.textDecoration.LINE_THROUGH)||e.textDecoration.push(r.textDecoration.LINE_THROUGH);break;case"noLineThrough":e.textDecoration.includes(r.textDecoration.LINE_THROUGH)&&a.util.ArrayUtils.remove(e.textDecoration,r.textDecoration.LINE_THROUGH);break;case"overline":e.textDecoration.includes(r.textDecoration.OVERLINE)||e.textDecoration.push(r.textDecoration.OVERLINE);break;case"noOverline":e.textDecoration.includes(r.textDecoration.OVERLINE)&&a.util.ArrayUtils.remove(e.textDecoration,r.textDecoration.OVERLINE)}},a.text.TtmlTextParser.getStyleAttribute_=function(e,t,r,n){var i=a.text.TtmlTextParser;return(e=i.getStyleAttributeFromElement_(e,r,n))?e:i.getStyleAttributeFromRegion_(t,r,n)},a.text.TtmlTextParser.getStyleAttributeFromRegion_=function(e,t,r){for(var n=a.util.XmlUtils,i=a.text.TtmlTextParser.styleNs_,o=a.text.TtmlTextParser.getLeafNodes_(e),s=0;s<o.length;s++){var l=n.getAttributeNS(o[s],i,r);if(l)return l}return(e=a.text.TtmlTextParser.getElementsFromCollection_(e,"style",t,"")[0])?n.getAttributeNS(e,i,r):null},a.text.TtmlTextParser.getStyleAttributeFromElement_=function(e,t,r){var n=a.util.XmlUtils,i=a.text.TtmlTextParser.styleNs_,o=n.getAttributeNS(e,i,r);if(o)return o;for(e=a.text.TtmlTextParser.getElementsFromCollection_(e,"style",t,""),t=null,o=0;o<e.length;o++){var s=n.getAttributeNS(e[o],i,r);s&&(t=s)}return t},a.text.TtmlTextParser.getElementsFromCollection_=function(e,t,r,n){var o=[];if(!e||1>r.length)return o;if(e=a.text.TtmlTextParser.getInheritedAttribute_(e,t))for(e=e.split(" "),t=(e=i.makeIterator(e)).next();!t.done;t=e.next()){t=t.value;for(var s=i.makeIterator(r),l=s.next();!l.done;l=s.next())if(n+(l=l.value).getAttribute("xml:id")==t){o.push(l);break}}return o},a.text.TtmlTextParser.getInheritedAttribute_=function(e,t){for(var r=null;e&&!(r=e.getAttribute(t));){var n=e.parentNode;if(!(n instanceof Element))break;e=n}return r},a.text.TtmlTextParser.parseTime_=function(e,t){var r=null,n=a.text.TtmlTextParser;return n.timeColonFormatFrames_.test(e)?r=n.parseColonTimeWithFrames_(t,e):n.timeColonFormat_.test(e)?r=n.parseTimeFromRegex_(n.timeColonFormat_,e):n.timeColonFormatMilliseconds_.test(e)?r=n.parseTimeFromRegex_(n.timeColonFormatMilliseconds_,e):n.timeFramesFormat_.test(e)?r=n.parseFramesTime_(t,e):n.timeTickFormat_.test(e)?r=n.parseTickTime_(t,e):n.timeHMSFormat_.test(e)&&(r=n.parseTimeFromRegex_(n.timeHMSFormat_,e)),r},a.text.TtmlTextParser.parseFramesTime_=function(e,t){var r=a.text.TtmlTextParser.timeFramesFormat_.exec(t);return Number(r[1])/e.frameRate},a.text.TtmlTextParser.parseTickTime_=function(e,t){var r=a.text.TtmlTextParser.timeTickFormat_.exec(t);return Number(r[1])/e.tickRate},a.text.TtmlTextParser.parseColonTimeWithFrames_=function(e,t){var r=a.text.TtmlTextParser.timeColonFormatFrames_.exec(t),n=Number(r[1]),i=Number(r[2]),o=Number(r[3]),s=Number(r[4]);return(o+=(s+=(Number(r[5])||0)/e.subFrameRate)/e.frameRate)+60*i+3600*n},a.text.TtmlTextParser.parseTimeFromRegex_=function(e,t){var r=e.exec(t);return null==r||""==r[0]?null:(Number(r[4])||0)/1e3+(Number(r[3])||0)+60*(Number(r[2])||0)+3600*(Number(r[1])||0)},a.text.TtmlTextParser.RateInfo_=function(e,t,r,n){this.frameRate=Number(e)||30,this.subFrameRate=Number(t)||1,this.tickRate=Number(n),0==this.tickRate&&(this.tickRate=e?this.frameRate*this.subFrameRate:1),r&&(e=/^(\d+) (\d+)$/g.exec(r))&&(this.frameRate*=Number(e[1])/Number(e[2]))},a.text.TextEngine.registerParser("application/ttml+xml",a.text.TtmlTextParser),a.text.Mp4TtmlParser=function(){this.parser_=new a.text.TtmlTextParser},o.exportSymbol("shaka.text.Mp4TtmlParser",a.text.Mp4TtmlParser),a.text.Mp4TtmlParser.prototype.parseInit=function(e){var t=a.util.Mp4Parser,r=!1;if((new t).box("moov",t.children).box("trak",t.children).box("mdia",t.children).box("minf",t.children).box("stbl",t.children).fullBox("stsd",t.sampleDescription).box("stpp",(function(e){r=!0,e.parser.stop()})).parse(e),!r)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.INVALID_MP4_TTML)},o.exportProperty(a.text.Mp4TtmlParser.prototype,"parseInit",a.text.Mp4TtmlParser.prototype.parseInit),a.text.Mp4TtmlParser.prototype.parseMedia=function(e,t){var r=a.util.Mp4Parser,n=!1,i=[];if((new r).box("mdat",r.allData(function(e){n=!0,i=i.concat(this.parser_.parseMedia(e,t))}.bind(this))).parse(e),!n)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.INVALID_MP4_TTML);return i},o.exportProperty(a.text.Mp4TtmlParser.prototype,"parseMedia",a.text.Mp4TtmlParser.prototype.parseMedia),a.text.TextEngine.registerParser('application/mp4; codecs="stpp"',a.text.Mp4TtmlParser),a.text.TextEngine.registerParser('application/mp4; codecs="stpp.ttml.im1t"',a.text.Mp4TtmlParser),a.text.TextEngine.registerParser('application/mp4; codecs="stpp.TTML.im1t"',a.text.Mp4TtmlParser),a.text.VttTextParser=function(){},o.exportSymbol("shaka.text.VttTextParser",a.text.VttTextParser),a.text.VttTextParser.prototype.parseInit=function(e){o.asserts.assert(!1,"VTT does not have init segments")},o.exportProperty(a.text.VttTextParser.prototype,"parseInit",a.text.VttTextParser.prototype.parseInit),a.text.VttTextParser.prototype.parseMedia=function(e,t){var r=a.text.VttTextParser,n=a.util.StringUtils.fromUTF8(e);if(n=(n=n.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n")).split(/\n{2,}/m),!/^WEBVTT($|[ \t\n])/m.test(n[0]))throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.INVALID_TEXT_HEADER);var i=t.segmentStart;if(null==i&&(i=0,n[0].includes("X-TIMESTAMP-MAP"))){var o=n[0].match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),s=n[0].match(/MPEGTS:(\d+)/m);if(o&&s){if(i=new a.util.TextParser(o[1]),null==(i=a.text.VttTextParser.parseTime_(i)))throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.INVALID_TEXT_HEADER);i=t.periodStart+(Number(s[1])/a.text.VttTextParser.MPEG_TIMESCALE_-i)}}s=[],o=n[0].split("\n");for(var l=1;l<o.length;l++)if(/^Region:/.test(o[l])){var u=r.parseRegion_(o[l]);s.push(u)}for(l=[],u=1;u<n.length;u++)o=n[u].split("\n"),(o=r.parseCue_(o,i,s))&&l.push(o);return l},o.exportProperty(a.text.VttTextParser.prototype,"parseMedia",a.text.VttTextParser.prototype.parseMedia),a.text.VttTextParser.parseRegion_=function(e){var t=a.text.VttTextParser;e=new a.util.TextParser(e);var r=new a.text.CueRegion;e.readWord(),e.skipWhitespace();for(var n=e.readWord();n;)t.parseRegionSetting_(r,n)||a.log.warning("VTT parser encountered an invalid VTTRegion setting: ",n," The setting will be ignored."),e.skipWhitespace(),n=e.readWord();return r},a.text.VttTextParser.parseCue_=function(e,t,r){var n=a.text.VttTextParser;if(1==e.length&&!e[0]||/^NOTE($|[ \t])/.test(e[0])||"STYLE"==e[0])return null;var i=null;e[0].includes("--\x3e")||(i=e[0],e.splice(0,1));var o=new a.util.TextParser(e[0]),s=n.parseTime_(o),l=o.readRegex(/[ \t]+--\x3e[ \t]+/g),u=n.parseTime_(o);if(null==s||null==l||null==u)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.INVALID_TEXT_CUE);for(s+=t,u+=t,e=e.slice(1).join("\n").trim(),s=new a.text.Cue(s,u,e),o.skipWhitespace(),u=o.readWord();u;)n.parseCueSetting(s,u,r)||a.log.warning("VTT parser encountered an invalid VTT setting: ",u," The setting will be ignored."),o.skipWhitespace(),u=o.readWord();return null!=i&&(s.id=i),s},a.text.VttTextParser.parseCueSetting=function(e,t,r){var n,i=a.text.VttTextParser;if(n=/^align:(start|middle|center|end|left|right)$/.exec(t))i.setTextAlign_(e,n[1]);else if(n=/^vertical:(lr|rl)$/.exec(t))i.setVerticalWritingMode_(e,n[1]);else if(n=/^size:([\d.]+)%$/.exec(t))e.size=Number(n[1]);else if(n=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(t))e.position=Number(n[1]),n[2]&&i.setPositionAlign_(e,n[2]);else{if(!(n=/^region:(.*)$/.exec(t)))return i.parsedLineValueAndInterpretation_(e,t);(t=i.getRegionById_(r,n[1]))&&(e.region=t)}return!0},a.text.VttTextParser.getRegionById_=function(e,t){var r=e.filter((function(e){return e.id==t}));return r.length?(o.asserts.assert(1==r.length,"VTTRegion ids should be unique!"),r[0]):(a.log.warning("VTT parser could not find a region with id: ",t," The region will be ignored."),null)},a.text.VttTextParser.parseRegionSetting_=function(e,t){var r;if(r=/^id=(.*)$/.exec(t))e.id=r[1];else if(r=/^width=(\d{1,2}|100)%$/.exec(t))e.width=Number(r[1]);else if(r=/^lines=(\d+)$/.exec(t))e.height=Number(r[1]),e.heightUnits=a.text.CueRegion.units.LINES;else if(r=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(t))e.regionAnchorX=Number(r[1]),e.regionAnchorY=Number(r[2]);else if(r=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(t))e.viewportAnchorX=Number(r[1]),e.viewportAnchorY=Number(r[2]);else{if(!/^scroll=up$/.exec(t))return!1;e.scroll=a.text.CueRegion.scrollMode.UP}return!0},a.text.VttTextParser.setTextAlign_=function(e,t){var r=a.text.Cue;"middle"==t?e.textAlign=r.textAlign.CENTER:(o.asserts.assert(t.toUpperCase()in r.textAlign,t.toUpperCase()+" Should be in Cue.textAlign values!"),e.textAlign=r.textAlign[t.toUpperCase()])},a.text.VttTextParser.setPositionAlign_=function(e,t){var r=a.text.Cue;e.positionAlign="line-left"==t||"start"==t?r.positionAlign.LEFT:"line-right"==t||"end"==t?r.positionAlign.RIGHT:r.positionAlign.CENTER},a.text.VttTextParser.setVerticalWritingMode_=function(e,t){var r=a.text.Cue;e.writingMode="lr"==t?r.writingMode.VERTICAL_LEFT_TO_RIGHT:r.writingMode.VERTICAL_RIGHT_TO_LEFT},a.text.VttTextParser.parsedLineValueAndInterpretation_=function(e,t){var r,n=a.text.Cue;if(r=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(t))e.lineInterpretation=n.lineInterpretation.PERCENTAGE,e.line=Number(r[1]),r[2]&&(o.asserts.assert(r[2].toUpperCase()in n.lineAlign,r[2].toUpperCase()+" Should be in Cue.lineAlign values!"),e.lineAlign=n.lineAlign[r[2].toUpperCase()]);else{if(!(r=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(t)))return!1;e.lineInterpretation=n.lineInterpretation.LINE_NUMBER,e.line=Number(r[1]),r[2]&&(o.asserts.assert(r[2].toUpperCase()in n.lineAlign,r[2].toUpperCase()+" Should be in Cue.lineAlign values!"),e.lineAlign=n.lineAlign[r[2].toUpperCase()])}return!0},a.text.VttTextParser.parseTime_=function(e){if(null==(e=e.readRegex(/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3})/g)))return null;var t=Number(e[2]),r=Number(e[3]);return 59<t||59<r?null:Number(e[4])/1e3+r+60*t+3600*(Number(e[1])||0)},a.text.VttTextParser.MPEG_TIMESCALE_=9e4,a.text.TextEngine.registerParser("text/vtt",a.text.VttTextParser),a.text.TextEngine.registerParser('text/vtt; codecs="vtt"',a.text.VttTextParser),a.text.Mp4VttParser=function(){this.timescale_=null},o.exportSymbol("shaka.text.Mp4VttParser",a.text.Mp4VttParser),a.text.Mp4VttParser.prototype.parseInit=function(e){var t=a.util.Mp4Parser,r=!1;if((new t).box("moov",t.children).box("trak",t.children).box("mdia",t.children).fullBox("mdhd",function(e){o.asserts.assert(0==e.version||1==e.version,"MDHD version can only be 0 or 1"),0==e.version?(e.reader.skip(4),e.reader.skip(4),this.timescale_=e.reader.readUint32(),e.reader.skip(4)):(e.reader.skip(8),e.reader.skip(8),this.timescale_=e.reader.readUint32(),e.reader.skip(8)),e.reader.skip(4)}.bind(this)).box("minf",t.children).box("stbl",t.children).fullBox("stsd",t.sampleDescription).box("wvtt",(function(e){r=!0})).parse(e),!this.timescale_)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.INVALID_MP4_VTT);if(!r)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.INVALID_MP4_VTT)},o.exportProperty(a.text.Mp4VttParser.prototype,"parseInit",a.text.Mp4VttParser.prototype.parseInit),a.text.Mp4VttParser.prototype.parseMedia=function(e,t){var r=this;if(!this.timescale_)throw a.log.error("No init segment for MP4+VTT!"),new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.INVALID_MP4_VTT);var n,i=a.text.Mp4VttParser,s=a.util.Mp4Parser,l=0,u=[],c=[],d=!1,p=!1,f=!1,h=null;if((new s).box("moof",s.children).box("traf",s.children).fullBox("tfdt",(function(e){d=!0,o.asserts.assert(0==e.version||1==e.version,"TFDT version can only be 0 or 1"),l=0==e.version?e.reader.readUint32():e.reader.readUint64()})).fullBox("tfhd",(function(e){o.asserts.assert(null!=e.flags,"A TFHD box should have a valid flags value"),h=i.parseTFHD_(e.flags,e.reader)})).fullBox("trun",(function(e){p=!0,o.asserts.assert(null!=e.version,"A TRUN box should have a valid version value"),o.asserts.assert(null!=e.flags,"A TRUN box should have a valid flags value"),u=i.parseTRUN_(e.version,e.flags,e.reader)})).box("mdat",s.allData((function(e){o.asserts.assert(!f,"VTT cues in mp4 with multiple MDAT are not currently supported!"),f=!0,n=e}))).parse(e),!f&&!d&&!p)throw new a.util.Error(a.util.Error.Severity.CRITICAL,a.util.Error.Category.TEXT,a.util.Error.Code.INVALID_MP4_VTT);var m=l;s=new DataView(n.buffer,n.byteOffset,n.byteLength);var g=new a.util.DataViewReader(s,a.util.DataViewReader.Endianness.BIG_ENDIAN);return u.forEach((function(e){var n=e.duration||h,i=e.timeOffset?l+e.timeOffset:m;m=i+(n||0);var s=0;do{var u=g.readUint32();s+=u;var d=g.readUint32(),p=null;"vttc"==(d=a.util.Mp4Parser.typeToString(d))?8<u&&(p=g.readBytes(u-8)):("vtte"!=d&&a.log.error("Unknown box "+d+"! Skipping!"),g.skip(u-8)),n?p&&(o.asserts.assert(null!=r.timescale_,"Timescale should not be null!"),c.push(a.text.Mp4VttParser.parseVTTC_(p,t.periodStart+i/r.timescale_,t.periodStart+m/r.timescale_))):a.log.error("WVTT sample duration unknown, and no default found!"),o.asserts.assert(!e.sampleSize||s<=e.sampleSize,"The samples do not fit evenly into the sample sizes given in the TRUN box!")}while(e.sampleSize&&s<e.sampleSize)})),o.asserts.assert(!g.hasMoreData(),"MDAT which contain VTT cues and non-VTT data are not currently supported!"),c.filter(a.util.Functional.isNotNull)},o.exportProperty(a.text.Mp4VttParser.prototype,"parseMedia",a.text.Mp4VttParser.prototype.parseMedia),a.text.Mp4VttParser.parseTFHD_=function(e,t){return t.skip(4),1&e&&t.skip(8),2&e&&t.skip(4),8&e?t.readUint32():null},a.text.Mp4VttParser.parseTRUN_=function(e,t,r){var n=r.readUint32();1&t&&r.skip(4),4&t&&r.skip(4);for(var i=[],o=0;o<n;o++){var a={duration:null,sampleSize:null,timeOffset:null};256&t&&(a.duration=r.readUint32()),512&t&&(a.sampleSize=r.readUint32()),1024&t&&r.skip(4),2048&t&&(a.timeOffset=0==e?r.readUint32():r.readInt32()),i.push(a)}return i},a.text.Mp4VttParser.parseVTTC_=function(e,t,r){var n,i,o;return(new a.util.Mp4Parser).box("payl",a.util.Mp4Parser.allData((function(e){n=a.util.StringUtils.fromUTF8(e)}))).box("iden",a.util.Mp4Parser.allData((function(e){i=a.util.StringUtils.fromUTF8(e)}))).box("sttg",a.util.Mp4Parser.allData((function(e){o=a.util.StringUtils.fromUTF8(e)}))).parse(e),n?a.text.Mp4VttParser.assembleCue_(n,i,o,t,r):null},a.text.Mp4VttParser.assembleCue_=function(e,t,r,n,i){if(e=new a.text.Cue(n,i,e),t&&(e.id=t),r)for(r=(t=new a.util.TextParser(r)).readWord();r;)a.text.VttTextParser.parseCueSetting(e,r,[])||a.log.warning("VTT parser encountered an invalid VTT setting: ",r," The setting will be ignored."),t.skipWhitespace(),r=t.readWord();return e},a.text.TextEngine.registerParser('application/mp4; codecs="wvtt"',a.text.Mp4VttParser),a.util.Dom=function(){},a.util.Dom.createHTMLElement=function(e){return document.createElement(e)},o.exportSymbol("shaka.util.Dom.createHTMLElement",a.util.Dom.createHTMLElement),a.util.Dom.createVideoElement=function(){var e=document.createElement("video");return e.muted=!0,e.width=600,e.height=400,e},o.exportSymbol("shaka.util.Dom.createVideoElement",a.util.Dom.createVideoElement),a.util.Dom.asHTMLElement=function(e){return e},o.exportSymbol("shaka.util.Dom.asHTMLElement",a.util.Dom.asHTMLElement),a.util.Dom.asHTMLMediaElement=function(e){return e},o.exportSymbol("shaka.util.Dom.asHTMLMediaElement",a.util.Dom.asHTMLMediaElement),a.util.Dom.getElementByClassName=function(e,t){var r=t.getElementsByClassName(e);return o.asserts.assert(1==r.length,"Should only be one element with class name "+e),a.util.Dom.asHTMLElement(r[0])},a.util.Dom.removeAllChildren=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},o.exportSymbol("shaka.util.Dom.removeAllChildren",a.util.Dom.removeAllChildren);
/*
 @license
 EME Encryption Scheme Polyfill
 Copyright 2019 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/
var s=function(){};o.exportSymbol("EmeEncryptionSchemePolyfill",s),s.install=function(){s.originalRMKSA_?console.debug("EmeEncryptionSchemePolyfill: Already installed."):navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration?(s.originalRMKSA_=navigator.requestMediaKeySystemAccess,console.debug("EmeEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.requestMediaKeySystemAccess=s.probeRMKSA_):console.debug("EmeEncryptionSchemePolyfill: EME not found")},o.exportProperty(s,"install",s.install),s.probeRMKSA_=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var o;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:return console.assert(r==navigator,'bad "this" for requestMediaKeySystemAccess'),n.yield(s.originalRMKSA_.call(r,e,t),2);case 2:return d(o=n.yieldResult)?(console.debug("EmeEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.requestMediaKeySystemAccess=s.originalRMKSA_,n.return(o)):(console.debug("EmeEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.requestMediaKeySystemAccess=s.polyfillRMKSA_,n.return(s.polyfillRMKSA_.call(r,e,t)))}}))}))},s.polyfillRMKSA_=function(e,t){var r=this;return i.asyncExecutePromiseGeneratorFunction((function n(){var o,a,l,d,p,f,h,m;return i.generator.createGenerator(n,(function(n){switch(n.nextAddress){case 1:console.assert(r==navigator,'bad "this" for requestMediaKeySystemAccess'),o=c(e),a=[];for(var g=i.makeIterator(t),y=g.next();!y.done;y=g.next())l=y.value,d=s.filterCapabilities_(l.videoCapabilities,o),p=s.filterCapabilities_(l.audioCapabilities,o),l.videoCapabilities&&l.videoCapabilities.length&&!d.length||l.audioCapabilities&&l.audioCapabilities.length&&!p.length||((f=Object.assign({},l)).videoCapabilities=d,f.audioCapabilities=p,a.push(f));if(!a.length)throw(h=Error("Unsupported keySystem or supportedConfigurations.")).name="NotSupportedError",h.code=DOMException.NOT_SUPPORTED_ERR,h;return n.yield(s.originalRMKSA_.call(r,e,a),2);case 2:return m=n.yieldResult,n.return(new u(m,o))}}))}))},s.filterCapabilities_=function(e,t){return e?e.filter((function(e){return!e.encryptionScheme||e.encryptionScheme==t})):e};var l=function(){};o.exportSymbol("McEncryptionSchemePolyfill",l),l.install=function(){navigator.mediaCapabilities?(l.originalDecodingInfo_=navigator.mediaCapabilities.decodingInfo,console.debug("McEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=l.probeDecodingInfo_):console.debug("McEncryptionSchemePolyfill: MediaCapabilities not found")},o.exportProperty(l,"install",l.install),l.probeDecodingInfo_=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){var n;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return console.assert(t==navigator.mediaCapabilities,'bad "this" for decodingInfo'),r.yield(l.originalDecodingInfo_.call(t,e),2);case 2:return n=r.yieldResult,e.keySystemConfiguration?d(n.keySystemAccess)?(console.debug("McEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.mediaCapabilities.decodingInfo=l.originalDecodingInfo_,r.return(n)):(console.debug("McEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=l.polyfillDecodingInfo_,r.return(l.polyfillDecodingInfo_.call(t,e))):r.return(n)}}))}))},l.polyfillDecodingInfo_=function(e){var t=this;return i.asyncExecutePromiseGeneratorFunction((function r(){var n,o,a,s,d,p,f;return i.generator.createGenerator(r,(function(r){switch(r.nextAddress){case 1:return console.assert(t==navigator.mediaCapabilities,'bad "this" for decodingInfo'),n=null,e.keySystemConfiguration&&(o=e.keySystemConfiguration,a=o.keySystem,s=o.audio&&o.audio.encryptionScheme,d=o.video&&o.video.encryptionScheme,n=c(a),p={powerEfficient:!1,smooth:!1,supported:!1,keySystemAccess:null,configuration:e},s&&s!=n||d&&d!=n)?r.return(p):r.yield(l.originalDecodingInfo_.call(t,e),2);case 2:return(f=r.yieldResult).keySystemAccess&&(f.keySystemAccess=new u(f.keySystemAccess,n)),r.return(f)}}))}))};var u=function(e,t){this.mksa_=e,this.scheme_=t,this.keySystem=e.keySystem};function c(e){return e.startsWith("com.widevine")||e.startsWith("com.microsoft")||e.startsWith("com.adobe")||e.startsWith("org.w3")?"cenc":e.startsWith("com.apple")?"cbcs-1-9":(console.warn("EmeEncryptionSchemePolyfill: Unknown key system:",e,"Please contribute!"),null)}function d(e){var t=(e=e.getConfiguration()).audioCapabilities&&e.audioCapabilities[0];return!(!(e=e.videoCapabilities&&e.videoCapabilities[0]||t)||void 0===e.encryptionScheme)}u.prototype.getConfiguration=function(){var e=this.mksa_.getConfiguration();if(e.videoCapabilities)for(var t=i.makeIterator(e.videoCapabilities),r=t.next();!r.done;r=t.next())r.value.encryptionScheme=this.scheme_;if(e.audioCapabilities)for(r=(t=i.makeIterator(e.audioCapabilities)).next();!r.done;r=t.next())r.value.encryptionScheme=this.scheme_;return e},u.prototype.createMediaKeys=function(){return this.mksa_.createMediaKeys()};var p=function(){};o.exportSymbol("EncryptionSchemePolyfills",p),p.install=function(){s.install(),l.install()},o.exportProperty(p,"install",p.install),void 0!==r&&r.exports&&(r.exports=p)}.call(n,r,r,void 0),n.shaka)t[i]=n.shaka[i]}()}).call(this,r(9))},function(e,t,r){(function(e){function r(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===r(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===r(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===r(e)},t.isError=function(e){return"[object Error]"===r(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(this,r(25).Buffer)},function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"c",(function(){return u})),r.d(t,"b",(function(){return c}));var n=r(3);function i(){var e=s(["\n  &.fadeIn {\n  transition: opacity ease 0.5s;\n}\n"]);return i=function(){return e},e}function o(){var e=s(["\n  @keyframes fadein {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n  animation: fadein 2s;\n"]);return o=function(){return e},e}function a(){var e=s(["\n  .errorBackground {\n    background-image: url('data:image/svg+xml;base64,PCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIyLjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluICAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiCiAgICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6YT0iaHR0cDovL25zLmFkb2JlLmNvbS9BZG9iZVNWR1ZpZXdlckV4dGVuc2lvbnMvMy4wLyIKICAgICB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjQwOS42cHgiIGhlaWdodD0iMzIzLjNweCIgdmlld0JveD0iMCAwIDQwOS42IDMyMy4zIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0MDkuNiAzMjMuMzsiCiAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+CiAgICAuc3Qwe2ZpbGw6I0E2QTZBNjt9Cjwvc3R5bGU+CjxkZWZzPgo8L2RlZnM+CjxnPgogICAgPHBhdGggY2xhc3M9InN0MCIgZD0iTTQwOS42LDRjMCwxMDUuMSwwLDIxMC4xLDAsMzE1LjJjLTIuNiwzLjQtNi4xLDQtMTAuMiw0Yy0xMjkuNy0wLjEtMjU5LjQtMC4xLTM4OS4xLTAuMQogICAgICAgIGMtOC4zLDAtMTAuMi0xLjgtMTAuMi0xMEMwLDIxMi4yLDAsMTExLjEsMCwxMC4xYzAtOC4yLDEuOS0xMCwxMC4yLTEwYzEyOS43LDAsMjU5LjQsMCwzODkuMS0wLjFDNDAzLjUsMCw0MDcsMC43LDQwOS42LDR6CiAgICAgICAgIE0zNzAuNiwyNzAuMWMwLTEuNywwLTMuMSwwLTQuNGMwLTczLjcsMC0xNDcuNCwwLTIyMS4xYzAtNS40LDAtNS40LTUuNC01LjRjLTEwNi45LDAtMjEzLjgsMC0zMjAuNywwYy01LjQsMC01LjQsMC01LjQsNS41CiAgICAgICAgYzAsNzAuNCwwLDE0MC44LDAsMjExLjFjMCwxLjQtMC41LDIuOSwwLjUsNC4yYzEuNC0wLjYsMi0xLjksMi43LTIuOWMyOC44LTM4LjcsNTcuNy03Ny40LDg2LjUtMTE2YzEuMS0xLjUsMi4yLTMsMy40LTQuNQogICAgICAgIGMxLjUtMS44LDMuMi0xLjksNC44LTAuMmMxLjEsMS4yLDIuMSwyLjQsMy4xLDMuNmMyNC40LDMwLDQ4LjcsNjAsNzMsOTAuMWMyLDIuNSwzLjIsMyw1LjgsMC42YzE4LjUtMTYuNSwzNy4yLTMyLjgsNTUuOC00OS4yCiAgICAgICAgYzQuOC00LjIsNS00LjIsOS4zLDAuM2MyNy40LDI4LjQsNTQuOCw1Ni43LDgyLjMsODUuMUMzNjcuNCwyNjgsMzY4LjIsMjY5LjUsMzcwLjYsMjcwLjF6Ii8+CiAgICA8cGF0aCBjbGFzcz0ic3QwIiBkPSJNMzA0LjMsMTAyLjhjLTAuOSwxOC4zLTE2LjgsMzEuMS0zMy40LDI5LjhjLTE4LjEtMS4zLTMxLjUtMTYuOS0yOS45LTMzLjljMS43LTE4LjQsMTYuOS0zMC4zLDMzLjEtMjkuNQogICAgICAgIEMyOTMuMiw3MC4zLDMwNS40LDg2LjUsMzA0LjMsMTAyLjh6Ii8+CjwvZz4KPC9zdmc+');\n    display: block;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    background-repeat: no-repeat;\n    background-size: 50px 50px;\n    background-position-x: 50%;\n    background-position-y: 50%;\n  }\n\n  img {\n    outline: 0;\n  }\n\n  img:not([src]) {\n    visibility: hidden;\n  }\n\n  a {\n    text-decoration: none;\n    outline: 0;\n  }\n\n  .fadeIn {\n    transition: opacity ease 0.3s;\n  }\n"]);return a=function(){return e},e}function s(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var l=Object(n.a)(a()),u=Object(n.a)(o()),c=Object(n.a)(i())},function(e,t,r){var n=r(62)(Object,"create");e.exports=n},function(e,t,r){var n=r(129);e.exports=function(e,t){for(var r=e.length;r--;)if(n(e[r][0],t))return r;return-1}},function(e,t,r){var n=r(135);e.exports=function(e,t){var r=e.__data__;return n(t)?r["string"==typeof t?"string":"hash"]:r.map}},function(e,t,r){(function(){var t,n={}.hasOwnProperty;t=r(7),e.exports=function(e){function t(e){t.__super__.constructor.call(this,e),this.value=""}return function(e,t){for(var r in t)n.call(t,r)&&(e[r]=t[r]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this.value},set:function(e){return this.value=e||""}}),Object.defineProperty(t.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(t.prototype,"textContent",{get:function(){return this.value},set:function(e){return this.value=e||""}}),t.prototype.clone=function(){return Object.create(this)},t.prototype.substringData=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},t.prototype.appendData=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},t.prototype.insertData=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},t.prototype.deleteData=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},t.prototype.replaceData=function(e,t,r){throw new Error("This DOM method is not implemented."+this.debugInfo())},t.prototype.isEqualNode=function(e){return!!t.__super__.isEqualNode.apply(this,arguments).isEqualNode(e)&&e.data===this.data},t}(t)}).call(this)},function(e,t){(function(){e.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(this)},function(e,t,r){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var n=r(170),i=r(171),o=r(78);function a(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,r){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return u(this,e,t,r)}function u(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=p(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!l.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|h(t,r),i=(e=s(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(l.isBuffer(t)){var r=0|f(t.length);return 0===(e=s(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?s(e,0):p(e,t);if("Buffer"===t.type&&o(t.data))return p(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(c(t),e=s(e,t<0?0:0|f(t)),!l.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function p(e,t){var r=t.length<0?0:0|f(t.length);e=s(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function f(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function h(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return z(e).length;default:if(n)return B(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return C(this,t,r);case"utf8":case"utf-8":return x(this,t,r);case"ascii":return P(this,t,r);case"latin1":case"binary":return I(this,t,r);case"base64":return M(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function y(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:_(e,t,r,n,i);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):_(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function _(e,t,r,n,i){var o,a=1,s=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,s/=2,l/=2,r/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var c=-1;for(o=r;o<s;o++)if(u(e,o)===u(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===l)return c*a}else-1!==c&&(o-=o-c),c=-1}else for(r+l>s&&(r=s-l),o=r;o>=0;o--){for(var d=!0,p=0;p<l;p++)if(u(e,o+p)!==u(t,p)){d=!1;break}if(d)return o}return-1}function v(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[r+a]=s}return a}function E(e,t,r,n){return V(B(t,e.length-r),e,r,n)}function S(e,t,r,n){return V(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function b(e,t,r,n){return S(e,t,r,n)}function T(e,t,r,n){return V(z(t),e,r,n)}function w(e,t,r,n){return V(function(e,t){for(var r,n,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)r=e.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function M(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function x(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,a,s,l,u=e[i],c=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=r)switch(d){case 1:u<128&&(c=u);break;case 2:128==(192&(o=e[i+1]))&&(l=(31&u)<<6|63&o)>127&&(c=l);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(l=(15&u)<<12|(63&o)<<6|63&a)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,d=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}t.Buffer=l,t.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,r){return u(null,e,t,r)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,r){return function(e,t,r,n){return c(t),t<=0?s(e,t):void 0!==r?"string"==typeof n?s(e,t).fill(r,n):s(e,t).fill(r):s(e,t)}(null,e,t,r)},l.allocUnsafe=function(e){return d(null,e)},l.allocUnsafeSlow=function(e){return d(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=l.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var a=e[r];if(!l.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,i),i+=a.length}return n},l.byteLength=h,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?x(this,0,e):m.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,r,n,i){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0),s=Math.min(o,a),u=this.slice(n,i),c=e.slice(t,r),d=0;d<s;++d)if(u[d]!==c[d]){o=u[d],a=c[d];break}return o<a?-1:a<o?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return y(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return y(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return v(this,e,t,r);case"utf8":case"utf-8":return E(this,e,t,r);case"ascii":return S(this,e,t,r);case"latin1":case"binary":return b(this,e,t,r);case"base64":return T(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function P(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function I(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function C(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=F(e[o]);return i}function A(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function N(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function D(e,t,r,n,i,o){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function k(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function L(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function R(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function O(e,t,r,n,o){return o||R(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function U(e,t,r,n,o){return o||R(e,0,r,8),i.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=l.prototype;else{var i=t-e;r=new l(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},l.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||N(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},l.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||N(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},l.prototype.readUInt8=function(e,t){return t||N(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||N(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||N(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||N(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||N(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||N(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||N(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},l.prototype.readInt8=function(e,t){return t||N(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||N(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){t||N(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return t||N(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||N(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||N(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||N(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||N(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||N(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||D(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},l.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||D(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},l.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):L(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);D(this,e,t,r,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<r&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);D(this,e,t,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):k(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):k(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):L(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||D(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,r){return O(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return O(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return U(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return U(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3||!l.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},l.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var a=l.isBuffer(e)?e:B(new l(e,n).toString()),s=a.length;for(o=0;o<r-t;++o)this[o+t]=a[o%s]}return this};var j=/[^+\/0-9A-Za-z-_]/g;function F(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function z(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(j,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r(9))},function(e,t,r){"use strict";var n,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(r,n){function i(){void 0!==o&&e.removeListener("error",o),r([].slice.call(arguments))}var o;"error"!==t&&(o=function(r){e.removeListener(t,i),n(r)},e.once("error",o)),e.once(t,i)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var l=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,r,n){var i,o,a,s;if(u(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),a=o[t]),void 0===a)a=o[t]=r,++e._eventsCount;else if("function"==typeof a?a=o[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(i=c(e))>0&&a.length>i&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,s=l,console&&console.warn&&console.warn(s)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=p.bind(n);return i.listener=r,n.wrapFn=i,i}function h(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):g(i,i.length)}function m(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var l=i[e];if(void 0===l)return!1;if("function"==typeof l)o(l,this,t);else{var u=l.length,c=g(l,u);for(r=0;r<u;++r)o(c[r],this,t)}return!0},s.prototype.addListener=function(e,t){return d(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return d(this,e,t,!0)},s.prototype.once=function(e,t){return u(t),this.on(e,f(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,f(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,i,o,a;if(u(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){a=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},s.prototype.listenerCount=m,s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,r){"use strict";(function(t){void 0===t||!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,r,n,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,a,s=arguments.length;switch(s){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,r)}));case 3:return t.nextTick((function(){e.call(null,r,n)}));case 4:return t.nextTick((function(){e.call(null,r,n,i)}));default:for(o=new Array(s-1),a=0;a<o.length;)o[a++]=arguments[a];return t.nextTick((function(){e.apply(null,o)}))}}}:e.exports=t}).call(this,r(13))},function(e,t,r){"use strict";e.exports=function(e){var t="string"==typeof e?e.charCodeAt(0):e;return t>=48&&t<=57}},function(e,t,r){"use strict";e.exports=s;var n=r(216),i=n.CONTINUE,o=n.SKIP,a=n.EXIT;function s(e,t,r,i){"function"==typeof t&&"function"!=typeof r&&(i=r,r=t,t=null),n(e,t,(function(e,t){var n=t[t.length-1],i=n?n.children.indexOf(e):null;return r(e,i,n)}),i)}s.CONTINUE=i,s.SKIP=o,s.EXIT=a},function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"flush",(function(){return a})),r.d(t,"hydrate",(function(){return s})),r.d(t,"cx",(function(){return l})),r.d(t,"merge",(function(){return u})),r.d(t,"getRegisteredStyles",(function(){return c})),r.d(t,"injectGlobal",(function(){return d})),r.d(t,"keyframes",(function(){return p})),r.d(t,"css",(function(){return f})),r.d(t,"sheet",(function(){return h})),r.d(t,"caches",(function(){return m}));var n=r(97),i=void 0!==e?e:{},o=Object(n.a)(i),a=o.flush,s=o.hydrate,l=o.cx,u=o.merge,c=o.getRegisteredStyles,d=o.injectGlobal,p=o.keyframes,f=o.css,h=o.sheet,m=o.caches}.call(this,r(9))},function(e,t,r){"use strict";t.a=function(e){var t={};return function(r){return void 0===t[r]&&(t[r]=e(r)),t[r]}}},function(e,t,r){e.exports=r(143)},function(e,t){var r=Array.isArray;e.exports=r},function(e,t,r){var n=r(61),i=r(108);e.exports=function(e){return"symbol"==typeof e||i(e)&&"[object Symbol]"==n(e)}},function(e,t,r){var n=r(36).Symbol;e.exports=n},function(e,t,r){var n=r(105),i="object"==typeof self&&self&&self.Object===Object&&self,o=n||i||Function("return this")();e.exports=o},function(e,t){(function(){t.defaults={.1:{explicitCharkey:!1,trim:!0,normalize:!0,normalizeTags:!1,attrkey:"@",charkey:"#",explicitArray:!1,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!1,validator:null,xmlns:!1,explicitChildren:!1,childkey:"@@",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,emptyTag:""},.2:{explicitCharkey:!1,trim:!1,normalize:!1,normalizeTags:!1,attrkey:"$",charkey:"_",explicitArray:!0,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!0,validator:null,xmlns:!1,explicitChildren:!1,preserveChildrenOrder:!1,childkey:"$$",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,rootName:"root",xmldec:{version:"1.0",encoding:"UTF-8",standalone:!0},doctype:null,renderOpts:{pretty:!0,indent:"  ",newline:"\n"},headless:!1,chunkSize:1e4,emptyTag:"",cdata:!1}}}).call(this)},function(e,t,r){(function(){var t,n,i,o,a,s,l,u,c={}.hasOwnProperty;u=r(11),l=u.isObject,s=u.isFunction,a=u.getValue,o=r(7),t=r(4),n=r(74),i=r(39),e.exports=function(e){function r(e,n,i){var o,a,s,l;if(r.__super__.constructor.call(this,e),null==n)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(n),this.type=t.Element,this.attribs={},this.schemaTypeInfo=null,null!=i&&this.attribute(i),e.type===t.Document&&(this.isRoot=!0,this.documentObject=e,e.rootObject=this,e.children))for(a=0,s=(l=e.children).length;a<s;a++)if((o=l[a]).type===t.DocType){o.name=this.name;break}}return function(e,t){for(var r in t)c.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),Object.defineProperty(r.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(r.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(r.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(r.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(r.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(r.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(r.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(r.prototype,"attributes",{get:function(){return this.attributeMap&&this.attributeMap.nodes||(this.attributeMap=new i(this.attribs)),this.attributeMap}}),r.prototype.clone=function(){var e,t,r,n;for(t in(r=Object.create(this)).isRoot&&(r.documentObject=null),r.attribs={},n=this.attribs)c.call(n,t)&&(e=n[t],r.attribs[t]=e.clone());return r.children=[],this.children.forEach((function(e){var t;return(t=e.clone()).parent=r,r.children.push(t)})),r},r.prototype.attribute=function(e,t){var r,i;if(null!=e&&(e=a(e)),l(e))for(r in e)c.call(e,r)&&(i=e[r],this.attribute(r,i));else s(t)&&(t=t.apply()),this.options.keepNullAttributes&&null==t?this.attribs[e]=new n(this,e,""):null!=t&&(this.attribs[e]=new n(this,e,t));return this},r.prototype.removeAttribute=function(e){var t,r,n;if(null==e)throw new Error("Missing attribute name. "+this.debugInfo());if(e=a(e),Array.isArray(e))for(r=0,n=e.length;r<n;r++)t=e[r],delete this.attribs[t];else delete this.attribs[e];return this},r.prototype.toString=function(e){return this.options.writer.element(this,this.options.writer.filterOptions(e))},r.prototype.att=function(e,t){return this.attribute(e,t)},r.prototype.a=function(e,t){return this.attribute(e,t)},r.prototype.getAttribute=function(e){return this.attribs.hasOwnProperty(e)?this.attribs[e].value:null},r.prototype.setAttribute=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.getAttributeNode=function(e){return this.attribs.hasOwnProperty(e)?this.attribs[e]:null},r.prototype.setAttributeNode=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.removeAttributeNode=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.getElementsByTagName=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.getAttributeNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.setAttributeNS=function(e,t,r){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.removeAttributeNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.getAttributeNodeNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.setAttributeNodeNS=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.getElementsByTagNameNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.hasAttribute=function(e){return this.attribs.hasOwnProperty(e)},r.prototype.hasAttributeNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.setIdAttribute=function(e,t){return this.attribs.hasOwnProperty(e)?this.attribs[e].isId:t},r.prototype.setIdAttributeNS=function(e,t,r){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.setIdAttributeNode=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.getElementsByTagName=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.getElementsByTagNameNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.getElementsByClassName=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.isEqualNode=function(e){var t,n,i;if(!r.__super__.isEqualNode.apply(this,arguments).isEqualNode(e))return!1;if(e.namespaceURI!==this.namespaceURI)return!1;if(e.prefix!==this.prefix)return!1;if(e.localName!==this.localName)return!1;if(e.attribs.length!==this.attribs.length)return!1;for(t=n=0,i=this.attribs.length-1;0<=i?n<=i:n>=i;t=0<=i?++n:--n)if(!this.attribs[t].isEqualNode(e.attribs[t]))return!1;return!0},r}(o)}).call(this)},function(e,t){(function(){e.exports=function(){function e(e){this.nodes=e}return Object.defineProperty(e.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),e.prototype.clone=function(){return this.nodes=null},e.prototype.getNamedItem=function(e){return this.nodes[e]},e.prototype.setNamedItem=function(e){var t;return t=this.nodes[e.nodeName],this.nodes[e.nodeName]=e,t||null},e.prototype.removeNamedItem=function(e){var t;return t=this.nodes[e],delete this.nodes[e],t||null},e.prototype.item=function(e){return this.nodes[Object.keys(this.nodes)[e]]||null},e.prototype.getNamedItemNS=function(e,t){throw new Error("This DOM method is not implemented.")},e.prototype.setNamedItemNS=function(e){throw new Error("This DOM method is not implemented.")},e.prototype.removeNamedItemNS=function(e,t){throw new Error("This DOM method is not implemented.")},e}()}).call(this)},function(e,t,r){(function(){var t,n,i={}.hasOwnProperty;t=r(4),n=r(23),e.exports=function(e){function r(e,n){if(r.__super__.constructor.call(this,e),null==n)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=t.CData,this.value=this.stringify.cdata(n)}return function(e,t){for(var r in t)i.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.clone=function(){return Object.create(this)},r.prototype.toString=function(e){return this.options.writer.cdata(this,this.options.writer.filterOptions(e))},r}(n)}).call(this)},function(e,t,r){(function(){var t,n,i={}.hasOwnProperty;t=r(4),n=r(23),e.exports=function(e){function r(e,n){if(r.__super__.constructor.call(this,e),null==n)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=t.Comment,this.value=this.stringify.comment(n)}return function(e,t){for(var r in t)i.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.clone=function(){return Object.create(this)},r.prototype.toString=function(e){return this.options.writer.comment(this,this.options.writer.filterOptions(e))},r}(n)}).call(this)},function(e,t,r){(function(){var t,n,i,o={}.hasOwnProperty;i=r(11).isObject,n=r(7),t=r(4),e.exports=function(e){function r(e,n,o,a){var s;r.__super__.constructor.call(this,e),i(n)&&(n=(s=n).version,o=s.encoding,a=s.standalone),n||(n="1.0"),this.type=t.Declaration,this.version=this.stringify.xmlVersion(n),null!=o&&(this.encoding=this.stringify.xmlEncoding(o)),null!=a&&(this.standalone=this.stringify.xmlStandalone(a))}return function(e,t){for(var r in t)o.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.toString=function(e){return this.options.writer.declaration(this,this.options.writer.filterOptions(e))},r}(n)}).call(this)},function(e,t,r){(function(){var t,n,i,o,a,s,l,u,c={}.hasOwnProperty;u=r(11).isObject,l=r(7),t=r(4),n=r(44),o=r(45),i=r(46),a=r(47),s=r(39),e.exports=function(e){function r(e,n,i){var o,a,s,l,c,d;if(r.__super__.constructor.call(this,e),this.type=t.DocType,e.children)for(a=0,s=(l=e.children).length;a<s;a++)if((o=l[a]).type===t.Element){this.name=o.name;break}this.documentObject=e,u(n)&&(n=(c=n).pubID,i=c.sysID),null==i&&(i=(d=[n,i])[0],n=d[1]),null!=n&&(this.pubID=this.stringify.dtdPubID(n)),null!=i&&(this.sysID=this.stringify.dtdSysID(i))}return function(e,t){for(var r in t)c.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),Object.defineProperty(r.prototype,"entities",{get:function(){var e,r,n,i,o;for(i={},r=0,n=(o=this.children).length;r<n;r++)(e=o[r]).type!==t.EntityDeclaration||e.pe||(i[e.name]=e);return new s(i)}}),Object.defineProperty(r.prototype,"notations",{get:function(){var e,r,n,i,o;for(i={},r=0,n=(o=this.children).length;r<n;r++)(e=o[r]).type===t.NotationDeclaration&&(i[e.name]=e);return new s(i)}}),Object.defineProperty(r.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(r.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(r.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),r.prototype.element=function(e,t){var r;return r=new i(this,e,t),this.children.push(r),this},r.prototype.attList=function(e,t,r,i,o){var a;return a=new n(this,e,t,r,i,o),this.children.push(a),this},r.prototype.entity=function(e,t){var r;return r=new o(this,!1,e,t),this.children.push(r),this},r.prototype.pEntity=function(e,t){var r;return r=new o(this,!0,e,t),this.children.push(r),this},r.prototype.notation=function(e,t){var r;return r=new a(this,e,t),this.children.push(r),this},r.prototype.toString=function(e){return this.options.writer.docType(this,this.options.writer.filterOptions(e))},r.prototype.ele=function(e,t){return this.element(e,t)},r.prototype.att=function(e,t,r,n,i){return this.attList(e,t,r,n,i)},r.prototype.ent=function(e,t){return this.entity(e,t)},r.prototype.pent=function(e,t){return this.pEntity(e,t)},r.prototype.not=function(e,t){return this.notation(e,t)},r.prototype.up=function(){return this.root()||this.documentObject},r.prototype.isEqualNode=function(e){return!!r.__super__.isEqualNode.apply(this,arguments).isEqualNode(e)&&(e.name===this.name&&(e.publicId===this.publicId&&e.systemId===this.systemId))},r}(l)}).call(this)},function(e,t,r){(function(){var t,n,i={}.hasOwnProperty;n=r(7),t=r(4),e.exports=function(e){function r(e,n,i,o,a,s){if(r.__super__.constructor.call(this,e),null==n)throw new Error("Missing DTD element name. "+this.debugInfo());if(null==i)throw new Error("Missing DTD attribute name. "+this.debugInfo(n));if(!o)throw new Error("Missing DTD attribute type. "+this.debugInfo(n));if(!a)throw new Error("Missing DTD attribute default. "+this.debugInfo(n));if(0!==a.indexOf("#")&&(a="#"+a),!a.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(n));if(s&&!a.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(n));this.elementName=this.stringify.name(n),this.type=t.AttributeDeclaration,this.attributeName=this.stringify.name(i),this.attributeType=this.stringify.dtdAttType(o),s&&(this.defaultValue=this.stringify.dtdAttDefault(s)),this.defaultValueType=a}return function(e,t){for(var r in t)i.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.toString=function(e){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(e))},r}(n)}).call(this)},function(e,t,r){(function(){var t,n,i,o={}.hasOwnProperty;i=r(11).isObject,n=r(7),t=r(4),e.exports=function(e){function r(e,n,o,a){if(r.__super__.constructor.call(this,e),null==o)throw new Error("Missing DTD entity name. "+this.debugInfo(o));if(null==a)throw new Error("Missing DTD entity value. "+this.debugInfo(o));if(this.pe=!!n,this.name=this.stringify.name(o),this.type=t.EntityDeclaration,i(a)){if(!a.pubID&&!a.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(o));if(a.pubID&&!a.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(o));if(this.internal=!1,null!=a.pubID&&(this.pubID=this.stringify.dtdPubID(a.pubID)),null!=a.sysID&&(this.sysID=this.stringify.dtdSysID(a.sysID)),null!=a.nData&&(this.nData=this.stringify.dtdNData(a.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(o))}else this.value=this.stringify.dtdEntityValue(a),this.internal=!0}return function(e,t){for(var r in t)o.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),Object.defineProperty(r.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(r.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(r.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(r.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(r.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(r.prototype,"xmlVersion",{get:function(){return null}}),r.prototype.toString=function(e){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions(e))},r}(n)}).call(this)},function(e,t,r){(function(){var t,n,i={}.hasOwnProperty;n=r(7),t=r(4),e.exports=function(e){function r(e,n,i){if(r.__super__.constructor.call(this,e),null==n)throw new Error("Missing DTD element name. "+this.debugInfo());i||(i="(#PCDATA)"),Array.isArray(i)&&(i="("+i.join(",")+")"),this.name=this.stringify.name(n),this.type=t.ElementDeclaration,this.value=this.stringify.dtdElementValue(i)}return function(e,t){for(var r in t)i.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.toString=function(e){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(e))},r}(n)}).call(this)},function(e,t,r){(function(){var t,n,i={}.hasOwnProperty;n=r(7),t=r(4),e.exports=function(e){function r(e,n,i){if(r.__super__.constructor.call(this,e),null==n)throw new Error("Missing DTD notation name. "+this.debugInfo(n));if(!i.pubID&&!i.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo(n));this.name=this.stringify.name(n),this.type=t.NotationDeclaration,null!=i.pubID&&(this.pubID=this.stringify.dtdPubID(i.pubID)),null!=i.sysID&&(this.sysID=this.stringify.dtdSysID(i.sysID))}return function(e,t){for(var r in t)i.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),Object.defineProperty(r.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(r.prototype,"systemId",{get:function(){return this.sysID}}),r.prototype.toString=function(e){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(e))},r}(n)}).call(this)},function(e,t,r){(function(){var t,n,i={}.hasOwnProperty;t=r(4),n=r(7),e.exports=function(e){function r(e,n){if(r.__super__.constructor.call(this,e),null==n)throw new Error("Missing raw text. "+this.debugInfo());this.type=t.Raw,this.value=this.stringify.raw(n)}return function(e,t){for(var r in t)i.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.clone=function(){return Object.create(this)},r.prototype.toString=function(e){return this.options.writer.raw(this,this.options.writer.filterOptions(e))},r}(n)}).call(this)},function(e,t,r){(function(){var t,n,i={}.hasOwnProperty;t=r(4),n=r(23),e.exports=function(e){function r(e,n){if(r.__super__.constructor.call(this,e),null==n)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=t.Text,this.value=this.stringify.text(n)}return function(e,t){for(var r in t)i.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),Object.defineProperty(r.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(r.prototype,"wholeText",{get:function(){var e,t,r;for(r="",t=this.previousSibling;t;)r=t.data+r,t=t.previousSibling;for(r+=this.data,e=this.nextSibling;e;)r+=e.data,e=e.nextSibling;return r}}),r.prototype.clone=function(){return Object.create(this)},r.prototype.toString=function(e){return this.options.writer.text(this,this.options.writer.filterOptions(e))},r.prototype.splitText=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.replaceWholeText=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r}(n)}).call(this)},function(e,t,r){(function(){var t,n,i={}.hasOwnProperty;t=r(4),n=r(23),e.exports=function(e){function r(e,n,i){if(r.__super__.constructor.call(this,e),null==n)throw new Error("Missing instruction target. "+this.debugInfo());this.type=t.ProcessingInstruction,this.target=this.stringify.insTarget(n),this.name=this.target,i&&(this.value=this.stringify.insValue(i))}return function(e,t){for(var r in t)i.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.clone=function(){return Object.create(this)},r.prototype.toString=function(e){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(e))},r.prototype.isEqualNode=function(e){return!!r.__super__.isEqualNode.apply(this,arguments).isEqualNode(e)&&e.target===this.target},r}(n)}).call(this)},function(e,t,r){(function(){var t,n={}.hasOwnProperty;t=r(77),e.exports=function(e){function t(e){t.__super__.constructor.call(this,e)}return function(e,t){for(var r in t)n.call(t,r)&&(e[r]=t[r]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype}(t,e),t.prototype.document=function(e,t){var r,n,i,o,a;for(t=this.filterOptions(t),o="",n=0,i=(a=e.children).length;n<i;n++)r=a[n],o+=this.writeChildNode(r,t,0);return t.pretty&&o.slice(-t.newline.length)===t.newline&&(o=o.slice(0,-t.newline.length)),o},t}(t)}).call(this)},function(e,t,r){(t=e.exports=r(79)).Stream=t,t.Readable=t,t.Writable=r(54),t.Duplex=r(15),t.Transform=r(83),t.PassThrough=r(179)},function(e,t,r){var n=r(25),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function a(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(o(n,t),t.Buffer=a),o(i,a),a.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},a.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t,r){"use strict";(function(t,n,i){var o=r(27);function a(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=_;var s,l=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?n:o.nextTick;_.WritableState=y;var u=Object.create(r(18));u.inherits=r(14);var c={deprecate:r(177)},d=r(80),p=r(53).Buffer,f=i.Uint8Array||function(){};var h,m=r(81);function g(){}function y(e,t){s=s||r(15),e=e||{};var n=t instanceof s;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,u=e.writableHighWaterMark,c=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(u||0===u)?u:c,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var d=!1===e.decodeStrings;this.decodeStrings=!d,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,i){--t.pendingcb,r?(o.nextTick(i,n),o.nextTick(w,e,t),e._writableState.errorEmitted=!0,e.emit("error",n)):(i(n),e._writableState.errorEmitted=!0,e.emit("error",n),w(e,t))}(e,r,n,t,i);else{var a=b(r);a||r.corked||r.bufferProcessing||!r.bufferedRequest||S(e,r),n?l(E,e,r,a,i):E(e,r,a,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function _(e){if(s=s||r(15),!(h.call(_,this)||this instanceof s))return new _(e);this._writableState=new y(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),d.call(this)}function v(e,t,r,n,i,o,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function E(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),w(e,t)}function S(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),o=t.corkedRequestsFree;o.entry=r;for(var s=0,l=!0;r;)i[s]=r,r.isBuf||(l=!1),r=r.next,s+=1;i.allBuffers=l,v(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new a(t),t.bufferedRequestCount=0}else{for(;r;){var u=r.chunk,c=r.encoding,d=r.callback;if(v(e,t,!1,t.objectMode?1:u.length,u,c,d),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function b(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function T(e,t){e._final((function(r){t.pendingcb--,r&&e.emit("error",r),t.prefinished=!0,e.emit("prefinish"),w(e,t)}))}function w(e,t){var r=b(t);return r&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,o.nextTick(T,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),r}u.inherits(_,d),y.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(y.prototype,"buffer",{get:c.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(h=Function.prototype[Symbol.hasInstance],Object.defineProperty(_,Symbol.hasInstance,{value:function(e){return!!h.call(this,e)||this===_&&(e&&e._writableState instanceof y)}})):h=function(e){return e instanceof this},_.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},_.prototype.write=function(e,t,r){var n,i=this._writableState,a=!1,s=!i.objectMode&&(n=e,p.isBuffer(n)||n instanceof f);return s&&!p.isBuffer(e)&&(e=function(e){return p.from(e)}(e)),"function"==typeof t&&(r=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=g),i.ended?function(e,t){var r=new Error("write after end");e.emit("error",r),o.nextTick(t,r)}(this,r):(s||function(e,t,r,n){var i=!0,a=!1;return null===r?a=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||t.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(e.emit("error",a),o.nextTick(n,a),i=!1),i}(this,i,e,r))&&(i.pendingcb++,a=function(e,t,r,n,i,o){if(!r){var a=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=p.from(t,r));return t}(t,n,i);n!==a&&(r=!0,i="buffer",n=a)}var s=t.objectMode?1:n.length;t.length+=s;var l=t.length<t.highWaterMark;l||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else v(e,t,!1,s,n,i,o);return l}(this,i,s,e,t,r)),a},_.prototype.cork=function(){this._writableState.corked++},_.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||S(this,e))},_.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(_.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),_.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},_.prototype._writev=null,_.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,r){t.ending=!0,w(e,t),r&&(t.finished?o.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,n,r)},Object.defineProperty(_.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),_.prototype.destroy=m.destroy,_.prototype._undestroy=m.undestroy,_.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,r(13),r(82).setImmediate,r(9))},function(e,t,r){"use strict";var n=r(178).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=u,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=c,this.end=d,t=3;break;default:return this.write=p,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function c(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function p(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},o.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=a(t[n]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--n<r||-2===i)return 0;if((i=a(t[n]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--n<r||-2===i)return 0;if((i=a(t[n]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,r){"use strict";var n=r(205),i=r(206),o=r(28),a=r(207),s=r(208),l=r(209);e.exports=function(e,t){var r,o,a={};t||(t={});for(o in p)r=t[o],a[o]=null==r?p[o]:r;(a.position.indent||a.position.start)&&(a.indent=a.position.indent||[],a.position=a.position.start);return function(e,t){var r,o,a,p,v,E,S,b,T,w,M,x,P,I,C,A,N,D,k,L=t.additional,R=t.nonTerminated,O=t.text,U=t.reference,j=t.warning,F=t.textContext,B=t.referenceContext,z=t.warningContext,V=t.position,G=t.indent||[],H=e.length,K=0,W=-1,Y=V.column||1,X=V.line||1,q="",Z=[];"string"==typeof L&&(L=L.charCodeAt(0));A=J(),b=j?function(e,t){var r=J();r.column+=t,r.offset+=t,j.call(z,y[e],r,e)}:d,K--,H++;for(;++K<H;)if(10===v&&(Y=G[W]||1),38===(v=e.charCodeAt(K))){if(9===(S=e.charCodeAt(K+1))||10===S||12===S||32===S||38===S||60===S||S!=S||L&&S===L){q+=c(v),Y++;continue}for(x=P=K+1,k=P,35===S?(k=++x,88===(S=e.charCodeAt(k))||120===S?(I=h,k=++x):I="decimal"):I=f,r="",M="",p="",C=g[I],k--;++k<H&&(S=e.charCodeAt(k),C(S));)p+=c(S),I===f&&u.call(n,p)&&(r=p,M=n[p]);(a=59===e.charCodeAt(k))&&(k++,(o=I===f&&l(p))&&(r=p,M=o)),D=1+k-P,(a||R)&&(p?I===f?(a&&!M?b(5,1):(r!==p&&(k=x+r.length,D=1+k-x,a=!1),a||(T=r?1:3,t.attribute?61===(S=e.charCodeAt(k))?(b(T,D),M=null):s(S)?M=null:b(T,D):b(T,D))),E=M):(a||b(2,D),E=parseInt(p,m[I]),(Q=E)>=55296&&Q<=57343||Q>1114111?(b(7,D),E=c(65533)):E in i?(b(6,D),E=i[E]):(w="",_(E)&&b(6,D),E>65535&&(w+=c((E-=65536)>>>10|55296),E=56320|1023&E),E=w+c(E))):I!==f&&b(4,D)),E?($(),A=J(),K=k-1,Y+=k-P+1,Z.push(E),(N=J()).offset++,U&&U.call(B,E,{start:A,end:N},e.slice(P-1,k)),A=N):(p=e.slice(P-1,k),q+=p,Y+=p.length,K=k-1)}else 10===v&&(X++,W++,Y=0),v==v?(q+=c(v),Y++):$();var Q;return Z.join("");function J(){return{line:X,column:Y,offset:K+(V.offset||0)}}function $(){q&&(Z.push(q),O&&O.call(F,q,{start:A,end:J()}),q="")}}(e,a)};var u={}.hasOwnProperty,c=String.fromCharCode,d=Function.prototype,p={warning:null,reference:null,text:null,warningContext:null,referenceContext:null,textContext:null,position:{},additional:null,attribute:!1,nonTerminated:!0},f="named",h="hexadecimal",m={hexadecimal:16,decimal:10},g={};g[f]=s,g.decimal=o,g[h]=a;var y={};function _(e){return e>=1&&e<=8||11===e||e>=13&&e<=31||e>=127&&e<=159||e>=64976&&e<=65007||65535==(65535&e)||65534==(65535&e)}y[1]="Named character references must be terminated by a semicolon",y[2]="Numeric character references must be terminated by a semicolon",y[3]="Named character references cannot be empty",y[4]="Numeric character references cannot be empty",y[5]="Named character references must be known",y[6]="Numeric character references cannot be disallowed",y[7]="Numeric character references cannot be outside the permissible Unicode range"},function(e,t,r){"use strict";
/*!
 * repeat-string <https://github.com/jonschlinkert/repeat-string>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var n,i="";e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("expected a string");if(1===t)return e;if(2===t)return e+e;var r=e.length*t;if(n!==e||void 0===n)n=e,i="";else if(i.length>=r)return i.substr(0,r);for(;r>i.length&&t>1;)1&t&&(i+=e),t>>=1,e+=e;return i=(i+=e).substr(0,r)}},function(e,t,r){"use strict";e.exports=function(e){var t=String(e),r=t.length;for(;"\n"===t.charAt(--r););return t.slice(0,r+1)}},function(e,t,r){"use strict";e.exports=function(e,t,r,n){var i,o,a,s,l,u,c=["pedantic","commonmark"],d=c.length,p=e.length,f=-1;for(;++f<p;){for(i=e[f],o=i[1]||{},a=i[0],s=-1,u=!1;++s<d;)if(void 0!==o[l=c[s]]&&o[l]!==r.options[l]){u=!0;break}if(!u&&t[a].apply(r,n))return!0}return!1}},function(e,t,r){"use strict";var n=r(229);e.exports=function(e){return n(e).toLowerCase()}},function(e,t,r){var n=r(35),i=r(106),o=r(107),a=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?i(e):o(e)}},function(e,t,r){var n=r(116),i=r(121);e.exports=function(e,t){var r=i(e,t);return n(r)?r:void 0}},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,r){"use strict";e.exports=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}}},function(e,t,r){"use strict";var n=r(6);function i(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,r){if(!t)return e;var o;if(r)o=r(t);else if(n.isURLSearchParams(t))o=t.toString();else{var a=[];n.forEach(t,(function(e,t){null!=e&&(n.isArray(e)?t+="[]":e=[e],n.forEach(e,(function(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),a.push(i(t)+"="+i(e))})))})),o=a.join("&")}if(o){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}},function(e,t,r){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,r){"use strict";(function(t){var n=r(6),i=r(148),o={"Content-Type":"application/x-www-form-urlencoded"};function a(e,t){!n.isUndefined(e)&&n.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var s,l={adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==t&&"[object process]"===Object.prototype.toString.call(t))&&(s=r(68)),s),transformRequest:[function(e,t){return i(t,"Accept"),i(t,"Content-Type"),n.isFormData(e)||n.isArrayBuffer(e)||n.isBuffer(e)||n.isStream(e)||n.isFile(e)||n.isBlob(e)?e:n.isArrayBufferView(e)?e.buffer:n.isURLSearchParams(e)?(a(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):n.isObject(e)?(a(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300}};l.headers={common:{Accept:"application/json, text/plain, */*"}},n.forEach(["delete","get","head"],(function(e){l.headers[e]={}})),n.forEach(["post","put","patch"],(function(e){l.headers[e]=n.merge(o)})),e.exports=l}).call(this,r(13))},function(e,t,r){"use strict";var n=r(6),i=r(149),o=r(65),a=r(151),s=r(154),l=r(155),u=r(69);e.exports=function(e){return new Promise((function(t,c){var d=e.data,p=e.headers;n.isFormData(d)&&delete p["Content-Type"];var f=new XMLHttpRequest;if(e.auth){var h=e.auth.username||"",m=e.auth.password||"";p.Authorization="Basic "+btoa(h+":"+m)}var g=a(e.baseURL,e.url);if(f.open(e.method.toUpperCase(),o(g,e.params,e.paramsSerializer),!0),f.timeout=e.timeout,f.onreadystatechange=function(){if(f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in f?s(f.getAllResponseHeaders()):null,n={data:e.responseType&&"text"!==e.responseType?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:r,config:e,request:f};i(t,c,n),f=null}},f.onabort=function(){f&&(c(u("Request aborted",e,"ECONNABORTED",f)),f=null)},f.onerror=function(){c(u("Network Error",e,null,f)),f=null},f.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),c(u(t,e,"ECONNABORTED",f)),f=null},n.isStandardBrowserEnv()){var y=r(156),_=(e.withCredentials||l(g))&&e.xsrfCookieName?y.read(e.xsrfCookieName):void 0;_&&(p[e.xsrfHeaderName]=_)}if("setRequestHeader"in f&&n.forEach(p,(function(e,t){void 0===d&&"content-type"===t.toLowerCase()?delete p[t]:f.setRequestHeader(t,e)})),n.isUndefined(e.withCredentials)||(f.withCredentials=!!e.withCredentials),e.responseType)try{f.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&f.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){f&&(f.abort(),c(e),f=null)})),void 0===d&&(d=null),f.send(d)}))}},function(e,t,r){"use strict";var n=r(150);e.exports=function(e,t,r,i,o){var a=new Error(e);return n(a,t,r,i,o)}},function(e,t,r){"use strict";var n=r(6);e.exports=function(e,t){t=t||{};var r={},i=["url","method","params","data"],o=["headers","auth","proxy"],a=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];n.forEach(i,(function(e){void 0!==t[e]&&(r[e]=t[e])})),n.forEach(o,(function(i){n.isObject(t[i])?r[i]=n.deepMerge(e[i],t[i]):void 0!==t[i]?r[i]=t[i]:n.isObject(e[i])?r[i]=n.deepMerge(e[i]):void 0!==e[i]&&(r[i]=e[i])})),n.forEach(a,(function(n){void 0!==t[n]?r[n]=t[n]:void 0!==e[n]&&(r[n]=e[n])}));var s=i.concat(o).concat(a),l=Object.keys(t).filter((function(e){return-1===s.indexOf(e)}));return n.forEach(l,(function(n){void 0!==t[n]?r[n]=t[n]:void 0!==e[n]&&(r[n]=e[n])})),r}},function(e,t,r){"use strict";function n(e){this.message=e}n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,e.exports=n},function(e,t){(function(){e.exports=function(){function e(){}return e.prototype.hasFeature=function(e,t){return!0},e.prototype.createDocumentType=function(e,t,r){throw new Error("This DOM method is not implemented.")},e.prototype.createDocument=function(e,t,r){throw new Error("This DOM method is not implemented.")},e.prototype.createHTMLDocument=function(e){throw new Error("This DOM method is not implemented.")},e.prototype.getFeature=function(e,t){throw new Error("This DOM method is not implemented.")},e}()}).call(this)},function(e,t,r){(function(){var t,n,i,o,a,s,l,u={}.hasOwnProperty;l=r(11).isPlainObject,i=r(72),n=r(161),o=r(7),t=r(4),s=r(76),a=r(51),e.exports=function(e){function r(e){r.__super__.constructor.call(this,null),this.name="#document",this.type=t.Document,this.documentURI=null,this.domConfig=new n,e||(e={}),e.writer||(e.writer=new a),this.options=e,this.stringify=new s(e)}return function(e,t){for(var r in t)u.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),Object.defineProperty(r.prototype,"implementation",{value:new i}),Object.defineProperty(r.prototype,"doctype",{get:function(){var e,r,n,i;for(r=0,n=(i=this.children).length;r<n;r++)if((e=i[r]).type===t.DocType)return e;return null}}),Object.defineProperty(r.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(r.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(r.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(r.prototype,"xmlEncoding",{get:function(){return 0!==this.children.length&&this.children[0].type===t.Declaration?this.children[0].encoding:null}}),Object.defineProperty(r.prototype,"xmlStandalone",{get:function(){return 0!==this.children.length&&this.children[0].type===t.Declaration&&"yes"===this.children[0].standalone}}),Object.defineProperty(r.prototype,"xmlVersion",{get:function(){return 0!==this.children.length&&this.children[0].type===t.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(r.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(r.prototype,"origin",{get:function(){return null}}),Object.defineProperty(r.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(r.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(r.prototype,"contentType",{get:function(){return null}}),r.prototype.end=function(e){var t;return t={},e?l(e)&&(t=e,e=this.options.writer):e=this.options.writer,e.document(this,e.filterOptions(t))},r.prototype.toString=function(e){return this.options.writer.document(this,this.options.writer.filterOptions(e))},r.prototype.createElement=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.createDocumentFragment=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.createTextNode=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.createComment=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.createCDATASection=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.createProcessingInstruction=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.createAttribute=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.createEntityReference=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.getElementsByTagName=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.importNode=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.createElementNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.createAttributeNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.getElementsByTagNameNS=function(e,t){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.getElementById=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.adoptNode=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.normalizeDocument=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.renameNode=function(e,t,r){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.getElementsByClassName=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.createEvent=function(e){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.createRange=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.createNodeIterator=function(e,t,r){throw new Error("This DOM method is not implemented."+this.debugInfo())},r.prototype.createTreeWalker=function(e,t,r){throw new Error("This DOM method is not implemented."+this.debugInfo())},r}(o)}).call(this)},function(e,t,r){(function(){var t;t=r(4),r(7),e.exports=function(){function e(e,r,n){if(this.parent=e,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),null==r)throw new Error("Missing attribute name. "+this.debugInfo(r));this.name=this.stringify.name(r),this.value=this.stringify.attValue(n),this.type=t.Attribute,this.isId=!1,this.schemaTypeInfo=null}return Object.defineProperty(e.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(e.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(e.prototype,"textContent",{get:function(){return this.value},set:function(e){return this.value=e||""}}),Object.defineProperty(e.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(e.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(e.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(e.prototype,"specified",{get:function(){return!0}}),e.prototype.clone=function(){return Object.create(this)},e.prototype.toString=function(e){return this.options.writer.attribute(this,this.options.writer.filterOptions(e))},e.prototype.debugInfo=function(e){return null==(e=e||this.name)?"parent: <"+this.parent.name+">":"attribute: {"+e+"}, parent: <"+this.parent.name+">"},e.prototype.isEqualNode=function(e){return e.namespaceURI===this.namespaceURI&&(e.prefix===this.prefix&&(e.localName===this.localName&&e.value===this.value))},e}()}).call(this)},function(e,t,r){(function(){var t,n,i={}.hasOwnProperty;n=r(7),t=r(4),e.exports=function(e){function r(e){r.__super__.constructor.call(this,e),this.type=t.Dummy}return function(e,t){for(var r in t)i.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.clone=function(){return Object.create(this)},r.prototype.toString=function(e){return""},r}(n)}).call(this)},function(e,t){(function(){var t=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty;e.exports=function(){function e(e){var n,i,o;for(n in this.assertLegalName=t(this.assertLegalName,this),this.assertLegalChar=t(this.assertLegalChar,this),e||(e={}),this.options=e,this.options.version||(this.options.version="1.0"),i=e.stringify||{})r.call(i,n)&&(o=i[n],this[n]=o)}return e.prototype.name=function(e){return this.options.noValidation?e:this.assertLegalName(""+e||"")},e.prototype.text=function(e){return this.options.noValidation?e:this.assertLegalChar(this.textEscape(""+e||""))},e.prototype.cdata=function(e){return this.options.noValidation?e:(e=(e=""+e||"").replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(e))},e.prototype.comment=function(e){if(this.options.noValidation)return e;if((e=""+e||"").match(/--/))throw new Error("Comment text cannot contain double-hypen: "+e);return this.assertLegalChar(e)},e.prototype.raw=function(e){return this.options.noValidation?e:""+e||""},e.prototype.attValue=function(e){return this.options.noValidation?e:this.assertLegalChar(this.attEscape(e=""+e||""))},e.prototype.insTarget=function(e){return this.options.noValidation?e:this.assertLegalChar(""+e||"")},e.prototype.insValue=function(e){if(this.options.noValidation)return e;if((e=""+e||"").match(/\?>/))throw new Error("Invalid processing instruction value: "+e);return this.assertLegalChar(e)},e.prototype.xmlVersion=function(e){if(this.options.noValidation)return e;if(!(e=""+e||"").match(/1\.[0-9]+/))throw new Error("Invalid version number: "+e);return e},e.prototype.xmlEncoding=function(e){if(this.options.noValidation)return e;if(!(e=""+e||"").match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+e);return this.assertLegalChar(e)},e.prototype.xmlStandalone=function(e){return this.options.noValidation?e:e?"yes":"no"},e.prototype.dtdPubID=function(e){return this.options.noValidation?e:this.assertLegalChar(""+e||"")},e.prototype.dtdSysID=function(e){return this.options.noValidation?e:this.assertLegalChar(""+e||"")},e.prototype.dtdElementValue=function(e){return this.options.noValidation?e:this.assertLegalChar(""+e||"")},e.prototype.dtdAttType=function(e){return this.options.noValidation?e:this.assertLegalChar(""+e||"")},e.prototype.dtdAttDefault=function(e){return this.options.noValidation?e:this.assertLegalChar(""+e||"")},e.prototype.dtdEntityValue=function(e){return this.options.noValidation?e:this.assertLegalChar(""+e||"")},e.prototype.dtdNData=function(e){return this.options.noValidation?e:this.assertLegalChar(""+e||"")},e.prototype.convertAttKey="@",e.prototype.convertPIKey="?",e.prototype.convertTextKey="#text",e.prototype.convertCDataKey="#cdata",e.prototype.convertCommentKey="#comment",e.prototype.convertRawKey="#raw",e.prototype.assertLegalChar=function(e){var t,r;if(this.options.noValidation)return e;if(t="","1.0"===this.options.version){if(t=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,r=e.match(t))throw new Error("Invalid character in string: "+e+" at index "+r.index)}else if("1.1"===this.options.version&&(t=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,r=e.match(t)))throw new Error("Invalid character in string: "+e+" at index "+r.index);return e},e.prototype.assertLegalName=function(e){var t;if(this.options.noValidation)return e;if(this.assertLegalChar(e),t=/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/,!e.match(t))throw new Error("Invalid character in name");return e},e.prototype.textEscape=function(e){var t;return this.options.noValidation?e:(t=this.options.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,e.replace(t,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;"))},e.prototype.attEscape=function(e){var t;return this.options.noValidation?e:(t=this.options.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,e.replace(t,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;"))},e}()}).call(this)},function(e,t,r){(function(){var t,n,i,o={}.hasOwnProperty;i=r(11).assign,t=r(4),r(42),r(43),r(40),r(41),r(38),r(48),r(49),r(50),r(75),r(44),r(46),r(45),r(47),n=r(24),e.exports=function(){function e(e){var t,r,n;for(t in e||(e={}),this.options=e,r=e.writer||{})o.call(r,t)&&(n=r[t],this["_"+t]=this[t],this[t]=n)}return e.prototype.filterOptions=function(e){var t,r,o,a,s,l,u,c;return e||(e={}),e=i({},this.options,e),(t={writer:this}).pretty=e.pretty||!1,t.allowEmpty=e.allowEmpty||!1,t.indent=null!=(r=e.indent)?r:"  ",t.newline=null!=(o=e.newline)?o:"\n",t.offset=null!=(a=e.offset)?a:0,t.dontPrettyTextNodes=null!=(s=null!=(l=e.dontPrettyTextNodes)?l:e.dontprettytextnodes)?s:0,t.spaceBeforeSlash=null!=(u=null!=(c=e.spaceBeforeSlash)?c:e.spacebeforeslash)?u:"",!0===t.spaceBeforeSlash&&(t.spaceBeforeSlash=" "),t.suppressPrettyCount=0,t.user={},t.state=n.None,t},e.prototype.indent=function(e,t,r){var n;return!t.pretty||t.suppressPrettyCount?"":t.pretty&&(n=(r||0)+t.offset+1)>0?new Array(n).join(t.indent):""},e.prototype.endline=function(e,t,r){return!t.pretty||t.suppressPrettyCount?"":t.newline},e.prototype.attribute=function(e,t,r){var n;return this.openAttribute(e,t,r),n=" "+e.name+'="'+e.value+'"',this.closeAttribute(e,t,r),n},e.prototype.cdata=function(e,t,r){var i;return this.openNode(e,t,r),t.state=n.OpenTag,i=this.indent(e,t,r)+"<![CDATA[",t.state=n.InsideTag,i+=e.value,t.state=n.CloseTag,i+="]]>"+this.endline(e,t,r),t.state=n.None,this.closeNode(e,t,r),i},e.prototype.comment=function(e,t,r){var i;return this.openNode(e,t,r),t.state=n.OpenTag,i=this.indent(e,t,r)+"\x3c!-- ",t.state=n.InsideTag,i+=e.value,t.state=n.CloseTag,i+=" --\x3e"+this.endline(e,t,r),t.state=n.None,this.closeNode(e,t,r),i},e.prototype.declaration=function(e,t,r){var i;return this.openNode(e,t,r),t.state=n.OpenTag,i=this.indent(e,t,r)+"<?xml",t.state=n.InsideTag,i+=' version="'+e.version+'"',null!=e.encoding&&(i+=' encoding="'+e.encoding+'"'),null!=e.standalone&&(i+=' standalone="'+e.standalone+'"'),t.state=n.CloseTag,i+=t.spaceBeforeSlash+"?>",i+=this.endline(e,t,r),t.state=n.None,this.closeNode(e,t,r),i},e.prototype.docType=function(e,t,r){var i,o,a,s,l;if(r||(r=0),this.openNode(e,t,r),t.state=n.OpenTag,s=this.indent(e,t,r),s+="<!DOCTYPE "+e.root().name,e.pubID&&e.sysID?s+=' PUBLIC "'+e.pubID+'" "'+e.sysID+'"':e.sysID&&(s+=' SYSTEM "'+e.sysID+'"'),e.children.length>0){for(s+=" [",s+=this.endline(e,t,r),t.state=n.InsideTag,o=0,a=(l=e.children).length;o<a;o++)i=l[o],s+=this.writeChildNode(i,t,r+1);t.state=n.CloseTag,s+="]"}return t.state=n.CloseTag,s+=t.spaceBeforeSlash+">",s+=this.endline(e,t,r),t.state=n.None,this.closeNode(e,t,r),s},e.prototype.element=function(e,r,i){var a,s,l,u,c,d,p,f,h,m,g,y,_,v;for(h in i||(i=0),m=!1,g="",this.openNode(e,r,i),r.state=n.OpenTag,g+=this.indent(e,r,i)+"<"+e.name,y=e.attribs)o.call(y,h)&&(a=y[h],g+=this.attribute(a,r,i));if(u=0===(l=e.children.length)?null:e.children[0],0===l||e.children.every((function(e){return(e.type===t.Text||e.type===t.Raw)&&""===e.value})))r.allowEmpty?(g+=">",r.state=n.CloseTag,g+="</"+e.name+">"+this.endline(e,r,i)):(r.state=n.CloseTag,g+=r.spaceBeforeSlash+"/>"+this.endline(e,r,i));else if(!r.pretty||1!==l||u.type!==t.Text&&u.type!==t.Raw||null==u.value){if(r.dontPrettyTextNodes)for(c=0,p=(_=e.children).length;c<p;c++)if(((s=_[c]).type===t.Text||s.type===t.Raw)&&null!=s.value){r.suppressPrettyCount++,m=!0;break}for(g+=">"+this.endline(e,r,i),r.state=n.InsideTag,d=0,f=(v=e.children).length;d<f;d++)s=v[d],g+=this.writeChildNode(s,r,i+1);r.state=n.CloseTag,g+=this.indent(e,r,i)+"</"+e.name+">",m&&r.suppressPrettyCount--,g+=this.endline(e,r,i),r.state=n.None}else g+=">",r.state=n.InsideTag,r.suppressPrettyCount++,m=!0,g+=this.writeChildNode(u,r,i+1),r.suppressPrettyCount--,m=!1,r.state=n.CloseTag,g+="</"+e.name+">"+this.endline(e,r,i);return this.closeNode(e,r,i),g},e.prototype.writeChildNode=function(e,r,n){switch(e.type){case t.CData:return this.cdata(e,r,n);case t.Comment:return this.comment(e,r,n);case t.Element:return this.element(e,r,n);case t.Raw:return this.raw(e,r,n);case t.Text:return this.text(e,r,n);case t.ProcessingInstruction:return this.processingInstruction(e,r,n);case t.Dummy:return"";case t.Declaration:return this.declaration(e,r,n);case t.DocType:return this.docType(e,r,n);case t.AttributeDeclaration:return this.dtdAttList(e,r,n);case t.ElementDeclaration:return this.dtdElement(e,r,n);case t.EntityDeclaration:return this.dtdEntity(e,r,n);case t.NotationDeclaration:return this.dtdNotation(e,r,n);default:throw new Error("Unknown XML node type: "+e.constructor.name)}},e.prototype.processingInstruction=function(e,t,r){var i;return this.openNode(e,t,r),t.state=n.OpenTag,i=this.indent(e,t,r)+"<?",t.state=n.InsideTag,i+=e.target,e.value&&(i+=" "+e.value),t.state=n.CloseTag,i+=t.spaceBeforeSlash+"?>",i+=this.endline(e,t,r),t.state=n.None,this.closeNode(e,t,r),i},e.prototype.raw=function(e,t,r){var i;return this.openNode(e,t,r),t.state=n.OpenTag,i=this.indent(e,t,r),t.state=n.InsideTag,i+=e.value,t.state=n.CloseTag,i+=this.endline(e,t,r),t.state=n.None,this.closeNode(e,t,r),i},e.prototype.text=function(e,t,r){var i;return this.openNode(e,t,r),t.state=n.OpenTag,i=this.indent(e,t,r),t.state=n.InsideTag,i+=e.value,t.state=n.CloseTag,i+=this.endline(e,t,r),t.state=n.None,this.closeNode(e,t,r),i},e.prototype.dtdAttList=function(e,t,r){var i;return this.openNode(e,t,r),t.state=n.OpenTag,i=this.indent(e,t,r)+"<!ATTLIST",t.state=n.InsideTag,i+=" "+e.elementName+" "+e.attributeName+" "+e.attributeType,"#DEFAULT"!==e.defaultValueType&&(i+=" "+e.defaultValueType),e.defaultValue&&(i+=' "'+e.defaultValue+'"'),t.state=n.CloseTag,i+=t.spaceBeforeSlash+">"+this.endline(e,t,r),t.state=n.None,this.closeNode(e,t,r),i},e.prototype.dtdElement=function(e,t,r){var i;return this.openNode(e,t,r),t.state=n.OpenTag,i=this.indent(e,t,r)+"<!ELEMENT",t.state=n.InsideTag,i+=" "+e.name+" "+e.value,t.state=n.CloseTag,i+=t.spaceBeforeSlash+">"+this.endline(e,t,r),t.state=n.None,this.closeNode(e,t,r),i},e.prototype.dtdEntity=function(e,t,r){var i;return this.openNode(e,t,r),t.state=n.OpenTag,i=this.indent(e,t,r)+"<!ENTITY",t.state=n.InsideTag,e.pe&&(i+=" %"),i+=" "+e.name,e.value?i+=' "'+e.value+'"':(e.pubID&&e.sysID?i+=' PUBLIC "'+e.pubID+'" "'+e.sysID+'"':e.sysID&&(i+=' SYSTEM "'+e.sysID+'"'),e.nData&&(i+=" NDATA "+e.nData)),t.state=n.CloseTag,i+=t.spaceBeforeSlash+">"+this.endline(e,t,r),t.state=n.None,this.closeNode(e,t,r),i},e.prototype.dtdNotation=function(e,t,r){var i;return this.openNode(e,t,r),t.state=n.OpenTag,i=this.indent(e,t,r)+"<!NOTATION",t.state=n.InsideTag,i+=" "+e.name,e.pubID&&e.sysID?i+=' PUBLIC "'+e.pubID+'" "'+e.sysID+'"':e.pubID?i+=' PUBLIC "'+e.pubID+'"':e.sysID&&(i+=' SYSTEM "'+e.sysID+'"'),t.state=n.CloseTag,i+=t.spaceBeforeSlash+">"+this.endline(e,t,r),t.state=n.None,this.closeNode(e,t,r),i},e.prototype.openNode=function(e,t,r){},e.prototype.closeNode=function(e,t,r){},e.prototype.openAttribute=function(e,t,r){},e.prototype.closeAttribute=function(e,t,r){},e}()}).call(this)},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){"use strict";(function(t,n){var i=r(27);e.exports=v;var o,a=r(78);v.ReadableState=_;r(26).EventEmitter;var s=function(e,t){return e.listeners(t).length},l=r(80),u=r(53).Buffer,c=t.Uint8Array||function(){};var d=Object.create(r(18));d.inherits=r(14);var p=r(173),f=void 0;f=p&&p.debuglog?p.debuglog("stream"):function(){};var h,m=r(174),g=r(81);d.inherits(v,l);var y=["error","close","destroy","pause","resume"];function _(e,t){e=e||{};var n=t instanceof(o=o||r(15));this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,a=e.readableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(a||0===a)?a:s,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(h||(h=r(55).StringDecoder),this.decoder=new h(e.encoding),this.encoding=e.encoding)}function v(e){if(o=o||r(15),!(this instanceof v))return new v(e);this._readableState=new _(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),l.call(this)}function E(e,t,r,n,i){var o,a=e._readableState;null===t?(a.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,T(e)}(e,a)):(i||(o=function(e,t){var r;n=t,u.isBuffer(n)||n instanceof c||"string"==typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));var n;return r}(a,t)),o?e.emit("error",o):a.objectMode||t&&t.length>0?("string"==typeof t||a.objectMode||Object.getPrototypeOf(t)===u.prototype||(t=function(e){return u.from(e)}(t)),n?a.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):S(e,a,t,!0):a.ended?e.emit("error",new Error("stream.push() after EOF")):(a.reading=!1,a.decoder&&!r?(t=a.decoder.write(t),a.objectMode||0!==t.length?S(e,a,t,!1):M(e,a)):S(e,a,t,!1))):n||(a.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(a)}function S(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&T(e)),M(e,t)}Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),v.prototype.destroy=g.destroy,v.prototype._undestroy=g.undestroy,v.prototype._destroy=function(e,t){this.push(null),t(e)},v.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=u.from(e,t),t=""),r=!0),E(this,e,t,!1,r)},v.prototype.unshift=function(e){return E(this,e,null,!0,!1)},v.prototype.isPaused=function(){return!1===this._readableState.flowing},v.prototype.setEncoding=function(e){return h||(h=r(55).StringDecoder),this._readableState.decoder=new h(e),this._readableState.encoding=e,this};function b(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=8388608?e=8388608:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function T(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(w,e):w(e))}function w(e){f("emit readable"),e.emit("readable"),C(e)}function M(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(x,e,t))}function x(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function P(e){f("readable nexttick read 0"),e.read(0)}function I(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),C(e),t.flowing&&!t.reading&&e.read(0)}function C(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function A(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,i=r.data;e-=i.length;for(;r=r.next;){var o=r.data,a=e>o.length?o.length:e;if(a===o.length?i+=o:i+=o.slice(0,e),0===(e-=a)){a===o.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(a));break}++n}return t.length-=n,i}(e,t):function(e,t){var r=u.allocUnsafe(e),n=t.head,i=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var o=n.data,a=e>o.length?o.length:e;if(o.copy(r,r.length-e,0,a),0===(e-=a)){a===o.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(a));break}++i}return t.length-=i,r}(e,t);return n}(e,t.buffer,t.decoder),r);var r}function N(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(D,t,e))}function D(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function k(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}v.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?N(this):T(this),null;if(0===(e=b(e,t))&&t.ended)return 0===t.length&&N(this),null;var n,i=t.needReadable;return f("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",i=!0),t.ended||t.reading?f("reading or ended",i=!1):i&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=b(r,t))),null===(n=e>0?A(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&N(this)),null!==n&&this.emit("data",n),n},v.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},v.prototype.pipe=function(e,t){var r=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,f("pipe count=%d opts=%j",o.pipesCount,t);var l=(!t||!1!==t.end)&&e!==n.stdout&&e!==n.stderr?c:v;function u(t,n){f("onunpipe"),t===r&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,f("cleanup"),e.removeListener("close",y),e.removeListener("finish",_),e.removeListener("drain",d),e.removeListener("error",g),e.removeListener("unpipe",u),r.removeListener("end",c),r.removeListener("end",v),r.removeListener("data",m),p=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||d())}function c(){f("onend"),e.end()}o.endEmitted?i.nextTick(l):r.once("end",l),e.on("unpipe",u);var d=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&s(e,"data")&&(t.flowing=!0,C(e))}}(r);e.on("drain",d);var p=!1;var h=!1;function m(t){f("ondata"),h=!1,!1!==e.write(t)||h||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==k(o.pipes,e))&&!p&&(f("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,h=!0),r.pause())}function g(t){f("onerror",t),v(),e.removeListener("error",g),0===s(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",_),v()}function _(){f("onfinish"),e.removeListener("close",y),v()}function v(){f("unpipe"),r.unpipe(e)}return r.on("data",m),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?a(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",g),e.once("close",y),e.once("finish",_),e.emit("pipe",r),o.flowing||(f("pipe resume"),r.resume()),e},v.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,r);return this}var a=k(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},v.prototype.on=function(e,t){var r=l.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&T(this):i.nextTick(P,this))}return r},v.prototype.addListener=v.prototype.on,v.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(I,e,t))}(this,e)),this},v.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},v.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",(function(){if(f("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){(f("wrapped data"),r.decoder&&(i=r.decoder.write(i)),r.objectMode&&null==i)||(r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<y.length;o++)e.on(y[o],this.emit.bind(this,y[o]));return this._read=function(t){f("wrapped _read",t),n&&(n=!1,e.resume())},this},Object.defineProperty(v.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),v._fromList=A}).call(this,r(9),r(13))},function(e,t,r){e.exports=r(26).EventEmitter},function(e,t,r){"use strict";var n=r(27);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var r=this,o=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return o||a?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||n.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(n.nextTick(i,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,r){(function(e){var n=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,n,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,n,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(n,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},r(176),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,r(9))},function(e,t,r){"use strict";e.exports=a;var n=r(15),i=Object.create(r(18));function o(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function a(e){if(!(this instanceof a))return new a(e);n.call(this,e),this._transformState={afterTransform:o.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",s)}function s(){var e=this;"function"==typeof this._flush?this._flush((function(t,r){l(e,t,r)})):l(this,null,null)}function l(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=r(14),i.inherits(a,n),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},a.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},a.prototype._destroy=function(e,t){var r=this;n.prototype._destroy.call(this,e,(function(e){t(e),r.emit("close")}))}},function(e,t){(function(){"use strict";var e;e=new RegExp(/(?!xmlns)^.*:/),t.normalize=function(e){return e.toLowerCase()},t.firstCharLowerCase=function(e){return e.charAt(0).toLowerCase()+e.slice(1)},t.stripPrefix=function(t){return t.replace(e,"")},t.parseNumbers=function(e){return isNaN(e)||(e=e%1==0?parseInt(e,10):parseFloat(e)),e},t.parseBooleans=function(e){return/^(?:true|false)$/i.test(e)&&(e="true"===e.toLowerCase()),e}}).call(this)},function(e,t,r){(function(e){function r(e,t){for(var r=0,n=e.length-1;n>=0;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}function n(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}t.resolve=function(){for(var t="",i=!1,o=arguments.length-1;o>=-1&&!i;o--){var a=o>=0?arguments[o]:e.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(t=a+"/"+t,i="/"===a.charAt(0))}return(i?"/":"")+(t=r(n(t.split("/"),(function(e){return!!e})),!i).join("/"))||"."},t.normalize=function(e){var o=t.isAbsolute(e),a="/"===i(e,-1);return(e=r(n(e.split("/"),(function(e){return!!e})),!o).join("/"))||o||(e="."),e&&a&&(e+="/"),(o?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(n(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,r){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=t.resolve(e).substr(1),r=t.resolve(r).substr(1);for(var i=n(e.split("/")),o=n(r.split("/")),a=Math.min(i.length,o.length),s=a,l=0;l<a;l++)if(i[l]!==o[l]){s=l;break}var u=[];for(l=s;l<i.length;l++)u.push("..");return(u=u.concat(o.slice(s))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),r=47===t,n=-1,i=!0,o=e.length-1;o>=1;--o)if(47===(t=e.charCodeAt(o))){if(!i){n=o;break}}else i=!1;return-1===n?r?"/":".":r&&1===n?"/":e.slice(0,n)},t.basename=function(e,t){var r=function(e){"string"!=typeof e&&(e+="");var t,r=0,n=-1,i=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!i){r=t+1;break}}else-1===n&&(i=!1,n=t+1);return-1===n?"":e.slice(r,n)}(e);return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},t.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,r=0,n=-1,i=!0,o=0,a=e.length-1;a>=0;--a){var s=e.charCodeAt(a);if(47!==s)-1===n&&(i=!1,n=a+1),46===s?-1===t?t=a:1!==o&&(o=1):-1!==t&&(o=-1);else if(!i){r=a+1;break}}return-1===t||-1===n||0===o||1===o&&t===n-1&&t===r+1?"":e.slice(t,n)};var i="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)}}).call(this,r(13))},function(e,t,r){"use strict";e.exports=function(e){var t="string"==typeof e?e.charCodeAt(0):e;return t>=97&&t<=122||t>=65&&t<=90}},function(e,t,r){"use strict";e.exports={position:!0,gfm:!0,commonmark:!1,footnotes:!1,pedantic:!1,blocks:r(213)}},function(e,t,r){"use strict";e.exports=function(e){var t,r=0,i=0,o=e.charAt(r),a={};for(;o in n;)i+=t=n[o],t>1&&(i=Math.floor(i/t)*t),a[i]=r,o=e.charAt(++r);return{indent:i,stops:a}};var n={" ":1,"\t":4}},function(e,t,r){"use strict";var n="<[A-Za-z][A-Za-z0-9\\-]*(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*(?:[^\"'=<>`\\u0000-\\u0020]+|'[^']*'|\"[^\"]*\"))?)*\\s*\\/?>",i="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>";t.openCloseTag=new RegExp("^(?:"+n+"|"+i+")"),t.tag=new RegExp("^(?:"+n+"|"+i+"|\x3c!----\x3e|\x3c!--(?:-?[^>-])(?:-?[^-])*--\x3e|<[?].*?[?]>|<![A-Za-z]+\\s+[^>]*>|<!\\[CDATA\\[[\\s\\S]*?\\]\\]>)")},function(e,t,r){"use strict";e.exports=function(e,t){return e.indexOf("<",t)}},function(e,t,r){"use strict";e.exports=function(e,t){var r=e.indexOf("[",t),n=e.indexOf("![",t);if(-1===n)return r;return r<n?r:n}},function(e,t,r){(function(){"use strict";var e,n,i,o,a={}.hasOwnProperty;n=r(37),e=r(159),i=r(168),o=r(84),t.defaults=n.defaults,t.processors=o,t.ValidationError=function(e){function t(e){this.message=e}return function(e,t){for(var r in t)a.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(t,Error),t}(),t.Builder=e.Builder,t.Parser=i.Parser,t.parseString=i.parseString,t.parseStringPromise=i.parseStringPromise}).call(this)},function(e,t,r){"use strict";(function(e){var n=r(0),i=r.n(n),o=r(2),a=r(19);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){_(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=y(e);if(t){var i=y(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m(this,r)}}function m(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?g(e):t}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var v=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(u,t);var r,n,o,s=h(u);function u(t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),_(g(r=s.call(this,t)),"initObserver",(function(){var e=new IntersectionObserver((function(t){var n=t[0],i=n.isIntersecting,o=n.intersectionRatio;i&&o>0&&(r.createImage(),e.disconnect(),e=null)}),{threshold:[.1,.5,.75,1]});e.observe(r.image.current)})),_(g(r),"createImage",(function(){r.loadImage(e.webpSupport&&r.props.webp)})),_(g(r),"loadImage",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=r.props,n=t.src,i=t.onErrorShowDefault,o=e?r.imageWebPUrl:n,a=new window.Image;a.onload=function(){r.image.current&&r.setState({sources:o,isLoaded:!0})},a.onerror=function(){e?r.loadImage():!0&&i&&r.setState({isError:!0,isLoaded:!1})},a.src=o})),_(g(r),"loadPolyfills",(function(){return!!r.supportsIntersectionObserver()})),_(g(r),"supportsIntersectionObserver",(function(){return"IntersectionObserver"in e&&"IntersectionObserverEntry"in e&&"intersectionRatio"in IntersectionObserverEntry.prototype})),r.image=i.a.createRef(),r.state={isLoaded:!1,sources:t.lazy?t.initial:t.image,widthSet:!1},r}return r=u,(n=[{key:"componentDidMount",value:function(){var t=this.props.src;this.props.handleCallback(!1),t&&(this.props.lazy&&this.loadPolyfills()?this.initObserver():this.loadImage(e.webpSupport&&this.props.webp))}},{key:"componentDidUpdate",value:function(t){this.props.handleCallback(this.state.load),this.props.src!==t.src&&(this.props.lazy&&this.loadPolyfills()?this.initObserver():this.loadImage(e.webpSupport&&this.props.webp))}},{key:"render",value:function(){var e=this.state,t=e.sources,r=e.isError,n=e.isLoaded,o=this.props,s=o.alt,l=o.containerClassName,u=o.containerStyle,c=o.style,p=o.onClick,f=o.children,h=o.className,m=o.src,g=o.errorImgClassName,y=(o.onEmptyShowDefault,o.onHoverBorder),_=o.fallbackImageUri,v=f&&!m;return i.a.createElement(i.a.Fragment,null,v&&i.a.createElement("div",{className:"".concat(l||""," ").concat(a.a," ").concat(a.c),style:d({},u),onClick:p},f),_&&i.a.createElement("img",{src:_,className:"".concat(a.b," fallbackImg fadeIn"),style:{opacity:n?0:1}}),!v&&i.a.createElement("div",{className:"".concat(l||""," ").concat(a.a," imageWrapper ").concat(n?"loaded":""),style:d(d({},u),{},{position:_?"absolute":"relative",top:0,left:0}),onClick:p},y&&i.a.createElement("div",{className:"imageBorder"}),!r&&i.a.createElement("img",{ref:this.image,className:"".concat(h||""," fadeIn"),style:d(d({},c),{},{opacity:n?1:0}),src:t,alt:s}),r&&!_&&i.a.createElement("div",{className:"errorBackground ".concat(g||"")})))}},{key:"dataProps",get:function(){var e={};return Object.entries(this.props).forEach((function(t){var r=l(t,2),n=r[0],i=r[1];n.startsWith("data-")&&(e[n]=i)})),e}},{key:"imageWebPUrl",get:function(){return"".concat(this.props.src,".webp")}}])&&p(r.prototype,n),o&&p(r,o),u}(n.PureComponent);_(v,"propTypes",{alt:o.string,className:o.string,containerClassName:o.string,containerStyle:o.object,fadeIn:o.bool,width:o.string,height:o.string,initial:o.string,lazy:o.bool,src:o.string,style:o.object,webp:o.bool,onClick:o.func,children:o.node,onErrorShowDefault:o.bool,onEmptyShowDefault:o.bool,errorImgClassName:o.string,handleCallback:o.func}),_(v,"defaultProps",{alt:"",className:"",containerClassName:"",containerStyle:{},fadeIn:!0,width:"100%",height:"auto",initial:"",lazy:!0,onClick:function(){},style:{},webp:!0,children:null,src:null,onErrorShowDefault:!1,onEmptyShowDefault:!1,errorImgClassName:"",handleCallback:function(){}}),t.a=v}).call(this,r(9))},function(e,t,r){e.exports=function(){"use strict";return function(e){function t(t){if(t)try{e(t+"}")}catch(e){}}return function(r,n,i,o,a,s,l,u,c,d){switch(r){case 1:if(0===c&&64===n.charCodeAt(0))return e(n+";"),"";break;case 2:if(0===u)return n+"/*|*/";break;case 3:switch(u){case 102:case 112:return e(i[0]+n),"";default:return n+(0===d?"/*|*/":"")}case-2:n.split("/*|*/}").forEach(t)}}}}()},function(e,t,r){"use strict";(function(e){var n=r(0),i=r.n(n),o=r(1),a=r.n(o),s=r(96),l=r.n(s),u=r(5);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function f(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=S(e);if(t){var i=S(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return v(this,r)}}function v(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?E(e):t}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var T,w=0,M=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(c,t);var r,n,o,s=_(c);function c(){var e;m(this,c);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return b(E(e=s.call.apply(s,[this].concat(r))),"state",{qualities:[],subtitles:[],bufferedPercentage:0,isMuteFeedbackHidden:!0,isPlayPauseFeedbackHidden:!0,isSkipFeedbackHidden:!0,isfullscreenFeedbackHidden:!0,skippedDuration:0,cue:{text:"",hidden:!0}}),b(E(e),"_getElementById",(function(t){var r="vpcc-custom-controller-".concat(e.props.id);return document.querySelector("#".concat(r," #").concat(t))})),b(E(e),"handleFeedbackOnClick",(function(){var t=e._getElementById("vpcc-quality"),r=a()(t,"children[0]",""),n=e._getElementById("vpcc-subtitle"),i=a()(n,"children[0]","");i&&(i.style.display="none"),r&&(r.style.display="none")})),b(E(e),"handleKeyboardEvent",(function(){e.props.config.keyboardShortcutsEnabled&&(document.onkeyup=function(t){var r=E(e),n=r.props.player,i=n&&n.getMediaElement(),o=a()(e.props,"isPreroll",!1);switch(t.which||t.keyCode){case 37:o||r._seekTo(-10);break;case 38:t.preventDefault(),i.volume=Math.min(1,i.volume+.1);break;case 39:o||r._seekTo(10);break;case 40:t.preventDefault(),i.volume=Math.max(0,i.volume-.1);break;case 70:t.preventDefault(),r._toggleFullscreen();break;case 77:t.preventDefault(),r._toggleMute();break;case 80:t.preventDefault(),r._togglePlayPause();break;default:t.preventDefault()}})})),b(E(e),"_getQuality",(function(){var t=e.props.player;return t&&t.getVariantTracks()||[]})),b(E(e),"_setQuality",(function(t){var r=e.props.player;if(r){var n=e._getQuality();if(n&&n.length>0){var i=n.filter((function(e){return e.id==t}))[0];if(i)r.selectVariantTrack(i,!0);else{var o,s=r.getStats(),l=a()(s,"estimatedBandwidth",0);n.reverse().map((function(e){l>e.bandwidth&&!o&&(r.selectVariantTrack(e,!0),o=e)})),o||r.selectVariantTrack(n[0],!0)}}}})),b(E(e),"_getSubtitle",(function(){var t=e.props.player,r=t&&t.getMediaElement();return t&&Array.from(r.textTracks)||[]})),b(E(e),"_setSubtitle",(function(t){if(e.props.player){var r=e._getSubtitle();if(r&&r.length>1){var n,i=r[t],o=f(r);try{for(o.s();!(n=o.n()).done;){var a=n.value;if(i.language==a.language){if(a.addEventListener("cuechange",e.handleCueOnChange),a.cues&&a.cues.length>0){var s,l=f(a.cues);try{for(l.s();!(s=l.n()).done;){var u=s.value;u.addEventListener("enter",e.handleCueOnEnter),u.addEventListener("exit",e.handleCueOnExit)}}catch(e){l.e(e)}finally{l.f()}}}else if(a.removeEventListener("cuechange",e.handleCueOnChange),a.cues&&a.cues.length>0){var c,d=f(a.cues);try{for(d.s();!(c=d.n()).done;){var p=c.value;p.removeEventListener("enter",e.handleCueOnEnter),p.removeEventListener("exit",e.handleCueOnExit)}}catch(e){d.e(e)}finally{d.f()}}}}catch(e){o.e(e)}finally{o.f()}e.setState({cue:{text:"",hidden:!0}})}}})),b(E(e),"handleCueOnChange",(function(t){var r=a()(t,"target.activeCues",{});r.length>0&&e.setState((function(e){return{cue:p(p({},e.cue),{},{text:r[0].text})}}))})),b(E(e),"handleCueOnEnter",(function(){e.setState((function(e){return{cue:p(p({},e.cue),{},{hidden:!1})}}))})),b(E(e),"handleCueOnExit",(function(){e.setState((function(e){return{cue:p(p({},e.cue),{},{text:"",hidden:!0})}}))})),b(E(e),"handleQualityFilter",(function(){var t=e._getQuality(),r=[],n=[];t.reverse().map((function(e){e.height&&!n.includes(e.height)&&(n.push(e.height),r.push(p(p({},e),{},{active:!1})))})),r.sort((function(e,t){return t.height-e.height})),r.push({bandwidth:"Auto",width:"Auto",height:"Auto",id:-1,active:!0}),e.setState({qualities:r})})),b(E(e),"handleSubtitleFilter",(function(){var t=e._getSubtitle(),r=(t=t.map((function(t,r){return p(p({},t),{},{id:r,active:t.language.toLowerCase()==e.props.config.preferredTextLanguage.toLowerCase(),name:t.language?t.label:null})})).filter((function(e){return e.name}))).filter((function(e){return e.active}))[0],n=[{id:0,active:!r,name:"Off",type:"SRT",kind:"metadata"}].concat(t);e.setState({subtitles:n.reverse()||[]},(function(){r&&e._setSubtitle(r.id)}))})),b(E(e),"initEventListeners",(function(t){var r=e._getElementById("vpcc-seek"),n=t&&t.isLive();r&&!n&&r.addEventListener("mousemove",e._updateSeekTooltip),(t&&t.getMediaElement()).addEventListener("progress",e._updateBuffer)})),b(E(e),"_updateBuffer",(function(){var t=e.props.player,r=t&&t.getMediaElement(),n=Math.round(a()(r,"duration",0)),i=Math.round(a()(r,"currentTime",0)),o=a()(r,"buffered",[]);if(n>0)for(var s=0;s<o.length;s++)if(o.start(o.length-1-s)<i){e.setState({bufferedPercentage:o.end(o.length-1-s)/n*100});break}})),b(E(e),"_formatTime",(function(e){var t=isFinite(e)?e:0,r=new Date(1e3*Math.abs(t)).toISOString().substr(11,8),n={hours:r.substr(0,2),minutes:r.substr(3,2),seconds:r.substr(6,2)};return parseInt(n.hours,10)>0?r:"".concat(n.minutes,":").concat(n.seconds)})),b(E(e),"_updateSeekTooltip",(function(t){var r=e.props.player,n=r&&r.getMediaElement(),i=e._getElementById("vpcc-seek"),o=Math.round(a()(n,"duration",0)),s=a()(e.props,"isPreroll",!1),l=r&&r.isLive();if(n&&!s&&!l){var u=e._getElementById("vpcc-seek-tooltip"),c=Math.round(t.offsetX/t.target.clientWidth*o);i.setAttribute("data-seek",c),u.textContent=e._formatTime(c);var d=n.getBoundingClientRect();e.isFullscreen(),u.style.left="".concat(t.pageX-d.left-.0875*d.height,"px")}})),b(E(e),"_updateSeekValue",(function(t){var r=t.target.value,n=e.props.player,i=n&&n.getMediaElement(),o=a()(e.props,"isPreroll",!1),s=n&&n.isLive();i&&!o&&!s&&e.props.config.seekBarEnabled&&(e.setState({currentTime:r}),i.currentTime=r)})),b(E(e),"_updateLocalStorage",(function(e,t){try{var r=JSON.parse(localStorage.getItem(e));r?localStorage.setItem(e,JSON.stringify(p(p({},r),t))):localStorage.setItem(e,JSON.stringify(t))}catch(e){}})),b(E(e),"_updateVolume",(function(t){var r=e.props.player,n=r&&r.getMediaElement();e._getElementById("vpcc-volume");n&&(n.muted&&(n.muted=!1),e.setState({volume:t.target.value}),n.volume=t.target.value,e._updateLocalStorage("player-volume-info",{volume:n.volume,muted:n.muted}))})),b(E(e),"_toggleMute",(function(){var t=e.props.player,r=t&&t.getMediaElement(),n=e._getElementById("vpcc-volume");r&&e.props.config.toggleMuteEnabled&&(e._debounce((function(){var t,i;(r.muted=!r.muted,r.muted)?(w=0,n.setAttribute("data-volume",n.value),r.volume=0):(w=0,r.volume=null!==(t=null==n||null===(i=n.dataset)||void 0===i?void 0:i.volume)&&void 0!==t?t:1);e._updateLocalStorage("player-volume-info",{volume:r.volume,muted:r.muted}),e.setState({isMuteFeedbackHidden:!0})}),500),e.setState({isMuteFeedbackHidden:!1}))})),b(E(e),"_togglePlayPause",(function(){var t=e.props.player,r=t&&t.getMediaElement();r&&e.props.config.togglePlayPauseEnabled&&(e._debounce((function(){w=0,r.paused||r.ended?r.play():r.pause(),e.setState({isPlayPauseFeedbackHidden:!0})}),500),e.setState({isPlayPauseFeedbackHidden:!1}))})),b(E(e),"_toggleFullscreen",(function(){var t=e.props.player,r=t&&t.getMediaElement();e.props.config.toggleFullscreenEnabled&&(e._debounce((function(){w=0,r&&(e.isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():r.parentNode.requestFullscreen?r.parentNode.requestFullscreen():r.parentNode.mozRequestFullScreen?r.parentNode.mozRequestFullScreen():r.parentNode.webkitRequestFullscreen?r.parentNode.webkitRequestFullscreen():r.parentNode.msRequestFullscreen&&r.parentNode.msRequestFullscreen()),e.setState({isfullscreenFeedbackHidden:!0})}),500),e.setState({isfullscreenFeedbackHidden:!1}))})),b(E(e),"isFullscreen",(function(){return null!=document.fullscreenElement})),b(E(e),"_updateQuality",(function(t){var r=e.props.player,n=e.state.qualities.map((function(r,n){return r.id===t?(e._setQuality(t),p(p({},r),{},{active:!0})):p(p({},r),{},{active:!1})}));r&&(e._toggleQualityPopup(),e.setState({qualities:n}))})),b(E(e),"_toggleQualityPopup",(function(){var t=e._getElementById("vpcc-quality"),r=a()(t,"children[0]","");r&&(r.style.display="grid"===r.style.display?"none":"grid");var n=e._getElementById("vpcc-subtitle"),i=a()(n,"children[0]","");i&&(i.style.display="none")})),b(E(e),"_updateSubtitle",(function(t){var r=e.props.player,n=e.state.subtitles.map((function(r){return r.id===t&&e._setSubtitle(r.id),p(p({},r),{},{active:r.id===t})}));r&&(e._toggleSubtitlePopup(),e.setState({subtitles:n}))})),b(E(e),"_toggleSubtitlePopup",(function(){var t=e._getElementById("vpcc-subtitle"),r=a()(t,"children[0]","");r&&(r.style.display="grid"===r.style.display?"none":"grid");var n=e._getElementById("vpcc-quality"),i=a()(n,"children[0]","");i&&(i.style.display="none")})),b(E(e),"_seekToLive",(function(){var t=e.props.player;if(t){var r=t&&t.getMediaElement();r&&(r.currentTime=t.seekRange().end)}})),b(E(e),"_seekTo",(function(t){var r=e.props.player,n=r&&r.isLive();if(r&&!n){var i=r&&r.getMediaElement();i&&e.props.config.seekBarEnabled&&(i.pause(),e._debounce((function(){i.currentTime+w*t<0?i.currentTime=0:i.currentTime+w*t>i.duration?i.currentTime=i.duration:i.currentTime+=w*t,w=0,i.play(),e.setState({isSkipFeedbackHidden:!0,skippedDuration:0})}),500),e.setState({isSkipFeedbackHidden:!1,skippedDuration:w*t}))}})),b(E(e),"_debounce",(function(e){clearTimeout(T),e&&(w+=1,T=setTimeout(e,500))})),b(E(e),"_skipVideo",(function(e){e&&e.id&&window&&(window.globalHistory?window.globalHistory.push("/watch?v=".concat(e.id,"&autoplay=1")):window.location.href="/watch?v=".concat(e.id,"&autoplay=1"))})),b(E(e),"renderFeedback",(function(){var t=e.props.player,r=t&&t.getMediaElement(),n=a()(r,"paused",!1),o=a()(r,"muted",!1),s=e.state,l=s.isMuteFeedbackHidden,c=s.isPlayPauseFeedbackHidden,d=s.isSkipFeedbackHidden,p=s.skippedDuration,f=s.isfullscreenFeedbackHidden;return i.a.createElement(u.b,{onClick:e.handleFeedbackOnClick},!d&&i.a.createElement("button",null,p>0?"+".concat(p,"s"):"".concat(p,"s")),!c&&i.a.createElement("button",null,n?"PLAY":"PAUSE"),!l&&i.a.createElement("button",null,o?"UNMUTE":"MUTED"),!f&&i.a.createElement("button",{className:"square"},e.isFullscreen()?"EXIT FULLSCREEN":"ENTER FULLSCREEN"))})),b(E(e),"renderCue",(function(){var t=e.state.cue,r=a()(e.props,"isPreroll",!1),n=a()(e.props,"isHover",!1);return i.a.createElement(i.a.Fragment,null,!t.hidden&&t.text&&!r&&i.a.createElement(u.a,{className:"".concat(n?"":"hide")},i.a.createElement(l.a,{source:t.text.replace(/-/g,""),escapeHtml:!1})))})),e}return r=c,(n=[{key:"componentDidMount",value:function(){var t=this.props.player;e.env.BROWSER&&t&&(this.handleQualityFilter(),this.handleSubtitleFilter(),this.initEventListeners(t),this.handleKeyboardEvent())}},{key:"componentWillUnmount",value:function(){this.props.config.keyboardShortcutsEnabled&&(document.onkeyup=null)}},{key:"render",value:function(){var e=this,t=this.props.player,r=a()(this.props,"isPreroll",!1),n=t&&t.isLive(),o=t&&t.getMediaElement(),s=a()(o,"paused",!1),l=isFinite(a()(o,"duration",0))?a()(o,"duration",0):0,c=isFinite(a()(o,"currentTime",0))?a()(o,"currentTime",0):0,d=a()(o,"volume",0),p=a()(o,"muted",!1),f=this.state,h=f.bufferedPercentage,m=f.qualities,g=f.subtitles,y=n?"100%":"".concat(c/l*100,"%"),_="".concat(c/l*100,"%"),v=n&&r||!n,E=this.props.recommendation;return i.a.createElement(i.a.Fragment,null,this.renderFeedback(),this.renderCue(),i.a.createElement("div",{id:"vpcc-custom-controller-".concat(this.props.id),refs:function(t){return e.rootController=t},className:"".concat(u.e," ").concat(this.props.isHover?"":"hide")},i.a.createElement("div",{className:"duration"},n&&!r&&i.a.createElement("p",{className:"live_text",onClick:this._seekToLive},"LIVE"),n&&!r&&i.a.createElement("span",{onClick:this._seekToLive,className:"live_indicator"},i.a.createElement("div",{className:"live_indicator_beckground"})),v&&this._formatTime(l-c)),i.a.createElement("div",{className:"progress"},i.a.createElement("div",{className:"progress_wrapper"},i.a.createElement("div",{className:"progressbar_progress",style:{width:r?_:y}}),i.a.createElement("div",{className:"progressbar_progress_buffer",style:{width:"".concat(r?0:h,"%")}}),i.a.createElement("div",{className:"progressbar_progress_background"}),i.a.createElement("input",{className:"seek",id:"vpcc-seek",value:c,min:"0",max:l,type:"range",step:"0.01",onChange:this._updateSeekValue}),!n&&!r&&i.a.createElement("div",{className:"tooltip",id:"vpcc-seek-tooltip"},"00:00"))),i.a.createElement("div",{className:"bottom_left_section"},i.a.createElement(u.c,{className:"".concat(s?"playIcon":"pauseIcon"," ").concat(this.props.config.togglePlayPauseEnabled?"":"disabled"),onClick:this._togglePlayPause},i.a.createElement("div",{className:"tooltip withTooltip"},s?"Play":"Pause"," (p)")),!n&&!r&&i.a.createElement(i.a.Fragment,null,i.a.createElement(u.c,{className:"forwardIcon ".concat(this.props.config.seekBarEnabled?"":"disabled"),onClick:function(){return e._seekTo(10)}},i.a.createElement("div",{className:"tooltip withTooltip"},"Forward ()")),i.a.createElement(u.c,{className:"backwardIcon ".concat(this.props.config.seekBarEnabled?"":"disabled"),onClick:function(){return e._seekTo(-10)}},i.a.createElement("div",{className:"tooltip withTooltip"},"Backward ()"))),E&&!r&&i.a.createElement(u.c,{className:"upcommingIcon",onClick:function(){return e._skipVideo(E)}},i.a.createElement("div",{className:"tooltip withTooltip"},"Skip To Next Video")),i.a.createElement("div",{className:"volume"},i.a.createElement(u.c,{id:"volume-button",className:"".concat(p||0==d?"mutedIcon":"muteIcon"," ").concat(this.props.config.toggleMuteEnabled?"":"disabled"),onClick:this._toggleMute},i.a.createElement("div",{className:"tooltip withTooltip"},p?"Unmute":"Mute"," (m)")),this.props.config.volumeBarEnabled&&i.a.createElement("div",{className:"progress"},i.a.createElement("div",{className:"progress_wrapper"},i.a.createElement("div",{className:"progressbar_progress",style:{width:"".concat(100*d,"%")}},i.a.createElement("span",{className:"progressbar_dot",style:{opacity:c/l==0?0:1}})),i.a.createElement("div",{className:"progressbar_progress_background"}),i.a.createElement(u.d,null,i.a.createElement("input",{className:"slider seek",id:"vpcc-volume",value:d,type:"range",max:"1",min:"0",step:"0.01",onChange:this._updateVolume})))))),i.a.createElement("div",{className:"bottom_right_section"},!r&&m.length>1&&i.a.createElement(u.c,{id:"vpcc-quality",className:"gearIcon",onClick:this._toggleQualityPopup},i.a.createElement("div",{className:"quality_popup"},i.a.createElement("div",{className:"quality_title"},"Qualities"),m.map((function(t){return i.a.createElement("div",{className:"quality_list ".concat(t.active?"active":""),onClick:function(){return e._updateQuality(t.id)}},t.active&&i.a.createElement("div",{className:"quality_tick_wrapper"},i.a.createElement(u.c,{className:"tickIcon",onClick:e._toggleQualityPopup})),t.height)})))),!r&&g.length>1&&i.a.createElement(u.c,{id:"vpcc-subtitle",className:"chatIcon",onClick:this._toggleSubtitlePopup},i.a.createElement("div",{className:"subtitle_popup"},i.a.createElement("div",{className:"subtitle_title"},"Subtitles"),g.map((function(t){return i.a.createElement(i.a.Fragment,null,t.name&&i.a.createElement("div",{className:"subtitle_list ".concat(t.active?"active":""),onClick:function(){return e._updateSubtitle(t.id)}},t.active&&i.a.createElement("div",{className:"subtitle_tick_wrapper"},i.a.createElement(u.c,{className:"tickIcon",onClick:e._toggleSubtitlePopup})),t.name))})))),i.a.createElement(u.c,{id:"vpcc-fullscreen",className:"".concat(this.isFullscreen()?"exitFullscreenIcon":"enterFullscreenIcon"," ").concat(this.props.config.toggleFullscreenEnabled?"":"disabled"),onClick:this._toggleFullscreen},i.a.createElement("div",{className:"tooltip withTooltip"},this.isFullscreen()?"Exit Fullscreen":"Enter Fullscreen"," (f)")))))}}])&&g(r.prototype,n),o&&g(r,o),c}(n.Component);t.a=M}).call(this,r(13))},function(e,t,r){"use strict";function n(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var i=r(12),o=r(185),a=r(198),s=r(2),l=r(253),u=r(255),c=r(256),d=r(257),p=r(260),f=r(261),h=r(262),m=r(263),g=r(264),y=Object.keys(m),_=function(e){var t=e.source||e.children||"",r=e.parserOptions;if(e.allowedTypes&&e.disallowedTypes)throw new Error("Only one of `allowedTypes` and `disallowedTypes` should be defined");var n=i(m,e.renderers),s=[[a,r]].concat(e.plugins||[]).reduce(v,o()),h=s.parse(t),_=i(e,{renderers:n,definitions:f(h)}),E=function(e){var t=[p,l()],r=e.disallowedTypes;e.allowedTypes&&(r=y.filter((function(t){return"root"!==t&&-1===e.allowedTypes.indexOf(t)})));var n=e.unwrapDisallowed?"unwrap":"remove";r&&r.length>0&&t.push(c.ofType(r,n));e.allowNode&&t.push(c.ifNotMatch(e.allowNode,n));var i=!e.escapeHtml&&!e.skipHtml,o=(e.astPlugins||[]).some((function(e){return(Array.isArray(e)?e[0]:e).identity===g.HtmlParser}));i&&!o&&t.push(u);return e.astPlugins?t.concat(e.astPlugins):t}(e),S=s.runSync(h),b=E.reduce((function(e,t){return t(e,_)}),S);return d(b,_)};function v(e,t){return Array.isArray(t)?e.use.apply(e,n(t)):e.use(t)}_.defaultProps={renderers:{},escapeHtml:!0,skipHtml:!1,sourcePos:!1,rawSourcePos:!1,transformLinkUri:h,astPlugins:[],plugins:[],parserOptions:{}},_.propTypes={className:s.string,source:s.string,children:s.string,sourcePos:s.bool,rawSourcePos:s.bool,escapeHtml:s.bool,skipHtml:s.bool,allowNode:s.func,allowedTypes:s.arrayOf(s.oneOf(y)),disallowedTypes:s.arrayOf(s.oneOf(y)),transformLinkUri:s.oneOfType([s.func,s.bool]),linkTarget:s.oneOfType([s.func,s.string]),transformImageUri:s.func,astPlugins:s.arrayOf(s.func),unwrapDisallowed:s.bool,renderers:s.object,plugins:s.array,parserOptions:s.object},_.types=y,_.renderers=m,_.uriTransformer=h,e.exports=_},function(e,t,r){"use strict";var n=r(31),i={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1};var o=function(e){for(var t,r=e.length,n=r^r,i=0;r>=4;)t=1540483477*(65535&(t=255&e.charCodeAt(i)|(255&e.charCodeAt(++i))<<8|(255&e.charCodeAt(++i))<<16|(255&e.charCodeAt(++i))<<24))+((1540483477*(t>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(t=1540483477*(65535&(t^=t>>>24))+((1540483477*(t>>>16)&65535)<<16)),r-=4,++i;switch(r){case 3:n^=(255&e.charCodeAt(i+2))<<16;case 2:n^=(255&e.charCodeAt(i+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(i)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),((n^=n>>>15)>>>0).toString(36)};var a=function(e){function t(e,t,n){var i=t.trim().split(h);t=i;var o=i.length,a=e.length;switch(a){case 0:case 1:var s=0;for(e=0===a?"":e[0]+" ";s<o;++s)t[s]=r(e,t[s],n).trim();break;default:var l=s=0;for(t=[];s<o;++s)for(var u=0;u<a;++u)t[l++]=r(e[u]+" ",i[s],n).trim()}return t}function r(e,t,r){var n=t.charCodeAt(0);switch(33>n&&(n=(t=t.trim()).charCodeAt(0)),n){case 38:return t.replace(m,"$1"+e.trim());case 58:return e.trim()+t.replace(m,"$1"+e.trim());default:if(0<1*r&&0<t.indexOf("\f"))return t.replace(m,(58===e.charCodeAt(0)?"":"$1")+e.trim())}return e+t}function n(e,t,r,o){var a=e+";",s=2*t+3*r+4*o;if(944===s){e=a.indexOf(":",9)+1;var l=a.substring(e,a.length-1).trim();return l=a.substring(0,e).trim()+l+";",1===C||2===C&&i(l,1)?"-webkit-"+l+l:l}if(0===C||2===C&&!i(a,1))return a;switch(s){case 1015:return 97===a.charCodeAt(10)?"-webkit-"+a+a:a;case 951:return 116===a.charCodeAt(3)?"-webkit-"+a+a:a;case 963:return 110===a.charCodeAt(5)?"-webkit-"+a+a:a;case 1009:if(100!==a.charCodeAt(4))break;case 969:case 942:return"-webkit-"+a+a;case 978:return"-webkit-"+a+"-moz-"+a+a;case 1019:case 983:return"-webkit-"+a+"-moz-"+a+"-ms-"+a+a;case 883:if(45===a.charCodeAt(8))return"-webkit-"+a+a;if(0<a.indexOf("image-set(",11))return a.replace(M,"$1-webkit-$2")+a;break;case 932:if(45===a.charCodeAt(4))switch(a.charCodeAt(5)){case 103:return"-webkit-box-"+a.replace("-grow","")+"-webkit-"+a+"-ms-"+a.replace("grow","positive")+a;case 115:return"-webkit-"+a+"-ms-"+a.replace("shrink","negative")+a;case 98:return"-webkit-"+a+"-ms-"+a.replace("basis","preferred-size")+a}return"-webkit-"+a+"-ms-"+a+a;case 964:return"-webkit-"+a+"-ms-flex-"+a+a;case 1023:if(99!==a.charCodeAt(8))break;return"-webkit-box-pack"+(l=a.substring(a.indexOf(":",15)).replace("flex-","").replace("space-between","justify"))+"-webkit-"+a+"-ms-flex-pack"+l+a;case 1005:return p.test(a)?a.replace(d,":-webkit-")+a.replace(d,":-moz-")+a:a;case 1e3:switch(t=(l=a.substring(13).trim()).indexOf("-")+1,l.charCodeAt(0)+l.charCodeAt(t)){case 226:l=a.replace(v,"tb");break;case 232:l=a.replace(v,"tb-rl");break;case 220:l=a.replace(v,"lr");break;default:return a}return"-webkit-"+a+"-ms-"+l+a;case 1017:if(-1===a.indexOf("sticky",9))break;case 975:switch(t=(a=e).length-10,s=(l=(33===a.charCodeAt(t)?a.substring(0,t):a).substring(e.indexOf(":",7)+1).trim()).charCodeAt(0)+(0|l.charCodeAt(7))){case 203:if(111>l.charCodeAt(8))break;case 115:a=a.replace(l,"-webkit-"+l)+";"+a;break;case 207:case 102:a=a.replace(l,"-webkit-"+(102<s?"inline-":"")+"box")+";"+a.replace(l,"-webkit-"+l)+";"+a.replace(l,"-ms-"+l+"box")+";"+a}return a+";";case 938:if(45===a.charCodeAt(5))switch(a.charCodeAt(6)){case 105:return l=a.replace("-items",""),"-webkit-"+a+"-webkit-box-"+l+"-ms-flex-"+l+a;case 115:return"-webkit-"+a+"-ms-flex-item-"+a.replace(b,"")+a;default:return"-webkit-"+a+"-ms-flex-line-pack"+a.replace("align-content","").replace(b,"")+a}break;case 973:case 989:if(45!==a.charCodeAt(3)||122===a.charCodeAt(4))break;case 931:case 953:if(!0===w.test(e))return 115===(l=e.substring(e.indexOf(":")+1)).charCodeAt(0)?n(e.replace("stretch","fill-available"),t,r,o).replace(":fill-available",":stretch"):a.replace(l,"-webkit-"+l)+a.replace(l,"-moz-"+l.replace("fill-",""))+a;break;case 962:if(a="-webkit-"+a+(102===a.charCodeAt(5)?"-ms-"+a:"")+a,211===r+o&&105===a.charCodeAt(13)&&0<a.indexOf("transform",10))return a.substring(0,a.indexOf(";",27)+1).replace(f,"$1-webkit-$2")+a}return a}function i(e,t){var r=e.indexOf(1===t?":":"{"),n=e.substring(0,3!==t?r:10);return r=e.substring(r+1,e.length-1),k(2!==t?n:n.replace(T,"$1"),r,t)}function o(e,t){var r=n(t,t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2));return r!==t+";"?r.replace(S," or ($1)").substring(4):"("+t+")"}function a(e,t,r,n,i,o,a,s,u,c){for(var d,p=0,f=t;p<D;++p)switch(d=N[p].call(l,e,f,r,n,i,o,a,s,u,c)){case void 0:case!1:case!0:case null:break;default:f=d}if(f!==t)return f}function s(e){return void 0!==(e=e.prefix)&&(k=null,e?"function"!=typeof e?C=1:(C=2,k=e):C=0),s}function l(e,r){var s=e;if(33>s.charCodeAt(0)&&(s=s.trim()),s=[s],0<D){var l=a(-1,r,s,s,P,x,0,0,0,0);void 0!==l&&"string"==typeof l&&(r=l)}var d=function e(r,s,l,d,p){for(var f,h,m,v,S,b=0,T=0,w=0,M=0,N=0,k=0,R=m=f=0,O=0,U=0,j=0,F=0,B=l.length,z=B-1,V="",G="",H="",K="";O<B;){if(h=l.charCodeAt(O),O===z&&0!==T+M+w+b&&(0!==T&&(h=47===T?10:47),M=w=b=0,B++,z++),0===T+M+w+b){if(O===z&&(0<U&&(V=V.replace(c,"")),0<V.trim().length)){switch(h){case 32:case 9:case 59:case 13:case 10:break;default:V+=l.charAt(O)}h=59}switch(h){case 123:for(f=(V=V.trim()).charCodeAt(0),m=1,F=++O;O<B;){switch(h=l.charCodeAt(O)){case 123:m++;break;case 125:m--;break;case 47:switch(h=l.charCodeAt(O+1)){case 42:case 47:e:{for(R=O+1;R<z;++R)switch(l.charCodeAt(R)){case 47:if(42===h&&42===l.charCodeAt(R-1)&&O+2!==R){O=R+1;break e}break;case 10:if(47===h){O=R+1;break e}}O=R}}break;case 91:h++;case 40:h++;case 34:case 39:for(;O++<z&&l.charCodeAt(O)!==h;);}if(0===m)break;O++}switch(m=l.substring(F,O),0===f&&(f=(V=V.replace(u,"").trim()).charCodeAt(0)),f){case 64:switch(0<U&&(V=V.replace(c,"")),h=V.charCodeAt(1)){case 100:case 109:case 115:case 45:U=s;break;default:U=A}if(F=(m=e(s,U,m,h,p+1)).length,0<D&&(S=a(3,m,U=t(A,V,j),s,P,x,F,h,p,d),V=U.join(""),void 0!==S&&0===(F=(m=S.trim()).length)&&(h=0,m="")),0<F)switch(h){case 115:V=V.replace(E,o);case 100:case 109:case 45:m=V+"{"+m+"}";break;case 107:m=(V=V.replace(g,"$1 $2"))+"{"+m+"}",m=1===C||2===C&&i("@"+m,3)?"@-webkit-"+m+"@"+m:"@"+m;break;default:m=V+m,112===d&&(G+=m,m="")}else m="";break;default:m=e(s,t(s,V,j),m,d,p+1)}H+=m,m=j=U=R=f=0,V="",h=l.charCodeAt(++O);break;case 125:case 59:if(1<(F=(V=(0<U?V.replace(c,""):V).trim()).length))switch(0===R&&(f=V.charCodeAt(0),45===f||96<f&&123>f)&&(F=(V=V.replace(" ",":")).length),0<D&&void 0!==(S=a(1,V,s,r,P,x,G.length,d,p,d))&&0===(F=(V=S.trim()).length)&&(V="\0\0"),f=V.charCodeAt(0),h=V.charCodeAt(1),f){case 0:break;case 64:if(105===h||99===h){K+=V+l.charAt(O);break}default:58!==V.charCodeAt(F-1)&&(G+=n(V,f,h,V.charCodeAt(2)))}j=U=R=f=0,V="",h=l.charCodeAt(++O)}}switch(h){case 13:case 10:47===T?T=0:0===1+f&&107!==d&&0<V.length&&(U=1,V+="\0"),0<D*L&&a(0,V,s,r,P,x,G.length,d,p,d),x=1,P++;break;case 59:case 125:if(0===T+M+w+b){x++;break}default:switch(x++,v=l.charAt(O),h){case 9:case 32:if(0===M+b+T)switch(N){case 44:case 58:case 9:case 32:v="";break;default:32!==h&&(v=" ")}break;case 0:v="\\0";break;case 12:v="\\f";break;case 11:v="\\v";break;case 38:0===M+T+b&&(U=j=1,v="\f"+v);break;case 108:if(0===M+T+b+I&&0<R)switch(O-R){case 2:112===N&&58===l.charCodeAt(O-3)&&(I=N);case 8:111===k&&(I=k)}break;case 58:0===M+T+b&&(R=O);break;case 44:0===T+w+M+b&&(U=1,v+="\r");break;case 34:case 39:0===T&&(M=M===h?0:0===M?h:M);break;case 91:0===M+T+w&&b++;break;case 93:0===M+T+w&&b--;break;case 41:0===M+T+b&&w--;break;case 40:if(0===M+T+b){if(0===f)switch(2*N+3*k){case 533:break;default:f=1}w++}break;case 64:0===T+w+M+b+R+m&&(m=1);break;case 42:case 47:if(!(0<M+b+w))switch(T){case 0:switch(2*h+3*l.charCodeAt(O+1)){case 235:T=47;break;case 220:F=O,T=42}break;case 42:47===h&&42===N&&F+2!==O&&(33===l.charCodeAt(F+2)&&(G+=l.substring(F,O+1)),v="",T=0)}}0===T&&(V+=v)}k=N,N=h,O++}if(0<(F=G.length)){if(U=s,0<D&&(void 0!==(S=a(2,G,U,r,P,x,F,d,p,d))&&0===(G=S).length))return K+G+H;if(G=U.join(",")+"{"+G+"}",0!=C*I){switch(2!==C||i(G,2)||(I=0),I){case 111:G=G.replace(_,":-moz-$1")+G;break;case 112:G=G.replace(y,"::-webkit-input-$1")+G.replace(y,"::-moz-$1")+G.replace(y,":-ms-input-$1")+G}I=0}}return K+G+H}(A,s,r,0,0);return 0<D&&(void 0!==(l=a(-2,d,s,s,P,x,d.length,0,0,0))&&(d=l)),"",I=0,x=P=1,d}var u=/^\0+/g,c=/[\0\r\f]/g,d=/: */g,p=/zoo|gra/,f=/([,: ])(transform)/g,h=/,\r+?/g,m=/([\t\r\n ])*\f?&/g,g=/@(k\w+)\s*(\S*)\s*/,y=/::(place)/g,_=/:(read-only)/g,v=/[svh]\w+-[tblr]{2}/,E=/\(\s*(.*)\s*\)/g,S=/([\s\S]*?);/g,b=/-self|flex-/g,T=/[^]*?(:[rp][el]a[\w-]+)[^]*/,w=/stretch|:\s*\w+\-(?:conte|avail)/,M=/([^-])(image-set\()/,x=1,P=1,I=0,C=1,A=[],N=[],D=0,k=null,L=0;return l.use=function e(t){switch(t){case void 0:case null:D=N.length=0;break;default:switch(t.constructor){case Array:for(var r=0,n=t.length;r<n;++r)e(t[r]);break;case Function:N[D++]=t;break;case Boolean:L=0|!!t}}return e},l.set=s,void 0!==e&&s(e),l},s=r(94),l=r.n(s),u=/[A-Z]|^ms/g,c=Object(n.a)((function(e){return e.replace(u,"-$&").toLowerCase()})),d=function(e,t){return null==t||"boolean"==typeof t?"":1===i[e]||45===e.charCodeAt(1)||isNaN(t)||0===t?t:t+"px"},p=function e(t){for(var r=t.length,n=0,i="";n<r;n++){var o=t[n];if(null!=o){var a=void 0;switch(typeof o){case"boolean":break;case"function":0,a=e([o()]);break;case"object":if(Array.isArray(o))a=e(o);else for(var s in a="",o)o[s]&&s&&(a&&(a+=" "),a+=s);break;default:a=o}a&&(i&&(i+=" "),i+=a)}}return i},f="undefined"!=typeof document;function h(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key||""),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),(void 0!==e.container?e.container:document.head).appendChild(t),t}var m=function(){function e(e){this.isSpeedy=!0,this.tags=[],this.ctr=0,this.opts=e}var t=e.prototype;return t.inject=function(){if(this.injected)throw new Error("already injected!");this.tags[0]=h(this.opts),this.injected=!0},t.speedy=function(e){if(0!==this.ctr)throw new Error("cannot change speedy now");this.isSpeedy=!!e},t.insert=function(e,t){if(this.isSpeedy){var r=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(this.tags[this.tags.length-1]);try{r.insertRule(e,r.cssRules.length)}catch(e){0}}else{var n=h(this.opts);this.tags.push(n),n.appendChild(document.createTextNode(e+(t||"")))}this.ctr++,this.ctr%65e3==0&&this.tags.push(h(this.opts))},t.flush=function(){this.tags.forEach((function(e){return e.parentNode.removeChild(e)})),this.tags=[],this.ctr=0,this.injected=!1},e}();t.a=function(e,t){if(void 0!==e.__SECRET_EMOTION__)return e.__SECRET_EMOTION__;void 0===t&&(t={});var r,n,i=t.key||"css",s=l()((function(e){r+=e,f&&h.insert(e,y)}));void 0!==t.prefix&&(n={prefix:t.prefix});var u={registered:{},inserted:{},nonce:t.nonce,key:i},h=new m(t);f&&h.inject();var g=new a(n);g.use(t.stylisPlugins)(s);var y="";function _(e,t){if(null==e)return"";switch(typeof e){case"boolean":return"";case"function":if(void 0!==e.__emotion_styles){var r=e.toString();return r}return _.call(this,void 0===this?e():e(this.mergedProps,this.context),t);case"object":return b.call(this,e);default:var n=u.registered[e];return!1===t&&void 0!==n?n:e}}var v,E,S=new WeakMap;function b(e){if(S.has(e))return S.get(e);var t="";return Array.isArray(e)?e.forEach((function(e){t+=_.call(this,e,!1)}),this):Object.keys(e).forEach((function(r){"object"!=typeof e[r]?void 0!==u.registered[e[r]]?t+=r+"{"+u.registered[e[r]]+"}":t+=c(r)+":"+d(r,e[r])+";":Array.isArray(e[r])&&"string"==typeof e[r][0]&&void 0===u.registered[e[r][0]]?e[r].forEach((function(e){t+=c(r)+":"+d(r,e)+";"})):t+=r+"{"+_.call(this,e[r],!1)+"}"}),this),S.set(e,t),t}var T=/label:\s*([^\s;\n{]+)\s*;/g,w=function(e,t){return o(e+t)+t},M=function(e){var t=!0,r="",n="";null==e||void 0===e.raw?(t=!1,r+=_.call(this,e,!1)):r+=e[0];for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return o.forEach((function(n,i){r+=_.call(this,n,46===r.charCodeAt(r.length-1)),!0===t&&void 0!==e[i+1]&&(r+=e[i+1])}),this),E=r,r=r.replace(T,(function(e,t){return n+="-"+t,""})),v=w(r,n),r};function x(e,t){void 0===u.inserted[v]&&(r="",g(e,t),u.inserted[v]=r)}var P=function(){var e=M.apply(this,arguments),t=i+"-"+v;return void 0===u.registered[t]&&(u.registered[t]=E),x("."+t,e),t};function I(e,t){var r="";return t.split(" ").forEach((function(t){void 0!==u.registered[t]?e.push(t):r+=t+" "})),r}function C(e,t){var r=[],n=I(r,e);return r.length<2?e:n+P(r,t)}function A(e){u.inserted[e]=!0}if(f){var N=document.querySelectorAll("[data-emotion-"+i+"]");Array.prototype.forEach.call(N,(function(e){h.tags[0].parentNode.insertBefore(e,h.tags[0]),e.getAttribute("data-emotion-"+i).split(" ").forEach(A)}))}var D={flush:function(){f&&(h.flush(),h.inject()),u.inserted={},u.registered={}},hydrate:function(e){e.forEach(A)},cx:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return C(p(t))},merge:C,getRegisteredStyles:I,injectGlobal:function(){var e=M.apply(this,arguments);x("",e)},keyframes:function(){var e=M.apply(this,arguments),t="animation-"+v;return x("","@keyframes "+t+"{"+e+"}"),t},css:P,sheet:h,caches:u};return e.__SECRET_EMOTION__=D,D}},function(e,t,r){"use strict";
/** @license React v16.13.1
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=r(99),i="function"==typeof Symbol&&Symbol.for,o=i?Symbol.for("react.element"):60103,a=i?Symbol.for("react.portal"):60106,s=i?Symbol.for("react.fragment"):60107,l=i?Symbol.for("react.strict_mode"):60108,u=i?Symbol.for("react.profiler"):60114,c=i?Symbol.for("react.provider"):60109,d=i?Symbol.for("react.context"):60110,p=i?Symbol.for("react.forward_ref"):60112,f=i?Symbol.for("react.suspense"):60113,h=i?Symbol.for("react.memo"):60115,m=i?Symbol.for("react.lazy"):60116,g="function"==typeof Symbol&&Symbol.iterator;function y(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v={};function E(e,t,r){this.props=e,this.context=t,this.refs=v,this.updater=r||_}function S(){}function b(e,t,r){this.props=e,this.context=t,this.refs=v,this.updater=r||_}E.prototype.isReactComponent={},E.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(y(85));this.updater.enqueueSetState(this,e,t,"setState")},E.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},S.prototype=E.prototype;var T=b.prototype=new S;T.constructor=b,n(T,E.prototype),T.isPureReactComponent=!0;var w={current:null},M=Object.prototype.hasOwnProperty,x={key:!0,ref:!0,__self:!0,__source:!0};function P(e,t,r){var n,i={},a=null,s=null;if(null!=t)for(n in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)M.call(t,n)&&!x.hasOwnProperty(n)&&(i[n]=t[n]);var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){for(var u=Array(l),c=0;c<l;c++)u[c]=arguments[c+2];i.children=u}if(e&&e.defaultProps)for(n in l=e.defaultProps)void 0===i[n]&&(i[n]=l[n]);return{$$typeof:o,type:e,key:a,ref:s,props:i,_owner:w.current}}function I(e){return"object"==typeof e&&null!==e&&e.$$typeof===o}var C=/\/+/g,A=[];function N(e,t,r,n){if(A.length){var i=A.pop();return i.result=e,i.keyPrefix=t,i.func=r,i.context=n,i.count=0,i}return{result:e,keyPrefix:t,func:r,context:n,count:0}}function D(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>A.length&&A.push(e)}function k(e,t,r){return null==e?0:function e(t,r,n,i){var s=typeof t;"undefined"!==s&&"boolean"!==s||(t=null);var l=!1;if(null===t)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case o:case a:l=!0}}if(l)return n(i,t,""===r?"."+L(t,0):r),1;if(l=0,r=""===r?".":r+":",Array.isArray(t))for(var u=0;u<t.length;u++){var c=r+L(s=t[u],u);l+=e(s,c,n,i)}else if(null===t||"object"!=typeof t?c=null:c="function"==typeof(c=g&&t[g]||t["@@iterator"])?c:null,"function"==typeof c)for(t=c.call(t),u=0;!(s=t.next()).done;)l+=e(s=s.value,c=r+L(s,u++),n,i);else if("object"===s)throw n=""+t,Error(y(31,"[object Object]"===n?"object with keys {"+Object.keys(t).join(", ")+"}":n,""));return l}(e,"",t,r)}function L(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}(e.key):t.toString(36)}function R(e,t){e.func.call(e.context,t,e.count++)}function O(e,t,r){var n=e.result,i=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?U(e,n,r,(function(e){return e})):null!=e&&(I(e)&&(e=function(e,t){return{$$typeof:o,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,i+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(C,"$&/")+"/")+r)),n.push(e))}function U(e,t,r,n,i){var o="";null!=r&&(o=(""+r).replace(C,"$&/")+"/"),k(e,O,t=N(t,o,n,i)),D(t)}var j={current:null};function F(){var e=j.current;if(null===e)throw Error(y(321));return e}var B={ReactCurrentDispatcher:j,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:w,IsSomeRendererActing:{current:!1},assign:n};t.Children={map:function(e,t,r){if(null==e)return e;var n=[];return U(e,n,null,t,r),n},forEach:function(e,t,r){if(null==e)return e;k(e,R,t=N(null,null,t,r)),D(t)},count:function(e){return k(e,(function(){return null}),null)},toArray:function(e){var t=[];return U(e,t,null,(function(e){return e})),t},only:function(e){if(!I(e))throw Error(y(143));return e}},t.Component=E,t.Fragment=s,t.Profiler=u,t.PureComponent=b,t.StrictMode=l,t.Suspense=f,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B,t.cloneElement=function(e,t,r){if(null==e)throw Error(y(267,e));var i=n({},e.props),a=e.key,s=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,l=w.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(c in t)M.call(t,c)&&!x.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==u?u[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){u=Array(c);for(var d=0;d<c;d++)u[d]=arguments[d+2];i.children=u}return{$$typeof:o,type:e.type,key:a,ref:s,props:i,_owner:l}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:d,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:c,_context:e},e.Consumer=e},t.createElement=P,t.createFactory=function(e){var t=P.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:p,render:e}},t.isValidElement=I,t.lazy=function(e){return{$$typeof:m,_ctor:e,_status:-1,_result:null}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return F().useCallback(e,t)},t.useContext=function(e,t){return F().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return F().useEffect(e,t)},t.useImperativeHandle=function(e,t,r){return F().useImperativeHandle(e,t,r)},t.useLayoutEffect=function(e,t){return F().useLayoutEffect(e,t)},t.useMemo=function(e,t){return F().useMemo(e,t)},t.useReducer=function(e,t,r){return F().useReducer(e,t,r)},t.useRef=function(e){return F().useRef(e)},t.useState=function(e){return F().useState(e)},t.version="16.13.1"},function(e,t,r){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function a(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(e){n[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var r,s,l=a(e),u=1;u<arguments.length;u++){for(var c in r=Object(arguments[u]))i.call(r,c)&&(l[c]=r[c]);if(n){s=n(r);for(var d=0;d<s.length;d++)o.call(r,s[d])&&(l[s[d]]=r[s[d]])}}return l}},function(e,t,r){"use strict";var n=r(101);function i(){}function o(){}o.resetWarningCache=i,e.exports=function(){function e(e,t,r,i,o,a){if(a!==n){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var r={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:i};return r.PropTypes=r,r}},function(e,t,r){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,r){var n=r(103),i=r(142);e.exports=function(e,t){for(var r=0,o=(t=n(t,e)).length;null!=e&&r<o;)e=e[i(t[r++])];return r&&r==o?e:void 0}},function(e,t,r){var n=r(33),i=r(104),o=r(109),a=r(139);e.exports=function(e,t){return n(e)?e:i(e,t)?[e]:o(a(e))}},function(e,t,r){var n=r(33),i=r(34),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;e.exports=function(e,t){if(n(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!i(e))||(a.test(e)||!o.test(e)||null!=t&&e in Object(t))}},function(e,t,r){(function(t){var r="object"==typeof t&&t&&t.Object===Object&&t;e.exports=r}).call(this,r(9))},function(e,t,r){var n=r(35),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=n?n.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),r=e[s];try{e[s]=void 0;var n=!0}catch(e){}var i=a.call(e);return n&&(t?e[s]=r:delete e[s]),i}},function(e,t){var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,r){var n=r(110),i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,a=n((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(i,(function(e,r,n,i){t.push(n?i.replace(o,"$1"):r||e)})),t}));e.exports=a},function(e,t,r){var n=r(111);e.exports=function(e){var t=n(e,(function(e){return 500===r.size&&r.clear(),e})),r=t.cache;return t}},function(e,t,r){var n=r(112);function i(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var a=e.apply(this,n);return r.cache=o.set(i,a)||o,a};return r.cache=new(i.Cache||n),r}i.Cache=n,e.exports=i},function(e,t,r){var n=r(113),i=r(134),o=r(136),a=r(137),s=r(138);function l(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}l.prototype.clear=n,l.prototype.delete=i,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,r){var n=r(114),i=r(126),o=r(133);e.exports=function(){this.size=0,this.__data__={hash:new n,map:new(o||i),string:new n}}},function(e,t,r){var n=r(115),i=r(122),o=r(123),a=r(124),s=r(125);function l(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}l.prototype.clear=n,l.prototype.delete=i,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,r){var n=r(20);e.exports=function(){this.__data__=n?n(null):{},this.size=0}},function(e,t,r){var n=r(117),i=r(118),o=r(63),a=r(120),s=/^\[object .+?Constructor\]$/,l=Function.prototype,u=Object.prototype,c=l.toString,d=u.hasOwnProperty,p=RegExp("^"+c.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||i(e))&&(n(e)?p:s).test(a(e))}},function(e,t,r){var n=r(61),i=r(63);e.exports=function(e){if(!i(e))return!1;var t=n(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(e,t,r){var n,i=r(119),o=(n=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!o&&o in e}},function(e,t,r){var n=r(36)["__core-js_shared__"];e.exports=n},function(e,t){var r=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return r.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,r){var n=r(20),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(n){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return i.call(t,e)?t[e]:void 0}},function(e,t,r){var n=r(20),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return n?void 0!==t[e]:i.call(t,e)}},function(e,t,r){var n=r(20);e.exports=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=n&&void 0===t?"__lodash_hash_undefined__":t,this}},function(e,t,r){var n=r(127),i=r(128),o=r(130),a=r(131),s=r(132);function l(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}l.prototype.clear=n,l.prototype.delete=i,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,r){var n=r(21),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,r=n(t,e);return!(r<0)&&(r==t.length-1?t.pop():i.call(t,r,1),--this.size,!0)}},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,r){var n=r(21);e.exports=function(e){var t=this.__data__,r=n(t,e);return r<0?void 0:t[r][1]}},function(e,t,r){var n=r(21);e.exports=function(e){return n(this.__data__,e)>-1}},function(e,t,r){var n=r(21);e.exports=function(e,t){var r=this.__data__,i=n(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this}},function(e,t,r){var n=r(62)(r(36),"Map");e.exports=n},function(e,t,r){var n=r(22);e.exports=function(e){var t=n(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,r){var n=r(22);e.exports=function(e){return n(this,e).get(e)}},function(e,t,r){var n=r(22);e.exports=function(e){return n(this,e).has(e)}},function(e,t,r){var n=r(22);e.exports=function(e,t){var r=n(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this}},function(e,t,r){var n=r(140);e.exports=function(e){return null==e?"":n(e)}},function(e,t,r){var n=r(35),i=r(141),o=r(33),a=r(34),s=n?n.prototype:void 0,l=s?s.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return i(t,e)+"";if(a(t))return l?l.call(t):"";var r=t+"";return"0"==r&&1/t==-1/0?"-0":r}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}},function(e,t,r){var n=r(34);e.exports=function(e){if("string"==typeof e||n(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},function(e,t,r){"use strict";var n=r(6),i=r(64),o=r(144),a=r(70);function s(e){var t=new o(e),r=i(o.prototype.request,t);return n.extend(r,o.prototype,t),n.extend(r,t),r}var l=s(r(67));l.Axios=o,l.create=function(e){return s(a(l.defaults,e))},l.Cancel=r(71),l.CancelToken=r(157),l.isCancel=r(66),l.all=function(e){return Promise.all(e)},l.spread=r(158),e.exports=l,e.exports.default=l},function(e,t,r){"use strict";var n=r(6),i=r(65),o=r(145),a=r(146),s=r(70);function l(e){this.defaults=e,this.interceptors={request:new o,response:new o}}l.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=s(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=[a,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)r=r.then(t.shift(),t.shift());return r},l.prototype.getUri=function(e){return e=s(this.defaults,e),i(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},n.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,r){return this.request(n.merge(r||{},{method:e,url:t}))}})),n.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,r,i){return this.request(n.merge(i||{},{method:e,url:t,data:r}))}})),e.exports=l},function(e,t,r){"use strict";var n=r(6);function i(){this.handlers=[]}i.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){n.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=i},function(e,t,r){"use strict";var n=r(6),i=r(147),o=r(66),a=r(67);function s(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return s(e),e.headers=e.headers||{},e.data=i(e.data,e.headers,e.transformRequest),e.headers=n.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),n.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||a.adapter)(e).then((function(t){return s(e),t.data=i(t.data,t.headers,e.transformResponse),t}),(function(t){return o(t)||(s(e),t&&t.response&&(t.response.data=i(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},function(e,t,r){"use strict";var n=r(6);e.exports=function(e,t,r){return n.forEach(r,(function(r){e=r(e,t)})),e}},function(e,t,r){"use strict";var n=r(6);e.exports=function(e,t){n.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))}},function(e,t,r){"use strict";var n=r(69);e.exports=function(e,t,r){var i=r.config.validateStatus;!i||i(r.status)?e(r):t(n("Request failed with status code "+r.status,r.config,null,r.request,r))}},function(e,t,r){"use strict";e.exports=function(e,t,r,n,i){return e.config=t,r&&(e.code=r),e.request=n,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(e,t,r){"use strict";var n=r(152),i=r(153);e.exports=function(e,t){return e&&!n(t)?i(e,t):t}},function(e,t,r){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,r){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,r){"use strict";var n=r(6),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,r,o,a={};return e?(n.forEach(e.split("\n"),(function(e){if(o=e.indexOf(":"),t=n.trim(e.substr(0,o)).toLowerCase(),r=n.trim(e.substr(o+1)),t){if(a[t]&&i.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([r]):a[t]?a[t]+", "+r:r}})),a):a}},function(e,t,r){"use strict";var n=r(6);e.exports=n.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function i(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=i(window.location.href),function(t){var r=n.isString(t)?i(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0}},function(e,t,r){"use strict";var n=r(6);e.exports=n.isStandardBrowserEnv()?{write:function(e,t,r,i,o,a){var s=[];s.push(e+"="+encodeURIComponent(t)),n.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),n.isString(i)&&s.push("path="+i),n.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,r){"use strict";var n=r(71);function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;e((function(e){r.reason||(r.reason=new n(e),t(r.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var e;return{token:new i((function(t){e=t})),cancel:e}},e.exports=i},function(e,t,r){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,r){(function(){"use strict";var e,n,i,o,a,s={}.hasOwnProperty;e=r(160),n=r(37).defaults,o=function(e){return"string"==typeof e&&(e.indexOf("&")>=0||e.indexOf(">")>=0||e.indexOf("<")>=0)},a=function(e){return"<![CDATA["+i(e)+"]]>"},i=function(e){return e.replace("]]>","]]]]><![CDATA[>")},t.Builder=function(){function t(e){var t,r,i;for(t in this.options={},r=n[.2])s.call(r,t)&&(i=r[t],this.options[t]=i);for(t in e)s.call(e,t)&&(i=e[t],this.options[t]=i)}return t.prototype.buildObject=function(t){var r,i,l,u,c,d;return r=this.options.attrkey,i=this.options.charkey,1===Object.keys(t).length&&this.options.rootName===n[.2].rootName?t=t[c=Object.keys(t)[0]]:c=this.options.rootName,d=this,l=function(e,t){var n,u,c,p,f,h;if("object"!=typeof t)d.options.cdata&&o(t)?e.raw(a(t)):e.txt(t);else if(Array.isArray(t)){for(p in t)if(s.call(t,p))for(f in u=t[p])c=u[f],e=l(e.ele(f),c).up()}else for(f in t)if(s.call(t,f))if(u=t[f],f===r){if("object"==typeof u)for(n in u)h=u[n],e=e.att(n,h)}else if(f===i)e=d.options.cdata&&o(u)?e.raw(a(u)):e.txt(u);else if(Array.isArray(u))for(p in u)s.call(u,p)&&(e="string"==typeof(c=u[p])?d.options.cdata&&o(c)?e.ele(f).raw(a(c)).up():e.ele(f,c).up():l(e.ele(f),c).up());else"object"==typeof u?e=l(e.ele(f),u).up():"string"==typeof u&&d.options.cdata&&o(u)?e=e.ele(f).raw(a(u)).up():(null==u&&(u=""),e=e.ele(f,u.toString()).up());return e},u=e.create(c,this.options.xmldec,this.options.doctype,{headless:this.options.headless,allowSurrogateChars:this.options.allowSurrogateChars}),l(u,t).end(this.options.renderOpts)},t}()}).call(this)},function(e,t,r){(function(){var t,n,i,o,a,s,l,u,c,d;d=r(11),u=d.assign,c=d.isFunction,i=r(72),o=r(73),a=r(166),l=r(51),s=r(167),t=r(4),n=r(24),e.exports.create=function(e,t,r,n){var i,a;if(null==e)throw new Error("Root element needs a name.");return n=u({},t,r,n),a=(i=new o(n)).element(e),n.headless||(i.declaration(n),null==n.pubID&&null==n.sysID||i.dtd(n)),a},e.exports.begin=function(e,t,r){var n;return c(e)&&(t=(n=[e,t])[0],r=n[1],e={}),t?new a(e,t,r):new o(e)},e.exports.stringWriter=function(e){return new l(e)},e.exports.streamWriter=function(e,t){return new s(e,t)},e.exports.implementation=new i,e.exports.nodeType=t,e.exports.writerState=n}).call(this)},function(e,t,r){(function(){var t,n;t=r(162),n=r(163),e.exports=function(){function e(){this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new t,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=Object.create(this.defaultParams)}return Object.defineProperty(e.prototype,"parameterNames",{get:function(){return new n(Object.keys(this.defaultParams))}}),e.prototype.getParameter=function(e){return this.params.hasOwnProperty(e)?this.params[e]:null},e.prototype.canSetParameter=function(e,t){return!0},e.prototype.setParameter=function(e,t){return null!=t?this.params[e]=t:delete this.params[e]},e}()}).call(this)},function(e,t){(function(){e.exports=function(){function e(){}return e.prototype.handleError=function(e){throw new Error(e)},e}()}).call(this)},function(e,t){(function(){e.exports=function(){function e(e){this.arr=e||[]}return Object.defineProperty(e.prototype,"length",{get:function(){return this.arr.length}}),e.prototype.item=function(e){return this.arr[e]||null},e.prototype.contains=function(e){return-1!==this.arr.indexOf(e)},e}()}).call(this)},function(e,t){(function(){e.exports=function(){function e(e){this.nodes=e}return Object.defineProperty(e.prototype,"length",{get:function(){return this.nodes.length||0}}),e.prototype.clone=function(){return this.nodes=null},e.prototype.item=function(e){return this.nodes[e]||null},e}()}).call(this)},function(e,t){(function(){e.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(this)},function(e,t,r){(function(){var t,n,i,o,a,s,l,u,c,d,p,f,h,m,g,y,_,v,E,S,b,T,w,M={}.hasOwnProperty;w=r(11),b=w.isObject,S=w.isFunction,T=w.isPlainObject,E=w.getValue,t=r(4),f=r(73),h=r(38),o=r(40),a=r(41),g=r(48),v=r(49),m=r(50),d=r(42),p=r(43),s=r(44),u=r(45),l=r(46),c=r(47),i=r(74),_=r(76),y=r(51),n=r(24),e.exports=function(){function e(e,r,n){var i;this.name="?xml",this.type=t.Document,e||(e={}),i={},e.writer?T(e.writer)&&(i=e.writer,e.writer=new y):e.writer=new y,this.options=e,this.writer=e.writer,this.writerOptions=this.writer.filterOptions(i),this.stringify=new _(e),this.onDataCallback=r||function(){},this.onEndCallback=n||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}return e.prototype.createChildNode=function(e){var r,n,i,o,a,s,l,u;switch(e.type){case t.CData:this.cdata(e.value);break;case t.Comment:this.comment(e.value);break;case t.Element:for(n in i={},l=e.attribs)M.call(l,n)&&(r=l[n],i[n]=r.value);this.node(e.name,i);break;case t.Dummy:this.dummy();break;case t.Raw:this.raw(e.value);break;case t.Text:this.text(e.value);break;case t.ProcessingInstruction:this.instruction(e.target,e.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+e.constructor.name)}for(a=0,s=(u=e.children).length;a<s;a++)o=u[a],this.createChildNode(o),o.type===t.Element&&this.up();return this},e.prototype.dummy=function(){return this},e.prototype.node=function(e,t,r){var n;if(null==e)throw new Error("Missing node name.");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node. "+this.debugInfo(e));return this.openCurrent(),e=E(e),null==t&&(t={}),t=E(t),b(t)||(r=(n=[t,r])[0],t=n[1]),this.currentNode=new h(this,e,t),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=r&&this.text(r),this},e.prototype.element=function(e,r,n){var i,o,a,s,l,u;if(this.currentNode&&this.currentNode.type===t.DocType)this.dtdElement.apply(this,arguments);else if(Array.isArray(e)||b(e)||S(e))for(s=this.options.noValidation,this.options.noValidation=!0,(u=new f(this.options).element("TEMP_ROOT")).element(e),this.options.noValidation=s,o=0,a=(l=u.children).length;o<a;o++)i=l[o],this.createChildNode(i),i.type===t.Element&&this.up();else this.node(e,r,n);return this},e.prototype.attribute=function(e,t){var r,n;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(e));if(null!=e&&(e=E(e)),b(e))for(r in e)M.call(e,r)&&(n=e[r],this.attribute(r,n));else S(t)&&(t=t.apply()),this.options.keepNullAttributes&&null==t?this.currentNode.attribs[e]=new i(this,e,""):null!=t&&(this.currentNode.attribs[e]=new i(this,e,t));return this},e.prototype.text=function(e){var t;return this.openCurrent(),t=new v(this,e),this.onData(this.writer.text(t,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.cdata=function(e){var t;return this.openCurrent(),t=new o(this,e),this.onData(this.writer.cdata(t,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.comment=function(e){var t;return this.openCurrent(),t=new a(this,e),this.onData(this.writer.comment(t,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.raw=function(e){var t;return this.openCurrent(),t=new g(this,e),this.onData(this.writer.raw(t,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.instruction=function(e,t){var r,n,i,o,a;if(this.openCurrent(),null!=e&&(e=E(e)),null!=t&&(t=E(t)),Array.isArray(e))for(r=0,o=e.length;r<o;r++)n=e[r],this.instruction(n);else if(b(e))for(n in e)M.call(e,n)&&(i=e[n],this.instruction(n,i));else S(t)&&(t=t.apply()),a=new m(this,e,t),this.onData(this.writer.processingInstruction(a,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this},e.prototype.declaration=function(e,t,r){var n;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return n=new d(this,e,t,r),this.onData(this.writer.declaration(n,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.doctype=function(e,t,r){if(this.openCurrent(),null==e)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new p(this,t,r),this.currentNode.rootNodeName=e,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this},e.prototype.dtdElement=function(e,t){var r;return this.openCurrent(),r=new l(this,e,t),this.onData(this.writer.dtdElement(r,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.attList=function(e,t,r,n,i){var o;return this.openCurrent(),o=new s(this,e,t,r,n,i),this.onData(this.writer.dtdAttList(o,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.entity=function(e,t){var r;return this.openCurrent(),r=new u(this,!1,e,t),this.onData(this.writer.dtdEntity(r,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.pEntity=function(e,t){var r;return this.openCurrent(),r=new u(this,!0,e,t),this.onData(this.writer.dtdEntity(r,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.notation=function(e,t){var r;return this.openCurrent(),r=new c(this,e,t),this.onData(this.writer.dtdNotation(r,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},e.prototype.up=function(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this},e.prototype.end=function(){for(;this.currentLevel>=0;)this.up();return this.onEnd()},e.prototype.openCurrent=function(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)},e.prototype.openNode=function(e){var r,i,o,a;if(!e.isOpen){if(this.root||0!==this.currentLevel||e.type!==t.Element||(this.root=e),i="",e.type===t.Element){for(o in this.writerOptions.state=n.OpenTag,i=this.writer.indent(e,this.writerOptions,this.currentLevel)+"<"+e.name,a=e.attribs)M.call(a,o)&&(r=a[o],i+=this.writer.attribute(r,this.writerOptions,this.currentLevel));i+=(e.children?">":"/>")+this.writer.endline(e,this.writerOptions,this.currentLevel),this.writerOptions.state=n.InsideTag}else this.writerOptions.state=n.OpenTag,i=this.writer.indent(e,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+e.rootNodeName,e.pubID&&e.sysID?i+=' PUBLIC "'+e.pubID+'" "'+e.sysID+'"':e.sysID&&(i+=' SYSTEM "'+e.sysID+'"'),e.children?(i+=" [",this.writerOptions.state=n.InsideTag):(this.writerOptions.state=n.CloseTag,i+=">"),i+=this.writer.endline(e,this.writerOptions,this.currentLevel);return this.onData(i,this.currentLevel),e.isOpen=!0}},e.prototype.closeNode=function(e){var r;if(!e.isClosed)return r="",this.writerOptions.state=n.CloseTag,r=e.type===t.Element?this.writer.indent(e,this.writerOptions,this.currentLevel)+"</"+e.name+">"+this.writer.endline(e,this.writerOptions,this.currentLevel):this.writer.indent(e,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(e,this.writerOptions,this.currentLevel),this.writerOptions.state=n.None,this.onData(r,this.currentLevel),e.isClosed=!0},e.prototype.onData=function(e,t){return this.documentStarted=!0,this.onDataCallback(e,t+1)},e.prototype.onEnd=function(){return this.documentCompleted=!0,this.onEndCallback()},e.prototype.debugInfo=function(e){return null==e?"":"node: <"+e+">"},e.prototype.ele=function(){return this.element.apply(this,arguments)},e.prototype.nod=function(e,t,r){return this.node(e,t,r)},e.prototype.txt=function(e){return this.text(e)},e.prototype.dat=function(e){return this.cdata(e)},e.prototype.com=function(e){return this.comment(e)},e.prototype.ins=function(e,t){return this.instruction(e,t)},e.prototype.dec=function(e,t,r){return this.declaration(e,t,r)},e.prototype.dtd=function(e,t,r){return this.doctype(e,t,r)},e.prototype.e=function(e,t,r){return this.element(e,t,r)},e.prototype.n=function(e,t,r){return this.node(e,t,r)},e.prototype.t=function(e){return this.text(e)},e.prototype.d=function(e){return this.cdata(e)},e.prototype.c=function(e){return this.comment(e)},e.prototype.r=function(e){return this.raw(e)},e.prototype.i=function(e,t){return this.instruction(e,t)},e.prototype.att=function(){return this.currentNode&&this.currentNode.type===t.DocType?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},e.prototype.a=function(){return this.currentNode&&this.currentNode.type===t.DocType?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},e.prototype.ent=function(e,t){return this.entity(e,t)},e.prototype.pent=function(e,t){return this.pEntity(e,t)},e.prototype.not=function(e,t){return this.notation(e,t)},e}()}).call(this)},function(e,t,r){(function(){var t,n,i,o={}.hasOwnProperty;t=r(4),i=r(77),n=r(24),e.exports=function(e){function r(e,t){this.stream=e,r.__super__.constructor.call(this,t)}return function(e,t){for(var r in t)o.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(r,e),r.prototype.endline=function(e,t,i){return e.isLastRootNode&&t.state===n.CloseTag?"":r.__super__.endline.call(this,e,t,i)},r.prototype.document=function(e,t){var r,n,i,o,a,s,l,u,c;for(n=i=0,a=(l=e.children).length;i<a;n=++i)(r=l[n]).isLastRootNode=n===e.children.length-1;for(t=this.filterOptions(t),c=[],o=0,s=(u=e.children).length;o<s;o++)r=u[o],c.push(this.writeChildNode(r,t,0));return c},r.prototype.attribute=function(e,t,n){return this.stream.write(r.__super__.attribute.call(this,e,t,n))},r.prototype.cdata=function(e,t,n){return this.stream.write(r.__super__.cdata.call(this,e,t,n))},r.prototype.comment=function(e,t,n){return this.stream.write(r.__super__.comment.call(this,e,t,n))},r.prototype.declaration=function(e,t,n){return this.stream.write(r.__super__.declaration.call(this,e,t,n))},r.prototype.docType=function(e,t,r){var i,o,a,s;if(r||(r=0),this.openNode(e,t,r),t.state=n.OpenTag,this.stream.write(this.indent(e,t,r)),this.stream.write("<!DOCTYPE "+e.root().name),e.pubID&&e.sysID?this.stream.write(' PUBLIC "'+e.pubID+'" "'+e.sysID+'"'):e.sysID&&this.stream.write(' SYSTEM "'+e.sysID+'"'),e.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(e,t,r)),t.state=n.InsideTag,o=0,a=(s=e.children).length;o<a;o++)i=s[o],this.writeChildNode(i,t,r+1);t.state=n.CloseTag,this.stream.write("]")}return t.state=n.CloseTag,this.stream.write(t.spaceBeforeSlash+">"),this.stream.write(this.endline(e,t,r)),t.state=n.None,this.closeNode(e,t,r)},r.prototype.element=function(e,r,i){var a,s,l,u,c,d,p,f,h;for(p in i||(i=0),this.openNode(e,r,i),r.state=n.OpenTag,this.stream.write(this.indent(e,r,i)+"<"+e.name),f=e.attribs)o.call(f,p)&&(a=f[p],this.attribute(a,r,i));if(u=0===(l=e.children.length)?null:e.children[0],0===l||e.children.every((function(e){return(e.type===t.Text||e.type===t.Raw)&&""===e.value})))r.allowEmpty?(this.stream.write(">"),r.state=n.CloseTag,this.stream.write("</"+e.name+">")):(r.state=n.CloseTag,this.stream.write(r.spaceBeforeSlash+"/>"));else if(!r.pretty||1!==l||u.type!==t.Text&&u.type!==t.Raw||null==u.value){for(this.stream.write(">"+this.endline(e,r,i)),r.state=n.InsideTag,c=0,d=(h=e.children).length;c<d;c++)s=h[c],this.writeChildNode(s,r,i+1);r.state=n.CloseTag,this.stream.write(this.indent(e,r,i)+"</"+e.name+">")}else this.stream.write(">"),r.state=n.InsideTag,r.suppressPrettyCount++,!0,this.writeChildNode(u,r,i+1),r.suppressPrettyCount--,!1,r.state=n.CloseTag,this.stream.write("</"+e.name+">");return this.stream.write(this.endline(e,r,i)),r.state=n.None,this.closeNode(e,r,i)},r.prototype.processingInstruction=function(e,t,n){return this.stream.write(r.__super__.processingInstruction.call(this,e,t,n))},r.prototype.raw=function(e,t,n){return this.stream.write(r.__super__.raw.call(this,e,t,n))},r.prototype.text=function(e,t,n){return this.stream.write(r.__super__.text.call(this,e,t,n))},r.prototype.dtdAttList=function(e,t,n){return this.stream.write(r.__super__.dtdAttList.call(this,e,t,n))},r.prototype.dtdElement=function(e,t,n){return this.stream.write(r.__super__.dtdElement.call(this,e,t,n))},r.prototype.dtdEntity=function(e,t,n){return this.stream.write(r.__super__.dtdEntity.call(this,e,t,n))},r.prototype.dtdNotation=function(e,t,n){return this.stream.write(r.__super__.dtdNotation.call(this,e,t,n))},r}(i)}).call(this)},function(e,t,r){(function(){"use strict";var e,n,i,o,a,s,l,u,c=function(e,t){return function(){return e.apply(t,arguments)}},d={}.hasOwnProperty;l=r(169),i=r(26),e=r(184),s=r(84),u=r(82).setImmediate,n=r(37).defaults,o=function(e){return"object"==typeof e&&null!=e&&0===Object.keys(e).length},a=function(e,t,r){var n,i;for(n=0,i=e.length;n<i;n++)t=(0,e[n])(t,r);return t},t.Parser=function(r){function i(e){var r,i,o;if(this.parseStringPromise=c(this.parseStringPromise,this),this.parseString=c(this.parseString,this),this.reset=c(this.reset,this),this.assignOrPush=c(this.assignOrPush,this),this.processAsync=c(this.processAsync,this),!(this instanceof t.Parser))return new t.Parser(e);for(r in this.options={},i=n[.2])d.call(i,r)&&(o=i[r],this.options[r]=o);for(r in e)d.call(e,r)&&(o=e[r],this.options[r]=o);this.options.xmlns&&(this.options.xmlnskey=this.options.attrkey+"ns"),this.options.normalizeTags&&(this.options.tagNameProcessors||(this.options.tagNameProcessors=[]),this.options.tagNameProcessors.unshift(s.normalize)),this.reset()}return function(e,t){for(var r in t)d.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(i,r),i.prototype.processAsync=function(){var e,t;try{return this.remaining.length<=this.options.chunkSize?(e=this.remaining,this.remaining="",this.saxParser=this.saxParser.write(e),this.saxParser.close()):(e=this.remaining.substr(0,this.options.chunkSize),this.remaining=this.remaining.substr(this.options.chunkSize,this.remaining.length),this.saxParser=this.saxParser.write(e),u(this.processAsync))}catch(e){if(t=e,!this.saxParser.errThrown)return this.saxParser.errThrown=!0,this.emit(t)}},i.prototype.assignOrPush=function(e,t,r){return t in e?(e[t]instanceof Array||(e[t]=[e[t]]),e[t].push(r)):this.options.explicitArray?e[t]=[r]:e[t]=r},i.prototype.reset=function(){var e,t,r,n,i;return this.removeAllListeners(),this.saxParser=l.parser(this.options.strict,{trim:!1,normalize:!1,xmlns:this.options.xmlns}),this.saxParser.errThrown=!1,this.saxParser.onerror=(i=this,function(e){if(i.saxParser.resume(),!i.saxParser.errThrown)return i.saxParser.errThrown=!0,i.emit("error",e)}),this.saxParser.onend=function(e){return function(){if(!e.saxParser.ended)return e.saxParser.ended=!0,e.emit("end",e.resultObject)}}(this),this.saxParser.ended=!1,this.EXPLICIT_CHARKEY=this.options.explicitCharkey,this.resultObject=null,n=[],e=this.options.attrkey,t=this.options.charkey,this.saxParser.onopentag=function(r){return function(i){var o,s,l,u,c;if((l={})[t]="",!r.options.ignoreAttrs)for(o in c=i.attributes)d.call(c,o)&&(e in l||r.options.mergeAttrs||(l[e]={}),s=r.options.attrValueProcessors?a(r.options.attrValueProcessors,i.attributes[o],o):i.attributes[o],u=r.options.attrNameProcessors?a(r.options.attrNameProcessors,o):o,r.options.mergeAttrs?r.assignOrPush(l,u,s):l[e][u]=s);return l["#name"]=r.options.tagNameProcessors?a(r.options.tagNameProcessors,i.name):i.name,r.options.xmlns&&(l[r.options.xmlnskey]={uri:i.uri,local:i.local}),n.push(l)}}(this),this.saxParser.onclosetag=function(e){return function(){var r,i,s,l,u,c,p,f,h,m;if(c=n.pop(),u=c["#name"],e.options.explicitChildren&&e.options.preserveChildrenOrder||delete c["#name"],!0===c.cdata&&(r=c.cdata,delete c.cdata),h=n[n.length-1],c[t].match(/^\s*$/)&&!r?(i=c[t],delete c[t]):(e.options.trim&&(c[t]=c[t].trim()),e.options.normalize&&(c[t]=c[t].replace(/\s{2,}/g," ").trim()),c[t]=e.options.valueProcessors?a(e.options.valueProcessors,c[t],u):c[t],1===Object.keys(c).length&&t in c&&!e.EXPLICIT_CHARKEY&&(c=c[t])),o(c)&&(c=""!==e.options.emptyTag?e.options.emptyTag:i),null!=e.options.validator&&(m="/"+function(){var e,t,r;for(r=[],e=0,t=n.length;e<t;e++)l=n[e],r.push(l["#name"]);return r}().concat(u).join("/"),function(){var t;try{c=e.options.validator(m,h&&h[u],c)}catch(r){return t=r,e.emit("error",t)}}()),e.options.explicitChildren&&!e.options.mergeAttrs&&"object"==typeof c)if(e.options.preserveChildrenOrder){if(h){for(s in h[e.options.childkey]=h[e.options.childkey]||[],p={},c)d.call(c,s)&&(p[s]=c[s]);h[e.options.childkey].push(p),delete c["#name"],1===Object.keys(c).length&&t in c&&!e.EXPLICIT_CHARKEY&&(c=c[t])}}else l={},e.options.attrkey in c&&(l[e.options.attrkey]=c[e.options.attrkey],delete c[e.options.attrkey]),!e.options.charsAsChildren&&e.options.charkey in c&&(l[e.options.charkey]=c[e.options.charkey],delete c[e.options.charkey]),Object.getOwnPropertyNames(c).length>0&&(l[e.options.childkey]=c),c=l;return n.length>0?e.assignOrPush(h,u,c):(e.options.explicitRoot&&(f=c,(c={})[u]=f),e.resultObject=c,e.saxParser.ended=!0,e.emit("end",e.resultObject))}}(this),r=function(e){return function(r){var i,o;if(o=n[n.length-1])return o[t]+=r,e.options.explicitChildren&&e.options.preserveChildrenOrder&&e.options.charsAsChildren&&(e.options.includeWhiteChars||""!==r.replace(/\\n/g,"").trim())&&(o[e.options.childkey]=o[e.options.childkey]||[],(i={"#name":"__text__"})[t]=r,e.options.normalize&&(i[t]=i[t].replace(/\s{2,}/g," ").trim()),o[e.options.childkey].push(i)),o}}(this),this.saxParser.ontext=r,this.saxParser.oncdata=function(e){var t;if(t=r(e))return t.cdata=!0}},i.prototype.parseString=function(t,r){var n;null!=r&&"function"==typeof r&&(this.on("end",(function(e){return this.reset(),r(null,e)})),this.on("error",(function(e){return this.reset(),r(e)})));try{return""===(t=t.toString()).trim()?(this.emit("end",null),!0):(t=e.stripBOM(t),this.options.async?(this.remaining=t,u(this.processAsync),this.saxParser):this.saxParser.write(t).close())}catch(e){if(n=e,!this.saxParser.errThrown&&!this.saxParser.ended)return this.emit("error",n),this.saxParser.errThrown=!0;if(this.saxParser.ended)throw n}},i.prototype.parseStringPromise=function(e){return new Promise((t=this,function(r,n){return t.parseString(e,(function(e,t){return e?n(e):r(t)}))}));var t},i}(i),t.parseString=function(e,r,n){var i,o;return null!=n?("function"==typeof n&&(i=n),"object"==typeof r&&(o=r)):("function"==typeof r&&(i=r),o={}),new t.Parser(o).parseString(e,i)},t.parseStringPromise=function(e,r){var n;return"object"==typeof r&&(n=r),new t.Parser(n).parseStringPromise(e)}}).call(this)},function(e,t,r){(function(e){!function(t){t.parser=function(e,t){return new o(e,t)},t.SAXParser=o,t.SAXStream=s,t.createStream=function(e,t){return new s(e,t)},t.MAX_BUFFER_LENGTH=65536;var n,i=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function o(e,r){if(!(this instanceof o))return new o(e,r);!function(e){for(var t=0,r=i.length;t<r;t++)e[i[t]]=""}(this),this.q=this.c="",this.bufferCheckPosition=t.MAX_BUFFER_LENGTH,this.opt=r||{},this.opt.lowercase=this.opt.lowercase||this.opt.lowercasetags,this.looseCase=this.opt.lowercase?"toLowerCase":"toUpperCase",this.tags=[],this.closed=this.closedRoot=this.sawRoot=!1,this.tag=this.error=null,this.strict=!!e,this.noscript=!(!e&&!this.opt.noscript),this.state=b.BEGIN,this.strictEntities=this.opt.strictEntities,this.ENTITIES=this.strictEntities?Object.create(t.XML_ENTITIES):Object.create(t.ENTITIES),this.attribList=[],this.opt.xmlns&&(this.ns=Object.create(u)),this.trackPosition=!1!==this.opt.position,this.trackPosition&&(this.position=this.line=this.column=0),w(this,"onready")}t.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}),o.prototype={end:function(){C(this)},write:function(e){if(this.error)throw this.error;if(this.closed)return I(this,"Cannot write after close. Assign an onready handler.");if(null===e)return C(this);"object"==typeof e&&(e=e.toString());var r=0,n="";for(;n=j(e,r++),this.c=n,n;)switch(this.trackPosition&&(this.position++,"\n"===n?(this.line++,this.column=0):this.column++),this.state){case b.BEGIN:if(this.state=b.BEGIN_WHITESPACE,"\ufeff"===n)continue;U(this,n);continue;case b.BEGIN_WHITESPACE:U(this,n);continue;case b.TEXT:if(this.sawRoot&&!this.closedRoot){for(var o=r-1;n&&"<"!==n&&"&"!==n;)(n=j(e,r++))&&this.trackPosition&&(this.position++,"\n"===n?(this.line++,this.column=0):this.column++);this.textNode+=e.substring(o,r-1)}"<"!==n||this.sawRoot&&this.closedRoot&&!this.strict?(h(n)||this.sawRoot&&!this.closedRoot||A(this,"Text data outside of root node."),"&"===n?this.state=b.TEXT_ENTITY:this.textNode+=n):(this.state=b.OPEN_WAKA,this.startTagPosition=this.position);continue;case b.SCRIPT:"<"===n?this.state=b.SCRIPT_ENDING:this.script+=n;continue;case b.SCRIPT_ENDING:"/"===n?this.state=b.CLOSE_TAG:(this.script+="<"+n,this.state=b.SCRIPT);continue;case b.OPEN_WAKA:if("!"===n)this.state=b.SGML_DECL,this.sgmlDecl="";else if(h(n));else if(y(c,n))this.state=b.OPEN_TAG,this.tagName=n;else if("/"===n)this.state=b.CLOSE_TAG,this.tagName="";else if("?"===n)this.state=b.PROC_INST,this.procInstName=this.procInstBody="";else{if(A(this,"Unencoded <"),this.startTagPosition+1<this.position){var a=this.position-this.startTagPosition;n=new Array(a).join(" ")+n}this.textNode+="<"+n,this.state=b.TEXT}continue;case b.SGML_DECL:"[CDATA["===(this.sgmlDecl+n).toUpperCase()?(M(this,"onopencdata"),this.state=b.CDATA,this.sgmlDecl="",this.cdata=""):this.sgmlDecl+n==="--"?(this.state=b.COMMENT,this.comment="",this.sgmlDecl=""):"DOCTYPE"===(this.sgmlDecl+n).toUpperCase()?(this.state=b.DOCTYPE,(this.doctype||this.sawRoot)&&A(this,"Inappropriately located doctype declaration"),this.doctype="",this.sgmlDecl=""):">"===n?(M(this,"onsgmldeclaration",this.sgmlDecl),this.sgmlDecl="",this.state=b.TEXT):m(n)?(this.state=b.SGML_DECL_QUOTED,this.sgmlDecl+=n):this.sgmlDecl+=n;continue;case b.SGML_DECL_QUOTED:n===this.q&&(this.state=b.SGML_DECL,this.q=""),this.sgmlDecl+=n;continue;case b.DOCTYPE:">"===n?(this.state=b.TEXT,M(this,"ondoctype",this.doctype),this.doctype=!0):(this.doctype+=n,"["===n?this.state=b.DOCTYPE_DTD:m(n)&&(this.state=b.DOCTYPE_QUOTED,this.q=n));continue;case b.DOCTYPE_QUOTED:this.doctype+=n,n===this.q&&(this.q="",this.state=b.DOCTYPE);continue;case b.DOCTYPE_DTD:this.doctype+=n,"]"===n?this.state=b.DOCTYPE:m(n)&&(this.state=b.DOCTYPE_DTD_QUOTED,this.q=n);continue;case b.DOCTYPE_DTD_QUOTED:this.doctype+=n,n===this.q&&(this.state=b.DOCTYPE_DTD,this.q="");continue;case b.COMMENT:"-"===n?this.state=b.COMMENT_ENDING:this.comment+=n;continue;case b.COMMENT_ENDING:"-"===n?(this.state=b.COMMENT_ENDED,this.comment=P(this.opt,this.comment),this.comment&&M(this,"oncomment",this.comment),this.comment=""):(this.comment+="-"+n,this.state=b.COMMENT);continue;case b.COMMENT_ENDED:">"!==n?(A(this,"Malformed comment"),this.comment+="--"+n,this.state=b.COMMENT):this.state=b.TEXT;continue;case b.CDATA:"]"===n?this.state=b.CDATA_ENDING:this.cdata+=n;continue;case b.CDATA_ENDING:"]"===n?this.state=b.CDATA_ENDING_2:(this.cdata+="]"+n,this.state=b.CDATA);continue;case b.CDATA_ENDING_2:">"===n?(this.cdata&&M(this,"oncdata",this.cdata),M(this,"onclosecdata"),this.cdata="",this.state=b.TEXT):"]"===n?this.cdata+="]":(this.cdata+="]]"+n,this.state=b.CDATA);continue;case b.PROC_INST:"?"===n?this.state=b.PROC_INST_ENDING:h(n)?this.state=b.PROC_INST_BODY:this.procInstName+=n;continue;case b.PROC_INST_BODY:if(!this.procInstBody&&h(n))continue;"?"===n?this.state=b.PROC_INST_ENDING:this.procInstBody+=n;continue;case b.PROC_INST_ENDING:">"===n?(M(this,"onprocessinginstruction",{name:this.procInstName,body:this.procInstBody}),this.procInstName=this.procInstBody="",this.state=b.TEXT):(this.procInstBody+="?"+n,this.state=b.PROC_INST_BODY);continue;case b.OPEN_TAG:y(d,n)?this.tagName+=n:(N(this),">"===n?L(this):"/"===n?this.state=b.OPEN_TAG_SLASH:(h(n)||A(this,"Invalid character in tag name"),this.state=b.ATTRIB));continue;case b.OPEN_TAG_SLASH:">"===n?(L(this,!0),R(this)):(A(this,"Forward-slash in opening tag not followed by >"),this.state=b.ATTRIB);continue;case b.ATTRIB:if(h(n))continue;">"===n?L(this):"/"===n?this.state=b.OPEN_TAG_SLASH:y(c,n)?(this.attribName=n,this.attribValue="",this.state=b.ATTRIB_NAME):A(this,"Invalid attribute name");continue;case b.ATTRIB_NAME:"="===n?this.state=b.ATTRIB_VALUE:">"===n?(A(this,"Attribute without value"),this.attribValue=this.attribName,k(this),L(this)):h(n)?this.state=b.ATTRIB_NAME_SAW_WHITE:y(d,n)?this.attribName+=n:A(this,"Invalid attribute name");continue;case b.ATTRIB_NAME_SAW_WHITE:if("="===n)this.state=b.ATTRIB_VALUE;else{if(h(n))continue;A(this,"Attribute without value"),this.tag.attributes[this.attribName]="",this.attribValue="",M(this,"onattribute",{name:this.attribName,value:""}),this.attribName="",">"===n?L(this):y(c,n)?(this.attribName=n,this.state=b.ATTRIB_NAME):(A(this,"Invalid attribute name"),this.state=b.ATTRIB)}continue;case b.ATTRIB_VALUE:if(h(n))continue;m(n)?(this.q=n,this.state=b.ATTRIB_VALUE_QUOTED):(A(this,"Unquoted attribute value"),this.state=b.ATTRIB_VALUE_UNQUOTED,this.attribValue=n);continue;case b.ATTRIB_VALUE_QUOTED:if(n!==this.q){"&"===n?this.state=b.ATTRIB_VALUE_ENTITY_Q:this.attribValue+=n;continue}k(this),this.q="",this.state=b.ATTRIB_VALUE_CLOSED;continue;case b.ATTRIB_VALUE_CLOSED:h(n)?this.state=b.ATTRIB:">"===n?L(this):"/"===n?this.state=b.OPEN_TAG_SLASH:y(c,n)?(A(this,"No whitespace between attributes"),this.attribName=n,this.attribValue="",this.state=b.ATTRIB_NAME):A(this,"Invalid attribute name");continue;case b.ATTRIB_VALUE_UNQUOTED:if(!g(n)){"&"===n?this.state=b.ATTRIB_VALUE_ENTITY_U:this.attribValue+=n;continue}k(this),">"===n?L(this):this.state=b.ATTRIB;continue;case b.CLOSE_TAG:if(this.tagName)">"===n?R(this):y(d,n)?this.tagName+=n:this.script?(this.script+="</"+this.tagName,this.tagName="",this.state=b.SCRIPT):(h(n)||A(this,"Invalid tagname in closing tag"),this.state=b.CLOSE_TAG_SAW_WHITE);else{if(h(n))continue;_(c,n)?this.script?(this.script+="</"+n,this.state=b.SCRIPT):A(this,"Invalid tagname in closing tag."):this.tagName=n}continue;case b.CLOSE_TAG_SAW_WHITE:if(h(n))continue;">"===n?R(this):A(this,"Invalid characters in closing tag");continue;case b.TEXT_ENTITY:case b.ATTRIB_VALUE_ENTITY_Q:case b.ATTRIB_VALUE_ENTITY_U:var s,l;switch(this.state){case b.TEXT_ENTITY:s=b.TEXT,l="textNode";break;case b.ATTRIB_VALUE_ENTITY_Q:s=b.ATTRIB_VALUE_QUOTED,l="attribValue";break;case b.ATTRIB_VALUE_ENTITY_U:s=b.ATTRIB_VALUE_UNQUOTED,l="attribValue"}";"===n?(this[l]+=O(this),this.entity="",this.state=s):y(this.entity.length?f:p,n)?this.entity+=n:(A(this,"Invalid character in entity name"),this[l]+="&"+this.entity+n,this.entity="",this.state=s);continue;default:throw new Error(this,"Unknown state: "+this.state)}this.position>=this.bufferCheckPosition&&function(e){for(var r=Math.max(t.MAX_BUFFER_LENGTH,10),n=0,o=0,a=i.length;o<a;o++){var s=e[i[o]].length;if(s>r)switch(i[o]){case"textNode":x(e);break;case"cdata":M(e,"oncdata",e.cdata),e.cdata="";break;case"script":M(e,"onscript",e.script),e.script="";break;default:I(e,"Max buffer length exceeded: "+i[o])}n=Math.max(n,s)}var l=t.MAX_BUFFER_LENGTH-n;e.bufferCheckPosition=l+e.position}(this);return this}
/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var e;x(e=this),""!==e.cdata&&(M(e,"oncdata",e.cdata),e.cdata=""),""!==e.script&&(M(e,"onscript",e.script),e.script="")}};try{n=r(172).Stream}catch(e){n=function(){}}var a=t.EVENTS.filter((function(e){return"error"!==e&&"end"!==e}));function s(e,t){if(!(this instanceof s))return new s(e,t);n.apply(this),this._parser=new o(e,t),this.writable=!0,this.readable=!0;var r=this;this._parser.onend=function(){r.emit("end")},this._parser.onerror=function(e){r.emit("error",e),r._parser.error=null},this._decoder=null,a.forEach((function(e){Object.defineProperty(r,"on"+e,{get:function(){return r._parser["on"+e]},set:function(t){if(!t)return r.removeAllListeners(e),r._parser["on"+e]=t,t;r.on(e,t)},enumerable:!0,configurable:!1})}))}s.prototype=Object.create(n.prototype,{constructor:{value:s}}),s.prototype.write=function(t){if("function"==typeof e&&"function"==typeof e.isBuffer&&e.isBuffer(t)){if(!this._decoder){var n=r(55).StringDecoder;this._decoder=new n("utf8")}t=this._decoder.write(t)}return this._parser.write(t.toString()),this.emit("data",t),!0},s.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},s.prototype.on=function(e,t){var r=this;return r._parser["on"+e]||-1===a.indexOf(e)||(r._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),r.emit.apply(r,t)}),n.prototype.on.call(r,e,t)};var l="http://www.w3.org/XML/1998/namespace",u={xml:l,xmlns:"http://www.w3.org/2000/xmlns/"},c=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,d=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,p=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,f=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function h(e){return" "===e||"\n"===e||"\r"===e||"\t"===e}function m(e){return'"'===e||"'"===e}function g(e){return">"===e||h(e)}function y(e,t){return e.test(t)}function _(e,t){return!y(e,t)}var v,E,S,b=0;for(var T in t.STATE={BEGIN:b++,BEGIN_WHITESPACE:b++,TEXT:b++,TEXT_ENTITY:b++,OPEN_WAKA:b++,SGML_DECL:b++,SGML_DECL_QUOTED:b++,DOCTYPE:b++,DOCTYPE_QUOTED:b++,DOCTYPE_DTD:b++,DOCTYPE_DTD_QUOTED:b++,COMMENT_STARTING:b++,COMMENT:b++,COMMENT_ENDING:b++,COMMENT_ENDED:b++,CDATA:b++,CDATA_ENDING:b++,CDATA_ENDING_2:b++,PROC_INST:b++,PROC_INST_BODY:b++,PROC_INST_ENDING:b++,OPEN_TAG:b++,OPEN_TAG_SLASH:b++,ATTRIB:b++,ATTRIB_NAME:b++,ATTRIB_NAME_SAW_WHITE:b++,ATTRIB_VALUE:b++,ATTRIB_VALUE_QUOTED:b++,ATTRIB_VALUE_CLOSED:b++,ATTRIB_VALUE_UNQUOTED:b++,ATTRIB_VALUE_ENTITY_Q:b++,ATTRIB_VALUE_ENTITY_U:b++,CLOSE_TAG:b++,CLOSE_TAG_SAW_WHITE:b++,SCRIPT:b++,SCRIPT_ENDING:b++},t.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},t.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(t.ENTITIES).forEach((function(e){var r=t.ENTITIES[e],n="number"==typeof r?String.fromCharCode(r):r;t.ENTITIES[e]=n})),t.STATE)t.STATE[t.STATE[T]]=T;function w(e,t,r){e[t]&&e[t](r)}function M(e,t,r){e.textNode&&x(e),w(e,t,r)}function x(e){e.textNode=P(e.opt,e.textNode),e.textNode&&w(e,"ontext",e.textNode),e.textNode=""}function P(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function I(e,t){return x(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,w(e,"onerror",t),e}function C(e){return e.sawRoot&&!e.closedRoot&&A(e,"Unclosed root tag"),e.state!==b.BEGIN&&e.state!==b.BEGIN_WHITESPACE&&e.state!==b.TEXT&&I(e,"Unexpected end"),x(e),e.c="",e.closed=!0,w(e,"onend"),o.call(e,e.strict,e.opt),e}function A(e,t){if("object"!=typeof e||!(e instanceof o))throw new Error("bad call to strictFail");e.strict&&I(e,t)}function N(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,r=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(r.ns=t.ns),e.attribList.length=0,M(e,"onopentagstart",r)}function D(e,t){var r=e.indexOf(":")<0?["",e]:e.split(":"),n=r[0],i=r[1];return t&&"xmlns"===e&&(n="xmlns",i=""),{prefix:n,local:i}}function k(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName))e.attribName=e.attribValue="";else{if(e.opt.xmlns){var t=D(e.attribName,!0),r=t.prefix,n=t.local;if("xmlns"===r)if("xml"===n&&e.attribValue!==l)A(e,"xml: prefix must be bound to "+l+"\nActual: "+e.attribValue);else if("xmlns"===n&&"http://www.w3.org/2000/xmlns/"!==e.attribValue)A(e,"xmlns: prefix must be bound to http://www.w3.org/2000/xmlns/\nActual: "+e.attribValue);else{var i=e.tag,o=e.tags[e.tags.length-1]||e;i.ns===o.ns&&(i.ns=Object.create(o.ns)),i.ns[n]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,M(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}}function L(e,t){if(e.opt.xmlns){var r=e.tag,n=D(e.tagName);r.prefix=n.prefix,r.local=n.local,r.uri=r.ns[n.prefix]||"",r.prefix&&!r.uri&&(A(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),r.uri=n.prefix);var i=e.tags[e.tags.length-1]||e;r.ns&&i.ns!==r.ns&&Object.keys(r.ns).forEach((function(t){M(e,"onopennamespace",{prefix:t,uri:r.ns[t]})}));for(var o=0,a=e.attribList.length;o<a;o++){var s=e.attribList[o],l=s[0],u=s[1],c=D(l,!0),d=c.prefix,p=c.local,f=""===d?"":r.ns[d]||"",h={name:l,value:u,prefix:d,local:p,uri:f};d&&"xmlns"!==d&&!f&&(A(e,"Unbound namespace prefix: "+JSON.stringify(d)),h.uri=d),e.tag.attributes[l]=h,M(e,"onattribute",h)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),M(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=b.TEXT:e.state=b.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function R(e){if(!e.tagName)return A(e,"Weird empty close tag."),e.textNode+="</>",void(e.state=b.TEXT);if(e.script){if("script"!==e.tagName)return e.script+="</"+e.tagName+">",e.tagName="",void(e.state=b.SCRIPT);M(e,"onscript",e.script),e.script=""}var t=e.tags.length,r=e.tagName;e.strict||(r=r[e.looseCase]());for(var n=r;t--;){if(e.tags[t].name===n)break;A(e,"Unexpected close tag")}if(t<0)return A(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",void(e.state=b.TEXT);e.tagName=r;for(var i=e.tags.length;i-- >t;){var o=e.tag=e.tags.pop();e.tagName=e.tag.name,M(e,"onclosetag",e.tagName);var a={};for(var s in o.ns)a[s]=o.ns[s];var l=e.tags[e.tags.length-1]||e;e.opt.xmlns&&o.ns!==l.ns&&Object.keys(o.ns).forEach((function(t){var r=o.ns[t];M(e,"onclosenamespace",{prefix:t,uri:r})}))}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=b.TEXT}function O(e){var t,r=e.entity,n=r.toLowerCase(),i="";return e.ENTITIES[r]?e.ENTITIES[r]:e.ENTITIES[n]?e.ENTITIES[n]:("#"===(r=n).charAt(0)&&("x"===r.charAt(1)?(r=r.slice(2),i=(t=parseInt(r,16)).toString(16)):(r=r.slice(1),i=(t=parseInt(r,10)).toString(10))),r=r.replace(/^0+/,""),isNaN(t)||i.toLowerCase()!==r?(A(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t))}function U(e,t){"<"===t?(e.state=b.OPEN_WAKA,e.startTagPosition=e.position):h(t)||(A(e,"Non-whitespace before first tag."),e.textNode=t,e.state=b.TEXT)}function j(e,t){var r="";return t<e.length&&(r=e.charAt(t)),r}b=t.STATE,String.fromCodePoint||(v=String.fromCharCode,E=Math.floor,S=function(){var e,t,r=16384,n=[],i=-1,o=arguments.length;if(!o)return"";for(var a="";++i<o;){var s=Number(arguments[i]);if(!isFinite(s)||s<0||s>1114111||E(s)!==s)throw RangeError("Invalid code point: "+s);s<=65535?n.push(s):(e=55296+((s-=65536)>>10),t=s%1024+56320,n.push(e,t)),(i+1===o||n.length>r)&&(a+=v.apply(null,n),n.length=0)}return a},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:S,configurable:!0,writable:!0}):String.fromCodePoint=S)}(t)}).call(this,r(25).Buffer)},function(e,t,r){"use strict";t.byteLength=function(e){var t=u(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,n=u(e),a=n[0],s=n[1],l=new o(function(e,t,r){return 3*(t+r)/4-r}(0,a,s)),c=0,d=s>0?a-4:a;for(r=0;r<d;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],l[c++]=t>>16&255,l[c++]=t>>8&255,l[c++]=255&t;2===s&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,l[c++]=255&t);1===s&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,l[c++]=t>>8&255,l[c++]=255&t);return l},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],a=0,s=r-i;a<s;a+=16383)o.push(c(e,a,a+16383>s?s:a+16383));1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=a.length;s<l;++s)n[s]=a[s],i[a.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function c(e,t,r){for(var i,o,a=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,i){var o,a,s=8*i-n-1,l=(1<<s)-1,u=l>>1,c=-7,d=r?i-1:0,p=r?-1:1,f=e[t+d];for(d+=p,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+e[t+d],d+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=256*a+e[t+d],d+=p,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),o-=u}return(f?-1:1)*a*Math.pow(2,o-n)},t.write=function(e,t,r,n,i,o){var a,s,l,u=8*o-i-1,c=(1<<u)-1,d=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,h=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+d>=1?p/l:p*Math.pow(2,1-d))*l>=2&&(a++,l/=2),a+d>=c?(s=0,a=c):a+d>=1?(s=(t*l-1)*Math.pow(2,i),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&s,f+=h,s/=256,i-=8);for(a=a<<i|s,u+=i;u>0;e[r+f]=255&a,f+=h,a/=256,u-=8);e[r+f-h]|=128*m}},function(e,t,r){e.exports=i;var n=r(26).EventEmitter;function i(){n.call(this)}r(14)(i,n),i.Readable=r(52),i.Writable=r(180),i.Duplex=r(181),i.Transform=r(182),i.PassThrough=r(183),i.Stream=i,i.prototype.pipe=function(e,t){var r=this;function i(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function o(){r.readable&&r.resume&&r.resume()}r.on("data",i),e.on("drain",o),e._isStdio||t&&!1===t.end||(r.on("end",s),r.on("close",l));var a=!1;function s(){a||(a=!0,e.end())}function l(){a||(a=!0,"function"==typeof e.destroy&&e.destroy())}function u(e){if(c(),0===n.listenerCount(this,"error"))throw e}function c(){r.removeListener("data",i),e.removeListener("drain",o),r.removeListener("end",s),r.removeListener("close",l),r.removeListener("error",u),e.removeListener("error",u),r.removeListener("end",c),r.removeListener("close",c),e.removeListener("close",c)}return r.on("error",u),e.on("error",u),r.on("end",c),r.on("close",c),e.on("close",c),e.emit("pipe",r),e}},function(e,t){},function(e,t,r){"use strict";var n=r(53).Buffer,i=r(175);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},e.prototype.concat=function(e){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var t,r,i,o=n.allocUnsafe(e>>>0),a=this.head,s=0;a;)t=a.data,r=o,i=s,t.copy(r,i),s+=a.data.length,a=a.next;return o},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,r){(function(e,t){!function(e,r){"use strict";if(!e.setImmediate){var n,i,o,a,s,l=1,u={},c=!1,d=e.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(e);p=p&&p.setTimeout?p:e,"[object process]"==={}.toString.call(e.process)?n=function(e){t.nextTick((function(){h(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){h(e.data)},n=function(e){o.port2.postMessage(e)}):d&&"onreadystatechange"in d.createElement("script")?(i=d.documentElement,n=function(e){var t=d.createElement("script");t.onreadystatechange=function(){h(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):n=function(e){setTimeout(h,0,e)}:(a="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&h(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),n=function(t){e.postMessage(a+t,"*")}),p.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var i={callback:e,args:t};return u[l]=i,n(l),l++},p.clearImmediate=f}function f(e){delete u[e]}function h(e){if(c)setTimeout(h,0,e);else{var t=u[e];if(t){c=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(void 0,r)}}(t)}finally{f(e),c=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,r(9),r(13))},function(e,t,r){(function(t){function r(e){try{if(!t.localStorage)return!1}catch(e){return!1}var r=t.localStorage[e];return null!=r&&"true"===String(r).toLowerCase()}e.exports=function(e,t){if(r("noDeprecation"))return e;var n=!1;return function(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}}).call(this,r(9))},function(e,t,r){
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
var n=r(25),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function a(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(o(n,t),t.Buffer=a),a.prototype=Object.create(i.prototype),o(i,a),a.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},a.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t,r){"use strict";e.exports=o;var n=r(83),i=Object.create(r(18));function o(e){if(!(this instanceof o))return new o(e);n.call(this,e)}i.inherits=r(14),i.inherits(o,n),o.prototype._transform=function(e,t,r){r(null,e)}},function(e,t,r){e.exports=r(54)},function(e,t,r){e.exports=r(15)},function(e,t,r){e.exports=r(52).Transform},function(e,t,r){e.exports=r(52).PassThrough},function(e,t){(function(){"use strict";t.stripBOM=function(e){return"\ufeff"===e[0]?e.substring(1):e}}).call(this)},function(e,t,r){"use strict";var n=r(186),i=r(187),o=r(188),a=r(194),s=r(196),l=r(197);e.exports=function e(){var t=[],r=a(),_={},v=!1,E=-1;return S.data=function(e,t){if(s(e))return 2===arguments.length?(m("data",v),_[e]=t,S):c.call(_,e)&&_[e]||null;if(e)return m("data",v),_=e,S;return _},S.freeze=b,S.attachers=t,S.use=function(e){var r;if(m("use",v),null==e);else if("function"==typeof e)s.apply(null,arguments);else{if("object"!=typeof e)throw new Error("Expected usable value, not `"+e+"`");"length"in e?a(e):i(e)}r&&(_.settings=n(_.settings||{},r));return S;function i(e){a(e.plugins),e.settings&&(r=n(r||{},e.settings))}function o(e){if("function"==typeof e)s(e);else{if("object"!=typeof e)throw new Error("Expected usable value, not `"+e+"`");"length"in e?s.apply(null,e):i(e)}}function a(e){var t,r;if(null==e);else{if("object"!=typeof e||!("length"in e))throw new Error("Expected a list of plugins, not `"+e+"`");for(t=e.length,r=-1;++r<t;)o(e[r])}}function s(e,r){var i=T(e);i?(l(i[1])&&l(r)&&(r=n(i[1],r)),i[1]=r):t.push(u.call(arguments))}},S.parse=function(e){var t,r=o(e);if(b(),f("parse",t=S.Parser),p(t))return new t(String(r),r).parse();return t(String(r),r)},S.stringify=function(e,t){var r,n=o(t);if(b(),h("stringify",r=S.Compiler),g(e),p(r))return new r(e,n).compile();return r(e,n)},S.run=w,S.runSync=function(e,t){var r,n=!1;return w(e,t,(function(e,t){n=!0,i(e),r=t})),y("runSync","run",n),r},S.process=M,S.processSync=function(e){var t,r=!1;return b(),f("processSync",S.Parser),h("processSync",S.Compiler),M(t=o(e),(function(e){r=!0,i(e)})),y("processSync","process",r),t},S;function S(){for(var r=e(),i=t.length,o=-1;++o<i;)r.use.apply(null,t[o]);return r.data(n(!0,{},_)),r}function b(){var e,n,i,o;if(v)return S;for(;++E<t.length;)n=(e=t[E])[0],null,!1!==(i=e[1])&&(!0===i&&(e[1]=void 0),"function"==typeof(o=n.apply(S,e.slice(1)))&&r.use(o));return v=!0,E=1/0,S}function T(e){for(var r,n=t.length,i=-1;++i<n;)if((r=t[i])[0]===e)return r}function w(e,t,n){if(g(e),b(),n||"function"!=typeof t||(n=t,t=null),!n)return new Promise(i);function i(i,a){r.run(e,o(t),(function(t,r,o){r=r||e,t?a(t):i?i(r):n(null,r,o)}))}i(null,n)}function M(e,t){if(b(),f("process",S.Parser),h("process",S.Compiler),!t)return new Promise(r);function r(r,n){var i=o(e);d.run(S,{file:i},(function(e){e?n(e):r?r(i):t(null,i)}))}r(null,t)}}().freeze();var u=[].slice,c={}.hasOwnProperty,d=a().use((function(e,t){t.tree=e.parse(t.file)})).use((function(e,t,r){e.run(t.tree,t.file,(function(e,n,i){e?r(e):(t.tree=n,t.file=i,r())}))})).use((function(e,t){t.file.contents=e.stringify(t.tree,t.file)}));function p(e){return"function"==typeof e&&function(e){var t;for(t in e)return!0;return!1}(e.prototype)}function f(e,t){if("function"!=typeof t)throw new Error("Cannot `"+e+"` without `Parser`")}function h(e,t){if("function"!=typeof t)throw new Error("Cannot `"+e+"` without `Compiler`")}function m(e,t){if(t)throw new Error(["Cannot invoke `"+e+"` on a frozen processor.\nCreate a new ","processor first, by invoking it: use `processor()` instead of ","`processor`."].join(""))}function g(e){if(!e||!s(e.type))throw new Error("Expected node, got `"+e+"`")}function y(e,t,r){if(!r)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}},function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,i=Object.prototype.toString,o=Object.defineProperty,a=Object.getOwnPropertyDescriptor,s=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===i.call(e)},l=function(e){if(!e||"[object Object]"!==i.call(e))return!1;var t,r=n.call(e,"constructor"),o=e.constructor&&e.constructor.prototype&&n.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!r&&!o)return!1;for(t in e);return void 0===t||n.call(e,t)},u=function(e,t){o&&"__proto__"===t.name?o(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},c=function(e,t){if("__proto__"===t){if(!n.call(e,t))return;if(a)return a(e,t).value}return e[t]};e.exports=function e(){var t,r,n,i,o,a,d=arguments[0],p=1,f=arguments.length,h=!1;for("boolean"==typeof d&&(h=d,d=arguments[1]||{},p=2),(null==d||"object"!=typeof d&&"function"!=typeof d)&&(d={});p<f;++p)if(null!=(t=arguments[p]))for(r in t)n=c(d,r),d!==(i=c(t,r))&&(h&&i&&(l(i)||(o=s(i)))?(o?(o=!1,a=n&&s(n)?n:[]):a=n&&l(n)?n:{},u(d,{name:r,newValue:e(h,a,i)})):void 0!==i&&u(d,{name:r,newValue:i}));return d}},function(e,t,r){"use strict";e.exports=function(e){if(e)throw e}},function(e,t,r){"use strict";var n=r(189),i=r(191);e.exports=i;var o=i.prototype;function a(e,t,r){var i=this.path,o=new n(e,t,r);return i&&(o.name=i+":"+o.name,o.file=i),o.fatal=!1,this.messages.push(o),o}o.message=a,o.info=function(){var e=this.message.apply(this,arguments);return e.fatal=null,e},o.fail=function(){var e=this.message.apply(this,arguments);throw e.fatal=!0,e},o.warn=a},function(e,t,r){"use strict";var n=r(190);function i(){}e.exports=a,i.prototype=Error.prototype,a.prototype=new i;var o=a.prototype;function a(e,t,r){var i,o,a;"string"==typeof t&&(r=t,t=null),i=function(e){var t,r=[null,null];"string"==typeof e&&(-1===(t=e.indexOf(":"))?r[1]=e:(r[0]=e.slice(0,t),r[1]=e.slice(t+1)));return r}(r),o=n(t)||"1:1",a={start:{line:null,column:null},end:{line:null,column:null}},t&&t.position&&(t=t.position),t&&(t.start?(a=t,t=t.start):a.start=t),e.stack&&(this.stack=e.stack,e=e.message),this.message=e,this.name=o,this.reason=e,this.line=t?t.line:null,this.column=t?t.column:null,this.location=a,this.source=i[0],this.ruleId=i[1]}o.file="",o.name="",o.reason="",o.message="",o.stack="",o.fatal=null,o.column=null,o.line=null},function(e,t,r){"use strict";var n={}.hasOwnProperty;function i(e){return e&&"object"==typeof e||(e={}),a(e.line)+":"+a(e.column)}function o(e){return e&&"object"==typeof e||(e={}),i(e.start)+"-"+i(e.end)}function a(e){return e&&"number"==typeof e?e:1}e.exports=function(e){if(!e||"object"!=typeof e)return null;if(n.call(e,"position")||n.call(e,"type"))return o(e.position);if(n.call(e,"start")||n.call(e,"end"))return o(e);if(n.call(e,"line")||n.call(e,"column"))return i(e);return null}},function(e,t,r){"use strict";(function(t){var n=r(85),i=r(192),o=r(193);e.exports=u;var a={}.hasOwnProperty,s=u.prototype;s.toString=function(e){var t=this.contents||"";return o(t)?t.toString(e):String(t)};var l=["history","path","basename","stem","extname","dirname"];function u(e){var r,n,i;if(e){if("string"==typeof e||o(e))e={contents:e};else if("message"in e&&"messages"in e)return e}else e={};if(!(this instanceof u))return new u(e);for(this.data={},this.messages=[],this.history=[],this.cwd=t.cwd(),n=-1,i=l.length;++n<i;)r=l[n],a.call(e,r)&&(this[r]=e[r]);for(r in e)-1===l.indexOf(r)&&(this[r]=e[r])}function c(e,t){if(-1!==e.indexOf(n.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+n.sep+"`")}function d(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function p(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}Object.defineProperty(s,"path",{get:function(){return this.history[this.history.length-1]},set:function(e){d(e,"path"),e!==this.path&&this.history.push(e)}}),Object.defineProperty(s,"dirname",{get:function(){return"string"==typeof this.path?n.dirname(this.path):void 0},set:function(e){p(this.path,"dirname"),this.path=n.join(e||"",this.basename)}}),Object.defineProperty(s,"basename",{get:function(){return"string"==typeof this.path?n.basename(this.path):void 0},set:function(e){d(e,"basename"),c(e,"basename"),this.path=n.join(this.dirname||"",e)}}),Object.defineProperty(s,"extname",{get:function(){return"string"==typeof this.path?n.extname(this.path):void 0},set:function(e){var t=e||"";if(c(t,"extname"),p(this.path,"extname"),t){if("."!==t.charAt(0))throw new Error("`extname` must start with `.`");if(-1!==t.indexOf(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=i(this.path,t)}}),Object.defineProperty(s,"stem",{get:function(){return"string"==typeof this.path?n.basename(this.path,this.extname):void 0},set:function(e){d(e,"stem"),c(e,"stem"),this.path=n.join(this.dirname||"",e+(this.extname||""))}})}).call(this,r(13))},function(e,t,r){"use strict";var n=r(85);e.exports=function(e,t){if("string"!=typeof e)return e;if(0===e.length)return e;var r=n.basename(e,n.extname(e))+t;return n.join(n.dirname(e),r)}},function(e,t){function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return null!=e&&(r(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&r(e.slice(0,0))}(e)||!!e._isBuffer)}},function(e,t,r){"use strict";var n=r(195);e.exports=o,o.wrap=n;var i=[].slice;function o(){var e=[],t={run:function(){var t=-1,r=i.call(arguments,0,-1),o=arguments[arguments.length-1];if("function"!=typeof o)throw new Error("Expected function as last argument, not "+o);function a(s){var l=e[++t],u=i.call(arguments,0),c=u.slice(1),d=r.length,p=-1;if(s)o(s);else{for(;++p<d;)null!==c[p]&&void 0!==c[p]||(c[p]=r[p]);r=c,l?n(l,a).apply(null,r):o.apply(null,[null].concat(r))}}a.apply(null,[null].concat(r))},use:function(r){if("function"!=typeof r)throw new Error("Expected `fn` to be a function, not "+r);return e.push(r),t}};return t}},function(e,t,r){"use strict";var n=[].slice;e.exports=function(e,t){var r;return function(){var t,a=n.call(arguments,0),s=e.length>a.length;s&&a.push(i);try{t=e.apply(null,a)}catch(e){if(s&&r)throw e;return i(e)}s||(t&&"function"==typeof t.then?t.then(o,i):t instanceof Error?i(t):o(t))};function i(){r||(r=!0,t.apply(null,arguments))}function o(e){i(null,e)}}},function(e,t){var r=Object.prototype.toString;e.exports=function(e){return"[object String]"===r.call(e)}},function(e,t,r){"use strict";var n=Object.prototype.toString;e.exports=function(e){var t;return"[object Object]"===n.call(e)&&(null===(t=Object.getPrototypeOf(e))||t===Object.getPrototypeOf({}))}},function(e,t,r){"use strict";var n=r(199),i=r(12),o=r(200);function a(e){var t=n(o);t.prototype.options=i(t.prototype.options,this.data("settings"),e),this.Parser=t}e.exports=a,a.Parser=o},function(e,t,r){"use strict";var n=r(12),i=r(14);e.exports=function(e){var t,r,o;for(r in i(s,e),i(a,s),t=s.prototype)(o=t[r])&&"object"==typeof o&&(t[r]="concat"in o?o.concat():n(o));return s;function a(t){return e.apply(this,t)}function s(){return this instanceof s?e.apply(this,arguments):new a(arguments)}}},function(e,t,r){"use strict";var n=r(12),i=r(201),o=r(202),a=r(203),s=r(204),l=r(210);function u(e,t){this.file=t,this.offset={},this.options=n(this.options),this.setOptions({}),this.inList=!1,this.inBlock=!1,this.inLink=!1,this.atStart=!0,this.toOffset=o(t).toOffset,this.unescape=a(this,"escape"),this.decode=s(this)}e.exports=u;var c=u.prototype;function d(e){var t,r=[];for(t in e)r.push(t);return r}c.setOptions=r(211),c.parse=r(214),c.options=r(87),c.exitStart=i("atStart",!0),c.enterList=i("inList",!1),c.enterLink=i("inLink",!1),c.enterBlock=i("inBlock",!1),c.interruptParagraph=[["thematicBreak"],["atxHeading"],["fencedCode"],["blockquote"],["html"],["setextHeading",{commonmark:!1}],["definition",{commonmark:!1}],["footnote",{commonmark:!1}]],c.interruptList=[["atxHeading",{pedantic:!1}],["fencedCode",{pedantic:!1}],["thematicBreak",{pedantic:!1}],["definition",{commonmark:!1}],["footnote",{commonmark:!1}]],c.interruptBlockquote=[["indentedCode",{commonmark:!0}],["fencedCode",{commonmark:!0}],["atxHeading",{commonmark:!0}],["setextHeading",{commonmark:!0}],["thematicBreak",{commonmark:!0}],["html",{commonmark:!0}],["list",{commonmark:!0}],["definition",{commonmark:!1}],["footnote",{commonmark:!1}]],c.blockTokenizers={newline:r(218),indentedCode:r(219),fencedCode:r(220),blockquote:r(221),atxHeading:r(222),thematicBreak:r(223),list:r(224),setextHeading:r(226),html:r(227),footnote:r(228),definition:r(230),table:r(231),paragraph:r(232)},c.inlineTokenizers={escape:r(233),autoLink:r(235),url:r(236),html:r(238),link:r(239),reference:r(240),strong:r(241),emphasis:r(243),deletion:r(246),code:r(248),break:r(250),text:r(252)},c.blockMethods=d(c.blockTokenizers),c.inlineMethods=d(c.inlineTokenizers),c.tokenizeBlock=l("block"),c.tokenizeInline=l("inline"),c.tokenizeFactory=l},function(e,t,r){"use strict";e.exports=function(e,t,r){return function(){var n=r||this,i=n[e];return n[e]=!t,function(){n[e]=i}}}},function(e,t,r){"use strict";function n(e){return function(t){var r=-1,n=e.length;if(t<0)return{};for(;++r<n;)if(e[r]>t)return{line:r+1,column:t-(e[r-1]||0)+1,offset:t};return{}}}function i(e){return function(t){var r=t&&t.line,n=t&&t.column;if(!isNaN(r)&&!isNaN(n)&&r-1 in e)return(e[r-2]||0)+n-1||0;return-1}}e.exports=function(e){var t=function(e){var t=[],r=e.indexOf("\n");for(;-1!==r;)t.push(r+1),r=e.indexOf("\n",r+1);return t.push(e.length+1),t}(String(e));return{toPosition:n(t),toOffset:i(t)}}},function(e,t,r){"use strict";e.exports=function(e,t){return function(r){var n,i=0,o=r.indexOf("\\"),a=e[t],s=[];for(;-1!==o;)s.push(r.slice(i,o)),i=o+1,(n=r.charAt(i))&&-1!==a.indexOf(n)||s.push("\\"),o=r.indexOf("\\",i);return s.push(r.slice(i)),s.join("")}}},function(e,t,r){"use strict";var n=r(12),i=r(56);e.exports=function(e){return o.raw=function(e,o,a){return i(e,n(a,{position:t(o),warning:r}))},o;function t(t){for(var r=e.offset,n=t.line,i=[];++n&&n in r;)i.push((r[n]||0)+1);return{start:t,indent:i}}function r(t,r,n){3!==n&&e.file.message(t,r)}function o(n,o,a){i(n,{position:t(o),warning:r,text:a,reference:a,textContext:e,referenceContext:e})}}},function(e){e.exports=JSON.parse('{"AElig":"","AMP":"&","Aacute":"","Acirc":"","Agrave":"","Aring":"","Atilde":"","Auml":"","COPY":"","Ccedil":"","ETH":"","Eacute":"","Ecirc":"","Egrave":"","Euml":"","GT":">","Iacute":"","Icirc":"","Igrave":"","Iuml":"","LT":"<","Ntilde":"","Oacute":"","Ocirc":"","Ograve":"","Oslash":"","Otilde":"","Ouml":"","QUOT":"\\"","REG":"","THORN":"","Uacute":"","Ucirc":"","Ugrave":"","Uuml":"","Yacute":"","aacute":"","acirc":"","acute":"","aelig":"","agrave":"","amp":"&","aring":"","atilde":"","auml":"","brvbar":"","ccedil":"","cedil":"","cent":"","copy":"","curren":"","deg":"","divide":"","eacute":"","ecirc":"","egrave":"","eth":"","euml":"","frac12":"","frac14":"","frac34":"","gt":">","iacute":"","icirc":"","iexcl":"","igrave":"","iquest":"","iuml":"","laquo":"","lt":"<","macr":"","micro":"","middot":"","nbsp":"","not":"","ntilde":"","oacute":"","ocirc":"","ograve":"","ordf":"","ordm":"","oslash":"","otilde":"","ouml":"","para":"","plusmn":"","pound":"","quot":"\\"","raquo":"","reg":"","sect":"","shy":"","sup1":"","sup2":"","sup3":"","szlig":"","thorn":"","times":"","uacute":"","ucirc":"","ugrave":"","uml":"","uuml":"","yacute":"","yen":"","yuml":""}')},function(e){e.exports=JSON.parse('{"0":"","128":"","130":"","131":"","132":"","133":"","134":"","135":"","136":"","137":"","138":"","139":"","140":"","142":"","145":"","146":"","147":"","148":"","149":"","150":"","151":"","152":"","153":"","154":"","155":"","156":"","158":"","159":""}')},function(e,t,r){"use strict";e.exports=function(e){var t="string"==typeof e?e.charCodeAt(0):e;return t>=97&&t<=102||t>=65&&t<=70||t>=48&&t<=57}},function(e,t,r){"use strict";var n=r(86),i=r(28);e.exports=function(e){return n(e)||i(e)}},function(e,t,r){"use strict";var n;e.exports=function(e){var t,r="&"+e+";";if((n=n||document.createElement("i")).innerHTML=r,59===(t=n.textContent).charCodeAt(t.length-1)&&"semi"!==e)return!1;return t!==r&&t}},function(e,t,r){"use strict";e.exports=function(e){return function(t,r){var o,a,s,l,u,c,d=this,p=d.offset,f=[],h=d[e+"Methods"],m=d[e+"Tokenizers"],g=r.line,y=r.column;if(!t)return f;S.now=v,S.file=d.file,_("");for(;t;){for(o=-1,a=h.length,u=!1;++o<a&&(l=h[o],!(s=m[l])||s.onlyAtStart&&!d.atStart||s.notInList&&d.inList||s.notInBlock&&d.inBlock||s.notInLink&&d.inLink||(c=t.length,s.apply(d,[S,t]),!(u=c!==t.length))););u||d.file.fail(new Error("Infinite loop"),S.now())}return d.eof=v(),f;function _(e){for(var t=-1,r=e.indexOf("\n");-1!==r;)g++,t=r,r=e.indexOf("\n",r+1);-1===t?y+=e.length:y=e.length-t,g in p&&(-1!==t?y+=p[g]:y<=p[g]&&(y=p[g]+1))}function v(){var e={line:g,column:y};return e.offset=d.toOffset(e),e}function E(e){this.start=e,this.end=v()}function S(e){var r,o=function(){var e=[],t=g+1;return function(){for(var r=g+1;t<r;)e.push((p[t]||0)+1),t++;return e}}(),a=(r=v(),function(e,t){var n=e.position,i=n?n.start:r,o=[],a=n&&n.end.line,s=r.line;if(e.position=new E(i),n&&t&&n.indent){if(o=n.indent,a<s){for(;++a<s;)o.push((p[a]||0)+1);o.push(r.column)}t=o.concat(t)}return e.position.indent=t||[],e}),s=v();return function(e){t.substring(0,e.length)!==e&&d.file.fail(new Error("Incorrectly eaten value: please report this warning on http://git.io/vg5Ft"),v())}(e),l.reset=u,u.test=c,l.test=c,t=t.substring(e.length),_(e),o=o(),l;function l(e,t){return a(function(e,t){var r=t?t.children:f,o=r[r.length-1];return o&&e.type===o.type&&e.type in n&&i(o)&&i(e)&&(e=n[e.type].call(d,o,e)),e!==o&&r.push(e),d.atStart&&0!==f.length&&d.exitStart(),e}(a(e),t),o)}function u(){var r=l.apply(null,arguments);return g=s.line,y=s.column,t=e+t,r}function c(){var r=a({});return g=s.line,y=s.column,t=e+t,r.position}}}};var n={text:function(e,t){return e.value+=t.value,e},blockquote:function(e,t){if(this.options.commonmark)return t;return e.children=e.children.concat(t.children),e}};function i(e){var t,r;return"text"!==e.type||!e.position||(t=e.position.start,r=e.position.end,t.line!==r.line||r.column-t.column===e.value.length)}},function(e,t,r){"use strict";var n=r(12),i=r(212),o=r(87);e.exports=function(e){var t,r,a=this.options;if(null==e)e={};else{if("object"!=typeof e)throw new Error("Invalid value `"+e+"` for setting `options`");e=n(e)}for(t in o){if(null==(r=e[t])&&(r=a[t]),"blocks"!==t&&"boolean"!=typeof r||"blocks"===t&&"object"!=typeof r)throw new Error("Invalid value `"+r+"` for setting `options."+t+"`");e[t]=r}return this.options=e,this.escape=i(e),this}},function(e,t,r){"use strict";e.exports=a;var n=["\\","`","*","{","}","[","]","(",")","#","+","-",".","!","_",">"],i=n.concat(["~","|"]),o=i.concat(["\n",'"',"$","%","&","'",",","/",":",";","<","=","?","@","^"]);function a(e){var t=e||{};return t.commonmark?o:t.gfm?i:n}a.default=n,a.gfm=i,a.commonmark=o},function(e){e.exports=JSON.parse('["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","iframe","legend","li","link","main","menu","menuitem","meta","nav","noframes","ol","optgroup","option","p","param","pre","section","source","title","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"]')},function(e,t,r){"use strict";var n=r(12),i=r(215);e.exports=function(){var e,t=String(this.file),r={line:1,column:1,offset:0},a=n(r);65279===(t=t.replace(o,"\n")).charCodeAt(0)&&(t=t.slice(1),a.column++,a.offset++);e={type:"root",children:this.tokenizeBlock(t,a),position:{start:r,end:this.eof||n(r)}},this.options.position||i(e,!0);return e};var o=/\r\n|\r/g},function(e,t,r){"use strict";var n=r(29);function i(e){delete e.position}function o(e){e.position=void 0}e.exports=function(e,t){return n(e,t?i:o),e}},function(e,t,r){"use strict";e.exports=i;var n=r(217);function i(e,t,r,i){var a;function s(e,n,l){var u,c=[];return(t&&!a(e,n,l[l.length-1]||null)||!1!==(c=o(r(e,l)))[0])&&e.children&&"skip"!==c[0]&&!1===(u=o(function(e,t){var r,n=i?-1:1,o=(i?e.length:-1)+n;for(;o>-1&&o<e.length;){if(!1===(r=s(e[o],o,t))[0])return r;o="number"==typeof r[1]?r[1]:o+n}}(e.children,l.concat(e))))[0]?u:c}"function"==typeof t&&"function"!=typeof r&&(i=r,r=t,t=null),a=n(t),s(e,null,[])}function o(e){return null!==e&&"object"==typeof e&&"length"in e?e:"number"==typeof e?[!0,e]:[e]}i.CONTINUE=!0,i.SKIP="skip",i.EXIT=!1},function(e,t,r){"use strict";function n(e){if("string"==typeof e)return function(e){return function(t){return Boolean(t&&t.type===e)}}(e);if(null==e)return a;if("object"==typeof e)return("length"in e?o:i)(e);if("function"==typeof e)return e;throw new Error("Expected function, string, or object as test")}function i(e){return function(t){var r;for(r in e)if(t[r]!==e[r])return!1;return!0}}function o(e){var t=function(e){for(var t=[],r=e.length,i=-1;++i<r;)t[i]=n(e[i]);return t}(e),r=t.length;return function(){var e=-1;for(;++e<r;)if(t[e].apply(this,arguments))return!0;return!1}}function a(){return!0}e.exports=n},function(e,t,r){"use strict";var n=r(8);e.exports=function(e,t,r){var i,o,a,s,l=t.charAt(0);if("\n"!==l)return;if(r)return!0;s=1,i=t.length,o=l,a="";for(;s<i&&(l=t.charAt(s),n(l));)a+=l,"\n"===l&&(o+=a,a=""),s++;e(o)}},function(e,t,r){"use strict";var n=r(57),i=r(58);e.exports=function(e,t,r){var n,a,s,l=-1,u=t.length,c="",d="",p="",f="";for(;++l<u;)if(n=t.charAt(l),s)if(s=!1,c+=p,d+=f,p="",f="","\n"===n)p=n,f=n;else for(c+=n,d+=n;++l<u;){if(!(n=t.charAt(l))||"\n"===n){f=n,p=n;break}c+=n,d+=n}else if(" "===n&&t.charAt(l+1)===n&&t.charAt(l+2)===n&&t.charAt(l+3)===n)p+=o,l+=3,s=!0;else if("\t"===n)p+=n,s=!0;else{for(a="";"\t"===n||" "===n;)a+=n,n=t.charAt(++l);if("\n"!==n)break;p+=a+n,f+=n}if(d)return!!r||e(c)({type:"code",lang:null,value:i(d)})};var o=n(" ",4)},function(e,t,r){"use strict";var n=r(58);e.exports=function(e,t,r){var i,o,a,s,l,u,c,d,p,f,h,m=this.options,g=t.length+1,y=0,_="";if(!m.gfm)return;for(;y<g&&(" "===(a=t.charAt(y))||"\t"===a);)_+=a,y++;if(f=y,"~"!==(a=t.charAt(y))&&"`"!==a)return;y++,o=a,i=1,_+=a;for(;y<g&&(a=t.charAt(y))===o;)_+=a,i++,y++;if(i<3)return;for(;y<g&&(" "===(a=t.charAt(y))||"\t"===a);)_+=a,y++;s="",l="";for(;y<g&&"\n"!==(a=t.charAt(y))&&"~"!==a&&"`"!==a;)" "===a||"\t"===a?l+=a:(s+=l+a,l=""),y++;if((a=t.charAt(y))&&"\n"!==a)return;if(r)return!0;(h=e.now()).column+=_.length,h.offset+=_.length,_+=s,s=this.decode.raw(this.unescape(s),h),l&&(_+=l);l="",d="",p="",u="",c="";for(;y<g;)if(a=t.charAt(y),u+=d,c+=p,d="",p="","\n"===a){for(u?(d+=a,p+=a):_+=a,l="",y++;y<g&&" "===(a=t.charAt(y));)l+=a,y++;if(d+=l,p+=l.slice(f),!(l.length>=4)){for(l="";y<g&&(a=t.charAt(y))===o;)l+=a,y++;if(d+=l,p+=l,!(l.length<i)){for(l="";y<g&&(" "===(a=t.charAt(y))||"\t"===a);)d+=a,p+=a,y++;if(!a||"\n"===a)break}}}else u+=a,p+=a,y++;return e(_+=u+d)({type:"code",lang:s||null,value:n(c)})}},function(e,t,r){"use strict";var n=r(16),i=r(59);e.exports=function(e,t,r){var o,a,s,l,u,c,d,p,f,h=this.offset,m=this.blockTokenizers,g=this.interruptBlockquote,y=e.now(),_=y.line,v=t.length,E=[],S=[],b=[],T=0;for(;T<v&&(" "===(a=t.charAt(T))||"\t"===a);)T++;if(">"!==t.charAt(T))return;if(r)return!0;T=0;for(;T<v;){for(l=t.indexOf("\n",T),d=T,p=!1,-1===l&&(l=v);T<v&&(" "===(a=t.charAt(T))||"\t"===a);)T++;if(">"===t.charAt(T)?(T++,p=!0," "===t.charAt(T)&&T++):T=d,u=t.slice(T,l),!p&&!n(u)){T=d;break}if(!p&&(s=t.slice(T),i(g,m,this,[e,s,!0])))break;c=d===T?u:t.slice(d,l),b.push(T-d),E.push(c),S.push(u),T=l+1}T=-1,v=b.length,o=e(E.join("\n"));for(;++T<v;)h[_]=(h[_]||0)+b[T],_++;return f=this.enterBlock(),S=this.tokenizeBlock(S.join("\n"),y),f(),o({type:"blockquote",children:S})}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i,o,a=this.options,s=t.length+1,l=-1,u=e.now(),c="",d="";for(;++l<s;){if(" "!==(n=t.charAt(l))&&"\t"!==n){l--;break}c+=n}o=0;for(;++l<=s;){if("#"!==(n=t.charAt(l))){l--;break}c+=n,o++}if(o>6)return;if(!o||!a.pedantic&&"#"===t.charAt(l+1))return;s=t.length+1,i="";for(;++l<s;){if(" "!==(n=t.charAt(l))&&"\t"!==n){l--;break}i+=n}if(!a.pedantic&&0===i.length&&n&&"\n"!==n)return;if(r)return!0;c+=i,i="",d="";for(;++l<s&&(n=t.charAt(l))&&"\n"!==n;)if(" "===n||"\t"===n||"#"===n){for(;" "===n||"\t"===n;)i+=n,n=t.charAt(++l);for(;"#"===n;)i+=n,n=t.charAt(++l);for(;" "===n||"\t"===n;)i+=n,n=t.charAt(++l);l--}else d+=i+n,i="";return u.column+=c.length,u.offset+=c.length,e(c+=d+i)({type:"heading",depth:o,children:this.tokenizeInline(d,u)})}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i,o,a,s=-1,l=t.length+1,u="";for(;++s<l&&("\t"===(n=t.charAt(s))||" "===n);)u+=n;if("*"!==n&&"-"!==n&&"_"!==n)return;i=n,u+=n,o=1,a="";for(;++s<l;)if((n=t.charAt(s))===i)o++,u+=a+i,a="";else{if(" "!==n)return o>=3&&(!n||"\n"===n)?(u+=a,!!r||e(u)({type:"thematicBreak"})):void 0;a+=n}}},function(e,t,r){"use strict";var n=r(16),i=r(57),o=r(28),a=r(88),s=r(225),l=r(59);e.exports=function(e,t,r){var i,a,s,u,c,d,p,f,_,v,E,S,b,T,w,M,x,P,I,C,A,N,D,k,L=this.options.commonmark,R=this.options.pedantic,O=this.blockTokenizers,U=this.interruptList,j=0,F=t.length,B=null,z=0;for(;j<F;){if("\t"===(u=t.charAt(j)))z+=4-z%4;else{if(" "!==u)break;z++}j++}if(z>=4)return;if(u=t.charAt(j),i=L?g:m,!0===h[u])c=u,s=!1;else{for(s=!0,a="";j<F&&(u=t.charAt(j),o(u));)a+=u,j++;if(u=t.charAt(j),!a||!0!==i[u])return;B=parseInt(a,10),c=u}if(" "!==(u=t.charAt(++j))&&"\t"!==u)return;if(r)return!0;j=0,T=[],w=[],M=[];for(;j<F;){for(d=t.indexOf("\n",j),p=j,f=!1,k=!1,-1===d&&(d=F),D=j+4,z=0;j<F;){if("\t"===(u=t.charAt(j)))z+=4-z%4;else{if(" "!==u)break;z++}j++}if(z>=4&&(k=!0),x&&z>=x.indent&&(k=!0),u=t.charAt(j),_=null,!k){if(!0===h[u])_=u,j++,z++;else{for(a="";j<F&&(u=t.charAt(j),o(u));)a+=u,j++;u=t.charAt(j),j++,a&&!0===i[u]&&(_=u,z+=a.length+1)}if(_)if("\t"===(u=t.charAt(j)))z+=4-z%4,j++;else if(" "===u){for(D=j+4;j<D&&" "===t.charAt(j);)j++,z++;j===D&&" "===t.charAt(j)&&(j-=3,z-=3)}else"\n"!==u&&""!==u&&(_=null)}if(_){if(!R&&c!==_)break;f=!0}else L||k||" "!==t.charAt(p)?L&&x&&(k=z>=x.indent||z>4):k=!0,f=!1,j=p;if(E=t.slice(p,d),v=p===j?E:t.slice(j,d),("*"===_||"_"===_||"-"===_)&&O.thematicBreak.call(this,e,E,!0))break;if(S=b,b=!n(v).length,k&&x)x.value=x.value.concat(M,E),w=w.concat(M,E),M=[];else if(f)0!==M.length&&(x.value.push(""),x.trail=M.concat()),x={value:[E],indent:z,trail:[]},T.push(x),w=w.concat(M,E),M=[];else if(b){if(S)break;M.push(E)}else{if(S)break;if(l(U,O,this,[e,E,!0]))break;x.value=x.value.concat(M,E),w=w.concat(M,E),M=[]}j=d+1}A=e(w.join("\n")).reset({type:"list",ordered:s,start:B,loose:null,children:[]}),P=this.enterList(),I=this.enterBlock(),C=!1,j=-1,F=T.length;for(;++j<F;)x=T[j].value.join("\n"),N=e.now(),(x=e(x)(y(this,x,N),A)).loose&&(C=!0),x=T[j].trail.join("\n"),j!==F-1&&(x+="\n"),e(x);return P(),I(),A.loose=C,A};var u=/\n\n(?!\s*$)/,c=/^\[([ \t]|x|X)][ \t]/,d=/^([ \t]*)([*+-]|\d+[.)])( {1,4}(?! )| |\t|$|(?=\n))([^\n]*)/,p=/^([ \t]*)([*+-]|\d+[.)])([ \t]+)/,f=/^( {1,4}|\t)?/gm,h={"*":!0,"+":!0,"-":!0},m={".":!0},g={};function y(e,t,r){var n,i,o=e.offset,a=e.options.pedantic?_:v,s=null;return t=a.apply(null,arguments),e.options.gfm&&(n=t.match(c))&&(i=n[0].length,s="x"===n[1].toLowerCase(),o[r.line]+=i,t=t.slice(i)),{type:"listItem",loose:u.test(t)||"\n"===t.charAt(t.length-1),checked:s,children:e.tokenizeBlock(t,r)}}function _(e,t,r){var n=e.offset,i=r.line;return t=t.replace(p,o),i=r.line,t.replace(f,o);function o(e){return n[i]=(n[i]||0)+e.length,i++,""}}function v(e,t,r){var n,o,l,u,c,p,f,h=e.offset,m=r.line;for(u=(t=t.replace(d,(function(e,t,r,a,s){o=t+r+a,l=s,Number(r)<10&&o.length%2==1&&(r=" "+r);return(n=t+i(" ",r.length)+a)+l}))).split("\n"),(c=s(t,a(n).indent).split("\n"))[0]=l,h[m]=(h[m]||0)+o.length,m++,p=0,f=u.length;++p<f;)h[m]=(h[m]||0)+u[p].length-c[p].length,m++;return c.join("\n")}g["."]=!0,g[")"]=!0},function(e,t,r){"use strict";var n=r(16),i=r(57),o=r(88);e.exports=function(e,t){var r,a,s,l,u=e.split("\n"),c=u.length+1,d=1/0,p=[];u.unshift(i(" ",t)+"!");for(;c--;)if(a=o(u[c]),p[c]=a.stops,0!==n(u[c]).length){if(!a.indent){d=1/0;break}a.indent>0&&a.indent<d&&(d=a.indent)}if(d!==1/0)for(c=u.length;c--;){for(s=p[c],r=d;r&&!(r in s);)r--;l=0!==n(u[c]).length&&d&&r!==d?"\t":"",u[c]=l+u[c].slice(r in s?s[r]+1:0)}return u.shift(),u.join("\n")}},function(e,t,r){"use strict";e.exports=function(e,t,r){var i,o,a,s,l,u=e.now(),c=t.length,d=-1,p="";for(;++d<c;){if(" "!==(a=t.charAt(d))||d>=3){d--;break}p+=a}i="",o="";for(;++d<c;){if("\n"===(a=t.charAt(d))){d--;break}" "===a||"\t"===a?o+=a:(i+=o+a,o="")}if(u.column+=p.length,u.offset+=p.length,p+=i+o,a=t.charAt(++d),s=t.charAt(++d),"\n"!==a||!n[s])return;p+=a,o=s,l=n[s];for(;++d<c;){if((a=t.charAt(d))!==s){if("\n"!==a)return;d--;break}o+=a}if(r)return!0;return e(p+o)({type:"heading",depth:l,children:this.tokenizeInline(i,u)})};var n={};n["="]=1,n["-"]=2},function(e,t,r){"use strict";var n=r(89).openCloseTag;e.exports=function(e,t,r){var i,o,a,s,l,u,c,d=this.options.blocks,p=t.length,f=0,h=[[/^<(script|pre|style)(?=(\s|>|$))/i,/<\/(script|pre|style)>/i,!0],[/^<!--/,/-->/,!0],[/^<\?/,/\?>/,!0],[/^<![A-Za-z]/,/>/,!0],[/^<!\[CDATA\[/,/\]\]>/,!0],[new RegExp("^</?("+d.join("|")+")(?=(\\s|/?>|$))","i"),/^$/,!0],[new RegExp(n.source+"\\s*$"),/^$/,!1]];for(;f<p&&("\t"===(s=t.charAt(f))||" "===s);)f++;if("<"!==t.charAt(f))return;i=-1===(i=t.indexOf("\n",f+1))?p:i,o=t.slice(f,i),a=-1,l=h.length;for(;++a<l;)if(h[a][0].test(o)){u=h[a];break}if(!u)return;if(r)return u[2];if(f=i,!u[1].test(o))for(;f<p;){if(i=-1===(i=t.indexOf("\n",f+1))?p:i,o=t.slice(f+1,i),u[1].test(o)){o&&(f=i);break}f=i}return c=t.slice(0,f),e(c)({type:"html",value:c})}},function(e,t,r){"use strict";var n=r(8),i=r(60);e.exports=a,a.notInList=!0,a.notInBlock=!0;var o=/^( {4}|\t)?/gm;function a(e,t,r){var a,s,l,u,c,d,p,f,h,m,g,y,_=this.offset;if(this.options.footnotes){for(a=0,s=t.length,l="",u=e.now(),c=u.line;a<s&&(h=t.charAt(a),n(h));)l+=h,a++;if("["===t.charAt(a)&&"^"===t.charAt(a+1)){for(a=(l+="[^").length,p="";a<s&&"]"!==(h=t.charAt(a));)"\\"===h&&(p+=h,a++,h=t.charAt(a)),p+=h,a++;if(p&&"]"===t.charAt(a)&&":"===t.charAt(a+1)){if(r)return!0;for(m=i(p),a=(l+=p+"]:").length;a<s&&("\t"===(h=t.charAt(a))||" "===h);)l+=h,a++;for(u.column+=l.length,u.offset+=l.length,p="",d="",f="";a<s;){if("\n"===(h=t.charAt(a))){for(f=h,a++;a<s&&"\n"===(h=t.charAt(a));)f+=h,a++;for(p+=f,f="";a<s&&" "===(h=t.charAt(a));)f+=h,a++;if(0===f.length)break;p+=f}p&&(d+=p,p=""),d+=h,a++}return l+=d,d=d.replace(o,(function(e){return _[c]=(_[c]||0)+e.length,c++,""})),g=e(l),y=this.enterBlock(),d=this.tokenizeBlock(d,u),y(),g({type:"footnoteDefinition",identifier:m,children:d})}}}}},function(e,t,r){"use strict";e.exports=function(e){return String(e).replace(/\s+/g," ")}},function(e,t,r){"use strict";var n=r(8),i=r(60);e.exports=o,o.notInList=!0,o.notInBlock=!0;function o(e,t,r){for(var n,o,l,u,c,d,p,f,h=this.options.commonmark,m=0,g=t.length,y="";m<g&&(" "===(u=t.charAt(m))||"\t"===u);)y+=u,m++;if("["===(u=t.charAt(m))){for(m++,y+=u,l="";m<g&&"]"!==(u=t.charAt(m));)"\\"===u&&(l+=u,m++,u=t.charAt(m)),l+=u,m++;if(l&&"]"===t.charAt(m)&&":"===t.charAt(m+1)){for(d=l,m=(y+=l+"]:").length,l="";m<g&&("\t"===(u=t.charAt(m))||" "===u||"\n"===u);)y+=u,m++;if(l="",n=y,"<"===(u=t.charAt(m))){for(m++;m<g&&a(u=t.charAt(m));)l+=u,m++;if((u=t.charAt(m))===a.delimiter)y+="<"+l+u,m++;else{if(h)return;m-=l.length+1,l=""}}if(!l){for(;m<g&&s(u=t.charAt(m));)l+=u,m++;y+=l}if(l){for(p=l,l="";m<g&&("\t"===(u=t.charAt(m))||" "===u||"\n"===u);)l+=u,m++;if(c=null,'"'===(u=t.charAt(m))?c='"':"'"===u?c="'":"("===u&&(c=")"),c){if(!l)return;for(m=(y+=l+u).length,l="";m<g&&(u=t.charAt(m))!==c;){if("\n"===u){if(m++,"\n"===(u=t.charAt(m))||u===c)return;l+="\n"}l+=u,m++}if((u=t.charAt(m))!==c)return;o=y,y+=l+u,m++,f=l,l=""}else l="",m=y.length;for(;m<g&&("\t"===(u=t.charAt(m))||" "===u);)y+=u,m++;return(u=t.charAt(m))&&"\n"!==u?void 0:!!r||(n=e(n).test().end,p=this.decode.raw(this.unescape(p),n,{nonTerminated:!1}),f&&(o=e(o).test().end,f=this.decode.raw(this.unescape(f),o)),e(y)({type:"definition",identifier:i(d),title:f||null,url:p}))}}}}function a(e){return">"!==e&&"["!==e&&"]"!==e}function s(e){return"["!==e&&"]"!==e&&!n(e)}a.delimiter=">"},function(e,t,r){"use strict";var n=r(8);e.exports=function(e,t,r){var i,o,a,s,l,u,c,d,p,f,h,m,g,y,_,v,E,S,b,T,w,M,x,P;if(!this.options.gfm)return;i=0,S=0,u=t.length+1,c=[];for(;i<u;){if(M=t.indexOf("\n",i),x=t.indexOf("|",i+1),-1===M&&(M=t.length),-1===x||x>M){if(S<2)return;break}c.push(t.slice(i,M)),S++,i=M+1}s=c.join("\n"),o=c.splice(1,1)[0]||[],i=0,u=o.length,S--,a=!1,h=[];for(;i<u;){if("|"===(p=o.charAt(i))){if(f=null,!1===a){if(!1===P)return}else h.push(a),a=!1;P=!1}else if("-"===p)f=!0,a=a||null;else if(":"===p)a="left"===a?"center":f&&null===a?"right":"left";else if(!n(p))return;i++}!1!==a&&h.push(a);if(h.length<1)return;if(r)return!0;E=-1,T=[],w=e(s).reset({type:"table",align:h,children:T});for(;++E<S;){for(b=c[E],l={type:"tableRow",children:[]},E&&e("\n"),e(b).reset(l,w),u=b.length+1,i=0,d="",m="",g=!0,y=null,_=null;i<u;)if("\t"!==(p=b.charAt(i))&&" "!==p){if(""===p||"|"===p)if(g)e(p);else{if(p&&_){d+=p,i++;continue}!m&&!p||g||(s=m,d.length>1&&(p?(s+=d.slice(0,d.length-1),d=d.charAt(d.length-1)):(s+=d,d="")),v=e.now(),e(s)({type:"tableCell",children:this.tokenizeInline(m,v)},l)),e(d+p),d="",m=""}else if(d&&(m+=d,d=""),m+=p,"\\"===p&&i!==u-2&&(m+=b.charAt(i+1),i++),"`"===p){for(y=1;b.charAt(i+1)===p;)m+=p,i++,y++;_?y>=_&&(_=0):_=y}g=!1,i++}else m?d+=p:e(p),i++;E||e("\n"+o)}return w}},function(e,t,r){"use strict";var n=r(16),i=r(28),o=r(58),a=r(59);e.exports=function(e,t,r){var s,l,u,c,d,p=this.options,f=p.commonmark,h=p.gfm,m=this.blockTokenizers,g=this.interruptParagraph,y=t.indexOf("\n"),_=t.length;for(;y<_;){if(-1===y){y=_;break}if("\n"===t.charAt(y+1))break;if(f){for(c=0,s=y+1;s<_;){if("\t"===(u=t.charAt(s))){c=4;break}if(" "!==u)break;c++,s++}if(c>=4){y=t.indexOf("\n",y+1);continue}}if(l=t.slice(y+1),a(g,m,this,[e,l,!0]))break;if(m.list.call(this,e,l,!0)&&(this.inList||f||h&&!i(n.left(l).charAt(0))))break;if(s=y,-1!==(y=t.indexOf("\n",y+1))&&""===n(t.slice(s,y))){y=s;break}}if(l=t.slice(0,y),""===n(l))return e(l),null;if(r)return!0;return d=e.now(),l=o(l),e(l)({type:"paragraph",children:this.tokenizeInline(l,d)})}},function(e,t,r){"use strict";var n=r(234);function i(e,t,r){var n,i;if("\\"===t.charAt(0)&&(n=t.charAt(1),-1!==this.escape.indexOf(n)))return!!r||(i="\n"===n?{type:"break"}:{type:"text",value:n},e("\\"+n)(i))}e.exports=i,i.locator=n},function(e,t,r){"use strict";e.exports=function(e,t){return e.indexOf("\\",t)}},function(e,t,r){"use strict";var n=r(8),i=r(56),o=r(90);e.exports=s,s.locator=o,s.notInLink=!0;var a="mailto:".length;function s(e,t,r){var o,s,l,u,c,d,p,f,h,m,g;if("<"===t.charAt(0)){for(this,o="",s=t.length,l=0,u="",d=!1,p="",l++,o="<";l<s&&(c=t.charAt(l),!(n(c)||">"===c||"@"===c||":"===c&&"/"===t.charAt(l+1)));)u+=c,l++;if(u){if(p+=u,u="",p+=c=t.charAt(l),l++,"@"===c)d=!0;else{if(":"!==c||"/"!==t.charAt(l+1))return;p+="/",l++}for(;l<s&&(c=t.charAt(l),!n(c)&&">"!==c);)u+=c,l++;if(c=t.charAt(l),u&&">"===c)return!!r||(h=p+=u,o+=p+c,(f=e.now()).column++,f.offset++,d&&("mailto:"===p.slice(0,a).toLowerCase()?(h=h.substr(a),f.column+=a,f.offset+=a):p="mailto:"+p),m=this.inlineTokenizers,this.inlineTokenizers={text:m.text},g=this.enterLink(),h=this.tokenizeInline(h,f),this.inlineTokenizers=m,g(),e(o)({type:"link",title:null,url:i(p,{nonTerminated:!1}),children:h}))}}}},function(e,t,r){"use strict";var n=r(56),i=r(8),o=r(237);e.exports=l,l.locator=o,l.notInLink=!0;var a=["http://","https://","mailto:"],s=a.length;function l(e,t,r){var o,l,u,c,d,p,f,h,m,g,y,_;if(this.options.gfm){for(o="",c=-1,h=s;++c<h;)if(p=a[c],(f=t.slice(0,p.length)).toLowerCase()===p){o=f;break}if(o){for(c=o.length,h=t.length,m="",g=0;c<h&&(u=t.charAt(c),!i(u)&&"<"!==u)&&("."!==u&&","!==u&&":"!==u&&";"!==u&&'"'!==u&&"'"!==u&&")"!==u&&"]"!==u||(y=t.charAt(c+1))&&!i(y))&&("("!==u&&"["!==u||g++,")"!==u&&"]"!==u||!(--g<0));)m+=u,c++;if(m){if(l=o+=m,"mailto:"===p){if(-1===(d=m.indexOf("@"))||d===h-1)return;l=l.substr("mailto:".length)}return!!r||(_=this.enterLink(),l=this.tokenizeInline(l,e.now()),_(),e(o)({type:"link",title:null,url:n(o,{nonTerminated:!1}),children:l}))}}}}},function(e,t,r){"use strict";e.exports=function(e,t){var r,i=n.length,o=-1,a=-1;if(!this.options.gfm)return-1;for(;++o<i;)-1!==(r=e.indexOf(n[o],t))&&(r<a||-1===a)&&(a=r);return a};var n=["https://","http://","mailto:"]},function(e,t,r){"use strict";var n=r(86),i=r(90),o=r(89).tag;e.exports=l,l.locator=i;var a=/^<a /i,s=/^<\/a>/i;function l(e,t,r){var i,l,u=t.length;if(!("<"!==t.charAt(0)||u<3)&&(i=t.charAt(1),(n(i)||"?"===i||"!"===i||"/"===i)&&(l=t.match(o))))return!!r||(l=l[0],!this.inLink&&a.test(l)?this.inLink=!0:this.inLink&&s.test(l)&&(this.inLink=!1),e(l)({type:"html",value:l}))}},function(e,t,r){"use strict";var n=r(8),i=r(91);e.exports=l,l.locator=i;var o={}.hasOwnProperty,a={'"':'"',"'":"'"},s={};function l(e,t,r){var i,l,u,c,d,p,f,h,m,g,y,_,v,E,S,b,T,w,M,x="",P=0,I=t.charAt(0),C=this.options.pedantic,A=this.options.commonmark,N=this.options.gfm;if("!"===I&&(m=!0,x=I,I=t.charAt(++P)),"["===I&&(m||!this.inLink)){for(x+=I,S="",P++,_=t.length,E=0,(T=e.now()).column+=P,T.offset+=P;P<_;){if(p=I=t.charAt(P),"`"===I){for(l=1;"`"===t.charAt(P+1);)p+=I,P++,l++;u?l>=u&&(u=0):u=l}else if("\\"===I)P++,p+=t.charAt(P);else if(u&&!N||"["!==I){if((!u||N)&&"]"===I){if(!E){if(!C)for(;P<_&&(I=t.charAt(P+1),n(I));)p+=I,P++;if("("!==t.charAt(P+1))return;p+="(",i=!0,P++;break}E--}}else E++;S+=p,p="",P++}if(i){for(g=S,x+=S+p,P++;P<_&&(I=t.charAt(P),n(I));)x+=I,P++;if(I=t.charAt(P),h=A?s:a,S="",c=x,"<"===I){for(P++,c+="<";P<_&&">"!==(I=t.charAt(P));){if(A&&"\n"===I)return;S+=I,P++}if(">"!==t.charAt(P))return;x+="<"+S+">",b=S,P++}else{for(I=null,p="";P<_&&(I=t.charAt(P),!p||!o.call(h,I));){if(n(I)){if(!C)break;p+=I}else{if("("===I)E++;else if(")"===I){if(0===E)break;E--}S+=p,p="","\\"===I&&(S+="\\",I=t.charAt(++P)),S+=I}P++}b=S,P=(x+=S).length}for(S="";P<_&&(I=t.charAt(P),n(I));)S+=I,P++;if(I=t.charAt(P),x+=S,S&&o.call(h,I))if(P++,x+=I,S="",y=h[I],d=x,A){for(;P<_&&(I=t.charAt(P))!==y;)"\\"===I&&(S+="\\",I=t.charAt(++P)),P++,S+=I;if((I=t.charAt(P))!==y)return;for(v=S,x+=S+I,P++;P<_&&(I=t.charAt(P),n(I));)x+=I,P++}else for(p="";P<_;){if((I=t.charAt(P))===y)f&&(S+=y+p,p=""),f=!0;else if(f){if(")"===I){x+=S+y+p,v=S;break}n(I)?p+=I:(S+=y+p+I,p="",f=!1)}else S+=I;P++}if(")"===t.charAt(P))return!!r||(x+=")",b=this.decode.raw(this.unescape(b),e(c).test().end,{nonTerminated:!1}),v&&(d=e(d).test().end,v=this.decode.raw(this.unescape(v),d)),M={type:m?"image":"link",title:v||null,url:b},m?M.alt=this.decode.raw(this.unescape(g),T)||null:(w=this.enterLink(),M.children=this.tokenizeInline(g,T),w()),e(x)(M))}}}s['"']='"',s["'"]="'",s["("]=")"},function(e,t,r){"use strict";var n=r(8),i=r(91),o=r(60);e.exports=a,a.locator=i;function a(e,t,r){var i,a,s,l,u,c,d,p,f=t.charAt(0),h=0,m=t.length,g="",y="",_="link",v="shortcut";if("!"===f&&(_="image",y=f,f=t.charAt(++h)),"["===f){if(h++,y+=f,c="",this.options.footnotes&&"^"===t.charAt(h)){if("image"===_)return;y+="^",h++,_="footnote"}for(p=0;h<m;){if("["===(f=t.charAt(h)))d=!0,p++;else if("]"===f){if(!p)break;p--}"\\"===f&&(c+="\\",f=t.charAt(++h)),c+=f,h++}if(g=c,i=c,"]"===(f=t.charAt(h))){for(h++,g+=f,c="";h<m&&(f=t.charAt(h),n(f));)c+=f,h++;if(f=t.charAt(h),"footnote"!==_&&"["===f){for(a="",c+=f,h++;h<m&&"["!==(f=t.charAt(h))&&"]"!==f;)"\\"===f&&(a+="\\",f=t.charAt(++h)),a+=f,h++;"]"===(f=t.charAt(h))?(v=a?"full":"collapsed",c+=a+f,h++):a="",g+=c,c=""}else{if(!i)return;a=i}if("full"===v||!d)return g=y+g,"link"===_&&this.inLink?null:!!r||("footnote"===_&&-1!==i.indexOf(" ")?e(g)({type:"footnote",children:this.tokenizeInline(i,e.now())}):((s=e.now()).column+=y.length,s.offset+=y.length,l={type:_+"Reference",identifier:o(a="full"===v?a:i)},"link"!==_&&"image"!==_||(l.referenceType=v),"link"===_?(u=this.enterLink(),l.children=this.tokenizeInline(i,s),u()):"image"===_&&(l.alt=this.decode.raw(this.unescape(i),s)||null),e(g)(l)))}}}},function(e,t,r){"use strict";var n=r(16),i=r(8),o=r(242);e.exports=a,a.locator=o;function a(e,t,r){var o,a,s,l,u,c,d,p=0,f=t.charAt(p);if(!("*"!==f&&"_"!==f||t.charAt(++p)!==f||(a=this.options.pedantic,u=(s=f)+s,c=t.length,p++,l="",f="",a&&i(t.charAt(p)))))for(;p<c;){if(d=f,!((f=t.charAt(p))!==s||t.charAt(p+1)!==s||a&&i(d))&&(f=t.charAt(p+2))!==s){if(!n(l))return;return!!r||((o=e.now()).column+=2,o.offset+=2,e(u+l+u)({type:"strong",children:this.tokenizeInline(l,o)}))}a||"\\"!==f||(l+=f,f=t.charAt(++p)),l+=f,p++}}},function(e,t,r){"use strict";e.exports=function(e,t){var r=e.indexOf("**",t),n=e.indexOf("__",t);if(-1===n)return r;if(-1===r)return n;return n<r?n:r}},function(e,t,r){"use strict";var n=r(16),i=r(244),o=r(8),a=r(245);e.exports=s,s.locator=a;function s(e,t,r){var a,s,l,u,c,d,p,f=0,h=t.charAt(f);if(!("*"!==h&&"_"!==h||(s=this.options.pedantic,c=h,l=h,d=t.length,f++,u="",h="",s&&o(t.charAt(f)))))for(;f<d;){if(p=h,!((h=t.charAt(f))!==l||s&&o(p))){if((h=t.charAt(++f))!==l){if(!n(u)||p===l)return;if(!s&&"_"===l&&i(h)){u+=l;continue}return!!r||((a=e.now()).column++,a.offset++,e(c+u+l)({type:"emphasis",children:this.tokenizeInline(u,a)}))}u+=l}s||"\\"!==h||(u+=h,h=t.charAt(++f)),u+=h,f++}}},function(e,t,r){"use strict";e.exports=function(e){return i.test("number"==typeof e?n(e):e.charAt(0))};var n=String.fromCharCode,i=/\w/},function(e,t,r){"use strict";e.exports=function(e,t){var r=e.indexOf("*",t),n=e.indexOf("_",t);if(-1===n)return r;if(-1===r)return n;return n<r?n:r}},function(e,t,r){"use strict";var n=r(8),i=r(247);e.exports=o,o.locator=i;function o(e,t,r){var i,o,a,s="",l="",u="",c="";if(this.options.gfm&&"~"===t.charAt(0)&&"~"===t.charAt(1)&&!n(t.charAt(2)))for(i=1,o=t.length,(a=e.now()).column+=2,a.offset+=2;++i<o;){if(!("~"!==(s=t.charAt(i))||"~"!==l||u&&n(u)))return!!r||e("~~"+c+"~~")({type:"delete",children:this.tokenizeInline(c,a)});c+=l,u=l,l=s}}},function(e,t,r){"use strict";e.exports=function(e,t){return e.indexOf("~~",t)}},function(e,t,r){"use strict";var n=r(8),i=r(249);e.exports=o,o.locator=i;function o(e,t,r){for(var i,o,a,s,l,u,c,d,p=t.length,f=0,h="",m="";f<p&&"`"===t.charAt(f);)h+="`",f++;if(h){for(l=h,s=f,h="",d=t.charAt(f),a=0;f<p;){if(u=d,d=t.charAt(f+1),"`"===u?(a++,m+=u):(a=0,h+=u),a&&"`"!==d){if(a===s){l+=h+m,c=!0;break}h+=m,m=""}f++}if(!c){if(s%2!=0)return;h=""}if(r)return!0;for(i="",o="",p=h.length,f=-1;++f<p;)u=h.charAt(f),n(u)?o+=u:(o&&(i&&(i+=o),o=""),i+=u);return e(l)({type:"inlineCode",value:i})}}},function(e,t,r){"use strict";e.exports=function(e,t){return e.indexOf("`",t)}},function(e,t,r){"use strict";var n=r(251);e.exports=i,i.locator=n;function i(e,t,r){for(var n,i=t.length,o=-1,a="";++o<i;){if("\n"===(n=t.charAt(o))){if(o<2)return;return!!r||e(a+=n)({type:"break"})}if(" "!==n)return;a+=n}}},function(e,t,r){"use strict";e.exports=function(e,t){var r=e.indexOf("\n",t);for(;r>t&&" "===e.charAt(r-1);)r--;return r}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n,i,o,a,s,l,u,c,d,p;if(r)return!0;n=this.inlineMethods,a=n.length,i=this.inlineTokenizers,o=-1,d=t.length;for(;++o<a;)"text"!==(c=n[o])&&i[c]&&((u=i[c].locator)||e.file.fail("Missing locator: `"+c+"`"),-1!==(l=u.call(this,t,1))&&l<d&&(d=l));s=t.slice(0,d),p=e.now(),this.decode(s,p,(function(t,r,n){e(n||t)({type:"text",value:t})}))}},function(e,t,r){var n=r(254);e.exports=function(){return function(e){return n(e,"list",(function(e,t){var r,n,i=0;for(r=0,n=t.length;r<n;r++)"list"===t[r].type&&(i+=1);for(r=0,n=e.children.length;r<n;r++){var o=e.children[r];o.index=r,o.ordered=e.ordered}e.depth=i})),e}}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=[];"function"==typeof t&&(r=t,t=null);function i(e){var o;return t&&e.type!==t||(o=r(e,n.concat())),e.children&&!1!==o?function(e,t){var r,o=e.length,a=-1;n.push(t);for(;++a<o;)if((r=e[a])&&!1===i(r))return!1;return n.pop(),!0}(e.children,e):o}i(e)}},function(e,t,r){"use strict";var n=r(29),i=/^<(area|base|br|col|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)\s*\/?>$/i,o=/^<(\/?)([a-z]+)\s*>$/;e.exports=function(e){var t,r;return n(e,"html",(function(e,n,a){r!==a&&(t=[],r=a);var s=function(e){var t=e.value.match(i);return!!t&&t[1]}(e);if(s)return a.children.splice(n,1,{type:"virtualHtml",tag:s,position:e.position}),!0;var l=function(e,t){var r=e.value.match(o);return!!r&&{tag:r[2],opening:!r[1],node:e}}(e);if(!l)return!0;var u=function(e,t){var r=e.length;for(;r--;)if(e[r].tag===t)return e.splice(r,1)[0];return!1}(t,l.tag);return u?a.children.splice(n,0,function(e,t,r){var n=r.children.indexOf(e.node),i=r.children.indexOf(t.node),o=r.children.splice(n,i-n+1).slice(1,-1);return{type:"virtualHtml",children:o,tag:e.tag,position:{start:e.node.position.start,end:t.node.position.end,indent:[]}}}(l,u,a)):l.opening||t.push(l),!0}),!0),e}},function(e,t,r){"use strict";var n=r(29);function i(e,t,r,n){if("remove"===n)r.children.splice(t,1);else if("unwrap"===n){var i=[t,1];e.children&&(i=i.concat(e.children)),Array.prototype.splice.apply(r.children,i)}}t.ofType=function(e,t){return function(t){return e.forEach((function(e){return n(t,e,r,!0)})),t};function r(e,r,n){n&&i(e,r,n,t)}},t.ifNotMatch=function(e,t){return function(e){return n(e,r,!0),e};function r(r,n,o){o&&!e(r,n,o)&&i(r,n,o,t)}}},function(e,t,r){"use strict";var n=r(0),i=r(12),o=r(258),a={start:{line:1,column:1,offset:0},end:{line:1,column:1,offset:0}};function s(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=t.renderers[e.type];void 0===e.position&&(e.position=r.node&&r.node.position||a);var c=e.position.start,d=[e.type,c.line,c.column,i].join("-");if(!o.isValidElementType(u))throw new Error("Renderer for type `".concat(e.type,"` not defined or is not renderable"));var p=l(e,d,t,u,r,i);return n.createElement(u,p,p.children||f()||void 0);function f(){return e.children&&e.children.map((function(r,n){return s(r,t,{node:e,props:p},n)}))}}function l(e,t,r,o,a,l){var c,d={key:t},p="string"==typeof o;r.sourcePos&&e.position&&(d["data-sourcepos"]=[(c=e.position).start.line,":",c.start.column,"-",c.end.line,":",c.end.column].map(String).join("")),r.rawSourcePos&&!p&&(d.sourcePosition=e.position),r.includeNodeIndex&&a.node&&a.node.children&&!p&&(d.index=a.node.children.indexOf(e),d.parentChildCount=a.node.children.length);var f=null!==e.identifier&&void 0!==e.identifier?r.definitions[e.identifier]||{}:null;switch(e.type){case"root":u(d,{className:r.className});break;case"text":d.nodeKey=t,d.children=e.value;break;case"heading":d.level=e.depth;break;case"list":d.start=e.start,d.ordered=e.ordered,d.tight=!e.loose,d.depth=e.depth;break;case"listItem":d.checked=e.checked,d.tight=!e.loose,d.ordered=e.ordered,d.index=e.index,d.children=function(e,t){if(e.loose)return e.children;if(t.node&&e.index>0&&t.node.children[e.index-1].loose)return e.children;return function(e){return e.children.reduce((function(e,t){return e.concat("paragraph"===t.type?t.children||[]:[t])}),[])}(e)}(e,a).map((function(t,n){return s(t,r,{node:e,props:d},n)}));break;case"definition":u(d,{identifier:e.identifier,title:e.title,url:e.url});break;case"code":u(d,{language:e.lang&&e.lang.split(/\s/,1)[0]});break;case"inlineCode":d.children=e.value,d.inline=!0;break;case"link":u(d,{title:e.title||void 0,target:"function"==typeof r.linkTarget?r.linkTarget(e.url,e.children,e.title):r.linkTarget,href:r.transformLinkUri?r.transformLinkUri(e.url,e.children,e.title):e.url});break;case"image":u(d,{alt:e.alt||void 0,title:e.title||void 0,src:r.transformImageUri?r.transformImageUri(e.url,e.children,e.title,e.alt):e.url});break;case"linkReference":u(d,i(f,{href:r.transformLinkUri?r.transformLinkUri(f.href):f.href}));break;case"imageReference":u(d,{src:r.transformImageUri&&f.href?r.transformImageUri(f.href,e.children,f.title,e.alt):f.href,title:f.title||void 0,alt:e.alt||void 0});break;case"table":case"tableHead":case"tableBody":d.columnAlignment=e.align;break;case"tableRow":d.isHeader="tableHead"===a.node.type,d.columnAlignment=a.props.columnAlignment;break;case"tableCell":u(d,{isHeader:a.props.isHeader,align:a.props.columnAlignment[l]});break;case"virtualHtml":d.tag=e.tag;break;case"html":d.isBlock=e.position.start.line!==e.position.end.line,d.escapeHtml=r.escapeHtml,d.skipHtml=r.skipHtml;break;case"parsedHtml":var h;e.children&&(h=e.children.map((function(t,n){return s(t,r,{node:e,props:d},n)}))),d.escapeHtml=r.escapeHtml,d.skipHtml=r.skipHtml,d.element=function(e,t){var r=e.element;if(Array.isArray(r)){var i=n.Fragment||"div";return n.createElement(i,null,r)}if(r.props.children||t){var o=n.Children.toArray(r.props.children).concat(t);return n.cloneElement(r,null,o)}return n.cloneElement(r,null)}(e,h);break;default:u(d,i(e,{type:void 0,position:void 0,children:void 0}))}return!p&&e.value&&(d.value=e.value),d}function u(e,t){for(var r in t)void 0!==t[r]&&(e[r]=t[r])}e.exports=s},function(e,t,r){"use strict";e.exports=r(259)},function(e,t,r){"use strict";
/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n="function"==typeof Symbol&&Symbol.for,i=n?Symbol.for("react.element"):60103,o=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,l=n?Symbol.for("react.profiler"):60114,u=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,d=n?Symbol.for("react.async_mode"):60111,p=n?Symbol.for("react.concurrent_mode"):60111,f=n?Symbol.for("react.forward_ref"):60112,h=n?Symbol.for("react.suspense"):60113,m=n?Symbol.for("react.suspense_list"):60120,g=n?Symbol.for("react.memo"):60115,y=n?Symbol.for("react.lazy"):60116,_=n?Symbol.for("react.block"):60121,v=n?Symbol.for("react.fundamental"):60117,E=n?Symbol.for("react.responder"):60118,S=n?Symbol.for("react.scope"):60119;function b(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case d:case p:case a:case l:case s:case h:return e;default:switch(e=e&&e.$$typeof){case c:case f:case y:case g:case u:return e;default:return t}}case o:return t}}}function T(e){return b(e)===p}t.AsyncMode=d,t.ConcurrentMode=p,t.ContextConsumer=c,t.ContextProvider=u,t.Element=i,t.ForwardRef=f,t.Fragment=a,t.Lazy=y,t.Memo=g,t.Portal=o,t.Profiler=l,t.StrictMode=s,t.Suspense=h,t.isAsyncMode=function(e){return T(e)||b(e)===d},t.isConcurrentMode=T,t.isContextConsumer=function(e){return b(e)===c},t.isContextProvider=function(e){return b(e)===u},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===i},t.isForwardRef=function(e){return b(e)===f},t.isFragment=function(e){return b(e)===a},t.isLazy=function(e){return b(e)===y},t.isMemo=function(e){return b(e)===g},t.isPortal=function(e){return b(e)===o},t.isProfiler=function(e){return b(e)===l},t.isStrictMode=function(e){return b(e)===s},t.isSuspense=function(e){return b(e)===h},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===a||e===p||e===l||e===s||e===h||e===m||"object"==typeof e&&null!==e&&(e.$$typeof===y||e.$$typeof===g||e.$$typeof===u||e.$$typeof===c||e.$$typeof===f||e.$$typeof===v||e.$$typeof===E||e.$$typeof===S||e.$$typeof===_)},t.typeOf=b},function(e,t,r){"use strict";var n=r(29);function i(e){var t=e.children;e.children=[{type:"tableHead",align:e.align,children:[t[0]],position:t[0].position}],t.length>1&&e.children.push({type:"tableBody",align:e.align,children:t.slice(1),position:{start:t[1].position.start,end:t[t.length-1].position.end}})}e.exports=function(e){return n(e,"table",i),e}},function(e,t,r){"use strict";e.exports=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(t.children||[]).reduce((function(t,r){return"definition"===r.type&&(t[r.identifier]={href:r.url,title:r.title}),e(r,t)}),r)}},function(e,t,r){"use strict";var n=["http","https","mailto","tel"];e.exports=function(e){var t=(e||"").trim(),r=t.charAt(0);if("#"===r||"/"===r)return t;var i=t.indexOf(":");if(-1===i)return t;for(var o=n.length,a=-1;++a<o;){var s=n[a];if(i===s.length&&t.slice(0,s.length).toLowerCase()===s)return t}return-1!==(a=t.indexOf("?"))&&i>a||-1!==(a=t.indexOf("#"))&&i>a?t:"javascript:void(0)"}},function(e,t,r){"use strict";var n=r(12),i=r(0),o=parseInt((i.version||"16").slice(0,2),10)>=16,a=i.createElement;function s(e,t){return a(e,l(t),t.children)}function l(e){return e["data-sourcepos"]?{"data-sourcepos":e["data-sourcepos"]}:{}}e.exports={break:"br",paragraph:"p",emphasis:"em",strong:"strong",thematicBreak:"hr",blockquote:"blockquote",delete:"del",link:"a",image:"img",linkReference:"a",imageReference:"img",table:s.bind(null,"table"),tableHead:s.bind(null,"thead"),tableBody:s.bind(null,"tbody"),tableRow:s.bind(null,"tr"),tableCell:function(e){var t=e.align?{textAlign:e.align}:void 0,r=l(e);return a(e.isHeader?"th":"td",t?n({style:t},r):r,e.children)},root:function(e){var t=!e.className,r=t&&i.Fragment||"div";return a(r,t?null:e,e.children)},text:function(e){return o?e.children:a("span",null,e.children)},list:function(e){var t=l(e);null!==e.start&&1!==e.start&&void 0!==e.start&&(t.start=e.start.toString());return a(e.ordered?"ol":"ul",t,e.children)},listItem:function(e){var t=null;if(null!==e.checked&&void 0!==e.checked){var r=e.checked;t=a("input",{type:"checkbox",checked:r,readOnly:!0})}return a("li",l(e),t,e.children)},definition:function(){return null},heading:function(e){return a("h".concat(e.level),l(e),e.children)},inlineCode:function(e){return a("code",l(e),e.children)},code:function(e){var t=e.language&&"language-".concat(e.language),r=a("code",t?{className:t}:null,e.value);return a("pre",l(e),r)},html:function(e){if(e.skipHtml)return null;var t=e.isBlock?"div":"span";if(e.escapeHtml){var r=i.Fragment||t;return a(r,null,e.value)}var n={dangerouslySetInnerHTML:{__html:e.value}};return a(t,n)},virtualHtml:function(e){return a(e.tag,l(e),e.children)},parsedHtml:function(e){return e["data-sourcepos"]?i.cloneElement(e.element,{"data-sourcepos":e["data-sourcepos"]}):e.element}}},function(e,t,r){"use strict";t.HtmlParser="undefined"==typeof Symbol?"__RMD_HTML_PARSER__":Symbol("__RMD_HTML_PARSER__")},function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n),o=r(2),a=r.n(o),s=r(1),l=r.n(s),u=r(32),c=r.n(u);function d(e){if(!isNaN(e))return e;const t=e.match(/^(?:(\d{2,}):)?(\d{2}):(\d{2})[,.](\d{3})$/);if(!t)throw new Error('Invalid SRT or VTT time format: "'+e+'"');return(t[1]?36e5*parseInt(t[1],10):0)+6e4*parseInt(t[2],10)+1e3*parseInt(t[3],10)+parseInt(t[4],10)}r(10);const p=/^((?:\d{2,}:)?\d{2}:\d{2}[,.]\d{3}) --> ((?:\d{2,}:)?\d{2}:\d{2}[,.]\d{3})(?: (.*))?$/;function f(e){if(!e)return[];const t=e.trim().concat("\n").replace(/\r\n/g,"\n").replace(/\n{3,}/g,"\n\n").replace(/^WEBVTT.*\n(?:.*: .*\n)*\n/,"").split("\n");return t.reduce((e,r,n)=>{const i=e[e.length-1];if(!i.index&&/^\d+$/.test(r))return i.index=parseInt(r,10),e;if(!i.hasOwnProperty("start")){const t=function(e){const t=p.exec(e);if(t){const e={start:d(t[1]),end:d(t[2])};return t[3]&&(e.settings=t[3]),e}}(r);return t?Object.assign(i,t):e.length>1&&(e[e.length-2].text+="\n"+r),e}return""===r?(delete i.index,n!==t.length-1&&e.push({})):i.text=i.text?i.text+"\n"+r:r,e},[{}])}var h=r(92),m=r.n(h);function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){_(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var v=function(e){return m.a.parseStringPromise(e.toString()).then((function(e){var t=l()(e,"['vmap:VMAP']['vmap:AdBreak']",[]);return t=t.map((function(e){var t=l()(e,"['vmap:AdSource']['0']['vmap:VASTAdData']['0']['VAST']['0']['Ad']['0']['$']['id']",""),r=l()(e,"['vmap:AdSource']['0']['vmap:VASTAdData']['0']['VAST']['0']['Ad']['0']['InLine']['0']['Impression']['0']",""),n=l()(e,"['vmap:AdSource']['0']['vmap:VASTAdData']['0']['VAST']['0']['Ad']['0']['InLine']['0']['Creatives']['0']['Creative']['0']['Linear']['0']","");return y(y({},e.$),{},{id:t,impression:r,durations:l()(n,"Duration",[]),mediafile:l()(n,"['MediaFiles']['0']['MediaFile']['0']['_']",""),isPlayed:!1})}))})).catch((function(e){return console.log("failed",e),[]}))},E=r(93).a,S=r(3);function b(){var e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["{\n  span {\n    color: #fff;\n    font-weight: bold;\n    display: inline-block;\n    vertical-align: middle;\n    padding-left: 0.5rem;\n  }\n\n  .animationContainer {\n    display: inline-block;\n    vertical-align: middle;\n    position: relative;\n    width: 2rem;\n    height: 2rem;\n  }\n  \n  .animationContainer svg {\n    position: absolute;\n  }\n  \n  .animationContainer i {\n    background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgdmlld0JveD0iMCAwIDIyIDIyIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDojMmM1NmZmO30uYntmaWxsOiNmZmY7fTwvc3R5bGU+PC9kZWZzPjxjaXJjbGUgY2xhc3M9ImEiIGN4PSIxMSIgY3k9IjExIiByPSIxMSIvPjxwYXRoIGNsYXNzPSJiIiBkPSJNMjkuNDc3LDI2LjI4MSwyMi43NDMsMjIuNTRhMS4xMzQsMS4xMzQsMCwwLDAtMS42ODQuOTkydjcuNDgyQTEuMTM0LDEuMTM0LDAsMCwwLDIyLjc0MywzMmw2LjczMy0zLjc0MUExLjEzNCwxLjEzNCwwLDAsMCwyOS40NzcsMjYuMjgxWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzLjA1OSAtMTYuMzk2KSIvPjwvc3ZnPg==');\n    background-repeat: no-repeat;\n    background-size: contain;\n    display: inline-block;\n    width: 1.6rem;\n    height: 1.6rem;\n    vertical-align: middle;\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n  }\n  \n  .timeCount {\n    transition: all 1s linear;\n    stroke-linecap: round;\n  }\n  \n  @media screen and (max-width: 640px) {\n    .animationContainer {\n      width: 16px;\n      height: 16px;\n    }\n  \n    .animationContainer i {\n      width: 12px;\n      height: 12px;\n    }\n  }\n}"]);return b=function(){return e},e}var T=Object(S.a)(b());function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=N(e);if(t){var i=N(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return C(this,r)}}function C(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?A(e):t}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var k=2*Math.PI*49,L=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(a,e);var t,r,n,o=I(a);function a(){var e;M(this,a);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return D(A(e=o.call.apply(o,[this].concat(r))),"state",{seconds:e.props.startSecond,radius:k,durationLeftState:"",increment:100/e.props.startSecond,percent:100/e.props.startSecond}),e}return t=a,(r=[{key:"tick",value:function(){var e=this.state,t=e.seconds,r=e.percent,n=e.increment;if(t<=0)this.setState({radius:0}),this.props.onTimeFinish&&this.props.onTimeFinish(),clearInterval(this.interval);else{var i=k-r/100*k;this.setState((function(e){return{seconds:e.seconds-1,percent:e.percent+n,radius:i}}))}}},{key:"componentDidMount",value:function(){var e=this;this.interval=setInterval((function(){return e.tick()}),1e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"render",value:function(){var e=this.props.isMobile,t=e?"0 1 120 120":"-5 3 120 120",r=e?"16.5":"2.2rem";return i.a.createElement("div",{className:T},i.a.createElement("div",{className:"animationContainer"},i.a.createElement("svg",{width:r,height:r,viewBox:t,style:{transform:"rotate(-90deg)"}},i.a.createElement("circle",{r:49,cy:"58",cx:"60",strokeWidth:"12",stroke:"#486CFF",fill:"none"}),i.a.createElement("circle",{className:"timeCount".concat(" circle_animation"),r:49,cy:"58",cx:"60",strokeWidth:"12",stroke:"#FFFFFF",fill:"none",strokeDasharray:k,strokeDashoffset:this.state.radius})),i.a.createElement("i",null)),i.a.createElement("span",null,"Play next movie in ",this.state.seconds))}}])&&x(t.prototype,r),n&&x(t,n),a}(n.Component),R=function(e){var t=document.getElementsByClassName(e);[].forEach.call(t,(function(e){for(var t=e.innerHTML.split(" ");e.scrollHeight>e.offsetHeight;){if(!(t.length>1))return;t.pop(),e.innerHTML="".concat(t.join(" "),"...")}}))};function O(){var e=function(e,t){t||(t=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["\n   {\n    position: relative;\n    height: calc(100% - 10em);\n    bottom: 0;\n    left: 50%;\n    transform: translateX(-50%);\n    display: block;\n    pointer-events: none;\n    z-index: 103;\n\n    .container {\n      position: absolute;\n      display: block;\n      bottom: 0;\n      right: 2rem;\n      width: 35rem;\n      height: 15.3rem;\n      max-height: 15.3rem;\n      max-width: 35rem;\n      background-color: #1f1f1f;\n      pointer-events: auto;\n    }\n\n    .poster {\n      height: 100%;\n      width: 25%;\n      float: left;\n      display: block;\n    }\n\n    .poster img,\n    .poster div {\n      height: 100%;\n    }\n\n    .content {\n      position: relative;\n      width: 75%;\n      height: 100%;\n      float: right;\n      display: block;\n      padding: 1.4rem 1rem 1rem 1rem;\n      box-sizing: border-box;\n    }\n\n    .title {\n      position: relative;\n      height: 70%;\n      font-size: 1.8rem;\n      line-height: 1.2;\n      font-weight: bold;\n      margin-bottom: 0.5rem;\n      max-height: 4.4rem;\n    }\n\n    .title p {\n      height: 100%;\n      overflow: hidden;\n    }\n\n    .desc {\n      position: relative;\n      height: 40%;\n      font-size: 1.2rem;\n      line-height: 1.3;\n      color: #969696;\n      padding-top: 0.5rem;\n    }\n\n    .desc p {\n      height: 70%;\n      overflow: hidden;\n    }\n\n    .link {\n      display: flex;\n      align-items: flex-end;\n      justify-content: space-between;\n      font-size: 1.2rem;\n      padding-top: 0.5rem;\n      vertical-align: middle;\n      height: 25%;\n      width: calc(100% - 2rem);\n      bottom: 1rem;\n      position: absolute;\n    }\n\n    .play {\n      background-color: rgba(44, 86, 255, 0.8);\n      border-radius: 0.3rem;\n      padding: 0.3rem 0.5rem 0.4rem 1rem;\n      width: 100%;\n      transition: all 0.3s ease-in;\n    }\n\n    .play:hover {\n      background-color: rgba(44, 86, 255, 1);\n      cursor: pointer;\n    }\n\n    .close {\n      color: #808080;\n      border: 1px solid #808080;\n      margin-left: 1rem;\n      border-radius: 0.3rem;\n      vertical-align: middle;\n      padding: 0.6rem;\n      text-align: center;\n      width: 30%;\n      transition: all 0.3s ease-in;\n    }\n\n    .close:hover {\n      color: #fff;\n      cursor: pointer;\n    }\n\n    @media screen and (max-width: 640px) {\n      .container {\n        bottom: 0;\n        right: 0;\n        width: calc(100% - 10px);\n        height: calc(100% - 60px);\n        margin: 0 5px;\n        max-height: 153px;\n        max-width: 350px;\n      }\n\n      .poster {\n        height: 65.25%;\n        width: 50%;\n      }\n\n      .content {\n        width: 50%;\n        height: 65.25%;\n        padding: 10px;\n      }\n\n      .title {\n        font-size: 12px;\n        max-height: 30px;\n      }\n\n      .title p {\n        height: 100%;\n      }\n\n      .desc {\n        font-size: 11px;\n        height: 33px;\n        padding-top: 3px;\n      }\n\n      .desc p {\n        height: 100%;\n      }\n\n      .link {\n        font-size: 11px;\n        align-items: center;\n        height: 34.75%;\n        padding: 0;\n        position: relative;\n        width: 100%;\n        bottom: 0;\n      }\n\n      .play {\n        width: 50%;\n        margin-left: 5px;\n        padding: 5px 5px 5px 8px;\n      }\n\n      .play:hover {\n        cursor: pointer;\n      }\n\n      .close {\n        text-align: center;\n        width: calc(50% - 5px);\n        margin: 0 5px;\n        border-radius: 3px;\n        padding: 6.5px;\n      }\n    }\n\n    @media screen and (max-width: 320px) {\n      .container {\n        height: calc(100% - 60px);\n        max-height: 153px;\n        max-width: 350px;\n      }\n\n      .title {\n        height: 25px;\n      }\n\n      .link {\n        font-size: 9px;\n      }\n\n      .play {\n        padding: 3.5px 4px 3.5px 8px;\n      }\n    }\n  }\n"]);return O=function(){return e},e}var U=Object(S.a)(O());function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function F(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function V(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=K(e);if(t){var i=K(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return G(this,r)}}function G(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?H(e):t}function H(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function K(e){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function W(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(a,e);var t,r,n,o=V(a);function a(){var e;F(this,a);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return W(H(e=o.call.apply(o,[this].concat(r))),"state",{adsHeight:0,adsWidth:0,isFullscreenMobile:!1}),W(H(e),"cancelUpcVideo",(function(t){e.props.handleCancelVideo&&e.props.handleCancelVideo(),t.preventDefault()})),W(H(e),"redirectToNextVideo",(function(e){window&&(window.globalHistory?window.globalHistory.push("/watch?v=".concat(e,"&autoplay=1")):window.location.href="/watch?v=".concat(e,"&autoplay=1"))})),e}return t=a,(r=[{key:"componentDidMount",value:function(){R("upc-video-title"),R("upc-video-desc")}},{key:"render",value:function(){var e=this,t=this.props,r=t.data,n=t.isMobile,o=void 0!==n&&n,a=t.startInterval,s=void 0===a?20:a,u=this.state,c=u.adsWidth,d=(u.adsHeight,u.isFullscreenMobile),p=c?"".concat(c,"px"):"100%",f=o&&!d?{}:{bottom:"0"},h=l()(r,"images.cover[".concat(o?"landscape":"portrait"),"");return i.a.createElement("div",{className:U,style:{width:p}},i.a.createElement("div",{className:"container",style:f},i.a.createElement("div",{className:"poster"},i.a.createElement(E,{src:h})),i.a.createElement("div",{className:"content"},i.a.createElement("div",{className:"title"},i.a.createElement("p",{className:"upc-video-title"},r.title)),i.a.createElement("div",{className:"desc"},i.a.createElement("p",{className:"upc-video-desc"},r.shortDescription)),!o&&i.a.createElement("div",{className:"link"},i.a.createElement("a",{className:"play",onClick:function(){return e.redirectToNextVideo(r.id)}},i.a.createElement(L,{startSecond:s,onTimeFinish:function(){return e.redirectToNextVideo(r.id)}})),i.a.createElement("a",{className:"close",onClick:this.cancelUpcVideo},"Close"))),o&&i.a.createElement("div",{className:"link"},i.a.createElement("a",{className:"play",onClick:function(){return e.redirectToNextVideo(r.id)}},i.a.createElement(L,{isMobile:o,startSecond:s,onTimeFinish:function(){return e.redirectToNextVideo(r.id)}})),i.a.createElement("a",{className:"close",onClick:this.cancelUpcVideo},"Close"))))}}])&&B(t.prototype,r),n&&B(t,n),a}(n.Component),X=r(95).a,q=r(17),Z=r.n(q);function Q(){var e=oe(["\n   {\n    &.fullscreen {\n      position: absolute;\n      top: 0;\n      right: 0;\n      bottom: 0;\n      left: 0;\n      z-index: 1;\n\n      img {\n        width: 100%;\n        height: 100%;\n      }\n    }\n\n    &.wide {\n      position: absolute;\n      top: 2em;\n      right: 2em;\n      z-index: 1;\n\n      img {\n        width: auto;\n        height: 11.4em;\n      }\n    }\n\n    &.square {\n      position: absolute;\n      top: 2em;\n      right: 2em;\n      z-index: 1;\n\n      img {\n        width: auto;\n        height: 11.4em;\n      }\n    }\n  }\n"]);return Q=function(){return e},e}function J(){var e=oe(["\n   {\n    &.playIcon {\n      width: 5rem;\n      height: 5rem;\n      margin: 0 1rem;\n      display: inline-block;\n      background: url(data:image/svg+xml;charset=utf-8;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNSAxNiI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6IzFmOTNmZjt9PC9zdHlsZT48L2RlZnM+PHBhdGggY2xhc3M9ImEiIGQ9Ik0xNTEuMDg4LDI4Ljc3MWwtMTEuMjIzLTYuMTM4YTEuODksMS44OSwwLDAsMC0yLjgwNywxLjYyN1YzNi41MzRhMS44OSwxLjg5LDAsMCwwLDIuODA3LDEuNjI1bDExLjIyMy02LjEzOEExLjg0NiwxLjg0NiwwLDAsMCwxNTEuMDg4LDI4Ljc3MVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMzcuMDU5IC0yMi4zOTYpIi8+PC9zdmc+);\n      background-repeat: no-repeat;\n      background-size: contain;\n      vertical-align: middle;\n      border: none;\n      cursor: pointer;\n\n      @media (max-width: 640px),\n        @media only screen and (orientation: landscape) {\n        width: 44px;\n        height: 44px;\n        margin: 0 10px;\n        display: inline-block;\n        background: url(data:image/svg+xml;charset=utf-8;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNSAxNiI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6IzFmOTNmZjt9PC9zdHlsZT48L2RlZnM+PHBhdGggY2xhc3M9ImEiIGQ9Ik0xNTEuMDg4LDI4Ljc3MWwtMTEuMjIzLTYuMTM4YTEuODksMS44OSwwLDAsMC0yLjgwNywxLjYyN1YzNi41MzRhMS44OSwxLjg5LDAsMCwwLDIuODA3LDEuNjI1bDExLjIyMy02LjEzOEExLjg0NiwxLjg0NiwwLDAsMCwxNTEuMDg4LDI4Ljc3MVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMzcuMDU5IC0yMi4zOTYpIi8+PC9zdmc+);\n        background-repeat: no-repeat;\n        background-size: contain;\n        vertical-align: middle;\n        border: none;\n        cursor: pointer;\n      }\n    }\n  }\n"]);return J=function(){return e},e}function $(){var e=oe(["\n   {\n    top: 50%;\n    left: 50%;\n    position: absolute;\n    min-width: 5rem;\n    background-color: rgba(0, 0, 0, 0.9);\n    padding: 2.3em 1.8em;\n    outline: none !important;\n    border: 0;\n    border-radius: 0.3em;\n    color: white;\n    transform: translate(-50%, -50%);\n    z-index: 2;\n    cursor: pointer;\n  }\n"]);return $=function(){return e},e}function ee(){var e=oe(["\n   {\n    top: 50%;\n    left: 50%;\n    position: absolute;\n    min-width: 5rem;\n    background-color: transparent;\n    outline: none !important;\n    border: 0;\n    color: white;\n    transform: translate(-50%, -50%);\n    z-index: 2;\n    cursor: pointer;\n  }\n"]);return ee=function(){return e},e}function te(){var e=oe(["\n   {\n    position: absolute;\n    height: 100%;\n    width: 100%;\n    z-index: 2;\n\n    img {\n      background-size: cover;\n      position: absolute;\n      margin: auto;\n      top: 0;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      width: 100%;\n      height: 100%;\n    }\n  }\n"]);return te=function(){return e},e}function re(){var e=oe(["\n   {\n    position: relative;\n    z-index: 2;\n    height: 12.3935%;\n    cursor: pointer;\n    display: block;\n    margin: auto;\n    width: auto;\n  }\n"]);return re=function(){return e},e}function ne(){var e=oe(["\n   {\n    opacity: 1;\n    transition: all 300ms ease-in-out;\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    max-width: 100vw;\n    width: 100%;\n    height: 100%;\n    max-width: 100%; /* important to prevent greater than video width itself */\n    max-height: 100%; /* important to prevent greater than video height itself */\n    margin: auto;\n    z-index: 1;\n  }\n"]);return ne=function(){return e},e}function ie(){var e=oe(["\n   {\n    position: relative;\n    height: 100%;\n    width: 100%;\n    user-select: none;\n    color: #ffffff;\n    background: #000000;\n    font-size: 1rem;\n\n    &.fullscreen {\n      font-size: 1.8rem;\n\n      @media only screen and (max-width: 840px) {\n        font-size: 12px;\n      }\n    }\n\n    code {\n      font-size: 1.4rem;\n      line-height: 1.4;\n      white-space: pre-line;\n      color: rgb(255, 255, 255);\n      font-family: 'Public Sans', sans-serif;\n\n      @media (max-width: 640px) {\n        font-size: 12px;\n      }\n    }\n\n    video {\n      display: inherit;\n      max-width: 100%;\n      margin: auto;\n    }\n  }\n"]);return ie=function(){return e},e}function oe(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var ae,se=Object(S.a)(ie()),le=Object(S.a)(ne()),ue=Object(S.b)("img")(re()),ce=Object(S.b)("div")(te()),de=Object(S.b)("div")(ee()),pe=Object(S.b)("div")($()),fe=Object(S.b)("div")(J()),he=Object(S.b)("div")(Q());function me(e){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ge(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return ye(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ye(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ve(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_e(Object(r),!0).forEach((function(t){Ce(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ee(e,t,r,n,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,i)}function Se(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){Ee(o,n,i,a,s,"next",e)}function s(e){Ee(o,n,i,a,s,"throw",e)}a(void 0)}))}}function be(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Te(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function we(e,t){return(we=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Ie(e);if(t){var i=Ie(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return xe(this,r)}}function xe(e,t){return!t||"object"!==me(t)&&"function"!=typeof t?Pe(e):t}function Pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ie(e){return(Ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ce(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Ae={id:a.a.string.isRequired,title:a.a.string,poster:a.a.string,children:a.a.node,bugLogo:a.a.object,isPlayButtonDisabled:a.a.bool,recommendation:a.a.object,playerConfig:a.a.object},Ne=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&we(e,t)}(s,e);var t,r,n,o,a=Me(s);function s(){var e;be(this,s);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return Ce(Pe(e=a.call.apply(a,[this].concat(r))),"state",{isHover:!1,isLoading:!0,isPlaying:!1,isError:!1,errorMsg:"",hasNextVideo:!0,hasPlayButton:!1,banner:{id:"",link:"",mediaURL:""},isPreroll:!1,ads:[],autoplayEnabled:!1}),Ce(Pe(e),"loadPlayer",(function(){Z.a.polyfill.installAll(),Z.a.Player.isBrowserSupported()?(e.initPlayer(),e.handleUserIdle()):(console.error("Browser not supported!"),that.onError({customMsg:"DISMISSED: Browser not supported!"}))})),Ce(Pe(e),"handleUserIdle",(function(){var t=Pe(e);clearInterval(ae),ae=setInterval((function(){document.cookie.includes("__idleSessionId")||t.setState({isHover:!1})}),1e3)})),Ce(Pe(e),"handleOnAdsImpression",(function(e){e&&fetch(e.impression,{method:"GET",mode:"no-cors",credentials:"include",headers:{Origin:"https://mst.cx"}}).then((function(e){return console.log(e.status)})).catch((function(e){return console.log("Error: ads impressions failed ",e)}))})),Ce(Pe(e),"getTimeFormatToSecond",(function(e){var t=e.split(":"),r={4:86400,3:3600,2:60,1:1};return r=r[t.length],t.reduce((function(e,t){var n=e+parseInt(t,10)*r;return r/=60,n}),0)})),Ce(Pe(e),"initPreroll",Se(regeneratorRuntime.mark((function t(){var r,n,i,o,a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(n=e.state.ads).length>0&&(i=n.map((function(t){if(!1===t.isPlayed&&e.player)if("start"===t.timeOffset){if(0==e.player.totalWatchTime)return r=t,ve(ve({},t),{},{isPlayed:!0})}else if(e.getTimeFormatToSecond(t.timeOffset)==e.player.totalWatchTime)return r=t,ve(ve({},t),{},{isPlayed:!0});return t})),r&&(o={manifestUri:r.mediafile,startTime:0},e.player?(e.handleInitPlayer(e.player,o),e.player.isPreroll=!0):(a=document.getElementById("video-main-".concat(e.props.id)),(s=new Z.a.Player(a)).isPreroll=!0,e.handleInitPlayer(s,o)),e.handleOnAdsImpression(r),e.setState({ads:i,isPreroll:!0})));case 2:case"end":return t.stop()}}),t)})))),Ce(Pe(e),"initPlayer",Se(regeneratorRuntime.mark((function t(){var r,n,i,o,a,s,u,c,d,p,f,h,m,g,y,_;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=l()(e.props,"drm",""),n=l()(e.props,"streamSourceUrl",""),i=l()(e.player,"totalWatchTime",0),o=Number(l()(e.props,"watchTimePosition",0)),a=document.getElementById("video-main-".concat(e.props.id)),s=e.player||new Z.a.Player(a),0===i&&o>0&&(i=o),u=/.*Version.*Safari.*/.test(navigator.userAgent),c=i>0&&!isNaN(i)?i:0,!r||!r.drmEnabled){t.next=28;break}if(d=u?r.fairplay.streamUrl:r.widevine.streamUrl,p=d||e.props.streamSourceUrl,f=e.props.deviceId,u){t.next=15;break}h={manifestUri:p,drm:{servers:{"com.widevine.alpha":"".concat(r.widevine.licenseUrl,"?deviceId=").concat(f),"com.microsoft.playready":"".concat(r.playready.licenseUrl,"?deviceId=").concat(f),"com.apple.fps.1_0":"".concat(r.fairplay.licenseUrl,"?deviceId=").concat(f)}},startTime:c},e.handleInitPlayer(s,h),t.next=26;break;case 15:return t.next=17,fetch(r.fairplay.certificateUrl);case 17:if((m=t.sent).ok){t.next=21;break}return console.log("Failed to retrieve fairplay certificate"),t.abrupt("return");case 21:return t.next=23,m.arrayBuffer();case 23:g=t.sent,y={manifestUri:p,drm:{servers:{"com.widevine.alpha":"".concat(r.widevine.licenseUrl,"?deviceId=").concat(f),"com.microsoft.playready":"".concat(r.playready.licenseUrl,"?deviceId=").concat(f),"com.apple.fps.1_0":"".concat(r.fairplay.licenseUrl,"?deviceId=").concat(f)},advanced:{"com.apple.fps.1_0":{serverCertificate:new Uint8Array(g)}}},startTime:c},e.handleInitPlayer(s,y);case 26:t.next=29;break;case 28:""!==n?(_={manifestUri:n,startTime:c},e.handleInitPlayer(s,_)):console.log("Stream source not found");case 29:return t.abrupt("return",!0);case 30:case"end":return t.stop()}}),t)})))),Ce(Pe(e),"handleInitPlayer",(function(t,r){var n=Pe(e),i=r.manifestUri,o=r.startTime,a={timeout:1e4,maxAttempts:2,baseDelay:1e3,backoffFactor:1,fuzzFactor:.5};delete r.manifestUri,delete r.startTime,t.getNetworkingEngine().registerResponseFilter((function(e,t){return t.headers["Access-Control-Allow-Origin"]="*",t})),t.configure(ve(ve({},r),{},{abr:{enabled:!1},manifest:{retryParameters:a},streaming:{retryParameters:a},availabilityWindowOverride:300}));try{t.unload().then((function(){t.load(i,o).then((function(){var e=t.getMediaElement();e.volume=n.props.volume,e.muted=n.props.muted;for(var r=0;r<e.textTracks.length;r++)e.textTracks[r].mode="hidden";console.log("player loaded"),n.setState({isLoading:!1,hasPlayButton:!0}),t.reset=function(e){e&&n.setState({isError:!0,errorMsg:e}),t.unload(),n.player=null,window["player".concat(n.props.id)]=null},n.player||(n.player=t,window["player".concat(n.props.id)]=t,n.handlePlayerEventListener(t),console.log("Player Controls loaded and ready"),n.childRefs&&(n.childRefs.addEventListener("mouseenter",n.handleOnMouseMove),n.childRefs.addEventListener("mousemove",n.handleOnMouseMove),n.childRefs.addEventListener("mouseout",n.handleOnMouseExit)))})).catch(n.onError)}))}catch(e){console.warn("Error: player load failed ",e)}})),Ce(Pe(e),"handleInitPreroll",(function(){var t=Pe(e);try{var r=e.props.adsSource||"";r&&c.a.get(r).then((function(e){return 200==e.status&&e.data?e.data:null})).then((function(e){e&&v(e).then((function(e){var r=e.map((function(e){return ve(ve({},e),{},{isPlayed:!1})}));r.length>0&&t.setState({ads:r})}))}))}catch(e){console.log("Error: fetch preroll API failed ",e)}})),Ce(Pe(e),"handleInitBanner",(function(){try{var t=e.props.adsBannerUrl||"";t&&c.a.get(t).then((function(t){if(200===t.status){var r=l()(t,"data.data.data[0]",{});["89","93","97","101","105","109"].includes(r.id)?e.handleInitBanner():e.setState({banner:{id:r.id,link:r.link,mediaURL:r.mediaURL}})}}))}catch(e){console.warn("Error: fetch banner API failed ",e)}})),Ce(Pe(e),"onErrorEvent",(function(t){e.onError(t.detail)})),Ce(Pe(e),"onError",(function(t){t.category;var r=t.code,n=(t.data,t.severity,t.message,e.props.errorCodes);console.error("Player error: ",t),e.props.handleVideoError&&e.props.handleVideoError(t),e.player&&e.player.reset(),e.setState({isError:!0,errorMsg:t.customMsg||"".concat(l()(n,"".concat(r),"Silahkan refresh browser anda dalam beberapa saat lagi"),"  ").concat(r," ")})})),Ce(Pe(e),"handlePlayerEventListener",(function(t){var r,n=Pe(e);r=setInterval((function(){t&&t.getLoadMode&&t.getLoadMode()>1&&clearInterval(r)}),500),t.addEventListener("error",n.onErrorEvent);var i=t&&t.getMediaElement();if(i){if(n.props.subtitles&&n.props.subtitles.length>0){var o,a=ge(n.props.subtitles);try{var s=function(){var e=o.value;if(e.label&&""==e.label.trim())return{v:void 0};var t=i.addTextTrack("metadata",e.label,e.country);c.a.get(e.src).then((function(e){200==e.status&&e.data&&f(e.data).map((function(e){var r=new VTTCue(e.start/1e3,e.end/1e3,e.text);window.cue=r,t.addCue(r)}))})).catch((function(e){return console.log("Error: fetch subtitle failed ",e)}))};for(a.s();!(o=a.n()).done;){var l=s();if("object"===me(l))return l.v}}catch(e){a.e(e)}finally{a.f()}}var u=[],d=0,p=0;i.addEventListener("play",(function(e){n.props.handleOnPlayCallback&&n.props.handleOnPlayCallback(n.player),d||(n.player.totalWatchTime=u.length,n.props.handleVideoWatchTime&&n.props.handleVideoWatchTime(n.player),d=1),n.durationInterval=setInterval((function(){var e=n.player,t=e&&e.getMediaElement();t&&!n.state.isPreroll&&(p=Math.floor(t.currentTime),-1===u.indexOf(p)&&(u.length%30==0&&n.handleInitBanner(),n.initPreroll(),u.push(p)),n.player.levels_=e&&e.getVariantTracks(),n.player.totalWatchTime=u.length),n.props.handleVideoWatchTime&&n.props.handleVideoWatchTime(e)}),1e3)})),i.addEventListener("pause",(function(){clearInterval(n.durationInterval),n.props.handleVideoPause&&n.props.handleVideoPause(t)})),i.addEventListener("ended",(function(){clearInterval(n.durationInterval),n.props.handleVideoEnded&&n.props.handleVideoEnded(t),n.player.isPreroll&&n.setState({isPreroll:!1},(function(){n.initPlayer(),n.player.isPreroll=!1}))})),i.addEventListener("durationchange",(function(e){clearInterval(n.durationInterval),n.props.handleDurationChange&&n.props.handleDurationChange(t)})),i.addEventListener("volumechange",(function(e){n.props.handleOnVideoVolumeChange&&n.props.handleOnVideoVolumeChange(t)})),n.props.autoPlay&&n.handlePlayButton()}})),Ce(Pe(e),"handlePlayButton",(function(){if(e.props.handleOnPlayCallback&&e.props.handleOnPlayCallback(e.player),!e.props.isPlayerBlocked&&e.player){var t=e.player,r=t&&t.getMediaElement(),n=e.state.ads;r&&e.setState({isPlaying:!0,autoplayEnabled:!0},(function(){var t=n.filter((function(e){return"start"===e.timeOffset}))[0];t&&!t.isPlayed?(e.player.totalWatchTime=0,e.initPreroll()):r.play()}))}})),Ce(Pe(e),"handleSubtreeOnChange",(function(){var t=l()(document.getElementById("video-main-".concat(e.props.id)),"offsetHeight",""),r=l()(document.getElementsByClassName(le),"[0]","");t&&r&&(r.style.height="".concat(t,"px"),r.style.width="".concat(16*t/9,"px"))})),Ce(Pe(e),"handleOnMouseExit",(function(t){e.setState({isHover:!1})})),Ce(Pe(e),"handleOnMouseMove",(function(t){document.cookie="__idleSessionId=mola; max-age=".concat(5,"; path=/;"),e.state.isHover||e.setState({isHover:!0})})),Ce(Pe(e),"handleCancelUpcVideo",(function(t){e.setState({hasNextVideo:!1})})),Ce(Pe(e),"renderNextVideo",(function(t){if(e.player){var r=l()(e.props,"recommendation",null);return r&&t&&!e.player.isLive()?i.a.createElement(Y,{data:r,handleCancelVideo:e.handleCancelUpcVideo,startInterval:10}):i.a.createElement("div",null)}})),Ce(Pe(e),"renderBugLogo",(function(t){var r="";return 3===t.type?r="fullscreen":2===t.type?r="wide":1===t.type&&(r="square"),i.a.createElement(he,{className:r},i.a.createElement("img",{id:"video-bug-logo-".concat(e.props.id),src:t.image,alt:"Bug-logo Player"}))})),e}return t=s,(r=[{key:"componentDidMount",value:(o=Se(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("componentDidMount",this.props,window),!window){e.next=12;break}return window["playerProps".concat(this.props.id)]=this.props,e.next=5,this.handleInitPreroll();case 5:if(console.log(window,window.shaka),!Z.a){e.next=11;break}return e.next=9,this.loadPlayer();case 9:e.next=12;break;case 11:console.log("Shaka not found");case 12:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){this.durationInterval&&clearInterval(this.durationInterval),this.childRefs&&(this.childRefs.removeEventListener("mouseenter",this.handleOnMouseMove),this.childRefs.removeEventListener("mousemove",this.handleOnMouseMove),this.childRefs.removeEventListener("mouseout",this.handleOnMouseExit)),this.player&&(this.player.getNetworkingEngine().clearAllResponseFilters(),this.player=null,window["player".concat(this.props.id)]=null),clearInterval(ae)}},{key:"render",value:function(){var e=this,t=this.state,r=t.isLoading,n=t.isError,o=t.isPlaying,a=t.isPreroll,s=t.errorMsg,u=t.isHover,c=t.hasNextVideo,d=t.hasPlayButton,p=t.banner,f=t.autoplayEnabled,h=this.props,m=h.id,g=(h.title,h.poster),y=h.children,_=h.isPlayButtonDisabled,v=h.recommendation,E=h.playerConfig,S=void 0===E?{}:E,b={type:l()(this.props,"bugLogo.attributes.logoType",null),image:l()(this.props,"bugLogo.attributes.imageURL",null)},T=this.player,w=T&&T.getMediaElement(),M=this.player&&!this.player.isPreroll&&this.player.isBuffering(),x=ve({togglePlayPauseEnabled:!0,toggleFullscreenEnabled:!0,toggleMuteEnabled:!0,seekBarEnabled:!0,volumeBarEnabled:!0,nextVideoEnabled:!0,keyboardShortcutsEnabled:!0,preferredTextLanguage:"id"},S),P=this.player&&!this.player.isPreroll&&!this.player.isLive()&&w&&w.duration-w.currentTime<=10&&x.nextVideoEnabled;this.handleSubtreeOnChange();var I=l()(document.getElementById("video-context-".concat(m)),"offsetHeight",0)-l()(document.getElementById("video-banner-".concat(m)),"height",0),C=document&&document.fullscreenElement;return i.a.createElement("div",{ref:function(t){return e.childRefs=t},id:"video-context-".concat(m),className:"".concat(se," ").concat(C?"fullscreen":"")},!o&&g&&i.a.createElement(ce,null,i.a.createElement("img",{id:"video-poster-".concat(m),src:g})),!o&&i.a.createElement(de,null,r&&!n&&!_&&i.a.createElement("code",null,"Loading . . ."),!n&&d&&!_&&i.a.createElement(fe,{className:"playIcon",onClick:function(){return e.handlePlayButton()}})),n&&i.a.createElement(pe,null,i.a.createElement("code",null,s)),i.a.createElement("video",{id:"video-main-".concat(m),autoPlay:f,style:{width:16*I/9,height:I}}),p&&p.mediaURL&&this.player&&!a&&i.a.createElement(ue,{id:"video-banner-".concat(m),alt:"banner-".concat(p.id),src:p.mediaURL,onClick:function(){return window.open(p.link)},onError:function(){return e.setState({banner:null})}}),this.player&&o&&i.a.createElement("div",{className:le,id:"video-child"},this.renderBugLogo(b),y,M&&u&&i.a.createElement(de,null,i.a.createElement("code",null,"Buffering . . .")),i.a.createElement(X,{id:m,player:this.player,isPreroll:a,isHover:u,config:x,recommendation:v}),P&&this.renderNextVideo(c)))}}])&&Te(t.prototype,r),n&&Te(t,n),s}(n.Component);Ne.propTypes=Ae,Ne.defaultProps={playerConfig:{togglePlayPauseEnabled:!0,toggleFullscreenEnabled:!0,toggleMuteEnabled:!0,seekBarEnabled:!0,volumeBarEnabled:!0,nextVideoEnabled:!0,keyboardShortcutsEnabled:!0,preferredTextLanguage:"id"}};t.default=Ne}]);